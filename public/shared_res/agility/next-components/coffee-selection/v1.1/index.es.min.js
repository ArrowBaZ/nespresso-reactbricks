const e=e=>t(JSON.stringify(e)),t=e=>e?e.toString().replace(/"/g,"&quot;").replace(/'/g,"&apos;"):"",n=e=>{const t=(e=>e.find((e=>"data"===e.nodeName)))([...e]),n=[...e].filter((e=>"data"!==e.nodeName)).reduce(((e,t)=>({...e,[t.nodeName]:t.nodeValue})),{});if(i(t))return n;try{return{...n,...JSON.parse(t.nodeValue)}}catch(e){console.log("ERROR: No data",e)}},i=e=>null==e,s=e=>window.napi.catalog().getProduct(e);window.gtmDataObject=window.gtmDataObject||[];const r=e=>{window.gtmDataObject.push({event:"impression",eventRaisedBy:"Web component",eventAction:"Promo Impression - On Scroll",ecommerce:{},...e})};class a extends class{constructor(e,t){this.observer=new IntersectionObserver((e=>this.onChange(e)),{threshold:[0],rootMargin:"0% 0%"}),this.el=e,this.data=t,this.el instanceof Element&&this.observer.observe(this.el)}onChange(e){e.forEach((e=>{e.isIntersecting&&(this.track(e),this.observer.unobserve(e.target))}))}track(){window.requestIdleCallback((()=>this.runTrack()))}runTrack(){this.data.id&&null!==this.data.id&&""!==this.data.id&&r({ecommerce:{promoView:{promotions:[this.data]}}})}}{constructor(e,t){super(e),this.data=t}runTrack(){this.data.id&&null!==this.data.id&&""!==this.data.id&&r({ecommerce:{promoView:{promotions:[this.data]}}})}}class o extends HTMLElement{constructor(){super(),this.template=""}connectedCallback(){this.props=this._createProps(),this.onStart?.(),this.loadTemplate(),this.onReady?.()}_createProps(e=null){const t=e||this.attributes;let n;try{n=[...t].reduce(((e,t)=>({...e,[t.nodeName]:t.nodeValue})),{});const e=[...t].find((e=>"data"===e.nodeName));return null==e?n:{...n,...JSON.parse(e.nodeValue)}}catch(e){console.log("ERROR: No data",e)}}render(e=!1){e&&(this.innerHTML="");const t=(e,n)=>{const i=e=>3===e.nodeType?"text":8===e.nodeType?"comment":e.tagName.toLowerCase(),s=e=>e.childNodes&&e.childNodes.length>0?null:e.textContent;var r=Array.prototype.slice.call(n.childNodes),a=Array.prototype.slice.call(e.childNodes),o=r.length-a.length;if(o>0)for(;o>0;o--)r[r.length-o].parentNode.removeChild(r[r.length-o]);a.forEach((function(e,a){if(r[a])if(i(e)===i(r[a])){var o=s(e);if(o&&o!==s(r[a])&&(r[a].textContent=o),r[a].childNodes.length>0&&e.childNodes.length<1)r[a].innerHTML="";else{if(r[a].childNodes.length<1&&e.childNodes.length>0){var c=document.createDocumentFragment();return t(e,c),void r[a].appendChild(c)}e.childNodes.length>0&&t(e,r[a])}}else r[a].parentNode.replaceChild(e.cloneNode(!0),r[a]);else n.appendChild(e.cloneNode(!0))}))},n=(i=this.template,(new DOMParser).parseFromString(i,"text/html").body);var i;t(n,this)}loadTemplate(e="",t=!1){this.template=""===e?this.template:`${e}`,this.render(t)}disconnectedCallback(){this.onDestroy?.()}}customElements.get("nb-nespresso-element")||customElements.define("nb-nespresso-element",o);const c={get is(){const{innerWidth:e,devicePixelRatio:t}=window;return{mobile:e<768,mobile_tablet:e<1024,tablet:e>=768&&e<1024,desktop:e>=1024&&t<=1,retina:e>=1024&&t>1}},lt:e=>window.innerWidth<e},l={getResponsiveSrc:e=>{const t=(n=e,Array.isArray(n)||"object"==typeof n?["mobile","tablet","desktop","retina"].find((e=>!0===c.is[e]&&e in n&&""!==n[e])):null);var n;return t?e[t]:e.desktop}};class d extends HTMLElement{constructor(){super(),this.boundHandleClick=this.handleClick.bind(this)}connectedCallback(){this.props=n(this.attributes),this.render(),this.initTracking()}setContrast(){const{contrast:e="light"}=this.props.layout;this.contrast=e,this.setAttribute("contrast",this.contrast)}createClasses(){const e=Object.keys(c.is).filter((e=>c.is[e])).join(" ");return["nb-card",`nb-card--${this.contrast}`,`${e}`].join(" ")}createStyles(){const{background:e}=this.props.layout,t=e?l.getResponsiveSrc(e):"";return e?`style="background-image: url('${t}')"`:""}render(){this.setContrast();const e=c.is.tablet?this.renderTablet():this.renderDefault(),t=this.createClasses(),n=this.createStyles();this.innerHTML=`<div class="${t}" ${n}>\n                            ${e}\n                         </div>`,this.applyClassHelpers(),this.cta=this.querySelector(".nb-card__cta"),this.bindEvents()}applyClassHelpers(){}renderDefault(){return`${this.renderHeading()}\n                ${this.renderText()}\n                ${this.renderVisual()}\n                ${this.renderActions()}\n                ${this.renderPopin()}`}renderTablet(){return`${this.renderVisual()}\n                <div class="nb-card__tabletRightCol">\n                    ${this.renderHeading()}\n                    ${this.renderText()}\n                    ${this.renderActions()}\n                    ${this.renderPopin()}\n                </div>`}renderHeading(){const{heading:e=""}=this.props.copywriting;return e&&`<h2 class="nb-card__heading">${e}</h2>`}renderText(){const{text:e=""}=this.props.copywriting;return e&&`<p  class="nb-card__body">${e}</p>`}renderVisual(){const{src:e="",alt:t=""}=this.props.copywriting.visual;return e&&`<img loading="lazy" class="nb-card__visual" src="${e}" alt="${t}" />`}renderActions(){const{cta:e={}}=this.props.copywriting,{label:t=""}=e,{copywriting:{popin:n={}}={}}=this.props,{text:i=""}=n;return""!==t||i?`<div class='nb-card__actions'>\n                    ${this.renderCta()}\n                    ${this.renderLink()}\n                </div>`:""}renderCta(){const{cta:t={}}=this.props.copywriting,{label:n=""}=t;if(""===n)return"";const{campaign:i}=this.props;if(i){const{id:e,name:n,creative:s,position:r}=i;t.campaign_id=e,t.campaign_name=n,t.campaign_creative=s,t.campaign_position=r}return`<nb-cta class="nb-card__cta" data="${e(t)}">${n}</nb-cta>`}renderLink(){const{copywriting:e,campaign:t}=this.props,{popin:n={}}=e,{id:i="",text:s=""}=n;return s?`\n            <nb-link\n                campaign_id="${t.id||""}"\n                campaign_name="${t.name||""}"\n                campaign_position="${t.position||""}"\n                campaign_creative="${t.creative||""}"\n                size="xsmall"\n                color="${"light"===this.contrast?"black":"white"}"\n                popin_id="${i}"\n                class="nb-card__link"\n            >${s}</nb-link>\n        `:""}renderPopin(){const{copywriting:{popin:e={}}={}}=this.props,{id:t="",image:n="",heading:i="",description:s="",image_alt:r="",close:a=""}=e;return t&&`<nb-popin\n                id="${t}"\n                heading="${i}"\n                variation="next"\n                bgcolor="highlight"\n                label_close="${a}"\n            >\n                ${n&&`<div class="popin-header-img"><img\n                        loading="lazy"\n                        src="${n}"\n                        alt="${r}"\n                        title="${r}"\n                        width="300"\n                        height="225"\n                    /></div>\n                `}\n                ${s}\n            </nb-popin>`}initTracking(){const{campaign:e}=this.props;if(!e)return;const{id:t,name:n,creative:i,position:s}=e;!function(e,t){const n=new a(e,t)}(this,{id:t,name:n,position:s,creative:i})}handleClick(){this.querySelector(".nb-card__cta > *").click()}bindEvents(){if(this.unbindEvents(),this.cta){const e=document.createElement("div");e.classList.add("nb-card__overlay");const t=this.querySelector(".nb-card__actions");t.parentNode.insertBefore(e,t),e.addEventListener("click",this.boundHandleClick)}}unbindEvents(){this.cta&&this.removeEventListener("click",this.boundHandleClick)}disconnectedCallback(){this.unbindEvents()}}customElements.get("nb-card")||customElements.define("nb-card",d);class p extends HTMLElement{constructor(){super(),this.props={}}connectedCallback(){this.props=n(this.attributes),this.render()}render(){const{intensity_label:e="Intensity",a11y_intensity_max:t,max_intensity:n}=this.props,i=parseInt(this.props.intensity);if(!i||isNaN(i))return"";const s=t.replace("{max_intensity}",n);this.innerHTML=`\n            <div aria-label="${e} ${i} ${s}">\n                ${e}${this.renderIntensityMin(i)}\n                ${i}\n                ${this.renderIntensityMax(i)}\n            </div>\n        `}renderIntensityMin(e){return new Array(Math.max(e,0)-0).fill('<span class="bar filled"></span>').join("")}renderIntensityMax(e){let{max_intensity:t}=this.props;return t&&"undefined"!==t||(t=14),new Array(parseInt(t)-Math.min(e,parseInt(t))).fill('<span class="bar"></span>').join("")}}customElements.get("nb-intensity")||customElements.define("nb-intensity",p);class h extends HTMLElement{connectedCallback(){this.props=n(this.attributes),this.render()}render(){const{icon:e,icon_size:t="",label:n,classname:i="t-2xs-500",sub_label:s="",sub_classname:r=""}=this.props;this.innerHTML=`\n            <nb-icon icon="${e}"></nb-icon>\n            <p class="${i}">\n                ${n}\n                ${s&&`<span>${s}</span>`}\n            </p>\n        `,""!==r&&this.querySelector("span").classList.add(r),""!==t&&this.style.setProperty("--icon-size",t/16+"rem")}}customElements.get("nb-icon-text")||customElements.define("nb-icon-text",h);customElements.get("nb-coffee-selection-item")||customElements.define("nb-coffee-selection-item",class extends d{render(){this.classList.add("nb-coffee-selection-item"),super.render()}renderDefault(){return this.applyLayoutSettings(),`<div class="nb-coffee-selection-item--content">\n                    ${this.renderHeading()}\n                    ${this.renderText()}\n                    ${this.renderIntensity()}\n                    ${this.renderActions()}\n                    ${this.renderIconTextRow()}\n                    ${this.renderPopin()}\n                </div>\n                ${this.renderVisual()}`}renderTablet(){return this.renderDefault()}renderLink(){const{contrast:e="light"}=this.props.layout,{copywriting:{popin:t={}}={}}=this.props,{id:n="",text:i=""}=t;return i?`\n            <nb-link\n                size="small"\n                color="${"light"===e?"gold":"white"}"\n                popin_id="${n}"\n                class="nb-card__link"\n            >${i}</nb-link>\n        `:""}applyClassHelpers(){this.querySelector(".nb-card__heading")?.classList.add("t-md-700-sl"),this.querySelector(".nb-card__body")?.classList.add("t-sm-400")}applyLayoutSettings(){const{background_color:e="",image_position:t}=this.props.layout;""!==e&&this.classList.add(`nb-coffee-selection-item--${e}`),"reverse"===t&&this.classList.add("nb-coffee-selection-item-reverse")}renderIntensity(){const{intensity:e,a11y_intensity_max:t,intensity_label:n}=this.props.copywriting;return`<nb-intensity\n                class="t-xs-500-sl nb-card__intensity"\n                intensity="${e}"\n                a11y_intensity_max="${t}"\n                intensity_label="${n}">\n            </nb-intensity>`}renderIconTextRow(){const{icon_text_row:e}=this.props.copywriting;return e&&e.length?e.map((e=>`<nb-icon-text\n                class="nb-card__iconTextRow"\n                icon="${e.icon_left}"\n                label="${e.label}"\n                classname="t-xs-500-sl">\n            </nb-icon-text>`)).join(""):""}});class u extends HTMLElement{constructor(){super(),this.products=[]}connectedCallback(){this.props=n(this.attributes),this.loadProducts().then((()=>{this.render()}))}loadProducts(){const{products:e}=this.props.copywriting;return this.products=e,new Promise((e=>{try{(function(e){const t=[];if(!window.napi)return Promise.reject();Array.isArray(e)||(e=[e]);for(const n of e)t.push(s(n).then((t=>e.splice(e.indexOf(n),1,t))).catch((()=>{e.splice(e.indexOf(n),1),console.error(`getProduct fail on sku ${n}`)})));return Promise.all(t)})(this.products).finally((()=>e()))}catch(e){console.error(e)}}))}render(){const{layout:e,campaign:t}=this.props;this.innerHTML=`\n            <nb-container\n                contrast="${e.contrast}"\n                background_color="${e.background_color}"\n                classname='${e.padding_top} ${e.padding_bottom}'\n                campaign_id='${t.id}'\n                campaign_name='${t.name}'\n                campaign_position='${t.position}'\n                campaign_creative='${t.creative}'>\n                ${this.renderHeading()}\n                ${this.renderCards()}\n            </nb-container>\n        `}renderHeading(){const{heading:e}=this.props.copywriting;return e?`<h2 class='h-2xl-300-sl'>${e}</h2>`:""}renderCards(){return this.products&&this.products.length?`<div class='cb-grid'>${this.products.map((e=>this.renderCard(e))).join("")}</div>`:""}renderCard(t){const{options:n}=this.props.copywriting,{intensity_label:i,a11y_intensity_max:s,max_intensity:r}=n,a=s.replace("{max_intensity}",r),o=[];if(t.capsuleCupSizes&&t.capsuleCupSizes.length&&o.push({size:"medium",color:"black",icon_left:"capsule-cupSize-lungo",label:t.capsuleCupSizes.join(", ")}),t.capsuleProductAromatics&&t.capsuleProductAromatics.length){const e=t.capsuleProductAromatics.map((e=>e[0].toUpperCase()+e.substring(1).toLowerCase()));o.push({size:"medium",color:"black",icon_left:"notes-default",label:e.join(", ")})}const c={campaign:{},layout:{image_position:"reverse",background_color:"highlight-040"},copywriting:{heading:t.name||"",text:t.headline||"",visual:{src:t.images?.icon||"",alt:t.images?.altText||t.name||""},intensity:t.capsuleProperties?.intensity,intensity_label:i,a11y_intensity_max:a,icon_text_row:o}};return`<nb-coffee-selection-item data="${e(c)}"></nb-coffee-selection-item>`}}customElements.get("nb-coffee-selection")||customElements.define("nb-coffee-selection",u);export{u as default};
