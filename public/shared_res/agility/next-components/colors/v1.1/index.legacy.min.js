const e=e=>{const s=(e=>e.find((e=>"data"===e.nodeName)))([...e]),n=[...e].filter((e=>"data"!==e.nodeName)).reduce(((e,t)=>({...e,[t.nodeName]:t.nodeValue})),{});if(t(s))return n;try{return{...n,...JSON.parse(s.nodeValue)}}catch(e){console.log("ERROR: No data",e)}},t=e=>null==e,s=({eventName:e,args:t,element:s})=>{let n;s=s||window,t?n=new CustomEvent(e,{detail:t,bubbles:!0}):"function"==typeof Event?n=new Event(e):(n=document.createEvent("Event"),n.initEvent(e,!0,!0)),s.dispatchEvent(n)},n=async e=>{const t=await(e=>window.napi.catalog().getProduct(e))(e),s=t?t.supercategories:[];return await Promise.all(s.map((async e=>await window.napi.catalog().getCategory(e))))};var r=(()=>{const e=window.napi&&window.napi.catalog,t=window.napi&&window.napi.ratings,s=window.napi&&window.napi.priceFormat;let r=null;const a=async t=>await e().getProduct(t),o=async(e,t)=>{try{return await i(e,t)}catch(t){throw console.error(`Fetch for product ${e.sku} failed: ${t}`),t}},i=async(e,t)=>{const{api_override:{name:s="",headline:r="",description:o=""}={}}=e,i=c(e),m=await a(e.sku),g=await n(e.sku),C={name:""!==s?s:m.name,headline:""!==r?r:m.headline,description:""!==o?o:m.description,longSku:m?m.id:null,price:m?m.price:null,pdp_urls:p(m,"pdpURLs"),images:m.images,slides:m.slides,technologies:m.technologies,type:m.type,productCategories:g};if(t&&e.productRatings?.ratingEnabled&&(C.rating=await u(e,m)),"capsule"===i&&(C.bundled=m.bundled,C.intensity=m.capsuleProperties?.intensity||0,C.unit_quantity=d(m,"unitQuantity",1),C.sales_multiple=d(m,"salesMultiple",10)),"giftcard"===i){if(!e.variant.giftcard_price)throw"Gift Card amount price is not defined.";C.price=h(e.variant.giftcard_price),C.images={icon:e.variant.default_image}}return{...l(e,m),...C}},l=(e,t,s=!1)=>{const n={...e};if(!t)return n;for(const e of Object.keys(n)){const r=""===n[e]||"0"===n[e];e in t&&(r||s)&&(n[e]=t[e])}return n},c=({variant:e})=>{const t=Object.keys(e).find((e=>e.includes("is_")));return t?t.split("_")[1]:""},d=(e,t,s)=>parseInt(e&&e[t]||s),p=(e,t)=>e&&Object.keys(e[t]).length>0?e[t]:{},u=async({sku:e},s)=>{if(!t||s&&s.productRatings&&!s.productRatings.ratingEnabled)return m(0,1);try{const{ratingAverage:s=0}=await t().summary(e);return m(0!==s?s:0,1)}catch(t){return console.error(`Product rating fetch failed on sku ${e}`,t),m(0,1)}},h=e=>{const{short:t}=r;return t((()=>{const{dataLayer:e={}}=window[window.config.padl.namespace];return e.app?.app?.currency})(),e)},m=(e,t=2)=>parseFloat(e).toFixed(t);return{loadPriceFormat:async()=>{r=await s()},getApiProduct:a,getAll:(e,t)=>Promise.all(e.map((async s=>{try{const n=await o(s,t);e.splice(e.indexOf(s),1,n)}catch(t){e.splice(e.indexOf(s),1)}}))),getOne:o,fetchOne:i,merge:l,formatPrice:h}})();class a extends HTMLElement{connectedCallback(){this.props=e(this.attributes),this.render(),this.createEventListeners()}createEventListeners(){this.addEventListener("click",this.handleClick)}render(){const{link:e,label:t,code:s,a11y_label:n="color",selected:r,size:a="large"}=this.props,o=document.createElement(e?"a":"button");e&&o.setAttribute("href",e),t&&(o.setAttribute("title",t),o.setAttribute("aria-label",`${t} ${n}`)),"true"===r&&o.setAttribute("class","selected"),this.classList.add(a),o.innerHTML=`\n            <div><span style="background-color: ${s}"></span></div>\n        `,this.innerHTML=o.outerHTML}handleClick(){const{sku:e}=this.props;s({element:this,eventName:"EVENT_COLOR_CLICKED",args:{sku:e}})}}customElements.get("nb-color")||customElements.define("nb-color",a);class o extends HTMLElement{constructor(){super(),this._apiProducts={},this._colors=[],this._maxColors=4}async connectedCallback(){this.props=e(this.attributes),this.updateMaxColors(),await this.fetchColors(),this.render(),this.createEventListeners()}hasColorData(){return this.props.colors&&this.props.colors.every(this.hasAllProps)}hasAllProps(e){return null!=e.sku&&null!=e.name&&null!=e.code}createEventListeners(){this.addEventListener("EVENT_COLOR_CLICKED",this.onColorChange)}render(){const{heading:e=""}=this.props;this.innerHTML=`\n            ${e?`<p class="t-sm-400-ll">${e}</p>`:""}\n            ${this.renderColors()}${this.renderExtraColors()}\n        `}renderColors(){return this._colors.map(this.renderColor.bind(this)).join("")}renderColor(e){const{a11y_label:t="",activeSku:s,size:n="large"}=this.props,{code:r="",name:a="",link:o="",sku:i=""}=e;return this.classList.add(n),`\n            <nb-color\n                code="${r}"\n                label="${a}"\n                link="${o}"\n                sku="${i}"\n                selected="${i===s}"\n                ${t?`a11y_label="${t}"`:""}\n                size="${n}"\n            ></nb-color>\n        `}renderExtraColors(){const{colors:e=[],extra_url:t,extra_title:s}=this.props,n=Math.max(0,e.length-this._maxColors);return n<=0||!t?"":`\n            <nb-link\n                size="small"\n                color="black"\n                seo_label="${s}"\n                aria-label="${s}"\n                link="${t}"\n            >+${n}</nb-link>`}async fetchColors(){if(this.hasColorData())this._colors=this.clampColor(this.props.colors);else try{const e=this.prepareColors(this._maxColors);await Promise.all(e.map(this.fetchColor.bind(this)))}catch(e){console.error(`Fetch for colors failed: ${e}`)}}async fetchColor(e){const{prevent:t}=this.props,s=await r.getApiProduct(e.sku),n={code:s.colorShade.cssCode,name:s.colorShade.name,link:void 0===t?s.pdpURLs.desktop:""};this._apiProducts[e.sku]=s,this._colors.push({...e,...n})}prepareColors(){const{colors:e=[]}=this.props;return this.clampColor(e).filter(this.hasSKU)}clampColor(e){return e.slice(0,this._maxColors)}hasSKU(e){return null!=e.sku&&""!==e.sku}updateMaxColors(){const{max_colors:e}=this.props;e&&(this._maxColors=parseInt(e))}onColorChange(e){const{sku:t}=(e=>{if(e.detail)return e.detail})(e),n={...this._apiProducts[t],sku:t};n&&s({element:this,eventName:"EVENT_COLOR_CHANGE",args:{productData:n}})}}customElements.get("nb-colors")||customElements.define("nb-colors",o);export{o as default};
