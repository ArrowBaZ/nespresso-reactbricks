const e=e=>null==e;class t extends HTMLElement{constructor(){super(),this.template=""}connectedCallback(){this.props=this._createProps(),this.onStart?.(),this.loadTemplate(),this.onReady?.()}_createProps(e=null){const t=e||this.attributes;let n;try{n=[...t].reduce(((e,t)=>({...e,[t.nodeName]:t.nodeValue})),{});const e=[...t].find((e=>"data"===e.nodeName));return null==e?n:{...n,...JSON.parse(e.nodeValue)}}catch(e){console.log("ERROR: No data",e)}}render(e=!1){e&&(this.innerHTML="");const t=(e,n)=>{const s=e=>3===e.nodeType?"text":8===e.nodeType?"comment":e.tagName.toLowerCase(),i=e=>e.childNodes&&e.childNodes.length>0?null:e.textContent;var o=Array.prototype.slice.call(n.childNodes),a=Array.prototype.slice.call(e.childNodes),r=o.length-a.length;if(r>0)for(;r>0;r--)o[o.length-r].parentNode.removeChild(o[o.length-r]);a.forEach((function(e,a){if(o[a])if(s(e)===s(o[a])){var r=i(e);if(r&&r!==i(o[a])&&(o[a].textContent=r),o[a].childNodes.length>0&&e.childNodes.length<1)o[a].innerHTML="";else{if(o[a].childNodes.length<1&&e.childNodes.length>0){var c=document.createDocumentFragment();return t(e,c),void o[a].appendChild(c)}e.childNodes.length>0&&t(e,o[a])}}else o[a].parentNode.replaceChild(e.cloneNode(!0),o[a]);else n.appendChild(e.cloneNode(!0))}))},n=(s=this.template,(new DOMParser).parseFromString(s,"text/html").body);var s;t(n,this)}loadTemplate(e="",t=!1){this.template=""===e?this.template:`${e}`,this.render(t)}disconnectedCallback(){this.onDestroy?.()}}customElements.get("nb-nespresso-element")||customElements.define("nb-nespresso-element",t),window.gtmDataObject=window.gtmDataObject||[];class n extends HTMLElement{constructor(){super(),this.boundClose=this.close.bind(this),this.boundhandlePromoClick=this.handlePromoClick.bind(this),this.hasMoved=!1,this.isIOS=(()=>{const e=window.navigator.userAgent,t=e.indexOf("OS ");return(e.indexOf("iPhone")>-1||e.indexOf("iPad")>-1)&&t>-1})(),this.isAndroid=window.navigator.userAgent.indexOf("Android ")>-1,this.isHuawei=(()=>{const e=window.navigator.userAgent.indexOf("HUAWEI"),t=navigator.userAgent.match(/ALP-|AMN-|ANA-|ANE-|ANG-|AQM-|ARS-|ART-|ATU-|BAC-|BLA-|BRQ-|CAG-|CAM-|CAN-|CAZ-|CDL-|CDY-|CLT-|CRO-|CUN-|DIG-|DRA-|DUA-|DUB-|DVC-|ELE-|ELS-|EML-|EVA-|EVR-|FIG-|FLA-|FRL-|GLK-|HMA-|HW-|HWI-|INE-|JAT-|JEF-|JER-|JKM-|JNY-|JSC-|LDN-|LIO-|LON-|LUA-|LYA-|LYO-|MAR-|MED-|MHA-|MLA-|MRD-|MYA-|NCE-|NEO-|NOH-|NOP-|OCE-|PAR-|PIC-|POT-|PPA-|PRA-|RNE-|SEA-|SLA-|SNE-|SPN-|STK-|TAH-|TAS-|TET-|TRT-|VCE-|VIE-|VKY-|VNS-|VOG-|VTR-|WAS-|WKG-|WLZ-|YAL/i);return e>-1||null!==t})(),this.sessionStorage=sessionStorage.getItem("app-banner-closed")}connectedCallback(){if(this.isClosed()||!this.hasStore())return this.style.display="none",void this.observeSmartBanner();this.props=(t=>{const n=(e=>e.find((e=>"data"===e.nodeName)))([...t]),s=[...t].filter((e=>"data"!==e.nodeName)).reduce(((e,t)=>({...e,[t.nodeName]:t.nodeValue})),{});if(e(n))return s;try{return{...s,...JSON.parse(n.nodeValue)}}catch(e){console.log("ERROR: No data",e)}})(this.attributes),this.render(),this.hasMoved?this.observeSmartBanner():this.injectionScript()}hasStore(){return this.isIOS||this.isAndroid}isClosed(){return"true"===this.sessionStorage}render(){const{id:e,name:t,creative:n,position:s}=this.props.campaign,{banner_a11y:i,heading:o,first_line:a,second_line_apple:r,second_line_android:c,second_line_huawei:l,label_close:d}=this.props.copywriting;let h="";o&&(h=`<h2 class="t-xs-700">${o}</h2>`);let p="";a&&(p=`<p class="t-2xs-500-sl">${a}</p>`);let m="";m=this.isHuawei?l:this.isAndroid?c:r;let u="";""!==m&&(u=`<p class="t-2xs-500-sl">${m}</p>`),this.innerHTML=`<nb-container\n                campaign_id="${e}"\n                campaign_name="${t}"\n                campaign_creative="${n}"\n                campaign_position="${s}"\n                classname="pt3 pb3"\n                contrast="light">\n                <aside aria-label="${i}">\n                    <nb-cta\n                        variation="navigation"\n                        contrast="light"\n                        icon_right="close"\n                        label="${d}">\n                    </nb-cta>\n                    <nb-icon icon="nespresso"></nb-icon>\n                    <div class="text">\n                        ${h}\n                        ${p}\n                        ${u}\n                    </div>\n                    ${this.renderAppLink()}\n                </aside>\n            </nb-container>`,this.closeBtn=this.querySelector("button"),this.appLink=this.querySelector("a"),this.observeFixedElements(),this.bindEvents()}observeFixedElements(){const e=document.querySelector("nb-app-banner"),t=document.querySelector("nb-plp");if(t&&e){new MutationObserver((function(t){const n=document.querySelector("plp-navigation");t.forEach((function(t){if("attributes"===t.type){const t=n.getAttribute("sticky");if(e.style.removeProperty("top"),e.classList.remove("is-plp-nav-positioned"),t&&"true"===t){const t=n.getBoundingClientRect().bottom;e.classList.add("is-plp-nav-positioned"),e.style.top=`${t}px`}}}))})).observe(t,{attributes:!0,childList:!0,subtree:!0})}}renderAppLink(){const{label_link:e}=this.props.copywriting;let t="";return t=this.isHuawei?"https://appgallery.huawei.com/app/C102571517":this.isAndroid?"https://play.google.com/store/apps/details?id=com.nespresso.activities":"https://apps.apple.com/us/app/nespresso/id342879434",`<a href="${t}" target="_blank" aria-label="${e}">\n            <nb-icon icon="chevron-right"></nb-icon>\n        </a>`}close(){this.classList.add("close"),this.removeBodyMargin(),this.setAttribute("aria-hidden","true"),sessionStorage.setItem("app-banner-closed","true"),this.sessionStorage="true"}handlePromoClick(){const{id:e,name:t,creative:n,position:s}=this.props.campaign;var i;""!==e&&(i={ecommerce:{promoClick:{promotions:[{id:e,name:t,position:s,creative:n}]}}},window.gtmDataObject.push({event:"promoClick",eventRaisedBy:"Web component",ecommerce:{},...i}))}observeSmartBanner(){const e=document.querySelector(".smartbanner");if(e)return e.remove(),void this.setBodyMargin();const t=this,n=new MutationObserver((e=>{e.forEach((function(e){e.addedNodes.forEach((function(e){1===e.nodeType&&e.classList.contains("smartbanner")&&(e.remove(),t.setBodyMargin(),n.disconnect())}))}))}));n.observe(document.body,{subtree:!1,childList:!0})}setBodyMargin(){this.isClosed()?document.documentElement.style.removeProperty("margin-top"):(document.documentElement.style.marginTop=this.offsetHeight+"px",document.documentElement.style.transition="0.3s ease-in-out margin-top")}removeBodyMargin(){document.documentElement.style.removeProperty("margin-top")}async injectionScript(){await this.ready;let e=document.getElementsByClassName("skip-links")[0];e&&(this.hasMoved=!0,document.body.insertBefore(this,e),this.setBodyMargin())}bindEvents(){this.unbindEvents(),this.closeBtn&&this.closeBtn.addEventListener("click",this.boundClose),this.appLink&&this.appLink.addEventListener("click",this.boundhandlePromoClick)}unbindEvents(){this.closeBtn&&this.closeBtn.removeEventListener("click",this.boundClose),this.appLink&&this.appLink.removeEventListener("click",this.boundhandlePromoClick)}}customElements.get("nb-app-banner")||customElements.define("nb-app-banner",n);export{n as default};
