const e=e=>null==e;class t extends HTMLElement{constructor(){super(),this.template=""}connectedCallback(){this.props=this._createProps(),this.onStart?.(),this.loadTemplate(),this.onReady?.()}_createProps(e=null){const t=e||this.attributes;let n;try{n=[...t].reduce(((e,t)=>({...e,[t.nodeName]:t.nodeValue})),{});const e=[...t].find((e=>"data"===e.nodeName));return null==e?n:{...n,...JSON.parse(e.nodeValue)}}catch(e){console.log("ERROR: No data",e)}}render(e=!1){e&&(this.innerHTML="");const t=(e,n)=>{const s=e=>3===e.nodeType?"text":8===e.nodeType?"comment":e.tagName.toLowerCase(),i=e=>e.childNodes&&e.childNodes.length>0?null:e.textContent;var r=Array.prototype.slice.call(n.childNodes),o=Array.prototype.slice.call(e.childNodes),a=r.length-o.length;if(a>0)for(;a>0;a--)r[r.length-a].parentNode.removeChild(r[r.length-a]);o.forEach((function(e,o){if(r[o])if(s(e)===s(r[o])){var a=i(e);if(a&&a!==i(r[o])&&(r[o].textContent=a),r[o].childNodes.length>0&&e.childNodes.length<1)r[o].innerHTML="";else{if(r[o].childNodes.length<1&&e.childNodes.length>0){var l=document.createDocumentFragment();return t(e,l),void r[o].appendChild(l)}e.childNodes.length>0&&t(e,r[o])}}else r[o].parentNode.replaceChild(e.cloneNode(!0),r[o]);else n.appendChild(e.cloneNode(!0))}))},n=(s=this.template,(new DOMParser).parseFromString(s,"text/html").body);var s;t(n,this)}loadTemplate(e="",t=!1){this.template=""===e?this.template:`${e}`,this.render(t)}disconnectedCallback(){this.onDestroy?.()}}customElements.get("nb-nespresso-element")||customElements.define("nb-nespresso-element",t);const n={get is(){const{innerWidth:e,devicePixelRatio:t}=window;return{mobile:e<768,mobile_tablet:e<1024,tablet:e>=768&&e<1024,desktop:e>=1024&&t<=1,retina:e>=1024&&t>1}},lt:e=>window.innerWidth<e},s={getResponsiveSrc:e=>{const t=(s=e,Array.isArray(s)||"object"==typeof s?["mobile","tablet","desktop","retina"].find((e=>!0===n.is[e]&&e in s&&""!==s[e])):null);var s;return t?e[t]:e.desktop}};class i extends HTMLElement{constructor(){super()}connectedCallback(){this.props=(t=>{const n=(e=>e.find((e=>"data"===e.nodeName)))([...t]),s=[...t].filter((e=>"data"!==e.nodeName)).reduce(((e,t)=>({...e,[t.nodeName]:t.nodeValue})),{});if(e(n))return s;try{return{...s,...JSON.parse(n.nodeValue)}}catch(e){console.log("ERROR: No data",e)}})(this.attributes),this.render(),this.initLazyLoad()}render(){const{campaign:e,layout:t,copywriting:n}=this.props,{sizes:s,notes:i}=n,{padding_top:r,padding_bottom:o,background_color:a="white_1000"}=t;this.innerHTML=`\n            <nb-container\n                background_color="${a}"\n                campaign_id="${e.id}"\n                campaign_name="${e.name}"\n                campaign_creative="${e.creative}"\n                campaign_position="${e.position}"\n                classname="${r} ${o}"\n                contrast="light">\n                <div class="col caption">\n                    ${this.renderHeader()}\n                    ${this.renderList(s)}\n                    ${this.renderList(i)}\n                    ${this.renderLevels()}\n                    ${this.renderDetails()}\n                </div>\n                <div class="col visual">\n                    ${this.renderVisual()}\n                </div>\n            </nb-container>\n      `}renderHeader(){const{header_title:e,description:t}=this.props.copywriting;return`\n            <h2 class="h-2xl-300-sl">${e}</h2>\n            ${t&&`<div class="description wysiwyg t-sm-400">${t}</div>`}\n        `}renderList(e){return e?`\n            <div class="cb-cell">\n                <nb-list data='${JSON.stringify(e)}'></nb-list>\n            </div>\n        `:""}renderLevels(){const{levels:e}=this.props.copywriting;if(null==e)return"";return`<div class="cb-table">${e.reduce(((e,t)=>`${e}${this.renderLevel(t)}`),"")}</div>`}renderLevel({label:e,value:t,information:s}){const{a11y_level_of:i}=this.props.copywriting;return`\n            <div class="cb-row">\n                <p class="t-xs-700-caps">${e}</p>\n                <div class="cb-cell">\n                    <nb-level value="${t}" a11y_of="${i}"></nb-level>\n                </div>\n                <nb-tooltip\n                    content="${s}"\n                    position="top"\n                    alignment="${n.is.mobile?"right":"center"}">\n                </nb-tooltip>\n            </div>\n        `}renderDetails(){const{details:e={}}=this.props.copywriting;if(!e.heading||!e.text)return"";return`<nb-collapse data='${JSON.stringify({...e,classes:{title:"t-xs-700-caps"}})}'></nb-collapse>`}renderVisual(){const{background:e={}}=this.props.layout;return s.getResponsiveSrc(e)&&`<img src="" alt="${e.background_image_alt}" />`}initLazyLoad(){const{background:e={}}=this.props.layout,t=s.getResponsiveSrc(e),n=this.querySelector(".visual img");n&&t&&function(e,t,n,s,i){const r=(t,n)=>{e.setAttribute(t,n);const r=()=>e.classList.add("lazy-loaded");if(s){const t=new Image;return t.src=s,t.onload=r,void(t.onerror=()=>{i&&i(`Image ${s} cannot be loaded.`),e.classList.add("lazy-loaded-error")})}r()};if(/Trident\/|MSIE/.test(window.navigator.userAgent)||(o=window.navigator.userAgent,a=o.indexOf("OS "),(o.indexOf("iPhone")>-1||o.indexOf("iPad")>-1)&&a>-1&&window.Number(o.substr(a+3,3).replace("_","."))<14))r(t,n);else if("IntersectionObserver"in window){e.classList.add("lazy-load");let s=new IntersectionObserver((function(e){e.forEach((function(e){e.isIntersecting&&(r(t,n),s.unobserve(e.target))}))}));s.observe(e)}else r(t,n);var o,a}(n,"src",t,t)}}customElements.get("nb-detailed-description")||customElements.define("nb-detailed-description",i);export{i as default};
