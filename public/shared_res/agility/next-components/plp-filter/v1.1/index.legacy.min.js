function e(e,t,n,i){let s=0;for(;e;){const o=e.indexOf(n,s);if(-1===o)break;const l=e.indexOf(i,o+1);if(-1===l)break;const r=e.substring(o+n.length,l);null!=t[r]?(e=e.substr(0,o)+t[r]+e.substr(l+i.length),s=o):s=l}return e}const t=e=>n(JSON.stringify(e)),n=e=>e?e.toString().replace(/"/g,"&quot;").replace(/'/g,"&apos;"):"";window.gtmDataObject=window.gtmDataObject||[];const i="intensity",s="type",o="color",l="price",r="recommended",d={lightMax:5,mildMin:6,mildMax:8,intenseMin:9};let c,a=r;function u(){for(const e in _)for(const t of _[e].values())_[e].delete(t),t.enabled=!1;C()}function h(){window.dispatchEvent(O("filteredProductDisplay")),S()}function p(e){a=a===e?r:e,C(),h(),S(!0)}function b(){return function(e){const t=document.querySelector("nb-plp-filter");if(null===t)return;const{filter_group_intensity_light_max_label:n,filter_group_intensity_mild_min_label:i,filter_group_intensity_mild_max_label:s,filter_group_intensity_intense_min_label:o}=t.getAttribute("data-response")?JSON.parse(t.getAttribute("data-response")):d;return[[e[0],n],[i,s],[o,e[1]]]}([undefined.intensity[0],undefined.intensity[undefined.intensity.length-1]])}const _={[i]:new Set,cupsize:new Set,aromatic:new Set,[o]:new Set,[l]:new Set,collection:new Set,type:new Set};function f(e,t,n){return t===i||t===o||t===l?n:e.find((e=>e.id===n))}const m={};function g(e,t){return!!(m[e]&&m[e][t]&&m[e][t].enabled)}function v(e,t){return e===o?t.name:t}function y(){const e=function(){const e=JSON.parse(JSON.stringify(void 0));for(const t in e){const n={};for(const i of e[t])n[v(t,i)]=!1;e[t]=n}return e}(),t=function(e){const t={};for(const n in e)t[n]=E(n);return t}(e);c.length>0?c.forEach((n=>{Object.entries(undefined).forEach((([i,s])=>{s.forEach((s=>{const o=k(i,s,!0)(n),l=v(i,s);e[i][l]=e[i][l]||(t[i],o)}))}))})):Object.entries(undefined).forEach((([n,i])=>{i.forEach((i=>e[n][v(n,i)]=t[n]))}));for(const t in e)for(const n in e[t])e[t][n]!==undefined[t][n].get()&&undefined[t][n].update(e[t][n])}function E(e){return Object.values(undefined[e]).some((e=>e.get()))}function w(e,t,n=null){e===o&&"string"==typeof t&&(t=undefined.color.find((e=>e.name===t)));const i=k(e,t,!0);null==n&&(n=!i.enabled),n?(_[e].add(i),i.enabled=!0):(_[e].delete(i),i.enabled=!1)}function k(e,t,n=!1){const r=v(e,t);return null!=m[e]&&null!=m[e][r]?m[e][r]:(null==m[e]&&(m[e]={}),m[e][r]=r=>function(e,t,n){switch(e){case i:return e=>e===t||0===e&&!n;case"cupsize":return e=>e.some((e=>new RegExp(t+"$","g").test(e)));case"aromatic":return e=>e.some((e=>new RegExp(t+"$","g").test(e)));case o:return e=>e.some((e=>e.name===t.name));case l:return e=>e===t;case"collection":return e=>e.some((e=>new RegExp(t+"$","g").test(e)));case s:return e=>e.some((e=>new RegExp(t+"$","g").test(e)))}}(e,t,n)(function(e,t){switch(t){case i:return e.intensity;case"cupsize":return e.cupSizes;case"aromatic":return e.flavors;case o:return e.colors;case l:return e.price;case"collection":return e.collections;case s:return e.types}}(r,e)))}function O(e){let t;return"function"==typeof Event?t=new Event(e):(t=document.createEvent("Event"),t.initEvent(e,!0,!0)),t}function C(e=!0){c=undefined.filter((e=>Object.values(_).every((t=>function(e,t){return 0===t.size||Array.from(t).some((t=>t(e)))}(e,t))))),function(){for(const e in void 0)for(const t in(void 0)[e]){const n=g(e,t);(void 0)[e][t].get()!==n&&(void 0)[e][t].update(n)}}(),y(),e&&new URLSearchParams(L()).toString(),a!==r&&(c=c.sort(undefined[a])),window.filteredProducts=c.length===undefined.length&&a===r?null:c,window.dispatchEvent(O("filteredProductUpdate"))}function S(e){const t=function(){let e=[];const t=L();for(const n in t)try{e.push(n+":"+t[n].join(","))}catch(e){}return e.join("|")}();var n;(e||""!==t)&&(n={eventAction:"PLP Filter click",eventLabel:[`sort:${a}`,t].join("|")},window.gtmDataObject.push({event:"customEvent",eventRaisedBy:"Web component",eventCategory:"User Engagement",eventAction:"Click",eventLabel:"",nonInteraction:0,...n}))}function L(){const e={};for(const t in undefined){const n=[];for(const e in undefined[t])g(t,e)&&n.push(t!==i&&t!==o?f(undefined,t,e).name:e);n.length>0&&(e[t]=n)}return a!==r&&(e.sort=a),e}class ${constructor(e){this.callBack=e}update(e){this.callBack(e)}}const A=["notes-almonds","notes-balanced","notes-bergamot","notes-berry","notes-biscuity","notes-blueberry","notes-cardamom","notes-cereal","notes-citrus","notes-cocoa","notes-default","notes-flowery","notes-fruity","notes-hazelnut","notes-herbal","notes-honey","notes-leather","notes-malted","notes-roasted","notes-spicy","notes-sugar","notes-winey","notes-wood","notes-brand-coffee-roasted","notes-brand-coffee-caramel","notes-brand-coffee-intense-roasted"],M={"productlistrespblock.filterlabels.intensity.chip.light":"Light {range}","productlistrespblock.filterlabels.intensity.chip.medium":"Mild {range}","productlistrespblock.filterlabels.intensity.chip.intense":"Intense {range}"};class N extends HTMLElement{connectedCallback(){this.props=[...this.attributes].reduce(((e,t)=>({...e,[t.nodeName]:t.nodeValue})),{});const{filter_group_intensity_light:e,filter_group_intensity_medium:t,filter_group_intensity_intense:n}=this.props;M["productlistrespblock.filterlabels.intensity.chip.light"]=e,M["productlistrespblock.filterlabels.intensity.chip.medium"]=t,M["productlistrespblock.filterlabels.intensity.chip.intense"]=n,this.init().finally((()=>this.render()))}async init(){this.priceFormatter=await async function(){return napi.priceFormat()}(),this.currency=async function(){return napi.market().read()}().currency}getFilterValueData(e,t,n){return t===i||t===o?n:e[t][n]}async render(){const{title:e,filter_type:t,properties:n}=this.props;this.filter_type=t,this.inputs=JSON.parse(n);this.innerHTML=`\n            <fieldset>\n                <legend>${e}</legend>\n                ${this.inputs.map(((e,n)=>{const i=this.getFilterValueData(undefined,t,e);return this.render_input(i,t,n)})).join("")}\n            </fieldset>\n        `,this.boundOnIntensityClick=this.onIntensityClick.bind(this),this.boundOnSizeClick=this.onSizeClick.bind(this),this.boundOnAromaticClick=this.onAromaticClick.bind(this),this.boundOnColorClick=this.onColorClick.bind(this),this.boundOnPriceClick=this.onPriceClick.bind(this),this.boundOnCollectionClick=this.onCollectionClick.bind(this),this.boundOnTypeClick=this.onTypeClick.bind(this),this.inputs.forEach(this.handleInput.bind(this))}getId(e,t){switch(e){case i:return t.join("-");case o:return t.name;case l:return t;default:return t.id}}getName(t,n,s){const o=["light","medium","intense"];switch(n){case i:return e(M["productlistrespblock.filterlabels.intensity.chip."+o[s]],{range:t[0]+" - "+t[1]},"{","}");case l:return this.priceFormatter.short(this.currency,t);default:return t.name}}render_input(e,t,n){const s=this.getId(t,e),o=this.getName(e,t,n);if(t!==i&&"group"===e.type)return`<nb-chip color="#FAF9F8" value="${s}">${o}</nb-chip>`;const l="aromatic"===t?e.id.split("/")?.pop():"";return`<nb-chip value="${s}" ${this.isCupSize(e)?`icon='${this.getCupSize(e)}'`:l?`icon='${(e=>{const t=(e=>(e=e.replace("capsule-aromatic-","").replace("recipe-",""),["peppery"].includes(e)?"spicy":["woody"].includes(e)?"wood":["sweet","caramel"].includes(e)?"sugar":["maltedCereal"].includes(e)?"malted":["veryRoasted","roastedCereal"].includes(e)?"roasted":["fruityWiney"].includes(e)?"fruity":["citric"].includes(e)?"citrus":["chocolate"].includes(e)?"cocoa":["nutty"].includes(e)?"hazelnut":["hintOfFruity"].includes(e)?"berry":["smooth-b2b"].includes(e)?"brand-coffee-roasted":["sweetnotes-b2b","toffeenotes-b2b","caramellynotes-b2b"].includes(e)?"brand-coffee-caramel":["rich-b2b"].includes(e)?"brand-coffee-intense-roasted":e.toLowerCase()))(e);let n=A.find((e=>t.split("-").includes(e.replace("notes-",""))));return n||(n="notes-default"),n})(l)}'`:""}>${o}</nb-chip>`}addEnableObserver(e,t,n,i){const s=(l=t,(void 0)[o=e][v(o,l)]);var o,l;const r=new $(i);s.addObserver(r),s.update(s.get())}handleInput(e){const{filter_type:t}=this.props;this.clickMap={[i]:this.boundOnIntensityClick,cupsize:this.boundOnSizeClick,aromatic:this.boundOnAromaticClick,[o]:this.boundOnColorClick,[l]:this.boundOnPriceClick,collection:this.boundOnCollectionClick,[s]:this.boundOnTypeClick};const n=this.getFilterValueData(undefined,t,e),r=this.getId(t,n),d=this.querySelector(`nb-chip[value="${r}"]`);d.addEventListener("change",this.clickMap[t]);let c=e;if(Array.isArray(e)&&t===i&&(e=undefined[t][e[0]]?e[0]:e[1]),t===i)for(let e=c[0];e<=c[1];e++)undefined[t][e];else this.addEnableObserver(t,e,d,(e=>{d.setAttribute("disabled",(!e).toString())}));const a=(h=e,(void 0)[u=t][v(u,h)]);var u,h;const p=new $((e=>{e?d.setAttribute("checked","true"):d.setAttribute("checked","false")}));a.addObserver(p),a.update(a.get())}isCupSize(e){return e.superCategories&&e.superCategories.some((e=>"capsule-cupSize"===e.match(/([^/]*)\/*$/)[0]))}getCupSize(e){return e.id.match(/([^/]*)\/*$/)[0]}onIntensityClick(e){const t=e.currentTarget.getAttribute("disabled");let n=e.currentTarget.getAttribute("value");-1!==n.indexOf("-")&&(n=this.getIntRange(n)),null!=t&&"false"!==t||function(e,t){Array.isArray(e)?e.filter((e=>(void 0).intensity)).forEach((e=>w(i,e,t))):w(i,e,t),C()}(n)}getIntRange(e){const t=[],n=e.split("-");for(let e=parseInt(n[0]);e<=n[1];e++)t.push(e);return t}onSizeClick(e){const t=e.currentTarget.getAttribute("disabled"),n=e.currentTarget.getAttribute("value");null!=t&&"false"!==t||function(e,t){w("cupsize",e,t),C()}(n)}onAromaticClick(e){const t=e.currentTarget.getAttribute("disabled"),n=e.currentTarget.getAttribute("value");null!=t&&"false"!==t||function(e,t){w("aromatic",e,t),C()}(n)}onColorClick(e){const t=e.currentTarget.getAttribute("disabled"),n=e.currentTarget.getAttribute("value");null!=t&&"false"!==t||function(e,t){const n=(void 0).color.find((t=>t.name===e));null!=n&&(w(o,n,t),C())}(n)}onPriceClick(e){const t=e.currentTarget.getAttribute("disabled"),n=e.currentTarget.getAttribute("value");null!=t&&"false"!==t||function(e,t){w(l,e,t),C()}(n)}onCollectionClick(e){const t=e.currentTarget.getAttribute("disabled"),n=e.currentTarget.getAttribute("value");null!=t&&"false"!==t||function(e,t){w("collection",e,t),C()}(n)}onTypeClick(e){const t=e.currentTarget.getAttribute("disabled"),n=e.currentTarget.getAttribute("value");null!=t&&"false"!==t||function(e,t){w("type",e,t),C()}(n)}disconnectedCallback(){const e=this.filter_type===i?b():this.inputs;e&&e.forEach((e=>{const t=Array.isArray(e)?e.join("-"):e;this.querySelector(`nb-chip[value="${t}"]`).removeEventListener("click",this.clickMap[this.filter_type])}))}}customElements.get("nb-filter-form")||customElements.define("nb-filter-form",N);class B extends HTMLElement{constructor(){super(),this.slot=this.innerHTML}connectedCallback(){this.render()}render(){const e=this.slot;this.innerHTML=`\n        <div class="innerScrollContainer">\n            <div class="innerScroll">\n                <div class="innerScrollOverflow">\n                    <div class="innerScrollPadding">\n                        ${e}\n                    </div>\n                </div>\n            </div>\n        </div>`}}customElements.get("nb-inner-scroll")||customElements.define("nb-inner-scroll",B);const P=e=>{const t=(e=>e.find((e=>"data"===e.nodeName)))([...e]),n=[...e].filter((e=>"data"!==e.nodeName)).reduce(((e,t)=>({...e,[t.nodeName]:t.nodeValue})),{});if(F(t))return n;try{return{...n,...JSON.parse(t.nodeValue)}}catch(e){console.log("ERROR: No data",e)}},F=e=>null==e,T=({eventName:e,args:t,element:n})=>{let i;n=n||window,t?i=new CustomEvent(e,{detail:t,bubbles:!0}):"function"==typeof Event?i=new Event(e):(i=document.createEvent("Event"),i.initEvent(e,!0,!0)),n.dispatchEvent(i)};class R extends HTMLElement{constructor(){super(),this.template=""}connectedCallback(){this.props=this._createProps(),this.onStart?.(),this.loadTemplate(),this.onReady?.()}_createProps(e=null){const t=e||this.attributes;let n;try{n=[...t].reduce(((e,t)=>({...e,[t.nodeName]:t.nodeValue})),{});const e=[...t].find((e=>"data"===e.nodeName));return null==e?n:{...n,...JSON.parse(e.nodeValue)}}catch(e){console.log("ERROR: No data",e)}}render(e=!1){e&&(this.innerHTML="");const t=(e,n)=>{const i=e=>3===e.nodeType?"text":8===e.nodeType?"comment":e.tagName.toLowerCase(),s=e=>e.childNodes&&e.childNodes.length>0?null:e.textContent;var o=Array.prototype.slice.call(n.childNodes),l=Array.prototype.slice.call(e.childNodes),r=o.length-l.length;if(r>0)for(;r>0;r--)o[o.length-r].parentNode.removeChild(o[o.length-r]);l.forEach((function(e,l){if(o[l])if(i(e)===i(o[l])){var r=s(e);if(r&&r!==s(o[l])&&(o[l].textContent=r),o[l].childNodes.length>0&&e.childNodes.length<1)o[l].innerHTML="";else{if(o[l].childNodes.length<1&&e.childNodes.length>0){var d=document.createDocumentFragment();return t(e,d),void o[l].appendChild(d)}e.childNodes.length>0&&t(e,o[l])}}else o[l].parentNode.replaceChild(e.cloneNode(!0),o[l]);else n.appendChild(e.cloneNode(!0))}))},n=(i=this.template,(new DOMParser).parseFromString(i,"text/html").body);var i;t(n,this)}loadTemplate(e="",t=!1){this.template=""===e?this.template:`${e}`,this.render(t)}disconnectedCallback(){this.onDestroy?.()}}customElements.get("nb-nespresso-element")||customElements.define("nb-nespresso-element",R);const x={get is(){const{innerWidth:e,devicePixelRatio:t}=window;return{mobile:e<768,mobile_tablet:e<1024,tablet:e>=768&&e<1024,desktop:e>=1024&&t<=1,retina:e>=1024&&t>1}},lt:e=>window.innerWidth<e};function D(e,t){const n=e.parentNode;if(n===document.getElementsByTagName("body")[0])return;const i=n.children;for(const n of i)n!==e&&(t?n.setAttribute("aria-hidden",t):n.removeAttribute("aria-hidden"));D(n,t)}class I extends HTMLElement{constructor(){super(),this.isOpen=!1,this.selected=null,this.buttonElement=null,this.onClickOutside=this.onClickOutside.bind(this)}connectedCallback(){this.props=P(this.attributes),this.render()}render(){this.buttonElement=null;const{label:e="",aa_description:t}=this.props;let{options:n}=this.props;n=n.map((e=>{const t={...e};return t.checked=t.checked||t.selected,t})),this.unbindEvent(),this.innerHTML=`\n            <button\n                class='nb-dropdown__button'\n                aria-haspopup="listbox"\n                aria-expanded="${this.isOpen}"\n                aria-label="${e} ${n&&this.renderSelected()}"\n                ${""!==t?`aria-description="${t}"`:""}>\n                    <span class="nb-dropdown__button__label t-xs-700-caps-sl">${e}</span>\n                    <span class="nb-dropdown__button__value t-xs-500-sl" value="${n&&this.renderSelected()}">\n                    </span>\n                </button>\n            <div class="nb-dropdown__menu">\n                <div role="listbox">\n                    ${n&&n.length>0&&this.renderOptions()}\n                </div>\n            </div>\n        `,this.buttonElement=this.querySelector(".nb-dropdown__button"),this.buttonElementValue=this.querySelector(".nb-dropdown__button__value"),this.dropdownMenu=this.querySelector(".nb-dropdown__menu > div"),this.selectedOption=this.querySelector("button[aria-selected=true]"),this.selected||(this.selected=n[0]),function(e){const t=e.querySelectorAll('button, [href], input, select, textarea, [tabindex="0"]');e.firstFocusable=t[0],e.lastFocusable=t[t.length-1],e.lastFocused=e.firstFocusable}(this.dropdownMenu),this.bindEvent()}renderOptions(){const{label:e,aa_listbox_description:t,aa_select_description:n,icon_option:i,options:s}=this.props;return s.map((s=>`<button\n                    class="${x.is.mobile?"t-sm-400-sl":"t-xs-500-sl"}"\n                    role="option"\n                    aria-label='${e+" "+s.label}'\n                    value='${s.label}'\n                    aria-selected='${s.checked}'\n                    ${s.link&&`data-link='${s.link}'`}\n                    ${s.checked?void 0!==t&&`aria-description="${t}"`:void 0!==n&&`aria-description="${n}"`}>\n                  ${i&&`<nb-icon icon='${i}'></nb-icon>`} ${s.label}\n                </button>`)).join("")}renderSelected(){const e=this.props.options.find((e=>!0===e.checked||!0===e.selected));return`${e&&e.label||this.props.options[0].label}`}bindEvent(){this.boundHandleClick=this.handleClick.bind(this),this.boundHandleLabelClick=this.handleLabelClick.bind(this),this.boundHandleMobileClose=this.handleMobileClose.bind(this),this.boundFocus=this.focus.bind(this),this.boundFocusin=this.focusin.bind(this),this.boundKeyNav=this.keyNav.bind(this),this.buttonElement.addEventListener("click",this.boundHandleClick),this.querySelectorAll(".nb-dropdown__menu button").forEach((e=>{e.addEventListener("click",this.boundHandleLabelClick)})),this.dropdownMenu.addEventListener("click",this.boundHandleMobileClose),window.addEventListener("click",this.onClickOutside)}unbindEvent(){this.buttonElement&&(this.buttonElement.removeEventListener("click",this.boundHandleClick),this.querySelectorAll(".nb-dropdown__menu button").forEach((e=>{e.removeEventListener("click",this.boundHandleLabelClick)})),this.dropdownMenu.removeEventListener("click",this.boundHandleMobileClose),window.removeEventListener("click",this.onClickOutside),document.removeEventListener("keydown",this.boundKeyNav))}handleClick(){this.toogleDropdown(!this.isOpen)}handleMobileClose(){this.toogleDropdown(!1)}onClickOutside(e){!this.isOpen||e.target.classList.contains("nb-dropdown__button")||e.target.classList.contains("nb-dropdown__button__label")||e.target.classList.contains("nb-dropdown__button__value")||this.toogleDropdown(!1)}handleLabelClick(e){this.isOpen=!1,this.selectedOption.setAttribute("aria-selected","false"),this.selectedOption=e.target,this.selectedOption.setAttribute("aria-selected","true"),this.props.options=this.props.options.map((e=>({...e,checked:!1}))),this.selected=this.props.options.find((e=>e.label===this.selectedOption.value)),this.selected.checked=!0,this.reRender(),T({eventName:"WEB_COMPONENT_SORT_BY_CHANGE",args:{options:this.props.options,selected:this.selected},element:this})}reRender(){const{label:e,aa_listbox_description:t,aa_select_description:n}=this.props;this.buttonElementValue.setAttribute("value",this.selectedOption.value),this.buttonElement.setAttribute("aria-label",e+" "+this.renderSelected()),this.dropdownMenu.querySelectorAll("button").forEach((e=>{e.setAttribute("aria-description",n)})),this.selectedOption.setAttribute("aria-description",t)}setSelected(e,t=!1){const n=this.props.options.find((t=>t.value===e));n&&(this.selected.checked=!1,this.selected=n,this.selected.checked=!0),t&&T({eventName:"WEB_COMPONENT_SORT_BY_CHANGE",args:{options:this.props.options,selected:this.selected},element:this})}toogleDropdown(e){e?this.open():this.close(),this.isOpen=!this.isOpen,this.switchAriaModal(),this.buttonElement.setAttribute("aria-expanded",this.isOpen)}switchAriaModal(){this.dropdownMenu.setAttribute("aria-modal",this.isOpen),D(this.dropdownMenu,this.isOpen)}open(){this.dropdownMenu.addEventListener("transitionend",this.boundFocus),document.addEventListener("focusin",this.boundFocusin),document.addEventListener("keydown",this.boundKeyNav),this.buttonElement.classList.add("isOpen"),this.openingSource=document.activeElement}close(){this.dropdownMenu.addEventListener("transitionend",this.boundFocus),document.removeEventListener("focusin",this.boundFocusin),document.removeEventListener("keydown",this.boundKeyNav),this.buttonElement.classList.remove("isOpen"),this.buttonElement.setAttribute("aria-expanded",!1)}focus(){this.dropdownMenu.removeEventListener("transitionend",this.boundFocus),this.isOpen?(this.selectedOption.focus(),this.dropdownMenu.lastFocused=this.selectedOption):this.buttonElement.focus()}focusin(e){!function(e,t,n){t.contains(e.target)?t.lastFocused=e.target:t.lastFocused===t.firstFocusable?n?t.lastFocusable.focus():t.firstFocusable.focus():n?t.firstFocusable.focus():t.lastFocusable.focus()}(e,this.dropdownMenu,!1)}keyNav(e){switch(e.key){case"Escape":this.toogleDropdown(!1);break;case"ArrowUp":e.preventDefault(),this.prevOption();break;case"ArrowDown":e.preventDefault(),this.nextOption();break;case"Home":case"PageUp":e.preventDefault(),this.firstOption();break;case"End":case"PageDown":e.preventDefault(),this.lastOption()}}prevOption(){if(this.dropdownMenu.lastFocused!==this.dropdownMenu.firstFocusable){const e=this.dropdownMenu.lastFocused.previousElementSibling;e.focus(),this.dropdownMenu.lastFocused=e}}nextOption(){if(this.dropdownMenu.lastFocused!==this.dropdownMenu.lastFocusable){const e=this.dropdownMenu.lastFocused.nextElementSibling;e.focus(),this.dropdownMenu.lastFocused=e}}firstOption(){this.dropdownMenu.lastFocused!==this.dropdownMenu.firstFocusable&&(this.dropdownMenu.firstFocusable.focus(),this.dropdownMenu.lastFocused=this.dropdownMenu.firstFocusable)}lastOption(){this.dropdownMenu.lastFocused!==this.dropdownMenu.lastFocusable&&(this.dropdownMenu.lastFocusable.focus(),this.dropdownMenu.lastFocused=this.dropdownMenu.lastFocusable)}disconnectedCallback(){this.unbindEvent()}}function z(e,t=!0){const n=[{label:e[r],value:r,checked:!a||a===r},{label:e.sortPriceAscending,value:"sortPriceAscending",checked:"sortPriceAscending"===a},{label:e.sortPriceDescending,value:"sortPriceDescending",checked:"sortPriceDescending"===a}];return t&&n.push({label:e.sortIntensityAscending,value:"sortIntensityAscending",checked:"sortIntensityAscending"===a},{label:e.sortIntensityDescending,value:"sortIntensityDescending",checked:"sortIntensityDescending"===a}),n}customElements.get("nb-dropdown")||customElements.define("nb-dropdown",I);const H={[i]:0,cupsize:1,aromatic:2,[l]:3,collection:4,[s]:5};class j extends HTMLElement{constructor(){super(),this.boundOnResetAll=this.onResetAll.bind(this),this.boundOnSeeResults=this.onSeeResults.bind(this),this.boundOnSortSelect=this.onSortSelect.bind(this)}connectedCallback(){this.props=[...this.attributes].reduce(((e,t)=>({...e,[t.nodeName]:t.nodeValue})),{}),this.boundOnFilteredProductsUpdate=this.onFilteredProductsUpdate.bind(this),window.addEventListener("filteredProductUpdate",this.boundOnFilteredProductsUpdate),this.boundPopinCloseClick=this.onPopinCloseClick.bind(this),window.addEventListener("WEB_COMPONENT_POPIN_CLOSE_CLICK",this.boundPopinCloseClick),this.previousState=this.isMobile(),this.render(),this.debouncedOnResize=function(e,t){let n;return t=t||100,function(i){n&&clearTimeout(n),n=setTimeout(e,t,i)}}(this.onResize.bind(this),250),window.addEventListener("resize",this.debouncedOnResize),this.boundOpen=this.onResize.bind(this),window.addEventListener("WEB_COMPONENT_POPIN_OPEN",this.boundOpen),this.props.popin_id&&(this.boundOnPopinClosed=this.onPopinClosed.bind(this),window.addEventListener("WEB_COMPONENT_POPIN_CLOSED",this.boundOnPopinClosed))}onPopinClosed(e){this.props.popin_id&&e.detail.id===this.props.popin_id&&h()}sortCategories(e,t){return H[e[0]]-H[t[0]]}render(){this.innerHTML=`\n            ${this.isMobile()?this.renderDropdown():""}\n            <div class="mobileShadow">\n                <header>\n                    <h2 class="t-sm-700-caps-sl">${undefined["productlistrespblock.filter.label"]}</h2>\n                </header>\n                <section>\n                    ${this.isMobile()?this.renderFilterForms():this.renderFilterFormsDesktop()}\n                </section>\n                <footer>\n                    <nb-link\n                        id="nb-filter-popin-reset-all"\n                        size="large"\n                        color="black">${undefined["productlistrespblock.resetfilters.label"]}</nb-link>\n                    ${this.renderSeeResults(c)}\n                </footer>\n            </div>`,this.resetAllButton=document.getElementById("nb-filter-popin-reset-all"),this.resetAllButton&&this.resetAllButton.addEventListener("click",this.boundOnResetAll),this.seeResultButton=document.getElementById("nb-filter-popin-see-results"),this.seeResultButton&&this.seeResultButton.addEventListener("click",this.boundOnSeeResults),this.closePopupButton=document.querySelector("#plp-filter .nb-popin--button--close"),this.closePopupButton&&this.closePopupButton.addEventListener("click",this.boundOnSeeResults),this.sortButton=document.getElementById("sortMenuMobile"),this.sortButton&&this.sortButton.addEventListener("WEB_COMPONENT_SORT_BY_CHANGE",this.boundOnSortSelect)}renderFilterFormsDesktop(){return`${this.renderFilterForms()}`}renderFilterForms(){const{filter_group_intensity_light:e,filter_group_intensity_medium:t,filter_group_intensity_intense:n}=this.props;return`${Object.entries(undefined).sort(this.sortCategories).map((([s,o])=>{const l=s===i?b():o;return`\n                    <nb-filter-form\n                        filter_group_intensity_light="${e}"\n                        filter_group_intensity_medium="${t}"\n                        filter_group_intensity_intense="${n}"\n                        title='${undefined["productlistrespblock.filterlabels."+s]}'\n                        key='${s}'\n                        filter_type='${s}'\n                        properties='${JSON.stringify(l)}'\n                    ></nb-filter-form>`})).join("")}`}renderDropdown(){const{label_close_sort_by:e,label_sort_by:n,aa_description_sort_by:i,aa_listbox_description_sort_by:s,aa_select_description_sort_by:o,dropdown_recommended_option_label:l,dropdown_price_ascending_option_label:d,dropdown_price_descending_option_label:c,dropdown_intensity_ascending_option_label:a,dropdown_intensity_descending_option_label:u}=this.props;return`<nb-dropdown\n                    id="sortMenuMobile"\n                    data="${t({label:n,aa_description:i,aa_listbox_description:s,aa_select_description:o,icon_option:"check",label_close:e,options:z({[r]:l,sortPriceAscending:d,sortPriceDescending:c,sortIntensityAscending:a,sortIntensityDescending:u})})}"></nb-dropdown>`}onSortSelect(e){p(e.detail.selected.value)}isMobile(){return window.innerWidth<=750}onResize(){this.isMobile()!==this.previousState&&(this.render(),this.previousState=this.isMobile())}renderSeeResults(e){return e&&e.length?`<nb-cta\n                    id="nb-filter-popin-see-results"\n                    variation="secondary"\n                    aria_label_after="${this.getA11ySeeResultsText(e.length)}">\n                    ${this.getSeeResultsText(e.length)}\n                </nb-cta>`:""}onPopinCloseClick(){u()}onResetAll(){u()}onSeeResults(){T({eventName:"WEB_COMPONENT_POPIN_CLOSE",element:window}),h()}getSeeResultsText(t){const{see_result_number_label:n="See {resultsLength} Results",see_result_number_label_one:i="",see_result_number_label_zero:s=""}=this.props;let o;return(isNaN(t)||null==t||0==t)&&(t="0"),o=0===t?s:1===t?i:n,e(o,{resultsLength:t},"{","}")}getA11ySeeResultsText(t){const{a11y_see_result_number_label:n="See {resultsLength} Results"}=this.props;return(isNaN(t)||null==t||0==t)&&(t="0"),e(n,{resultsLength:t},"{","}")}onFilteredProductsUpdate(){this.seeResultButton&&this.seeResultButton.setAttribute("slot",this.getSeeResultsText(c.length)),this.sortButton&&a!==this.sortButton.selected.value&&this.sortButton.setSelected(a)}disconnectedCallback(){this.resetAllButton&&this.resetAllButton.removeEventListener("click",this.boundOnResetAll),this.seeResultButton&&this.seeResultButton.removeEventListener("click",this.boundOnSeeResults),this.sortButton&&this.sortButton.removeEventListener("click",this.boundOnSortSelect),this.closePopupButton&&this.closePopupButton.removeEventListener("click",this.boundOnSeeResults),this.props.popin_id&&window.removeEventListener("WEB_COMPONENT_POPIN_CLOSED",this.boundOnPopinClosed),window.removeEventListener("resize",this.debouncedOnResize),window.removeEventListener("WEB_COMPONENT_POPIN_OPEN",this.boundOpen)}}customElements.get("nb-filter-popin")||customElements.define("nb-filter-popin",j);class U extends HTMLElement{constructor(){super(),this.filterCounter=0,this.isBubbleReady=!1,this.labelElement={},this.iconElement={},this.fullButtonElement={},this.bubbleElement=null,this.updateTotalFiltersBubble=this.updateTotalFiltersBubble.bind(this)}connectedCallback(){this.render(),this.updateTotalFiltersBubble(),window.addEventListener("filteredProductDisplay",this.updateTotalFiltersBubble)}render(){this.innerHTML=`<nb-cta popin_id='plp-filter' variation='plpFilter' icon_right='filter'>${this.attributes.label.nodeValue}</nb-cta>`,this.initElements()}initElements(){this.bubbleElement=document.createElement("div"),this.bubbleElement.classList.add("t-2xs-700"),this.bubbleElement.classList.add("bubbleCounter");const e=document.getElementsByClassName("button--plpFilter");e&&e[0]&&(this.fullButtonElement=e[0],this.labelElement=this.fullButtonElement.firstElementChild,this.iconElement=this.fullButtonElement.lastElementChild)}updateTotalFiltersBubble(){0===Object.keys(this.fullButtonElement).length&&(this.filterCounter=function(){let e=0;for(const t in void 0)if(t===i){const e=b();for(const n in e){let i=e[n][0];for(;i<=e[n][1];i++)(void 0)[t][i]}}else for(const n in(void 0)[t])e=(void 0)[t][n].get()?++e:e;return e}(),this.isBubbleReady||0===this.filterCounter?0===this.filterCounter&&this.isBubbleReady&&this.removeFiltersBubble():(this.isBubbleReady=!0,this.fullButtonElement.appendChild(this.bubbleElement),this.fullButtonElement.classList.add("bubbleActive")),this.bubbleElement.innerHTML=this.filterCounter)}removeFiltersBubble(){0===Object.keys(this.fullButtonElement).length&&this.isBubbleReady&&(this.fullButtonElement.lastElementChild.remove(),this.labelElement.classList.remove("bubbleActive"),this.iconElement.classList.remove("bubbleActive"),this.fullButtonElement.classList.remove("bubbleActive"),this.isBubbleReady=!1)}disconnectedCallback(){window.removeEventListener("filteredProductDisplay",this.updateTotalFiltersBubble)}}customElements.get("nb-plp-filter-cta")||customElements.define("nb-plp-filter-cta",U);const W=(e,t)=>{const{ref:n}=t.dataset,i=n.match(/(\w+)\[(.+)\]/);return null!==i?q(e,t,i):{...e,[t.dataset.ref]:t}},q=(e,t,[,n,i])=>(void 0===e[n]&&(e[n]=[]),e[n][i]=t,e);class V extends HTMLElement{constructor(){super(),this.isMobile=window.innerWidth<750,this.sortButton=null,this.boundProductUpdate=this.onProductUpdate.bind(this),this.boundOnSortSelect=this.onSortSelect.bind(this),this.boundOnSliderReady=this.onSliderReady.bind(this)}connectedCallback(){this.props=P(this.attributes),this.render(),this.refs=[...this.querySelectorAll("[data-ref]")].reduce(W,{}),this.bindEvent()}bindEvent(){window.addEventListener("filteredProductUpdate",this.boundProductUpdate),this.refs.navLink.addEventListener("WEB_COMPONENT_SLIDER_READY",this.boundOnSliderReady,{once:!0})}onProductUpdate(){a!==this.sortButton.selected.value&&this.sortButton.setSelected(a)}render(){this.sortButton&&this.sortButton.removeEventListener("click",this.boundOnSortSelect);const{cta_filter_label:e="Filters",label_sort_by:n="Sort By",aa_description_sort_by:i="You can select different sorting values from this listbox. To interact with this listbox press SPACE or ENTER key.",aa_listbox_description_sort_by:s="You can navigate through the options using UP or DOWN arrows keys. To exit this listbox press ESCAPE key.",aa_select_description_sort_by:o="To select this option press SPACE or ENTER key.",label_close_sort_by:l="Close",a11y_label_close_sort_by:d="Close filter popin",see_result_number_label:c="See {resultsLength} Results",see_result_number_label_zero:a="",see_result_number_label_one:u="",a11y_see_result_number_label:h="Close and validate filters",filter_group_intensity_light:p,filter_group_intensity_medium:b,filter_group_intensity_intense:_,dropdown_recommended_option_label:f,dropdown_price_ascending_option_label:m,dropdown_price_descending_option_label:g,dropdown_intensity_ascending_option_label:v,dropdown_intensity_descending_option_label:y,a11y_slider_previous_button:E,a11y_slider_next_button:w,dropdown_intensity_allow:k}=this.props;this.innerHTML=`\n                    <div class="cb-plp-filter">\n                        <div class='cb-plp-filter--side'>\n                            <nb-plp-filter-cta label='${e}'></nb-plp-filter-cta>\n                        </div>\n                        <div class='cb-plp-filter--links_list'>\n                        <nb-slider-menu\n                            a11y_slider_previous_button="${E}"\n                            a11y_slider_next_button="${w}"\n                            navigation="${!this.isMobile}"\n                            data-ref="navLink">\n                            ${this.renderLinksList()}\n                        </nb-slider-menu>\n                        </div>\n                        <div class='cb-plp-filter--side'>\n                            <nb-dropdown id="sortMenu"\n                                data="${t({label:n,aa_description:i,aa_listbox_description:s,aa_select_description:o,icon_option:"check",label_close:l,options:z({[r]:f,sortPriceAscending:m,sortPriceDescending:g,sortIntensityAscending:v,sortIntensityDescending:y},"true"===k)})}"/>\n                        </div>\n                    </div>\n                    <nb-popin id='plp-filter' popin_id="plp-filter" variation='before' bgcolor="white" class='nb-popin--filter' heading='${undefined["productlistrespblock.filter.label"]}' label_close='${d}'>\n                        <nb-filter-popin\n                            aa_description_sort_by="${i}"\n                            aa_listbox_description_sort_by="${s}"\n                            aa_select_description_sort_by="${o}"\n                            see_result_number_label="${c}"\n                            see_result_number_label_zero="${a}"\n                            see_result_number_label_one="${u}"\n                            a11y_see_result_number_label="${h}"\n                            label_close_sort_by="${l}"\n                            label_sort_by="${n}"\n                            filter_group_intensity_light="${p}"\n                            filter_group_intensity_medium="${b}"\n                            filter_group_intensity_intense="${_}"\n                            dropdown_recommended_option_label="${f}"\n                            dropdown_price_ascending_option_label="${m}"\n                            dropdown_price_descending_option_label="${g}"\n                            dropdown_intensity_ascending_option_label="${v}"\n                            dropdown_intensity_descending_option_label="${y}"\n                            popin_id="plp-filter"\n                            />\n                    </nb-popin>`,this.sortButton=document.getElementById("sortMenu"),this.sortButton&&this.sortButton.addEventListener("WEB_COMPONENT_SORT_BY_CHANGE",this.boundOnSortSelect)}onSortSelect(e){p(e.detail.selected.value)}onSliderReady(e){const t=(e=>{if(e.detail)return e.detail})(e),{className:n}=t;this.refs.navLink.querySelector(`.${n}`)}renderLinksList(){const{navigation:e=[]}=this.props;return e.map((({link:e="",icon_left:t="",seo_label:n="",label:i="",selected:s=!1})=>`<nb-link\n                            link='${e}'\n                            phantom='true'\n                            color='black'\n                            selected=${s}\n                            ${n&&`seo_label='${n}'`}\n                            ${t&&`icon_left='${t}'`}>${i}</nb-link>`)).join("")}disconnectedCallback(){this.sortButton&&this.sortButton.removeEventListener("click",this.boundOnSortSelect),window.removeEventListener("filteredProductUpdate",this.boundProductUpdate)}}customElements.get("nb-plp-filter")||customElements.define("nb-plp-filter",V);export{V as default};
