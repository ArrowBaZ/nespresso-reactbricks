const e=e=>{const i=(e=>e.find((e=>"data"===e.nodeName)))([...e]),s=[...e].filter((e=>"data"!==e.nodeName)).reduce(((e,t)=>({...e,[t.nodeName]:t.nodeValue})),{});if(t(i))return s;try{return{...s,...JSON.parse(i.nodeValue)}}catch(e){console.log("ERROR: No data",e)}},t=e=>null==e,i=e=>[...e.querySelectorAll("[data-ref]")].reduce(s,{}),s=(e,t)=>{const{ref:i}=t.dataset,s=i.match(/(\w+)\[(.+)\]/);return null!==s?n(e,t,s):{...e,[t.dataset.ref]:t}},n=(e,t,[,i,s])=>(void 0===e[i]&&(e[i]=[]),e[i][s]=t,e);var r=(e=[])=>{e.forEach((e=>{if(e&&e.element)return e.element.addEventListener(e.type,e.listener,e.options)}))},a=(e=[])=>{e.forEach((e=>{e&&e.element&&e.element.removeEventListener(e.type,e.listener)}))};class o extends HTMLElement{constructor(){super(),this.template=""}connectedCallback(){this.props=this._createProps(),this.onStart?.(),this.loadTemplate(),this.onReady?.()}_createProps(e=null){const t=e||this.attributes;let i;try{i=[...t].reduce(((e,t)=>({...e,[t.nodeName]:t.nodeValue})),{});const e=[...t].find((e=>"data"===e.nodeName));return null==e?i:{...i,...JSON.parse(e.nodeValue)}}catch(e){console.log("ERROR: No data",e)}}render(e=!1){e&&(this.innerHTML="");const t=(e,i)=>{const s=e=>3===e.nodeType?"text":8===e.nodeType?"comment":e.tagName.toLowerCase(),n=e=>e.childNodes&&e.childNodes.length>0?null:e.textContent;var r=Array.prototype.slice.call(i.childNodes),a=Array.prototype.slice.call(e.childNodes),o=r.length-a.length;if(o>0)for(;o>0;o--)r[r.length-o].parentNode.removeChild(r[r.length-o]);a.forEach((function(e,a){if(r[a])if(s(e)===s(r[a])){var o=n(e);if(o&&o!==n(r[a])&&(r[a].textContent=o),r[a].childNodes.length>0&&e.childNodes.length<1)r[a].innerHTML="";else{if(r[a].childNodes.length<1&&e.childNodes.length>0){var l=document.createDocumentFragment();return t(e,l),void r[a].appendChild(l)}e.childNodes.length>0&&t(e,r[a])}}else r[a].parentNode.replaceChild(e.cloneNode(!0),r[a]);else i.appendChild(e.cloneNode(!0))}))},i=(s=this.template,(new DOMParser).parseFromString(s,"text/html").body);var s;t(i,this)}loadTemplate(e="",t=!1){this.template=""===e?this.template:`${e}`,this.render(t)}disconnectedCallback(){this.onDestroy?.()}}customElements.get("nb-nespresso-element")||customElements.define("nb-nespresso-element",o);const l={get is(){const{innerWidth:e,devicePixelRatio:t}=window;return{mobile:e<768,mobile_tablet:e<1024,tablet:e>=768&&e<1024,desktop:e>=1024&&t<=1,retina:e>=1024&&t>1}},lt:e=>window.innerWidth<e},d={getResponsiveSrc:e=>{const t=(i=e,Array.isArray(i)||"object"==typeof i?["mobile","tablet","desktop","retina"].find((e=>!0===l.is[e]&&e in i&&""!==i[e])):null);var i;return t?e[t]:e.desktop}};window.gtmDataObject=window.gtmDataObject||[];function c(e){function t(e,t){return e%t==0}return"original"===function(e){const t=e.technologies[0];return t.substring(t.indexOf("/machineTechno/")+"/machineTechno/".length)}(e)?1===e.sales_multiple?t(e.unitQuantity,10)?e.unitQuantity/10:NaN:t(e.sales_multiple,10)?e.sales_multiple/10:NaN:1===e.sales_multiple?t(e.unitQuantity,10)&&1!==e.unitQuantity?e.unitQuantity/10:t(e.unitQuantity,7)&&1!==e.unitQuantity?e.unitQuantity/7:NaN:t(e.sales_multiple,10)?e.sales_multiple/10:t(e.sales_multiple,7)?e.sales_multiple/7:NaN}function p(e){return e.sales_multiple=e.sales_multiple||e.salesMultiple,!(e.sales_multiple>1&&1===e.unitQuantity)&&(1===e.sales_multiple&&e.unitQuantity>1)}const h=async e=>{const t=await(async()=>await window.napi.priceFormat())(),i=window[window.config.padl.namespace].dataLayer.app.app.currency;return t.html?t.html(i,e):t.short(i,e)||""},u=async e=>{const t=await(e=>window.napi.catalog().getProduct(e))(e),i=t?t.supercategories:[];return await Promise.all(i.map((async e=>await window.napi.catalog().getCategory(e))))};var _=(()=>{const e=window.napi&&window.napi.catalog,t=window.napi&&window.napi.ratings,i=window.napi&&window.napi.priceFormat;let s=null;const n=async t=>await e().getProduct(t),r=async(e,t)=>{try{return await a(e,t)}catch(t){throw console.error(`Fetch for product ${e.sku} failed: ${t}`),t}},a=async(e,t)=>{const{api_override:{name:i="",headline:s="",description:r=""}={}}=e,a=l(e),_=await n(e.sku),g=await u(e.sku),m={name:""!==i?i:_.name,headline:""!==s?s:_.headline,description:""!==r?r:_.description,longSku:_?_.id:null,price:_?_.price:null,pdp_urls:c(_,"pdpURLs"),images:_.images,slides:_.slides,technologies:_.technologies,type:_.type,productCategories:g};if(t&&e.productRatings?.ratingEnabled&&(m.rating=await p(e,_)),"capsule"===a&&(m.bundled=_.bundled,m.intensity=_.capsuleProperties?.intensity||0,m.unit_quantity=d(_,"unitQuantity",1),m.sales_multiple=d(_,"salesMultiple",10)),"giftcard"===a){if(!e.variant.giftcard_price)throw"Gift Card amount price is not defined.";m.price=h(e.variant.giftcard_price),m.images={icon:e.variant.default_image}}return{...o(e,_),...m}},o=(e,t,i=!1)=>{const s={...e};if(!t)return s;for(const e of Object.keys(s)){const n=""===s[e]||"0"===s[e];e in t&&(n||i)&&(s[e]=t[e])}return s},l=({variant:e})=>{const t=Object.keys(e).find((e=>e.includes("is_")));return t?t.split("_")[1]:""},d=(e,t,i)=>parseInt(e&&e[t]||i),c=(e,t)=>e&&Object.keys(e[t]).length>0?e[t]:{},p=async({sku:e},i)=>{if(!t||i&&i.productRatings&&!i.productRatings.ratingEnabled)return _(0,1);try{const{ratingAverage:i=0}=await t().summary(e);return _(0!==i?i:0,1)}catch(t){return console.error(`Product rating fetch failed on sku ${e}`,t),_(0,1)}},h=e=>{const{short:t}=s;return t((()=>{const{dataLayer:e={}}=window[window.config.padl.namespace];return e.app?.app?.currency})(),e)},_=(e,t=2)=>parseFloat(e).toFixed(t);return{loadPriceFormat:async()=>{s=await i()},getApiProduct:n,getAll:(e,t)=>Promise.all(e.map((async i=>{try{const s=await r(i,t);e.splice(e.indexOf(i),1,s)}catch(t){e.splice(e.indexOf(i),1)}}))),getOne:r,fetchOne:a,merge:o,formatPrice:h}})();const g=({eventName:e,args:t,element:i})=>{let s;i=i||window,t?s=new CustomEvent(e,{detail:t,bubbles:!0}):"function"==typeof Event?s=new Event(e):(s=document.createEvent("Event"),s.initEvent(e,!0,!0)),i.dispatchEvent(s)},m=e=>{if(e.detail)return e.detail},b=e=>{const t=e.refs.slider._slider;if(!t)return;const i={container:{width:t._widthContainer},slider:{width:t._widthWrapper},slide:{width:t._widthSlide}};let s=-1,n={};const r=()=>t._slides.length-t.slidesVisible,a=()=>s>-1,o=()=>s>=r(),d=e=>{const i=t._slides[e],{idPopin:s}=i;g({eventName:"WEB_COMPONENT_POPIN_OPEN",args:{id:s}})},c=()=>{},p=e=>{const n=t._children[e],r=i.slider.width,a=i.slider.width-i.slide.width,o=i.container.width+a;t.setSlideWidth(n,r),t.setContainerWidth(o),s=e},h=e=>{const n=t._children[e],r=i.slide.width,a=i.container.width;t.setSlideWidth(n,r),t.setContainerWidth(a),s=-1},u=e=>{t._slides[e].setAttribute("expanded","false")},_=e=>{const i=r(),s=e<=i;a()||s||(e=i),t.goToItem(e),a()?(()=>{for(const e of t._children)e.classList.remove("activeParent");t._children[t._currentIndex].classList.add("activeParent")})():t.activateItems()},m=(e,n)=>{const r=s>e,o=s<e,l=t._widthContainer-t._widthSlide*t.slidesVisible,d=i.slider.width,c=(e-1)*i.slide.width;if(a()&&o){return Math.min(d+c,l)}if(a()&&r){return Math.min(d+c,l)}return n},b=e=>(a()&&u(s),o()?e-1:e),v=e=>(a()&&u(s),o()?e-1:e),y=(e,i)=>{const s=i<=t._slides.length-t.slidesToScroll;return o()?!s:e},f=e=>{const i=t._currentIndex===t._slides.length-2,n=a()&&s>=t._currentIndex&&i?t._slides.length-1:r(),l=t._currentIndex<=n;o()&&(l?e.classList.remove("hidden"):e.classList.add("hidden"))};return n=l.is.mobile?{open:d,close:c}:{open:p,close:h},(()=>{for(const s of t._slides)g({eventName:"EVENT_CROSS_SELL_READY",element:s,args:{parent:e,geometry:i}})})(),t.goToItem(0),t._options.hookGetRightBoundary=y,t._options.hookMove=f,t._options.hookSlideChange=m,t._options.hookPrevious=b,t._options.hookNext=v,{update:(e,t)=>{const i=t!==s;e?(a()&&i&&u(s),n.open(t),_(t)):(n.close(t),_(t))},slider:t}};class v extends HTMLElement{constructor(){super(),this.props={},this.labels=[]}connectedCallback(){this.props=e(this.attributes),this.render()}render(){const{labels:e=[],direction:t="column"}=this.props;if(this.classList.add(""+("row"===t?"direction-row":"direction-"+t)),0===e.length)return"";this.labels=e,this.innerHTML=`${this.renderLabels()}`}renderLabels(){return this.labels.map((e=>{const{name:t="",bgColor:i="",color:s=""}=e;return`<mark class="t-3xs-500"\n                            ${i&&s&&`style="background: ${i}; color: ${s}"`}>\n                            <span aria-hidden="true">${t}</span>\n                            <span class="sr-only">${t}</span>\n                        </mark>`})).join("")}}customElements.get("nb-card-labels")||customElements.define("nb-card-labels",v);const y=()=>{const e=window[window?.padlNamespace]?.dataLayer;return e?e.app.app.market.toLocaleLowerCase():"ch"},f={fair_trade:"https://www.nespresso.com/shared_res/agility/commons/img/icons/fairTrade.svg",is_organic:function(){let e="https://www.nespresso.com/shared_res/agility/commons/img/icons/logo-organic-eu.svg";switch(y()){case"us":e="https://www.nespresso.com/shared_res/agility/commons/img/icons/logo-organic-us.svg";break;case"ca":e="https://www.nespresso.com/shared_res/agility/commons/img/icons/logo-organic-ca.svg";break;case"br":e="https://www.nespresso.com/shared_res/agility/commons/img/icons/logo-organic-br.svg";break;case"jp":e="https://www.nespresso.com/shared_res/agility/commons/img/icons/logo-organic-jp.svg";break;case"be":e="https://www.nespresso.com/shared_res/agility/commons/img/icons/logo-organic-be.png"}return e}(),only_vertuo_next:"https://www.nespresso.com/shared_res/agility/commons/img/icons/logo-only-vertuo-next.svg",is_q_certified_arabica:"https://www.nespresso.com/shared_res/agility/commons/img/icons/q_grade_certification_arabica.svg",is_rainforest:"https://www.nespresso.com/shared_res/agility/commons/img/icons/logo-rainforest.svg",is_sustainable:"https://www.nespresso.com/shared_res/agility/commons/img/icons/logo-sustainability.svg",is_design_award_2021:"https://www.nespresso.com/shared_res/agility/commons/img/icons/design_award_2021.svg"};class w extends HTMLElement{constructor(){super(),this.props={}}connectedCallback(){this.props=e(this.attributes),this.render()}render(){let e,t,i,s,n,r,a,o,l,d,c,p,{direction:h="row",logos:u}=this.props;this.classList.add(""+("column"===h?"direction-column":"direction-"+h));let _=[];null==u?(e=this.props?.fair_trade,t=this.props?.alt_fair_trade,i=this.props?.is_organic,s=this.props?.alt_organic,n=this.props?.only_vertuo_next,r=this.props?.alt_vertuo_next,a=this.props?.is_rainforest,o=this.props?.alt_rainforest,l=this.props?.is_sustainable,d=this.props?.alt_sustainable,c=this.props?.is_q_certified_arabica,p=this.props?.alt_q_certification_arabica):void 0===u.length?(e=u?.fair_trade,t=u?.alt_fair_trade,i=u?.is_organic,s=u?.alt_organic,n=u?.only_vertuo_next,r=u?.alt_vertuo_next,a=u?.is_rainforest,o=u?.alt_rainforest,l=u?.is_sustainable,d=u?.alt_sustainable,c=u?.is_q_certified_arabica,p=u?.alt_q_certification_arabica):u.length&&(_=[...u]),[[e,"fair_trade",t,_],[i,"is_organic",s,_],[n,"only_vertuo_next",r,_],[a,"is_rainforest",o,_],[l,"is_sustainable",d,_],[c,"is_q_certified_arabica",p,_]].map((e=>this.appendLogo.apply(this,e))),this.innerHTML=_.map((e=>`<img src="${f[e.name]}" alt="${e.alt}" loading="lazy">`)).join("")}appendLogo(e,t,i,s){e&&!this.hasLogo(s,t)&&s.push({name:t,alt:i})}hasLogo(e,t){return e.some((e=>e.name===t))}}function x(e){for(var t="",i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",s=i.length,n=0;n<e;n++)t+=i.charAt(Math.floor(Math.random()*s));return t}customElements.get("nb-card-logos")||customElements.define("nb-card-logos",w);const k=e=>C(JSON.stringify(e)),C=e=>e?e.toString().replace(/"/g,"&quot;").replace(/'/g,"&apos;"):"",$=(e,t)=>{for(let i in t)e.setAttribute(i,t[i])};class E{constructor(e){this._carousel=e,this._carousel._container.addEventListener("dragstart",(e=>e.preventDefault())),this._carousel._container.addEventListener("touchstart",(e=>this.startDrag(e)),{passive:!0}),this._carousel._container.addEventListener("mousedown",(e=>this.startDrag(e))),this._carousel._container.addEventListener("touchstart",(e=>this.startDrag(e)),{passive:!0}),window.addEventListener("mousemove",(e=>this.drag(e)),{passive:!1}),window.addEventListener("touchmove",(e=>this.drag(e)),{passive:!1}),window.addEventListener("mouseup",(()=>this.endDrag())),window.addEventListener("touchend",(()=>this.endDrag())),window.addEventListener("touchcancel",(()=>this.endDrag())),this.translateFactor=150}startDrag(e){e.touches&&e.touches.length>1||(e.touches&&(e=e.touches[0]),this._origin={x:e.screenX,y:e.screenY},this._width=this._carousel.containerWidth)}drag(e){if(!this._origin)return;const t=e.touches?e.touches[0]:e,i={x:t.screenX-this._origin.x,y:t.screenY-this._origin.y};this._lastTranslate=i;const s=this._carousel._currentIndex*this._carousel._widthSlide-this.translateFactor*i.x/this._width;this._carousel.translate(s)}preventMobileYTranslate(e,t){e.touches&&(e.touches&&Math.abs(t.x)>Math.abs(t.y)||e.touches&&Math.abs(t.y)>Math.abs(t.x))&&(e.preventDefault(),e.stopPropagation())}endDrag(){if(!this._origin||!this._lastTranslate)return this._origin=null,void(this._lastTranslate=null);const e=this._lastTranslate.x/this._carousel.carouselWidth;if(Math.abs(e)>.1){const e=this._lastTranslate.x<0?"next":"prev";this._carousel[e]()}else this._carousel.goToItem(this._carousel._currentIndex);this._origin=null,this._lastTranslate=null}}class L{constructor(e){this._carousel=e,new MutationObserver((e=>{e.forEach((function(e){if(!e||!e.oldValue||!e.classList)return;const t=e.classList.contains("has-overlay-absolute"),i=document.body.classList.contains("has-overlay");t&&!i&&this._carousel.goToItem(this._carousel._currentIndex)}))})).observe(document.body,{attributes:!0,attributeFilter:["class"],attributeOldValue:!0})}}class T{constructor(e,t={}){this._element=e,this._slides=[].slice.call(e.children);const i=t.index||0;this._options=Object.assign({},{slidesToScroll:1,slidesVisible:1,spaceBetween:0,navigationButton:!0,loop:!0,pagination:!0,hookGetRightBoundary:null,hookSlideChange:null,hookMove:null,hookNext:null,hookPrevious:null,pagination_variation:null,nav_centered:!1},t),this.moveCallbacks=[],this._ratio=this._slides.length/this._options.slidesVisible,this.buildIHM(),new L(this),this.hasPagination()&&(new E(this),this.goToItem(i))}get element(){return this._element}get slidesToScroll(){return this._options.slidesToScroll}get slidesVisible(){return this._options.slidesVisible}get slidesTotal(){return this._slides.length}get navigationButton(){return this._options.navigationButton}get navigationVariation(){return this._options.navigation_variation}get navigationSize(){return this._options.navigation_size}get loop(){return this._options.loop}get pagination(){return this._options.pagination}get containerWidth(){return this._container.offsetWidth}get carouselWidth(){return this._root.offsetWidth}get wrapperWidth(){return this._wrapper.offsetWidth}get paginationVariation(){return this._options.pagination_variation}get nav_centered(){return this._options.nav_centered}getSlideWidth(e){const{slidesVisible:t,spaceBetween:i}=this._options;return(e+parseInt(i))/t}buildIHM(){this._root=this.createElement("div","carousel"),this._container=this.createElement("div","container"),this._wrapper=this.createElement("div","wrapper"),this._children=this._slides.map((e=>{const t=this.createElement("div","item");return t.appendChild(e),this._container.appendChild(t),t})),this._wrapper.appendChild(this._container),this._root.appendChild(this._wrapper),this._element.appendChild(this._root),this.setWrapperStyle(),this.hasPagination()&&(this.navigationButton&&this.createNavigation(),this.pagination&&this.createPagination())}setWrapperStyle(){const e=this.wrapperWidth,t=this.getSlideWidth(e),i=t*this._children.length;this.setContainerWidth(i),this.setWrapperWidth(e);for(const e of this._children)this.setSlideWidth(e,t);this._widthContainer=i,this._widthSlide=t,this._widthWrapper=e}setSlideWidth(e,t){e.style.width=t-this._options.spaceBetween+"px",this._options.spaceBetween&&(e.style.marginRight=`${this._options.spaceBetween}px`)}setContainerWidth(e){this._container.style.width=`${e}px`}setWrapperWidth(e){this._wrapper.style.width=`${e}px`}disableTransition(){this._container.style.transition="none"}enableTransition(){this._container.style.transition=""}translate(e){this._container.style.left=-e+"px"}createElement(e,t){let i=document.createElement(e);return i.setAttribute("class",t),i}createNavigation(){const e=this.createElement("nb-cta","prev");e.setAttribute("variation","navigation"),e.setAttribute("contrast",this.navigationVariation),e.setAttribute("size",this.navigationSize),e.setAttribute("icon_right","chevron-left"),e.setAttribute("label","a11y_slider_previous_button");const t=this.createElement("nb-cta","next");t.setAttribute("variation","navigation"),t.setAttribute("contrast",this.navigationVariation),t.setAttribute("size",this.navigationSize),t.setAttribute("icon_right","chevron-right"),t.setAttribute("label","a11y_slider_next_button"),t.addEventListener("click",(()=>this.next())),e.addEventListener("click",(()=>this.prev())),t.addEventListener("keydown",(e=>"Enter"===e.key||"Space"===e.key?this.next():null)),e.addEventListener("keydown",(e=>"Enter"===e.key||"Space"===e.key?this.prev():null));let i=this._root.parentElement;i.appendChild(e),i.appendChild(t),this.onMove((i=>{const s=i._currentIndex+this.slidesVisible;this.loop||(i._currentIndex<=0?e.classList.add("hidden"):e.classList.remove("hidden"),this._slides.length===s?t.classList.add("hidden"):t.classList.remove("hidden"),this._options.hookMove&&this._options.hookMove(t))}))}getSlideNotVisible(){return this._children.length-(this.slidesVisible-1)}hasPagination(){return this.getSlideNotVisible()>1}createPaginationBullets(){const e=document.createElement("nav"),t=[];for(let i=0;i<this.getSlideNotVisible();i+=this.slidesToScroll){let s=document.createElement("span");s.innerText=(i+1).toString();let n=document.createElement("button");n.addEventListener("click",(()=>this.goToItem(i))),n.appendChild(s),e.appendChild(n),t.push(n)}const i=e=>{let i=t[e/this.slidesToScroll];i&&(t.forEach((e=>e.classList.remove("active"))),i.classList.add("active"))};i(this._currentIndex),this.onMove((()=>i(this._currentIndex))),this._root.parentElement.parentElement.appendChild(e)}createPaginationStepper(){const e=document.createElement("nav");let t=document.createElement("div");t.innerText=this.slidesTotal-this.slidesVisible+1,t.classList.add("totalPages");let i=document.createElement("div");i.innerText="/";let s=document.createElement("div");s.classList.add("currentPage"),e.appendChild(s),e.appendChild(i),e.appendChild(t),this.onMove((()=>s.innerText=this._currentIndex+1)),this.onMove((()=>e.setAttribute("aria-label",s.innerText+" "+i.innerHTML+" "+t.innerHTML))),this._root.parentElement.parentElement.appendChild(e)}createPagination(){this.slidesTotal<=5?this.createPaginationBullets():"stepper"===this.paginationVariation?(this.createPaginationStepper(),console.info("paginationVariation >> enabled")):(this.createPaginationBullets(),console.info("bullets enabled"))}next(){let e=this._currentIndex+this.slidesToScroll;this._options.hookNext&&(e=this._options.hookNext(e)),this.goToItem(e)}prev(){let e=this._currentIndex-this.slidesToScroll;this._options.hookPrevious&&(e=this._options.hookPrevious(e)),this.goToItem(e)}goToItem(e){this.hackUi();const t=this.getOverflowingIndex(e);let i=t*this._widthSlide;this._options.hookSlideChange&&(i=this._options.hookSlideChange(t,i)),this.translate(i),this._currentIndex=t,this.indexHasChange()}hackUi(){const e=document.querySelector("html");!e.classList.contains("has-overlay-absolute")&&e.classList.contains("has-overlay")}getOverflowingIndex(e){const t=this.getLeftBoundary(e),i=this.getRightBoundary(e),s=this._children.length-this._options.slidesVisible;return t?this.loop?s:0:i?this.loop?0:s:e}getLeftBoundary(e){return e<0}getRightBoundary(e){const t=e>=this._children.length,i=this.currentIndex+this.slidesVisible,s=void 0!==this._children[i],n=e>this.currentIndex;let r=t||n&&!s;return this._options.hookGetRightBoundary&&(r=this._options.hookGetRightBoundary(r,e)),r}_getMaxSlideWidth(e){return e.reduce(((e,t)=>Math.max(e,t.offsetWidth)),0)}onSlideChange(e){this.onMove(e)}onMove(e){this.moveCallbacks.push(e)}indexHasChange(){this.moveCallbacks.forEach((e=>e(this))),this.activateItems()}activateItems(){const e=this._currentIndex+this.slidesVisible;this._slides.map(((t,i)=>{t.classList.remove("active"),t.parentElement.classList.remove("activeParent"),i>=this._currentIndex&&i<e&&(t.classList.add("active"),t.parentElement.classList.add("activeParent"))}))}setClass(e){this._element.classList.add(e)}unsetClass(e){this._element.classList.remove(e)}get currentIndex(){return this._currentIndex}}class S extends HTMLElement{constructor(){super(),this._slider=null,this.randomId="slider_"+x(5)}static get observedAttributes(){return["slides_to_scroll","slides_visible","pagination","pagination_variation","nav_centered"]}connectedCallback(){this.slot=this.innerHTML,this.props=e(this.attributes),this.render()}createProps(){return[...this.attributes].reduce(((e,t)=>({...e,[t.nodeName]:t.nodeValue})),{})}render(){this.innerHTML=`<div class="slider ${this.randomId}">${this.slot}</div>`,this.loadSlider()}loadSlider(){const{indexSlider:e=0,slides_loop:t="true",slides_visible:i=4,slides_to_scroll:s=1,navigation:n="true",pagination:r="true",space_between:a=0,navigation_variation:o="dark",navigation_size:l="48",pagination_variation:d="stepper",nav_centered:c="false"}=this.props,p=this.querySelector(`.${this.randomId}`),h={index:parseInt(e),slidesToScroll:parseInt(s),slidesVisible:parseInt(i),spaceBetween:a,loop:"true"===t,navigationButton:"true"===n,pagination:"true"===r,navigation_variation:o,navigation_size:l,pagination_variation:d,nav_centered:c};this._slider=new T(p,h),this._slider.setClass("first"),this._slider.onSlideChange(this.handleClick.bind(this))}handleClick(){var e;g({eventName:"WEB_COMPONENT_SLIDE_CHANGE"}),this.toggleClasses(),e={rootElement:["nb-slider"]},window.gtmDataObject.push({event:"itemDisplay",eventRaisedBy:"Web component",eventAction:"Click",itemTypes:["products"],...e})}toggleClasses(){const e=0===this._slider.currentIndex,t=this._slider.slidesTotal===this._slider.currentIndex+this._slider.slidesVisible;this._slider.unsetClass("last"),this._slider.unsetClass("first"),e?this._slider.setClass("first"):t&&this._slider.setClass("last")}}customElements.get("nb-slider")||customElements.define("nb-slider",S);class P extends HTMLElement{constructor(){super(),this.props={}}connectedCallback(){this.props=e(this.attributes),this.render()}render(){const{slides:e,image_alt_text:t}=this.props;let i=document.createElement("nb-slider");$(i,{slides_to_scroll:"1",slides_visible:"1",navigation:"true",navigation_variation:"highlight",navigation_size:"32",pagination:"true"});let s=document.createElement("nb-loader");$(s,{icon:"loading"}),this.appendChild(s);e.forEach((e=>{const s=`${e.url}?impolicy=product&imwidth=600`;let n=document.createElement("img");n.setAttribute("alt",t),n.setAttribute("title",t),n.setAttribute("data-src",s),i.appendChild(n)})),this.appendChild(i),e.forEach((e=>{const t=`${e.url}?impolicy=product&imwidth=600`;!function(e,t,i,s,n){const r=(t,i)=>{e.setAttribute(t,i);const r=()=>e.classList.add("lazy-loaded");if(s){const t=new Image;return t.src=s,t.onload=r,void(t.onerror=()=>{n&&n(`Image ${s} cannot be loaded.`),e.classList.add("lazy-loaded-error")})}r()};if(/Trident\/|MSIE/.test(window.navigator.userAgent)||(a=window.navigator.userAgent,o=a.indexOf("OS "),(a.indexOf("iPhone")>-1||a.indexOf("iPad")>-1)&&o>-1&&window.Number(a.substr(o+3,3).replace("_","."))<14))r(t,i);else if("IntersectionObserver"in window){e.classList.add("lazy-load");let s=new IntersectionObserver((function(e){e.forEach((function(e){e.isIntersecting&&(r(t,i),s.unobserve(e.target))}))}));s.observe(e)}else r(t,i);var a,o}(i.querySelector(`img[data-src="${t}"]`),"src",t,t)}))}}customElements.get("nb-product-card-image-slider")||customElements.define("nb-product-card-image-slider",P);class N extends HTMLElement{constructor(){super(),this.parent=null,this.popin=null,this.idPopin=`plp-product-card-expandable-${x(5)}`,this.button3DRendered=!1}static get observedAttributes(){return["data","expanded","class"]}async connectedCallback(){this.props=e(this.attributes),this.render(),this.refs=i(this),this.createEventListeners()}attributeChangedCallback(e,t,i){"data"===e&&t&&(this.classList.add("loading"),setTimeout((()=>{a(this.eventListeners),this.initialize()}),300),setTimeout((()=>{this.classList.remove("loading")}),500)),"expanded"===e&&t!==i&&this.toggle("true"===i),"class"!==e||this.classList.contains("plp-product-card-expandable")||this.classList.add("plp-product-card-expandable")}createEventListeners(){const e=[{element:this,type:"EVENT_CROSS_SELL_READY",listener:this.onParentReady.bind(this)},this.refs.view&&{element:this.refs.view,type:"click",listener:this.onToggle.bind(this)}].filter(Boolean);!l.is.mobile&&this.refs.close&&e.push({element:this.refs.close,type:"click",listener:this.onToggle.bind(this)}),this.hasBundleDetails()&&this.refs.bundleDetails&&e.push({element:this.refs.bundleDetails,type:"click",listener:this.onOpenBundleDetails.bind(this)}),r(e),this.eventListeners=e}render(){this.innerHTML=`\n            ${this.renderCard()}\n            ${this.renderDetails()}\n            ${this.renderOverlay()}\n        `,this.loadStrikethroughPrice()}renderA11y(e){return e&&`<span class="sr-only">${e}</span>`}renderCover(e=!1){const{slides:t=[],variant:{show_slider:i=!1}={}}=this.props,s=i&&t.length>1;return!l.is.mobile&&this.isType("is_machine")&&s?this.renderCoverSlider():this.renderCoverImage(e)}renderCoverMobile(){return`\n            <div class="plp-product-card-expandable__cover">\n                ${this.renderCover(!0)}\n            </div>\n        `}renderCoverSlider(){const{slides:e=[],image_alt_text:t,name:i=""}=this.props;return`<nb-product-card-image-slider data="${k({slides:e,image_alt_text:t||i})}"></nb-product-card-image-slider>`}renderCoverImage(){const{image_alt_text:e,images:t={},api_override:i={}}=this.props,{icon:s=""}=t;return`\n            <img\n                alt="${e}"\n                src="${i.image||s}?impolicy=product&imwidth=300"\n                loading="lazy"\n            />\n        `}renderLogos(){const{variant:{logos:e=[]}}=this.props;if(!Array.isArray(e))return"";return`<div class="plp-product-card-expandable__logos">${e.map(this.renderLogo.bind(this)).join("")}</div>`}renderLogo({name:e,alt:t}){return f[e]?`<img src="${f[e]}" alt="${t}" loading="lazy">`:""}renderLabels(){const{labels:e=[]}=this.props;if(0===e.length)return"";return`<nb-card-labels data="${k({labels:e})}"></nb-card-labels>`}renderOverlay(){const{variant:{colors:e=[]}={}}=this.props;return!l.is.mobile&&this.isType("is_machine")&&0!==e.length?'\n                <div class="plp-product-card-expandable__overlay">\n                    <nb-loader></nb-loader>\n                </div>\n            ':""}renderCard(){const{a11y_product_card:e="",name:t,quick_view:i}=this.props;return`\n            <div class="plp-product-card-expandable__card">\n                ${this.renderA11y(e)}\n                <div class="plp-product-card-expandable__cover">\n                    ${this.renderCover()}\n                </div>\n                ${this.renderLabels()}\n                ${this.renderLogos()}\n                <div class="plp-product-card-expandable__content">\n                    <h3>${t}</h3>\n                    ${this.renderHeadline()}\n                    ${this.renderLink(i,"view")}\n                    <div class="plp-product-card-expandable__priceWrapper">\n                        <div class="plp-product-card-expandable__priceInnerWrapper">\n                            ${this.renderPrice(!0)}\n                        </div>\n                        ${this.renderAddToCart({mode:"card"})}\n                    </div>\n                </div>\n            </div>\n        `}async loadStrikethroughPrice(){const{strikethrough_price:e}=this.props;if(!e)return;const t=this.querySelector(".plp-product-card-expandable__priceInnerWrapper"),i=await(async e=>e?`<p class="cn_card__strikethroughPrice">${await h(e)}</p>`:"")(e);t.innerHTML=i+t.innerHTML}renderDetails(){const e=this.renderCardDetails();return l.is.mobile?this.popin?(this.popin.querySelector(".content").innerHTML=e,""):`<nb-popin id="${this.idPopin}" data-ref="popin" variation="before" bgcolor="white">${e}</nb-popin>`:e}renderCardDetails(){const{name:e="",discover_more:t,highlighted:i}=this.props;return`\n            <aside>\n                <div class="plp-product-card-expandable__details" data-ref="details" ${i?'highlighted="true"':""}>\n                    ${l.is.mobile?"":this.renderButtonClose()}\n                    ${l.is.mobile?this.renderCoverMobile():""}\n                    ${l.is.mobile?this.renderLabels():""}\n                    ${l.is.mobile?this.renderLogos():""}\n                    <div class="plp-product-card-expandable__content">\n                        <p class="plp-product-card-expandable__title h-lg-700-caps-sl">${e}</p>\n                        ${this.isType(["is_machine","is_accessory"])&&this.renderRating()}\n                        ${this.isType("is_capsule")&&this.renderIntensity()}\n                        ${this.renderDescription()}\n                        ${this.isType("is_capsule")&&this.renderBundleDetails()}\n                        ${this.renderExternalLink(t,"more")}\n                        ${this.isType("is_machine")&&this.renderColors()}\n                    </div>\n                    <div class="plp-product-card-expandable__priceWrapper">\n                        <div class="plp-product-card-expandable__priceInnerWrapper">\n                            ${this.renderPrice(!0)}\n                        </div>\n                        <div class="plp-product-card-expandable__actions">\n                            ${this.renderAddToCart({mode:"details"})}\n                            <div class="replace-with-button3d"></div>\n                        </div>\n                    </div>\n                </div>\n            </aside>\n        `}renderBundleDetails(){const{bundled:e=!1,variant:{bundle_details:{popin_link_text:t=""}={}}={}}=this.props;return e&&""!==t?`\n            <nb-link\n                class="plp-product-card-expandable__link--bundle-details"\n                data-ref="bundleDetails"\n                label="${t}"\n                size="large"\n                color="gold"\n            ></nb-link>\n        `:""}renderBundleDetailsPopin(){const{variant:{bundle_details:{popin_label_close:e=""}={}}={}}=this.props;let t=document.getElementById("bundle-popin-id");t||(this.parent.insertAdjacentHTML("beforeend",`<nb-popin\n                    content=""\n                    class="plp-product-card-expandable__popin-bundle-details"\n                    id="bundle-popin-id"\n                    label_close="${e}"\n                    variation="before"\n                    bgcolor="highlight"\n                    size="L"\n                    padding="false"\n                ></nb-popin>`),t=document.getElementById("bundle-popin-id")),this.refs.popinBundleDetails=t}renderHeadline(){const{headline:e}=this.props;return void 0===e?"":`<p class="plp-product-card-expandable__headline">${e}</p>`}renderDescription(){const{headline:e,description:t=""}=this.props,i=this.stripFirstHtmlLevel(t);return""===i&&""===e?"":`<p class="plp-product-card-expandable__description t-sm-400">${""!==i?i:e}</p>`}renderExternalLink(e,t){if(this.isType("is_giftcard"))return"";const{pdp_urls:{desktop:i=""}={}}=this.props;return this.renderLink(e,t,i)}renderLink(e,t,i=""){return`\n            <nb-link\n                data-ref="${t}"\n                class="plp-product-card-expandable__link--${t}"\n                color="gold"\n                size="large"\n                ${i&&`link="${i}"`}\n            >${e}</nb-link>\n        `}renderRating(){const{minimum_rating:e="0",rating:t="0",show_ratings:i=!1}=this.props,s=parseFloat(t),n=parseFloat(e);if(!i||!s||s<n)return"";return`<nb-rating class="plp-product-card-expandable__rating" data="${k({stars:t})}"></nb-rating>`}renderColors(){const{url:e="",name:t="",variant:{colors:i=[]}={},sku:s}=this.props;if(0===i.length)return"";return`\n            <nb-colors\n                data="${k({colors:i,activeSku:s,max_colors:"4",extra_url:e,extra_title:t})}"\n                prevent\n            ></nb-colors>\n        `}renderIntensity(){const{intensity:e=0,a11y_intensity_max:t,intensity_label:i}=this.props;return 0===e?"":`\n            <nb-intensity\n                a11y_intensity_max="${t}"\n                class="plp-product-card-expandable__intensity"\n                intensity="${e}"\n                intensity_label="${i}"\n            ></nb-intensity>\n        `}renderPrice(e=""){const{price:t,a11y_price:i,variant:{giftcard_price:s=""}}=this.props;if(!t||this.isType("is_giftcard")&&!s)return"";const n=`${t} ${i}`;return`\n            <div class="plp-product-card-expandable__price">${t}</div>\n            ${this.isType("is_capsule")&&e&&this.renderSleeve()}\n            ${this.isType("is_capsule")&&this.props.variant.show_sleeve_price?(e=>{const{show_capsule_price:t=!1,price_per_capsule:i,capsule_price_label:s,capsule_price_syntax:n="{capsule_price_label}: {price_per_capsule}"}=e;return t?`<p class="cn_card__priceWrapper--items capsulePrice">${function(e,t,i,s){let n=0;for(;e;){const r=e.indexOf(i,n);if(-1===r)break;const a=e.indexOf(s,r+1);if(-1===a)break;const o=e.substring(r+i.length,a);null!=t[o]?(e=e.substr(0,r)+t[o]+e.substr(a+s.length),n=r):n=a}return e}(n,{capsule_price_label:s,price_per_capsule:i},"{","}")}</p>`:""})(this.props.variant):""}\n            ${this.renderA11y(n)}\n        `}renderSleeve(){const{bundled:e=!1,sales_multiple:t,unit_quantity:i,show_sleeve:s=!1,variant:{number_of_sleeves:n}={},label_sleeve:r,label_sleeves:a,label_capsules:o}=this.props;if(!s||["","0"].includes(n))return"";return`\n            <p class="plp-product-card-expandable__sleeve">\n                ${n} ${n>1&&a?a:r} (${e?i:t} ${o})\n            </p>\n        `}renderAddToCart({mode:e}){const{sku:t,longSku:i="",variant:{giftcard_price:s=""}={},range:n,quantity_selector:r={}}=this.props,{index:a=null}=this.dataset,o="plp-product-card-expandable__buy",l={price:s,sku:t,quantity_selector:r};return this.isType("is_giftcard")&&s?`<nb-add-gift-card class="${o}" data="${k(l)}"></nb-add-gift-card>`:`\n            <nb-add-to-cart\n                class="${o}"\n                buttonSize="large"\n                showPrice\n                sku="${t}"\n                ${i&&`longSku="${i}"`}\n                position="${a}"\n                range="${e}-${n}"\n            ></nb-add-to-cart>\n        `}renderButtonClose(){const{variant:{bundle_details:{popin_label_close:e=""}={}}={}}=this.props;return`<nb-cta\n                    variation="navigation"\n                    contrast="highlight"\n                    icon_right="close-2"\n                    class="plp-product-card-expandable__close"\n                    data-ref="close"\n                    label="${e}"\n                ></nb-cta>`}renderCheck3D(){const{check_3d:e,variant:{key_3d:t=""}={}}=this.props;if(""===t)return"";const i=document.createElement("nb-cta-3d");i.setAttribute("class","plp-product-card-expandable__3d"),i.setAttribute("cta_ide_event",this.ctaIDEvent),i.setAttribute("key_3d",t),i.setAttribute("label_button_3d",e),this.querySelector(".replace-with-button3d").replaceWith(i)}isType(e){const{variant:t=null}=this.props;return t?Array.isArray(e)?(i=Object.keys(t),s=e,i.filter((e=>s.includes(e))).length>0||""):t[e]||"":"";var i,s}hasBundleDetails(){const{bundled:e=!1,variant:{bundle_details:{popin_link_text:t=""}={}}={}}=this.props;return!(!e||""===t)}stripFirstHtmlLevel(e){const t=document.createElement("div");return t.innerHTML=e,t.firstChild instanceof HTMLElement?t.firstChild.innerHTML:e}setDefaultAttributes(){const{category_name:e="",sku:t="",position:i=""}=this.props;this.setAttribute("data-product-item-id",t),this.setAttribute("data-product-section",e),this.setAttribute("data-product-position",i)}setDefaultStyles(){this.classList.add("class","plp-product-card-expandable")}onParentReady(e){const{parent:t,geometry:i}=m(e);this.parent=t,this.setDefaultAttributes(),this.setDefaultStyles(i),l.is.mobile&&this.extractPopin(),this.hasBundleDetails()&&this.renderBundleDetailsPopin()}onToggle(e=null){e.preventDefault(),console.log("onToggle"),console.log(this.getAttribute("expanded"),typeof this.getAttribute("expanded"));const t="true"===this.getAttribute("expanded");t||this.button3DRendered||this.renderCheck3D(),this.button3DRendered=!0,this.setAttribute("expanded",!t)}onOpenBundleDetails(){const{popinBundleDetails:e}=this.refs,{sku:t="",variant:{bundle_details:{description:i="",other_skus:s=[],other_skus_quantity:n=""}={}}={},range:r}=this.props,{index:a=null}=this.dataset,o=`\n            <nb-bundle-details\n                description="${i}"\n                main_sku="${t}"\n                other_skus="${s}"\n                other_skus_quantity= "${n}"\n                range="${r}"\n                position="${a}"\n            >\n            </nb-bundle-details>\n        `;e.setAttribute("content",o),g({eventName:"WEB_COMPONENT_POPIN_OPEN",args:{id:"bundle-popin-id"}})}toggle(e){const t=e?"add":"remove",{index:i=null}=this.dataset;this.classList[t]("plp-product-card-expandable--expanded"),g({element:this.parent,eventName:"EVENT_PRODUCT_CARD_TOGGLE",args:{expanded:e,index:i}})}extractPopin(){const{popin:e}=this.refs;this.parent.append(e);const t=[{element:e.querySelector(".button--navigation"),type:"click",listener:this.onToggle.bind(this)}],i=e.querySelector('[data-ref="bundleDetails"]');this.hasBundleDetails()&&i&&t.push({element:i,type:"click",listener:this.onOpenBundleDetails.bind(this)}),r(t),this.eventListeners=[...this.eventListeners,t],this.popin=this.parent.querySelector(`#${this.idPopin}`)}}customElements.get("nb-plp-product-card-expandable")||customElements.define("nb-plp-product-card-expandable",N);class I extends HTMLElement{constructor(){super(),this._fetchedProducts=[],this._expandedCardIndex=-1}async connectedCallback(){this.props=e(this.attributes),this.classes=this.createClasses(),this.render(),this.refs=i(this),await _.loadPriceFormat(),this.fetchProducts()}fetchProducts(){const{options:{show_ratings:e=!1}={}}=this.props;this._fetchedProducts=[...this.props.products].splice(0,8),_.getAll(this._fetchedProducts,e).finally((()=>{this.refs.sliderContainer.innerHTML=this.renderSlider(),this.refs=i(this),this.sliderManager=b(this),this.createEventListeners()}))}createClasses(){const{layout:{padding_top:e,padding_bottom:t}={}}=this.props,i="nb-cross-sell";return this.classList.add(i),{container:`${e} ${t} `,heading:`${i}__heading h-2xl-300`,link:`${i}__link`,slider:`${i}__slider`,background:`${i}__background`}}createEventListeners(){const e=[{element:this,type:"EVENT_PRODUCT_CARD_TOGGLE",listener:this.onCardToggle.bind(this)},{element:this,type:"EVENT_COLOR_CHANGE",listener:this.onColorChange.bind(this)}];r(e),this.eventListeners=e}render(){const{campaign:e,layout:t}=this.props,{heading:i}=this.props.copywriting;this.innerHTML=`\n            <nb-container\n                contrast="${t.contrast}"\n                background_color="${t.background_color}"\n                campaign_id="${e.id}"\n                campaign_name="${e.name}"\n                campaign_creative="${e.creative}"\n                campaign_position="${e.position}"\n                classname="${this.classes.container}"\n            >\n                ${i&&`<h2 class="${this.classes.heading}">${i}</h2>`}\n                ${this.renderLink()}\n                ${this.renderSliderContainer()}\n            </nb-container>\n        `}renderBackground(){const{background:e={}}=this.props.layout,t=d.getResponsiveSrc(e);return t&&`<img class="${this.classes.background}" src="${t}" alt="${e.background_image_alt}" loading=lazy />`}renderLink(){const{link:{label:e="",link:t="",size:i="large",color:s="gold",seo_label:n}={}}=this.props.copywriting;return e&&t?`\n            <nb-link\n                class="${this.classes.link}"\n                color="${s}"\n                link="${t}"\n                size="${i}"\n                title="${e}"\n                ${n&&`seo_label='${n}'`}\n            >${e}</nb-link>\n        `:""}renderSliderContainer(){return`\n            <div class="${this.classes.slider}" data-ref="sliderContainer">\n                ${this.renderBackground()}\n            </div>\n        `}renderSlider(){return`\n                ${this.renderBackground()}\n                <nb-slider\n                    pagination="true"\n                    slides_to_scroll="1"\n                    slides_loop="false"\n                    slides_visible="${this.getSlidesVisible()}"\n                    data-ref="slider">\n                    ${this.renderSlides()}\n                </nb-slider>\n            `}renderSlides(){return this._fetchedProducts.map(this.renderSlide.bind(this)).join("")}renderSlide(e,t){const i=k(this.prepareProductData(e));return`\n            <nb-plp-product-card-expandable\n                ${e.highlighted?`highlighted="${e.highlighted}"`:""}\n                data="${i}"\n                data-index="${t}"\n            ></nb-plp-product-card-expandable>\n        `}prepareProductData(e){e.unitQuantity=e.unit_quantity,e.salesMultiple=e.sales_multiple;const t=c(e);e.variant.number_of_sleeves=e.variant.number_of_sleeves||t;let{showCapsulePrice:i,price:s,price_per_capsule:n}=function(e,t,i){let s,n,r=e;const a=i(t);return e&&"capsule"===t.type&&!a?(s=!1===a?t.price*t.salesMultiple:t.price,s=Math.round(100*s)/100,n=t.price):(r=!1,s=t.price),{showCapsulePrice:r,price:s,price_per_capsule:n}}(e.variant.show_sleeve_price,e,p);return e.price=_.formatPrice(s),e.variant.show_capsule_price=i,e.variant.price_per_capsule=_.formatPrice(n),{...this.props.options,...this.props.copywriting,...e,range:e.productCategories?e.productCategories[0].name:"",quantity_selector:{...this.props.quantity_selector}}}tmpOverrideProductData(e){return e.unitQuantity=e.unit_quantity,e.salesMultiple=e.sales_multiple,e.variant.number_of_sleeves=e.variant.number_of_sleeves||c(e),e}getSlidesVisible(){return l.is.mobile?1:window.innerWidth>=768&&window.innerWidth<=1024?2:3}onCardToggle(e){const{expanded:t,index:i}=m(e);this.sliderManager.update(t,parseInt(i)),this.emit("WEB_COMPONENT_SLIDE_CHANGE"),t&&(this.track(),this.emit(l.is.mobile?"WEB_COMPONENT_POPIN_OPEN":"WEB_COMPONENT_DETAIL_OPEN",{id:`PRODUCT_DETAIL_POPIN_${i}`})),this._expandedCardIndex=t?parseInt(i):-1}async onColorChange(e){const{productData:t}=m(e);this.updateCardData(t)}updateCardData(e){if(!this.sliderManager.slider||this._expandedCardIndex<0)return;const t=this.sliderManager.slider._slides[this._expandedCardIndex],i=this._fetchedProducts[this._expandedCardIndex],s=e.sku===i.sku?i:this.mergeCardData(i,e),n=this.prepareProductData(s);t.setAttribute("data",JSON.stringify(n))}mergeCardData(e,t){const i=_.merge(e,t,!0);return i.price=_.formatPrice(i.price),i.longSku=t.id,e.pdp_urls=t.pdpURLs,i}track(){var e;e={eventAction:"Click CTA",eventLabel:"Page Builder - Cross Sell - Click CTA - Quick view"},window.gtmDataObject.push({event:"customEvent",eventRaisedBy:"Web component",eventCategory:"User Engagement",eventAction:"Click",eventLabel:"",nonInteraction:0,...e})}emit(e,t){g({eventName:e,args:t})}}customElements.get("nb-cross-sell")||customElements.define("nb-cross-sell",I);export{I as default};
