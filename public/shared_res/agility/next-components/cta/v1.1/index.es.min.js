const e=e=>null==e;class t{constructor(){this._bus=document.createElement("div")}register(e,t){this._bus.addEventListener(e,t)}remove(e,t){this._bus.removeEventListener(e,t)}fire(e,t={}){this._bus.dispatchEvent(new CustomEvent(e,{detail:t}))}}if(!n)var n=new t;var a=n;const s=({eventName:e,args:t,element:n})=>{let a;n=n||window,t?a=new CustomEvent(e,{detail:t,bubbles:!0}):"function"==typeof Event?a=new Event(e):(a=document.createEvent("Event"),a.initEvent(e,!0,!0)),n.dispatchEvent(a)};window.gtmDataObject=window.gtmDataObject||[];class i extends HTMLElement{constructor(){super(),this.template=""}connectedCallback(){this.props=this._createProps(),this.onStart?.(),this.loadTemplate(),this.onReady?.()}_createProps(e=null){const t=e||this.attributes;let n;try{n=[...t].reduce(((e,t)=>({...e,[t.nodeName]:t.nodeValue})),{});const e=[...t].find((e=>"data"===e.nodeName));return null==e?n:{...n,...JSON.parse(e.nodeValue)}}catch(e){console.log("ERROR: No data",e)}}render(e=!1){e&&(this.innerHTML="");const t=(e,n)=>{const a=e=>3===e.nodeType?"text":8===e.nodeType?"comment":e.tagName.toLowerCase(),s=e=>e.childNodes&&e.childNodes.length>0?null:e.textContent;var i=Array.prototype.slice.call(n.childNodes),o=Array.prototype.slice.call(e.childNodes),r=i.length-o.length;if(r>0)for(;r>0;r--)i[i.length-r].parentNode.removeChild(i[i.length-r]);o.forEach((function(e,o){if(i[o])if(a(e)===a(i[o])){var r=s(e);if(r&&r!==s(i[o])&&(i[o].textContent=r),i[o].childNodes.length>0&&e.childNodes.length<1)i[o].innerHTML="";else{if(i[o].childNodes.length<1&&e.childNodes.length>0){var l=document.createDocumentFragment();return t(e,l),void i[o].appendChild(l)}e.childNodes.length>0&&t(e,i[o])}}else i[o].parentNode.replaceChild(e.cloneNode(!0),i[o]);else n.appendChild(e.cloneNode(!0))}))},n=(a=this.template,(new DOMParser).parseFromString(a,"text/html").body);var a;t(n,this)}loadTemplate(e="",t=!1){this.template=""===e?this.template:`${e}`,this.render(t)}disconnectedCallback(){this.onDestroy?.()}}customElements.get("nb-nespresso-element")||customElements.define("nb-nespresso-element",i);const o=()=>window[window?.padlNamespace]?.dataLayer;class r extends HTMLElement{constructor(){super(),this.props={},this.market=(()=>{const e=o();return e?e.app.app.market.toLocaleLowerCase():"ch"})(),this.language=o()?o().page.page.pageInfo.language.toLocaleLowerCase():"en"}static get observedAttributes(){return["slot","quantity"]}connectedCallback(){this.props=(t=>{const n=(e=>e.find((e=>"data"===e.nodeName)))([...t]),a=[...t].filter((e=>"data"!==e.nodeName)).reduce(((e,t)=>({...e,[t.nodeName]:t.nodeValue})),{});if(e(n))return a;try{return{...a,...JSON.parse(n.nodeValue)}}catch(e){console.log("ERROR: No data",e)}})(this.attributes),this.boundHandleClick=this.handleClick.bind(this),this.slot=this.innerHTML.replace(/\n*$/,"").trim(),this.render()}render(){const{variation:e,contrast:t,transparent:n="false",size:a="48",icon_right:s="",icon_left:i="",label:o,seo_label:r="",aria_label_before:l,aria_label_after:c,link_new_tab:d=!1,label_update:h,add_to_cart:p=""}=this.props;let{link:m}=this.props;const u=this.slot?this.slot:o,b=document.createElement(m?"a":"button");m&&(m=m.replace("{market}",this.market),m=m.replace("{lang}",this.language),b.setAttribute("href",m)),m&&d&&b.setAttribute("target","_blank"),r&&m&&b.setAttribute("title",r),l&&b.setAttribute("aria-label",l+" "+u),c&&b.setAttribute("aria-label",u+" "+c),l&&c&&b.setAttribute("aria-label",l+" "+u+" "+c),"navigation"!==e&&b.classList.add("button--cta"),b.classList.add(`button--${e}`),t&&("true"===n?b.classList.add(`button--${t}--transparent`):b.classList.add(`button--${t}`)),a&&b.classList.add(`size--${a}`),"primary"!==e&&"tertiary"!==e||""===p||(this.setAttribute("quantity","0"),"small"===p?b.classList.add("addToCart--small"):b.classList.add("addToCart--large")),i&&this.setAttribute("icon_left",i),s&&this.setAttribute("icon_right",s),b.innerHTML=`\n                ${i&&`<nb-icon icon='${i}'></nb-icon>`}\n                <span>${u}</span>\n                ${"primary"===e&&""!==p&&""!==h?`<span class="update">${h}</span>`:""}\n                ${s&&`<nb-icon icon='${s}'></nb-icon>`}\n        `,this.innerHTML=b.outerHTML,this.removeListeners(),this.addListeners()}handleClick(){this.track();const{event_id:e="",popin_id:t="",qs_id:n=""}=this.props;e&&a.fire(e,{}),t&&this.popin(t),n&&this.openQuantitySelector(n)}popin(e){s({eventName:"WEB_COMPONENT_POPIN_OPEN",args:{id:e}})}openQuantitySelector(e){s({eventName:"WEB_COMPONENT_QS_OPEN",args:{id:e}})}track(){this.props.campaign_id&&this.handlePromoClick(),this.props.tracking_label&&this.handleCustomEvent()}handlePromoClick(){const{campaign_id:e="",campaign_name:t="",campaign_position:n="",campaign_creative:a=""}=this.props;var s;""!==e&&(s={ecommerce:{promoClick:{promotions:[{id:e,name:t,position:n,creative:a}]}}},window.gtmDataObject.push({event:"promoClick",eventRaisedBy:"Web component",ecommerce:{},...s}))}handleCustomEvent(){const{tracking_label:e=""}=this.props;var t;""!==e&&(t={eventAction:"Click CTA",eventLabel:e},window.gtmDataObject.push({event:"customEvent",eventRaisedBy:"Web component",eventCategory:"User Engagement",eventAction:"Click",eventLabel:"",nonInteraction:0,...t}))}attributeChangedCallback(e){"slot"===e&&this.render(),"quantity"===e&&(this.classList.add("updated"),setTimeout((()=>{this.classList.remove("updated")}),1200))}addListeners(){this.addEventListener("click",this.boundHandleClick)}removeListeners(){this.removeEventListener("click",this.boundHandleClick)}disconnectedCallback(){this.removeListeners()}}customElements.get("nb-cta")||customElements.define("nb-cta",r);export{r as default};
