class e extends HTMLElement{constructor(){super(),this.template=""}connectedCallback(){this.props=this._createProps(),this.onStart?.(),this.loadTemplate(),this.onReady?.()}_createProps(e=null){const t=e||this.attributes;let n;try{n=[...t].reduce(((e,t)=>({...e,[t.nodeName]:t.nodeValue})),{});const e=[...t].find((e=>"data"===e.nodeName));return null==e?n:{...n,...JSON.parse(e.nodeValue)}}catch(e){console.log("ERROR: No data",e)}}render(e=!1){e&&(this.innerHTML="");const t=(e,n)=>{const s=e=>3===e.nodeType?"text":8===e.nodeType?"comment":e.tagName.toLowerCase(),r=e=>e.childNodes&&e.childNodes.length>0?null:e.textContent;var i=Array.prototype.slice.call(n.childNodes),a=Array.prototype.slice.call(e.childNodes),l=i.length-a.length;if(l>0)for(;l>0;l--)i[i.length-l].parentNode.removeChild(i[i.length-l]);a.forEach((function(e,a){if(i[a])if(s(e)===s(i[a])){var l=r(e);if(l&&l!==r(i[a])&&(i[a].textContent=l),i[a].childNodes.length>0&&e.childNodes.length<1)i[a].innerHTML="";else{if(i[a].childNodes.length<1&&e.childNodes.length>0){var o=document.createDocumentFragment();return t(e,o),void i[a].appendChild(o)}e.childNodes.length>0&&t(e,i[a])}}else i[a].parentNode.replaceChild(e.cloneNode(!0),i[a]);else n.appendChild(e.cloneNode(!0))}))},n=(s=this.template,(new DOMParser).parseFromString(s,"text/html").body);var s;t(n,this)}loadTemplate(e="",t=!1){this.template=""===e?this.template:`${e}`,this.render(t)}disconnectedCallback(){this.onDestroy?.()}}customElements.get("nb-nespresso-element")||customElements.define("nb-nespresso-element",e);const t=async e=>{const t=await(async()=>await window.napi.priceFormat())(),n=window[window.config.padl.namespace].dataLayer.app.app.currency;return t.html?t.html(n,e):t.short(n,e)||""},n=e=>e.querySelector(".cb-price-old"),s=({strikethrough_price:e},s)=>{return e?((r=e,t(r)).then((e=>{const t=n(s);t&&(t.innerHTML=e)})).catch((e=>{console.error(`Error: Component SKU - Strike Through Price  - ${e}`);const t=n(s);t&&(t.style.display="none")})),'<p class="cb-price-old"></p>'):"";var r};function r(e,t,n,s){let r=0;for(;e;){const i=e.indexOf(n,r);if(-1===i)break;const a=e.indexOf(s,i+1);if(-1===a)break;const l=e.substring(i+n.length,a);null!=t[l]?(e=e.substr(0,i)+t[l]+e.substr(a+s.length),r=i):r=a}return e}const i=e=>e?e.toString().replace(/"/g,"&quot;").replace(/'/g,"&apos;"):"",a={get is(){const{innerWidth:e,devicePixelRatio:t}=window;return{mobile:e<768,mobile_tablet:e<1024,tablet:e>=768&&e<1024,desktop:e>=1024&&t<=1,retina:e>=1024&&t>1}},lt:e=>window.innerWidth<e},l="plp";window.napi&&window.napi.ratings;const o=({colors:e,sku:t,max_colors:n=4,a11y_extra_color:s="",url:r,activeSku:l,name:o})=>{if(!e)return"";var c;return`<nb-colors data="${c={colors:e,max_colors:n,activeSku:l||t,extra_url:r,extra_title:o+", "+s},i(JSON.stringify(c))}" size="${a.is.mobile?"small":"large"}"></nb-colors>`};class c extends e{loadTemplate(){const{popin_id:e,close:t,footer:n}=this.props.popin,{product:s}=this.props;if(this.product=s,!e||!this.product.name)return"";this.classList.add("nb-sku"),this.template=`<nb-popin\n                id="${e}"\n                heading="${this.product.name}"\n                size="S"\n                variation="next"\n                bgcolor="highlight"\n                label_close="${t}"\n                footer="${n}"\n            >\n                ${this.renderProduct()}\n                ${this.renderLevels()}\n                ${this.renderCupSizes()}\n                ${this.renderAromaticProfile()}\n                ${this.renderFeatures()}\n                ${this.renderIndredients()}\n                ${this.renderLink()}\n            </nb-popin>`,this.render(),this.renderFooter()}renderProduct(){let e="";return this.product.headline&&""!==this.product.headline?e=this.product.headline:this.product.description&&(e=this.product.description),`\n            <div class='cb-row'>\n                ${this.renderImageOrSlider()}\n                <div>\n                    <div class="t-xs-500 wysiwyg">${e}</div>\n                    ${this.renderProductType()}\n                </div>\n            </div>\n        `}renderProductType(){switch(this.product.type){case"capsule":return this.renderCoffee();case"machine":return this.renderMachine();default:return""}}renderCoffee(){const{product:e,intensity:t}=this.props;return`\n            ${(({technologies:e,intensity:t,a11y_intensity_max:n,intensity_label:s=""})=>{const r=(({technologies:e})=>e.indexOf("original")?14:12)({technologies:e});return 0===t?"":`<nb-intensity\n        class="t-xs-500-sl"\n        intensity="${t}"\n        max_intensity="${r}"\n        a11y_intensity_max="${n}"\n        intensity_label="${s}">\n    </nb-intensity>`})({...t,intensity:e.capsuleProperties.intensity,technologies:e.technologies})}\n            ${this.renderRoast()}\n        `}renderMachine(){const{showVoltage:e,colors:t}=this.props;return`\n            ${this.renderRatings()}\n            ${(({show_voltage:e,voltage_label:t,voltage_list:n,a11y_voltage_label:s,a11y_volts_label:r})=>e&&t&&n&&n.length?`<div class="cb-sku-tab">\n        <span class="sr-only">${s}</span>\n        <p class='t-sm-400' aria-hidden="true">${t}</p>\n        ${n.map((({label:e,url:t})=>t?`<a href="${t}" target="_self"><span class="t-sm-400-caps">${e}<span aria-hidden="true">V</span><span class='sr-only'> ${r}</span></span></a>`:`<div aria-current="page"><span class="t-sm-700-caps">${e}<span aria-hidden="true">V</span><span class='sr-only'> ${r}</span></span></div>`)).join("")}\n    </div>`:"")(e)}\n            ${o(t)}\n        `}renderRatings(){const{showRating:e}=this.props;return(t=this.product).productRatings&&t.productRatings.ratingEnabled?`${(e=>{const{show_ratings:t,minimum_rating:n=0,ratingAverage:s,reviewCount:r,review_cta:i,reviews_cta:a}=e;if(!t||!((e,t)=>e.reviewCount>0&&e.ratingAverage>0&&e.ratingAverage>=t)(e,n))return"";let l="";if(r&&i&&a){const e=(r>1?a:i).replace("{nb_review}",r);e&&(l=`<nb-link class="is-review" icon_right="chevron-right" size="small" color="gold">\n                        ${e}\n                    </nb-link>`)}return`<nb-rating stars="${s.toFixed(2)}"></nb-rating>\n            ${l}`})({...e,ratingAverage:e.ratings.ratingAverage,reviewCount:1})}`:"";var t}renderImageOrSlider(){return this.product.images.main?`<img src='${this.product.images.main}' alt='' aria-hidden='true' loading='lazy' />`:""}renderRoast(){const{product:e,levels:t}=this.props;return t&&t.roast&&e.roast.label?`<p class="t-xs-500 cb-roast">${t.roast} <strong>${e.roast.label}</strong></p>`:""}renderLevels(){const{levels:e}=this.props;return"capsule"===this.product.type&&e?`<div class="cb-properties cb-levels">\n            <ul>\n               ${this.renderLevelItem(e.roast,this.product.roast.value)}\n               ${this.renderLevelItem(e.bitterness,this.product.bitterness.value)}\n               ${this.renderLevelItem(e.body,this.product.body.value)}\n               ${this.renderLevelItem(e.acidity,this.product.acidity.value)}\n            </ul>\n        </div>`:""}renderLevelItem(e,t){const{a11y_level_of:n}=this.props.levels;return e&&t?`<li>\n            <h3 class="t-xs-700">${e}</h3>\n            <nb-level value="${t}" a11y_level_of="${n}"></nb-level>\n        </li>`:""}renderCupSizes(){const{cup_sizes:e}=this.props;return"capsule"===this.product.type&&e&&e.heading&&e.items?`<div class="cb-properties cb-cup-sizes">\n            <h3 class="t-xs-700">${e.heading}</h3>\n            <ul>\n                ${e.items.map((e=>`${this.renderCupSizeItem(e)}`)).join("")}\n            </ul>\n        </div>`:""}renderCupSizeItem(e){const{unit_is_oz:t}=this.props.cup_sizes;if(!e)return"";const n=e.toLowerCase();return`<li>\n            <nb-icon-text\n                icon="capsule-cupSize-${n}"\n                label="${e}"\n                sub_label="${((e,t=!1)=>{let n="";switch(e){case"carafe":n=t?"18.09":"535";break;case"alto":n=t?"11.33":"335";break;case"mug":n=t?"7.77":"230";break;case"gran_lungo":n=t?"5.07":"150";break;case"lungo":n=t?"3.7":"110";break;case"double_espresso":n=t?"2.7":"80";break;case"espresso":n=t?"1.35":"40";break;case"ristretto":n=t?"0.84":"25"}return t?n+" oz":n+" ml"})(n,t)}"\n                classname="t-xs-500">\n            </nb-icon-text>\n        </li>`}renderAromaticProfile(){const{aromatic_profile:e}=this.props;if("capsule"!==this.product.type||!e||!e.heading||!e.items||0===e.items.length)return"";let t="";return e.items.map((e=>{t+=`${e.toLowerCase()}, `})),t=t.slice(0,-2),`<div class='cb-properties cb-aromatic'>\n            <h3 class="t-xs-700">${e.heading}</h3>\n            <p class="t-xs-500">${t}</p>\n        </div>`}renderFeatures(){const{features:e}=this.props;return"machine"===this.product.type&&e&&e.items?`${e.items.map((e=>`${this.renderFeatureItem(e)}`)).join("")}`:""}renderFeatureItem(e){const{icon:t,heading:n,description:s}=e;return t&&n&&s?`<div class="cb-properties cb-features">\n            <nb-icon-text\n                icon="${t}"\n                label="${n}"\n                sub_label="${s}"\n                classname="t-xs-500">\n            </nb-icon-text>\n        </div>`:""}renderIndredients(){const{ingredients:e}=this.props;return"accessory"===this.product.type&&e&&e.heading&&e.description?`<div class="cb-properties cb-ingredients">\n            <nb-icon-text\n                icon="notes-cereal"\n                label="${e.heading}"\n                sub_label="${e.description}"\n                classname="t-xs-500">\n            </nb-icon-text>\n        </div>`:""}renderLink(){const{label:e,url:t}=this.props.link;return e&&t?`<div class="cb-properties">\n                    <nb-link\n                        link="${t}"\n                        target="_self"\n                        size="xsmall">\n                            ${e}\n                    </nb-link>\n                </div>`:""}renderPricing(){return`<div class='cb-price'>\n            ${s(this.props.pricing,this)}\n            ${(({price:e,hidePrice:t,giftcard_price:n})=>!e&&!n||t?"":`<p class="cb-price-current"><span>${e||n}</span></p>`)(this.props.pricing.add_to_cart)}\n            ${this.renderCapsuleExtraPricing()}\n        </div>`}renderCapsuleExtraPricing(){return"capsule"!==this.product.type?"":`\n            ${(e=>{const{show_sleeve:t=!1}=e;if(!t)return"";const{label_capsules:n,sleeve_syntax:s}=e,i=(({number_of_sleeves:e,label_sleeves:t,label_sleeve:n})=>e>1&&t?t:n)(e),a=e.number_of_capsules?e.number_of_capsules:(({bundled:e,sales_multiple:t,unit_quantity:n,unitQuantity:s})=>!1===e?t:n||s||0)(e),l=e.number_of_sleeves?e.number_of_sleeves:function(e){function t(e,t){return e%t==0}return"original"===function(e){const t=e.technologies[0];return t.substring(t.indexOf("/machineTechno/")+"/machineTechno/".length)}(e)?1===e.sales_multiple?t(e.unitQuantity,10)?e.unitQuantity/10:NaN:t(e.sales_multiple,10)?e.sales_multiple/10:NaN:1===e.sales_multiple?t(e.unitQuantity,10)&&1!==e.unitQuantity?e.unitQuantity/10:t(e.unitQuantity,7)&&1!==e.unitQuantity?e.unitQuantity/7:NaN:t(e.sales_multiple,10)?e.sales_multiple/10:t(e.sales_multiple,7)?e.sales_multiple/7:NaN}(e),o=r(s,{numberOfSleeves:l,sleeveLabel:i,quantity:a,label_capsules:n},"{","}");return o?`<p class="cb-price-items cb-show-sleeve">${o}</p>`:""})(this.props.pricing.showSleeve)}\n            ${(e=>{const{show_capsule_price:t=!1,capsule_price_label:n,capsule_price_syntax:s="{capsule_price_label}: {price_per_capsule}",price_per_capsule:i}=e;if(!t||!n)return"";const a=r(s,{capsule_price_label:n,price_per_capsule:i},"{","}");return a&&i?`<p class="cb-price-items cb-price-capsule">${a}</p>`:""})(this.props.pricing.showCapsulePrice)}\n        `}renderAction(){return`<div class='cb-action'>\n            ${(e=>{const{category_name:t="",sku:n,longSku:s="",position:r,variation:i=l,hidePrice:o,url:c,view_details_label:p="View details",rendererName:d=""}=e;let u="large";return i===l&&(u=a.is.mobile?"small":"large"),"small"===i&&(u="small"),o?`<nb-cta link="${c}" variation="primary">${p}</nb-cta>`:`\n        <nb-add-to-cart\n            sku="${n}"\n            longSku="${s}"\n            buttonSize="${u}"\n            showPrice\n            range='${t}'\n            position='${r}'\n            rendererName='${d}'\n        ></nb-add-to-cart>\n    `})(this.props.pricing.add_to_cart)}\n        </div>`}renderFooter(){const{popin:e,pricing:t}=this.props;var n;!(!(n=e.footer)||"false"===n)&&t&&(this.footer=this.querySelector("footer"),this.footer.innerHTML=`\n            ${this.renderPricing()}\n            ${this.renderAction()}\n        `)}}customElements.get("nb-sku-quick-view")||customElements.define("nb-sku-quick-view",c);export{c as default};
