class e extends HTMLElement{constructor(){super(),this.template=""}connectedCallback(){this.props=this._createProps(),this.onStart?.(),this.loadTemplate(),this.onReady?.()}_createProps(e=null){const t=e||this.attributes;let n;try{n=[...t].reduce(((e,t)=>({...e,[t.nodeName]:t.nodeValue})),{});const e=[...t].find((e=>"data"===e.nodeName));return null==e?n:{...n,...JSON.parse(e.nodeValue)}}catch(e){console.log("ERROR: No data",e)}}render(e=!1){e&&(this.innerHTML="");const t=(e,n)=>{const i=e=>3===e.nodeType?"text":8===e.nodeType?"comment":e.tagName.toLowerCase(),s=e=>e.childNodes&&e.childNodes.length>0?null:e.textContent;var r=Array.prototype.slice.call(n.childNodes),a=Array.prototype.slice.call(e.childNodes),l=r.length-a.length;if(l>0)for(;l>0;l--)r[r.length-l].parentNode.removeChild(r[r.length-l]);a.forEach((function(e,a){if(r[a])if(i(e)===i(r[a])){var l=s(e);if(l&&l!==s(r[a])&&(r[a].textContent=l),r[a].childNodes.length>0&&e.childNodes.length<1)r[a].innerHTML="";else{if(r[a].childNodes.length<1&&e.childNodes.length>0){var o=document.createDocumentFragment();return t(e,o),void r[a].appendChild(o)}e.childNodes.length>0&&t(e,r[a])}}else r[a].parentNode.replaceChild(e.cloneNode(!0),r[a]);else n.appendChild(e.cloneNode(!0))}))},n=(i=this.template,(new DOMParser).parseFromString(i,"text/html").body);var i;t(n,this)}loadTemplate(e="",t=!1){this.template=""===e?this.template:`${e}`,this.render(t)}disconnectedCallback(){this.onDestroy?.()}}function t(e,t,n,i){let s=0;for(;e;){const r=e.indexOf(n,s);if(-1===r)break;const a=e.indexOf(i,r+1);if(-1===a)break;const l=e.substring(r+n.length,a);null!=t[l]?(e=e.substr(0,r)+t[l]+e.substr(a+i.length),s=r):s=a}return e}customElements.get("nb-nespresso-element")||customElements.define("nb-nespresso-element",e);const n=e=>i(JSON.stringify(e)),i=e=>e?e.toString().replace(/"/g,"&quot;").replace(/'/g,"&apos;"):"",s={get is(){const{innerWidth:e,devicePixelRatio:t}=window;return{mobile:e<768,mobile_tablet:e<1024,tablet:e>=768&&e<1024,desktop:e>=1024&&t<=1,retina:e>=1024&&t>1}},lt:e=>window.innerWidth<e},r=({image:e=""},t)=>{const n=".cb-image img",i=t.querySelector(n),s=e=>{console.log(e),console.error(`Error: Component SKU - Lazy Load - ${e}`),i&&(i.style.display="none")};if(!i)return s(`${n} HTMLElement not found.`),"";const r=e+((e="product",t=150)=>{const n=[];return e&&n.push(`impolicy=${e}`),t&&n.push(`imwidth=${t}`),`?${n.join("&")}`})();if(!r)return s(`${r} source file is empty.`),"";!function(e,t,n,i,s){const r=(t,n)=>{e.setAttribute(t,n);const r=()=>e.classList.add("lazy-loaded");if(i){const t=new Image;return t.src=i,t.onload=r,void(t.onerror=()=>{s&&s(`Image ${i} cannot be loaded.`),e.classList.add("lazy-loaded-error")})}r()};if(/Trident\/|MSIE/.test(window.navigator.userAgent)||(a=window.navigator.userAgent,l=a.indexOf("OS "),(a.indexOf("iPhone")>-1||a.indexOf("iPad")>-1)&&l>-1&&window.Number(a.substr(l+3,3).replace("_","."))<14))r(t,n);else if("IntersectionObserver"in window){e.classList.add("lazy-load");let i=new IntersectionObserver((function(e){e.forEach((function(e){e.isIntersecting&&(r(t,n),i.unobserve(e.target))}))}));i.observe(e)}else r(t,n);var a,l}(i,"src",`${r}`,r,s)},a="plp",l=e=>"pdp"===e,o=e=>{const{url:t,name:n="",name_custom:i=""}=e;if(!n)return"";const s=""!==i?i:n,r=[],a=(({variation:e})=>l(e)?"h1":"h3")(e);return r.push(`<${a} class="cb-heading">`),t&&l(e.variation)?r.push((({url:e,a11y_product_card:t="",name:n="",name_custom:i=""})=>{const s=t.replace("{productName}",n);return`<a href="${e}" target="_self" title="${s}" aria-label="${s}">${""!==i?i:n}</a>`})(e)):r.push(`${s}`),r.push(`</${a}>`),r.join("")},c=({headline:e="",is_headline_hidden:t=!1})=>t&&s.is.mobile||!e?"":`<p class="cb-text">${e}</p>`,d=({label_technology:e})=>e?`<p class="cb-technology t-xs-700">${e}</p>`:"",u=({label_range:e})=>e?`<p class="cb-range t-xs-500">${e}</p>`:"";const p=async e=>{const t=await(async()=>await window.napi.priceFormat())(),n=window[window.config.padl.namespace].dataLayer.app.app.currency;return t.html?t.html(n,e):t.short(n,e)||""},h=e=>e.querySelector(".cb-price-old"),b=({strikethrough_price:e},t)=>{return e?((n=e,p(n)).then((e=>{const n=h(t);n&&(n.innerHTML=e)})).catch((e=>{console.error(`Error: Component SKU - Strike Through Price  - ${e}`);const n=h(t);n&&(n.style.display="none")})),'<p class="cb-price-old"></p>'):"";var n},_=({price:e,hidePrice:t,giftcard_price:n})=>!e&&!n||t?"":`<p class="cb-price-current"><span>${e||n}</span></p>`;class m extends e{constructor(){super(),this.type="default",this.boundOnPDPLinkClick=this.onPDPLinkClick.bind(this)}loadTemplate(){this.classList.add("nb-sku"),this.classList.add(`nb-sku__${this.type}`),(({variation:e,type:t},n)=>{"pdp"!==e?"capsule"===t&&s.is.mobile?n.setAttribute("landscape","true"):n.setAttribute("portrait","true"):n.setAttribute("pdp","true")})(this.props,this),this.template=`${this.renderVisual()}\n                          ${this.renderHeader()}\n                          <div class="cb-content">\n                              ${this.renderInformation()}\n                              <div class="cb-shop">\n                                  <div class="cb-price">\n                                      ${this.renderPricing()}\n                                  </div>\n                                  ${this.renderAction()}\n                              </div>\n                              ${this.renderFooter()}\n                          </div>`,this.render()}onReady(){const{sku:e,category_name:t,position:n=0}=this.props;this.setAttribute("data-product-item-id",e),this.setAttribute("data-product-section",t),this.setAttribute("data-product-position",n.toString()),this.activateLazyLoad(),this.bindEvent()}activateLazyLoad(){const{image:e}=this.props;if(!e)return"";r(this.props,this)}renderHeaderDefault(){return`${(({labels:e=[]},t=null)=>{if(!t||!e||!e.length)return"";t&&e.length&&t.classList.add("has-labels");const i=s.is.mobile?"row":"column";return`<nb-card-labels data="${n({labels:e})}" direction="${i}"></nb-card-labels>`})(this.props,this)}${((e,t)=>{const{fair_trade:i,alt_fair_trade:s,is_organic:r,alt_organic:a,only_vertuo_next:l,alt_vertuo_next:o,is_rainforest:c,alt_rainforest:d,is_sustainable:u,alt_sustainable:p,is_q_certified_arabica:h,alt_q_certification_arabica:b,logos:_}=e;return i||r||l||c||u||h||!(null==_||_.length<1)?(t.classList.add("has-logos"),`<nb-card-logos data='${n({fair_trade:i,alt_fair_trade:s,is_organic:r,alt_organic:a,only_vertuo_next:l,alt_vertuo_next:o,is_rainforest:c,alt_rainforest:d,is_sustainable:u,alt_sustainable:p,is_q_certified_arabica:h,alt_q_certification_arabica:b,logos:_})}'></nb-card-logos>`):""})(this.props,this)}`}renderHeader(){return this.renderHeaderDefault()}renderVisualDefault(){return(({url:e,image_alt_text:t,image:n})=>{if(!n)return"";let i=`<img src="" alt="${t||"loading"}"/>`;return e&&(i=`<a href="${e}" target="_self" aria-hidden="true" tabindex="-1">${i}</a>`),`<div class="cb-image">\n                ${i}\n            </div>`})(this.props)}renderVisual(){return this.renderVisualDefault()}renderInformationDefault(){return`${d(this.props)}\n        ${u(this.props)}\n        ${o(this.props)}\n        ${c(this.props)}`}renderInformation(){return this.renderInformationDefault()}renderPricingDefault(){return`${b(this.props,this)}\n                ${_(this.props)}`}renderPricing(){return this.renderPricingDefault()}renderActionDefault(){return(e=>{const{category_name:t="",sku:n,longSku:i="",position:r,variation:l=a,hidePrice:o,url:c,view_details_label:d="View details",rendererName:u=""}=e;let p="large";return l===a&&(p=s.is.mobile?"small":"large"),"small"===l&&(p="small"),o?`<nb-cta link="${c}" variation="primary">${d}</nb-cta>`:`\n        <nb-add-to-cart\n            sku="${n}"\n            longSku="${i}"\n            buttonSize="${p}"\n            showPrice\n            range='${t}'\n            position='${r}'\n            rendererName='${u}'\n        ></nb-add-to-cart>\n    `})(this.props)}renderAction(){return this.renderActionDefault()}renderFooterDefault(){return(({additional_message_icon:e,additional_message:t,additional_message_link:n})=>{if(!t&&!n)return"";let i="";if(t){let n="";e&&(n=`<nb-icon icon="${e}" class="additionalMsgIcon"></nb-icon>`),i=`<p class="cb-warn t-sm-500-sl">\n            ${n}\n            ${t}</p>`}return n&&n.link&&n.label&&(i+=`<nb-link\n            link='${n.link}'\n            color="${n.color}"\n            size="${n.size}"\n            seo_label="${n.seo_label}">\n            ${n.label}\n        </nb-link>`),i})(this.props)}renderFooter(){return this.renderFooterDefault()}async onPDPLinkClick(){window.napi&&window.napi.data&&window.napi.data().product().setProductClickData(await window.productHelper.getPadlProductDetail(await window.napi.catalog().getProduct(this.props.longSku)))}bindEvent(){this.linkElements=[],this.unbindEvent(),this.linkElements=this.querySelectorAll("a[href]"),this.linkElements.length&&Array.from(this.linkElements).forEach((e=>{e.addEventListener("click",this.boundOnPDPLinkClick)}))}unbindEvent(){this.linkElements.length&&(Array.from(this.linkElements).forEach((e=>{e.removeEventListener("click",this.boundOnPDPLinkClick)})),this.linkElements=[])}disconnectedCallback(){this.unbindEvent()}}customElements.get("nb-sku")||customElements.define("nb-sku",m);let g,f="";const $=e=>{y(e),e.bundlePopIn=document.getElementById("bundle-popin-id"),e.appendChild(e.bundlePopIn),((e,t)=>{for(let n in t)e.setAttribute(n,t[n])})(e.bundlePopIn,{variation:"before",bgcolor:"white",size:"L",padding:"false",label_close:g,content:f}),e.bundlePopIn.classList.add("nb-popin--bundle"),(({eventName:e,args:t,element:n})=>{let i;n=n||window,t?i=new CustomEvent(e,{detail:t,bubbles:!0}):"function"==typeof Event?i=new Event(e):(i=document.createEvent("Event"),i.initEvent(e,!0,!0)),n.dispatchEvent(i)})({eventName:"WEB_COMPONENT_POPIN_OPEN",args:{id:"bundle-popin-id"}})},y=e=>{if(null!=document.getElementById("bundle-popin-id"))return;let t=document.createElement("nb-popin");t=e.appendChild(t),t.setAttribute("id","bundle-popin-id"),t.setAttribute("content","")},v=e=>{const{label_decaffeinato:t}=e;return new RegExp(t,"ig")},k=e=>{const{name:t}=e;if(((e,t)=>{const{label_decaffeinato:n}=e;return n&&""!==n&&v(e).test(t)})(e,t)){const{label_decaffeinato:n}=e,i=s.is.mobile?"t-xs-700-caps":"t-sm-700-caps";e.name_custom=t.replace(v(e),`<span class='${i}'>${n}</span>`).trim()}return o(e)};class w extends m{constructor(){super(),this.type="coffee",this.boundHandleBundleOpen=this.handleBundleOpen.bind(this)}onReady(){this.bundlePopinLink=this.querySelector(".cb-cta-bundle"),super.onReady()}renderInformation(){return`${d(this.props)}\n                ${u(this.props)}\n                ${k(this.props)}\n                ${c(this.props)}\n                ${(({technologies:e,intensity:t,a11y_intensity_max:n,intensity_label:i=""})=>{const s=(({technologies:e})=>e.indexOf("original")?14:12)({technologies:e});return 0===t?"":`<nb-intensity\n        class="t-xs-500-sl"\n        intensity="${t}"\n        max_intensity="${s}"\n        a11y_intensity_max="${n}"\n        intensity_label="${i}">\n    </nb-intensity>`})(this.props)}\n                ${(({type:e,bundle_details:t,bundled:n,sku:i,position:s,range:r},a)=>"capsule"===e&&t&&t.popin_link_text&&!0===n?(f=`<nb-bundle-details\n                main_sku='${i}'\n                description='${t.description}'\n                other_skus='${t.other_skus}'\n                other_skus_quantity= '${t.other_skus_quantity}'\n                range='${r}'\n                position='${s}'>\n            </nb-bundle-details>`,a.variation="white",g=t.popin_label_close,`<nb-link class="cb-cta-bundle" size="large" color="gold" label="${t.popin_link_text}"></nb-link>`):"")(this.props,this)}\n                ${(({packaging:e})=>{if(!e)return"";const{show_packaging:t,packaging_list:n,a11y_packaging_label:i}=e;return t&&n&&n.length?`<div class="cb-sku-tab">\n        <span class="sr-only">${i}</span>\n        ${n.map((({label:e,url:t,selected:n})=>t&&!n?`<a href="${t}" target="_self"><span class="t-sm-400-caps">${e}</span></a>`:`<div aria-current="page"><span class="t-sm-700-caps">${e}</span></div>`)).join("")}\n    </div>`:""})(this.props)}`}renderPricingDefault(){return`${b(this.props,this)}\n                ${_(this.props)}`}renderPricing(){return`${this.renderPricingDefault()}\n                ${(({packaging:e})=>{if(!e)return"";const{show_packaging:t,packaging_list:n}=e;return t&&n&&n.length?`<p class="cb-price-items cb-pack-format">${n.find((e=>!0===e.selected)).pack_format}</p>`:""})(this.props)}\n                ${(e=>{const{show_sleeve:n=!1}=e;if(!n)return"";const{label_capsules:i,sleeve_syntax:s}=e,r=(({number_of_sleeves:e,label_sleeves:t,label_sleeve:n})=>e>1&&t?t:n)(e),a=e.number_of_capsules?e.number_of_capsules:(({bundled:e,sales_multiple:t,unit_quantity:n,unitQuantity:i})=>!1===e?t:n||i||0)(e),l=e.number_of_sleeves?e.number_of_sleeves:function(e){function t(e,t){return e%t==0}return"original"===function(e){const t=e.technologies[0];return t.substring(t.indexOf("/machineTechno/")+"/machineTechno/".length)}(e)?1===e.sales_multiple?t(e.unitQuantity,10)?e.unitQuantity/10:NaN:t(e.sales_multiple,10)?e.sales_multiple/10:NaN:1===e.sales_multiple?t(e.unitQuantity,10)&&1!==e.unitQuantity?e.unitQuantity/10:t(e.unitQuantity,7)&&1!==e.unitQuantity?e.unitQuantity/7:NaN:t(e.sales_multiple,10)?e.sales_multiple/10:t(e.sales_multiple,7)?e.sales_multiple/7:NaN}(e),o=t(s,{numberOfSleeves:l,sleeveLabel:r,quantity:a,label_capsules:i},"{","}");return o?`<p class="cb-price-items cb-show-sleeve">${o}</p>`:""})(this.props)}\n                ${(e=>{const{show_capsule_price:n=!1,capsule_price_label:i,capsule_price_syntax:s="{capsule_price_label}: {price_per_capsule}",price_per_capsule:r}=e;if(!n||!i)return"";const a=t(s,{capsule_price_label:i,price_per_capsule:r},"{","}");return a&&r?`<p class="cb-price-items cb-price-capsule">${a}</p>`:""})(this.props)}`}handleBundleOpen(){$(this)}bindEvent(){super.bindEvent(),this.bundlePopinLink&&this.bundlePopinLink.addEventListener("click",this.boundHandleBundleOpen)}unbindEvent(){super.unbindEvent(),this.bundlePopinLink&&this.bundlePopinLink.removeEventListener("click",this.boundHandleBundleOpen)}}customElements.get("nb-sku-coffee")||customElements.define("nb-sku-coffee",w);export{w as default};
