const e=e=>e?e.toString().replace(/"/g,"&quot;").replace(/'/g,"&apos;"):"",t=e=>null==e;var n=(e=[])=>{e.forEach((e=>{if(e&&e.element)return e.element.addEventListener(e.type,e.listener,e.options)}))},i=(e=[])=>{e.forEach((e=>{e&&e.element&&e.element.removeEventListener(e.type,e.listener)}))};const s=(()=>{let e="",t=[];const n=t=>{const n=document.createElement("script");return n.src=`${e}/js/${t}.js`,n},i=t=>{const n=document.createElement("link");return n.href=`${e}/css/${t}.css`,n.type="text/css",n.rel="stylesheet",n};return{destroy:()=>{for(const e of t)e.remove()},inject:(s,o="")=>{if(""===o)return!1;e=o;const r=n(s),d=i(s);document.body.append(r),document.head.append(d),t=[r,d]}}})();class o extends HTMLElement{constructor(){super(),this.template=""}connectedCallback(){this.props=this._createProps(),this.onStart?.(),this.loadTemplate(),this.onReady?.()}_createProps(e=null){const t=e||this.attributes;let n;try{n=[...t].reduce(((e,t)=>({...e,[t.nodeName]:t.nodeValue})),{});const e=[...t].find((e=>"data"===e.nodeName));return null==e?n:{...n,...JSON.parse(e.nodeValue)}}catch(e){console.log("ERROR: No data",e)}}render(e=!1){e&&(this.innerHTML="");const t=(e,n)=>{const i=e=>3===e.nodeType?"text":8===e.nodeType?"comment":e.tagName.toLowerCase(),s=e=>e.childNodes&&e.childNodes.length>0?null:e.textContent;var o=Array.prototype.slice.call(n.childNodes),r=Array.prototype.slice.call(e.childNodes),d=o.length-r.length;if(d>0)for(;d>0;d--)o[o.length-d].parentNode.removeChild(o[o.length-d]);r.forEach((function(e,r){if(o[r])if(i(e)===i(o[r])){var d=s(e);if(d&&d!==s(o[r])&&(o[r].textContent=d),o[r].childNodes.length>0&&e.childNodes.length<1)o[r].innerHTML="";else{if(o[r].childNodes.length<1&&e.childNodes.length>0){var l=document.createDocumentFragment();return t(e,l),void o[r].appendChild(l)}e.childNodes.length>0&&t(e,o[r])}}else o[r].parentNode.replaceChild(e.cloneNode(!0),o[r]);else n.appendChild(e.cloneNode(!0))}))},n=(i=this.template,(new DOMParser).parseFromString(i,"text/html").body);var i;t(n,this)}loadTemplate(e="",t=!1){this.template=""===e?this.template:`${e}`,this.render(t)}disconnectedCallback(){this.onDestroy?.()}}customElements.get("nb-nespresso-element")||customElements.define("nb-nespresso-element",o);class r extends HTMLElement{constructor(){super(),this._loaded=!1}get basePath(){return"/shared_res/agility/reviving-origins-traceability"}connectedCallback(){this._props=(e=>{const n=(e=>e.find((e=>"data"===e.nodeName)))([...e]),i=[...e].filter((e=>"data"!==e.nodeName)).reduce(((e,t)=>({...e,[t.nodeName]:t.nodeValue})),{});if(t(n))return i;try{return{...i,...JSON.parse(n.nodeValue)}}catch(e){console.log("ERROR: No data",e)}})(this.attributes),this.render(),this.createEventListeners(),this.classList.add("nb-popin-reviving-origins--loading")}disconnectedCallback(){this.deleteEventListeners(),s.destroy()}render(){const{copywriting:t={}}=this._props,{slug:n="",popin_id:i="",...s}=t,o=(t=>e(JSON.stringify(t)))(s);if(""===n||""===i)return"";this.innerHTML=`<nb-popin\n                bgcolor="black"\n                id="${i}"\n                padding="false"\n                size="full"\n                variation="before"\n            >\n                <div class="nb-popin-reviving-origins__app" data-project="${n}" data-dico="${o}"></div>\n                <div class="nb-popin-reviving-origins__overlay">\n                    <nb-loader></nb-loader>\n                </div>\n            </nb-popin>\n            `}createEventListeners(){this.boundOpenPopin=this.onOpenPopin.bind(this),this.boundAppReady=this.onAppReady.bind(this),this._eventListeners=[{element:window,type:"WEB_COMPONENT_POPIN_OPEN",listener:this.boundOpenPopin},{element:window,type:"REVIVING_ORIGINS_APP_READY",listener:this.boundAppReady}],n(this._eventListeners)}deleteEventListeners(){i(this._eventListeners)}onOpenPopin(e){const t=(e=>{if(e.detail)return e.detail})(e);t.id&&"popin-reviving-origins"===t.id&&!this._loaded&&s.inject("app",this.basePath)}onAppReady(){this._loaded=!0,i(this._eventListeners),setTimeout((()=>{this.classList.remove("nb-popin-reviving-origins--loading")}),1e3)}}customElements.get("nb-popin-reviving-origins")||customElements.define("nb-popin-reviving-origins",r);export{r as default};
