window.gtmDataObject=window.gtmDataObject||[];const e=e=>{window.gtmDataObject.push({event:"impression",eventRaisedBy:"Web component",eventAction:"Promo Impression - On Scroll",ecommerce:{},...e})};class t extends class{constructor(e,t){this.observer=new IntersectionObserver((e=>this.onChange(e)),{threshold:[0],rootMargin:"0% 0%"}),this.el=e,this.data=t,this.el instanceof Element&&this.observer.observe(this.el)}onChange(e){e.forEach((e=>{e.isIntersecting&&(this.track(e),this.observer.unobserve(e.target))}))}track(){window.requestIdleCallback((()=>this.runTrack()))}runTrack(){this.data.id&&null!==this.data.id&&""!==this.data.id&&e({ecommerce:{promoView:{promotions:[this.data]}}})}}{constructor(e,t){super(e),this.data=t}runTrack(){this.data.id&&null!==this.data.id&&""!==this.data.id&&e({ecommerce:{promoView:{promotions:[this.data]}}})}}const n=e=>e?e.toString().replace(/"/g,"&quot;").replace(/'/g,"&apos;"):"",i=e=>null==e;class s extends HTMLElement{constructor(){super(),this.template=""}connectedCallback(){this.props=this._createProps(),this.onStart?.(),this.loadTemplate(),this.onReady?.()}_createProps(e=null){const t=e||this.attributes;let n;try{n=[...t].reduce(((e,t)=>({...e,[t.nodeName]:t.nodeValue})),{});const e=[...t].find((e=>"data"===e.nodeName));return null==e?n:{...n,...JSON.parse(e.nodeValue)}}catch(e){console.log("ERROR: No data",e)}}render(e=!1){e&&(this.innerHTML="");const t=(e,n)=>{const i=e=>3===e.nodeType?"text":8===e.nodeType?"comment":e.tagName.toLowerCase(),s=e=>e.childNodes&&e.childNodes.length>0?null:e.textContent;var r=Array.prototype.slice.call(n.childNodes),a=Array.prototype.slice.call(e.childNodes),o=r.length-a.length;if(o>0)for(;o>0;o--)r[r.length-o].parentNode.removeChild(r[r.length-o]);a.forEach((function(e,a){if(r[a])if(i(e)===i(r[a])){var o=s(e);if(o&&o!==s(r[a])&&(r[a].textContent=o),r[a].childNodes.length>0&&e.childNodes.length<1)r[a].innerHTML="";else{if(r[a].childNodes.length<1&&e.childNodes.length>0){var c=document.createDocumentFragment();return t(e,c),void r[a].appendChild(c)}e.childNodes.length>0&&t(e,r[a])}}else r[a].parentNode.replaceChild(e.cloneNode(!0),r[a]);else n.appendChild(e.cloneNode(!0))}))},n=(i=this.template,(new DOMParser).parseFromString(i,"text/html").body);var i;t(n,this)}loadTemplate(e="",t=!1){this.template=""===e?this.template:`${e}`,this.render(t)}disconnectedCallback(){this.onDestroy?.()}}customElements.get("nb-nespresso-element")||customElements.define("nb-nespresso-element",s);const r={get is(){const{innerWidth:e,devicePixelRatio:t}=window;return{mobile:e<768,mobile_tablet:e<1024,tablet:e>=768&&e<1024,desktop:e>=1024&&t<=1,retina:e>=1024&&t>1}},lt:e=>window.innerWidth<e},a={getResponsiveSrc:e=>{const t=(n=e,Array.isArray(n)||"object"==typeof n?["mobile","tablet","desktop","retina"].find((e=>!0===r.is[e]&&e in n&&""!==n[e])):null);var n;return t?e[t]:e.desktop}};class o extends HTMLElement{constructor(){super(),this.boundHandleClick=this.handleClick.bind(this)}connectedCallback(){this.props=(e=>{const t=(e=>e.find((e=>"data"===e.nodeName)))([...e]),n=[...e].filter((e=>"data"!==e.nodeName)).reduce(((e,t)=>({...e,[t.nodeName]:t.nodeValue})),{});if(i(t))return n;try{return{...n,...JSON.parse(t.nodeValue)}}catch(e){console.log("ERROR: No data",e)}})(this.attributes),this.render(),this.initTracking()}setContrast(){const{contrast:e="light"}=this.props.layout;this.contrast=e,this.setAttribute("contrast",this.contrast)}createClasses(){const e=Object.keys(r.is).filter((e=>r.is[e])).join(" ");return["nb-card",`nb-card--${this.contrast}`,`${e}`].join(" ")}createStyles(){const{background:e}=this.props.layout,t=e?a.getResponsiveSrc(e):"";return e?`style="background-image: url('${t}')"`:""}render(){this.setContrast();const e=r.is.tablet?this.renderTablet():this.renderDefault(),t=this.createClasses(),n=this.createStyles();this.innerHTML=`<div class="${t}" ${n}>\n                            ${e}\n                         </div>`,this.applyClassHelpers(),this.cta=this.querySelector(".nb-card__cta"),this.bindEvents()}applyClassHelpers(){}renderDefault(){return`${this.renderHeading()}\n                ${this.renderText()}\n                ${this.renderVisual()}\n                ${this.renderActions()}\n                ${this.renderPopin()}`}renderTablet(){return`${this.renderVisual()}\n                <div class="nb-card__tabletRightCol">\n                    ${this.renderHeading()}\n                    ${this.renderText()}\n                    ${this.renderActions()}\n                    ${this.renderPopin()}\n                </div>`}renderHeading(){const{heading:e=""}=this.props.copywriting;return e&&`<h2 class="nb-card__heading">${e}</h2>`}renderText(){const{text:e=""}=this.props.copywriting;return e&&`<p  class="nb-card__body">${e}</p>`}renderVisual(){const{src:e="",alt:t=""}=this.props.copywriting.visual;return e&&`<img loading="lazy" class="nb-card__visual" src="${e}" alt="${t}" />`}renderActions(){const{cta:e={}}=this.props.copywriting,{label:t=""}=e,{copywriting:{popin:n={}}={}}=this.props,{text:i=""}=n;return""!==t||i?`<div class='nb-card__actions'>\n                    ${this.renderCta()}\n                    ${this.renderLink()}\n                </div>`:""}renderCta(){const{cta:e={}}=this.props.copywriting,{label:t=""}=e;if(""===t)return"";const{campaign:i}=this.props;if(i){const{id:t,name:n,creative:s,position:r}=i;e.campaign_id=t,e.campaign_name=n,e.campaign_creative=s,e.campaign_position=r}return`<nb-cta class="nb-card__cta" data="${(e=>n(JSON.stringify(e)))(e)}">${t}</nb-cta>`}renderLink(){const{copywriting:e,campaign:t}=this.props,{popin:n={}}=e,{id:i="",text:s=""}=n;return s?`\n            <nb-link\n                campaign_id="${t.id||""}"\n                campaign_name="${t.name||""}"\n                campaign_position="${t.position||""}"\n                campaign_creative="${t.creative||""}"\n                size="xsmall"\n                color="${"light"===this.contrast?"black":"white"}"\n                popin_id="${i}"\n                class="nb-card__link"\n            >${s}</nb-link>\n        `:""}renderPopin(){const{copywriting:{popin:e={}}={}}=this.props,{id:t="",image:n="",heading:i="",description:s="",image_alt:r="",close:a=""}=e;return t&&`<nb-popin\n                id="${t}"\n                heading="${i}"\n                variation="next"\n                bgcolor="highlight"\n                label_close="${a}"\n            >\n                ${n&&`<div class="popin-header-img"><img\n                        loading="lazy"\n                        src="${n}"\n                        alt="${r}"\n                        title="${r}"\n                        width="300"\n                        height="225"\n                    /></div>\n                `}\n                ${s}\n            </nb-popin>`}initTracking(){const{campaign:e}=this.props;if(!e)return;const{id:n,name:i,creative:s,position:r}=e;!function(e,n){const i=new t(e,n)}(this,{id:n,name:i,position:r,creative:s})}handleClick(){this.querySelector(".nb-card__cta > *").click()}bindEvents(){if(this.unbindEvents(),this.cta){const e=document.createElement("div");e.classList.add("nb-card__overlay");const t=this.querySelector(".nb-card__actions");t.parentNode.insertBefore(e,t),e.addEventListener("click",this.boundHandleClick)}}unbindEvents(){this.cta&&this.removeEventListener("click",this.boundHandleClick)}disconnectedCallback(){this.unbindEvents()}}customElements.get("nb-card")||customElements.define("nb-card",o);export{o as default};
