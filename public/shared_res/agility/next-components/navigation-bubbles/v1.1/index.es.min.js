const e=e=>null==e,t=e=>[...e.querySelectorAll("[data-ref]")].reduce(n,{}),n=(e,t)=>{const{ref:n}=t.dataset,s=n.match(/(\w+)\[(.+)\]/);return null!==s?i(e,t,s):{...e,[t.dataset.ref]:t}},i=(e,t,[,n,i])=>(void 0===e[n]&&(e[n]=[]),e[n][i]=t,e);var s=(e=[])=>{e.forEach((e=>{if(e&&e.element)return e.element.addEventListener(e.type,e.listener,e.options)}))},r=(e=[])=>{e.forEach((e=>{e&&e.element&&e.element.removeEventListener(e.type,e.listener)}))};const o=(()=>{const e=({identifier:e="",callback:t,options:n})=>{if(""===e)return{};const i=document.querySelectorAll(e),s=new IntersectionObserver(t,n);for(const e of i)s.observe(e);return{observer:s,targets:i}};return{initialize:t=>{t.map(e)},destroy:()=>{}}})(),a=[.2,.8],l=({eventName:e,args:t,element:n})=>{let i;n=n||window,t?i=new CustomEvent(e,{detail:t,bubbles:!0}):"function"==typeof Event?i=new Event(e):(i=document.createEvent("Event"),i.initEvent(e,!0,!0)),n.dispatchEvent(i)},d=(()=>{let e=null,t=!1;const n=e=>{i(e[0])},i=t=>{if(t.isIntersecting&&!e.isScrolling){let{sectionId:e=""}=t.target.dataset;e=""===e?t.target.getAttribute("data-id"):"",l({eventName:"EVENT_NAVIGATION_SECTION_CHANGE",args:{sectionId:e}})}};return{initialize:i=>{e=i;const s=[{identifier:"[data-id]",callback:n,options:{threshold:a,rootMargin:"-160px 0px 0px 0px"}}],r=()=>{t||(t=!0,o.initialize(s))};setTimeout((()=>{r()}),2e3),window.addEventListener("WEB_COMPONENT_PROJECTS_LOADED",(()=>{r()}))},destroy:()=>{}}})();class c extends HTMLElement{constructor(){super(),this.template=""}connectedCallback(){this.props=this._createProps(),this.onStart?.(),this.loadTemplate(),this.onReady?.()}_createProps(e=null){const t=e||this.attributes;let n;try{n=[...t].reduce(((e,t)=>({...e,[t.nodeName]:t.nodeValue})),{});const e=[...t].find((e=>"data"===e.nodeName));return null==e?n:{...n,...JSON.parse(e.nodeValue)}}catch(e){console.log("ERROR: No data",e)}}render(e=!1){e&&(this.innerHTML="");const t=(e,n)=>{const i=e=>3===e.nodeType?"text":8===e.nodeType?"comment":e.tagName.toLowerCase(),s=e=>e.childNodes&&e.childNodes.length>0?null:e.textContent;var r=Array.prototype.slice.call(n.childNodes),o=Array.prototype.slice.call(e.childNodes),a=r.length-o.length;if(a>0)for(;a>0;a--)r[r.length-a].parentNode.removeChild(r[r.length-a]);o.forEach((function(e,o){if(r[o])if(i(e)===i(r[o])){var a=s(e);if(a&&a!==s(r[o])&&(r[o].textContent=a),r[o].childNodes.length>0&&e.childNodes.length<1)r[o].innerHTML="";else{if(r[o].childNodes.length<1&&e.childNodes.length>0){var l=document.createDocumentFragment();return t(e,l),void r[o].appendChild(l)}e.childNodes.length>0&&t(e,r[o])}}else r[o].parentNode.replaceChild(e.cloneNode(!0),r[o]);else n.appendChild(e.cloneNode(!0))}))},n=(i=this.template,(new DOMParser).parseFromString(i,"text/html").body);var i;t(n,this)}loadTemplate(e="",t=!1){this.template=""===e?this.template:`${e}`,this.render(t)}disconnectedCallback(){this.onDestroy?.()}}customElements.get("nb-nespresso-element")||customElements.define("nb-nespresso-element",c);const h=e=>{const t=e=>{const t=e.querySelectorAll("a");for(const[e,i]of t.entries())i.addEventListener("click",n(e))},n=t=>n=>{n.preventDefault();const i=n.target.closest(".is-link");i&&(l({eventName:"EVENT_NAVIGATION_SECTION_CHANGE",args:{sectionId:i.getAttribute("data-href"),index:t}}),e.scroll&&e.scroll(i,t),window.location.hash=i.getAttribute("data-href"))},i=t=>{const{sectionId:n,index:i}=(e=>{if(e.detail)return e.detail})(t);e.updateBubbles&&e.updateBubbles(n),e.updateChips&&e.updateChips(n),e.updateSlider&&e.updateSlider(n,i)};return{createListeners:()=>{const{containerBubble:n,containerChip:r,sliderBubble:o,sliderChip:a}=e.refs,l=[];return n&&l.push({element:n,type:"WEB_COMPONENT_SLIDER_READY",listener:t(o),options:{once:!0}}),r&&l.push({element:r,type:"WEB_COMPONENT_SLIDER_READY",listener:t(a),options:{once:!0}}),l.push({element:window,type:"EVENT_NAVIGATION_SECTION_CHANGE",listener:i}),l.push({element:window,type:"EVENT_HEADER_POSITION_CHANGED",listener:e.updateLayout.bind(e)}),s(l),l}}},u={get is(){const{innerWidth:e,devicePixelRatio:t}=window;return{mobile:e<768,mobile_tablet:e<1024,tablet:e>=768&&e<1024,desktop:e>=1024&&t<=1,retina:e>=1024&&t>1}},lt:e=>window.innerWidth<e};class p{constructor(){this.promise=new Promise(((e,t)=>{this.reject=t,this.resolve=e}))}}window.gtmDataObject=window.gtmDataObject||[];class b extends HTMLElement{static get observedAttributes(){return["sticky"]}constructor(){super(),this.isMobile=window.innerWidth<768,this.isScrolling=!1}connectedCallback(){this.props=(t=>{const n=(e=>e.find((e=>"data"===e.nodeName)))([...t]),i=[...t].filter((e=>"data"!==e.nodeName)).reduce(((e,t)=>({...e,[t.nodeName]:t.nodeValue})),{});if(e(n))return i;try{return{...i,...JSON.parse(n.nodeValue)}}catch(e){console.log("ERROR: No data",e)}})(this.attributes),this.classList.add("nb-navigation-bubbles"),this.init()}init(){this.render(),this.refs=t(this),this.geometry=this.getGeometry(),this.slidesVisibles=this.getSlidesVisible(),d.initialize(this),this.eventsListeners=h(this).createListeners()}update(){this.eventListeners&&r(this.eventListeners),this.updateClasses(),this.render(),this.refs=t(this),this.eventsListeners=h(this).createListeners()}attributeChangedCallback(e,t,n){"sticky"===e&&this.props&&n!==t&&(this.props.sticky=n,this.update())}render(){let e="";e=this.isSticky()?`${this.renderNavigation(32,"Chip","white_1000")}`:`${this.renderNavigation(16,"Bubble","")}`,this.innerHTML=e,this.updateClasses()}renderNavigation(e,t,n){const{a11y_slider_previous_button:i,a11y_slider_next_button:s}=this.props,r=this.renderList(`render${t}`);return`\n            <nb-container\n                background_color="${n}"\n                class="nb-navigation-bubbles__container--${t.toLowerCase()}"\n                contrast="light"\n                data-ref="container${t}"\n            >\n                <nb-slider-menu\n                    a11y_slider_previous_button="${i}"\n                    a11y_slider_next_button="${s}"\n                    navigation="true"\n                    pagination="false"\n                    slides_loop="false"\n                    slides_visible="${this.slidesVisibles}"\n                    space_between="${e}"\n                    data-ref="slider${t}"\n                >\n                    ${r}\n                </nb-slider-menu>\n            </nb-container>\n        `}renderList(e){const{bubbles:t=[]}=this.props;return t.map((t=>this[e](t))).join("")}renderBubble(e){let{link:t}=e;if(!t)return null;const{linkNoHash:n,linkHash:i}=this._getHashLink(t);return`\n            <a href="${i}" class="is-link" data-href='${n}'>\n                <nb-bubble data='${JSON.stringify(e).replace(/"/g,"&quot;")}' data-ref="bubbles[${n}]"></nb-bubble>\n            </a>\n        `}_getHashLink(e){let t=e,n=e;return-1!==e.indexOf("#")?n=e.replace("#",""):t="#"+e,{linkNoHash:n,linkHash:t}}renderChip(e){const{link:t}=e;if(!t)return null;const{linkNoHash:n,linkHash:i}=this._getHashLink(t);return`\n            <a href="${i}" data-href='${n}' class="is-link">\n                <nb-chip\n                    background_image="${e.visual.src}"\n                    data-ref="chips[${n}]"\n                    rounded="false"\n                >\n                    ${e.label}\n                </nb-chip>\n            </a>\n        `}isSticky(){if(!this.props)return!1;const{sticky:e="false"}=this.props;return"true"===e}getMethod(e){return["add","remove"][e?0:1]}addClass(e,...t){this.classList[this.getMethod(e)](...t)}updateClasses(){const e=this.isSticky(),{padding_top:t,padding_bottom:n}=this.props;null!=n&&null!=t&&this.addClass(!e,t,n)}updateLayout(){this.geometry=this.getGeometry(),this.updatePosition()}updateBubbles(e){const{bubbles:t={}}=this.refs;for(const n in t){const i=t[n],s=n===e?"selected":"default";i.setAttribute&&i.setAttribute("state",s)}}updateChips(e){const{chips:t={}}=this.refs;for(const n in t){const i=t[n],s=n===e?"true":"false";i.setAttribute&&i.setAttribute("checked",s)}}async updateSlider(e,t){let n=t;if(this.refs.sliderChip){const i=await this.refs.sliderChip.sliderMenu;if(void 0===t){document.querySelectorAll("#pnProductNav-"+i._options.id+" .pn-ProductNavLinkWrapper").forEach(((t,i)=>{t.childNodes[0].getAttribute("data-href")===e&&(n=i)}))}n&&i&&i.goToSlide&&i.goToSlide(n)}}emit(e){l({element:this,...e})}async scroll(e,t){this.isScrolling=!0;const n=e.getAttribute("data-href"),{header:i,chips:s,navigation:r}=this.geometry,o=0===t?r.height:s.height,a={scrollPaddingTop:i.top+i.height+o};await((e,t={})=>{const n={scrollPaddingTop:140,scrollDuration:300,...t},i=new p;let s;const r=typeof e;if(["string","object"].indexOf(r)>-1){s=e,"string"===r&&(s=document.querySelector(e));try{e=window.pageYOffset+s.getBoundingClientRect().top-n.scrollPaddingTop}catch(t){throw new Error(`error: No element found with the selector "${e}"`)}}else"number"!=typeof e&&(e=0);let o=window.performance.now(),a=0,l=window.pageYOffset-e,d=window.innerHeight,c=document.body.clientHeight;l>d&&c-d>0&&(n.scrollDuration=Math.abs(n.scrollDuration+n.scrollDuration*(Math.abs(l)/(c-d))));let h=o+n.scrollDuration;return window.requestAnimationFrame((function t(){let s=window.performance.now();if(s<h){a=(s-o)/n.scrollDuration,a=--a*a*a+1;const i=l*a;window.scrollTo(0,e+(l-i)),window.requestAnimationFrame(t)}else window.scrollTo(0,e),setTimeout((()=>i.resolve()),125);return i.promise})),i.promise})(`[data-id="${n}"]`,a),this.isScrolling=!1}track(e){const{customEventAction:t}=this.props;let n={eventRaisedBy:"Before",eventLabel:e};var i;t&&(n.eventAction=t),i=n,window.gtmDataObject.push({event:"customEvent",eventRaisedBy:"Web component",eventCategory:"User Engagement",eventAction:"Click",eventLabel:"",nonInteraction:0,...i})}getGeometry(){const e=document.querySelector(".Header__top"),t=this?.getBoundingClientRect(),n=e?.getBoundingClientRect()||{height:0,y:0};return{header:{height:n.height,top:n.y},navigation:{height:t.height,top:window.scrollY+t.y},chips:{height:t.height,top:window.scrollY+t.y}}}getSlidesVisible(){const{sticky:e="false"}=this.props;return u.is.mobile?3:u.is.tablet?6:"true"===e?5:9}disconnectedCallback(){r(this.eventListeners)}}customElements.get("nb-navigation-bubbles")||customElements.define("nb-navigation-bubbles",b);export{b as default};
