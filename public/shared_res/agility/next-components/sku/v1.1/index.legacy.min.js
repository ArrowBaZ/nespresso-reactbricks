class e extends HTMLElement{constructor(){super(),this.template=""}connectedCallback(){this.props=this._createProps(),this.onStart?.(),this.loadTemplate(),this.onReady?.()}_createProps(e=null){const t=e||this.attributes;let n;try{n=[...t].reduce(((e,t)=>({...e,[t.nodeName]:t.nodeValue})),{});const e=[...t].find((e=>"data"===e.nodeName));return null==e?n:{...n,...JSON.parse(e.nodeValue)}}catch(e){console.log("ERROR: No data",e)}}render(e=!1){e&&(this.innerHTML="");const t=(e,n)=>{const r=e=>3===e.nodeType?"text":8===e.nodeType?"comment":e.tagName.toLowerCase(),i=e=>e.childNodes&&e.childNodes.length>0?null:e.textContent;var a=Array.prototype.slice.call(n.childNodes),s=Array.prototype.slice.call(e.childNodes),o=a.length-s.length;if(o>0)for(;o>0;o--)a[a.length-o].parentNode.removeChild(a[a.length-o]);s.forEach((function(e,s){if(a[s])if(r(e)===r(a[s])){var o=i(e);if(o&&o!==i(a[s])&&(a[s].textContent=o),a[s].childNodes.length>0&&e.childNodes.length<1)a[s].innerHTML="";else{if(a[s].childNodes.length<1&&e.childNodes.length>0){var l=document.createDocumentFragment();return t(e,l),void a[s].appendChild(l)}e.childNodes.length>0&&t(e,a[s])}}else a[s].parentNode.replaceChild(e.cloneNode(!0),a[s]);else n.appendChild(e.cloneNode(!0))}))},n=(r=this.template,(new DOMParser).parseFromString(r,"text/html").body);var r;t(n,this)}loadTemplate(e="",t=!1){this.template=""===e?this.template:`${e}`,this.render(t)}disconnectedCallback(){this.onDestroy?.()}}customElements.get("nb-nespresso-element")||customElements.define("nb-nespresso-element",e);const t=e=>n(JSON.stringify(e)),n=e=>e?e.toString().replace(/"/g,"&quot;").replace(/'/g,"&apos;"):"",r={get is(){const{innerWidth:e,devicePixelRatio:t}=window;return{mobile:e<768,mobile_tablet:e<1024,tablet:e>=768&&e<1024,desktop:e>=1024&&t<=1,retina:e>=1024&&t>1}},lt:e=>window.innerWidth<e},i=({image:e=""},t)=>{const n=".cb-image img",r=t.querySelector(n),i=e=>{console.log(e),console.error(`Error: Component SKU - Lazy Load - ${e}`),r&&(r.style.display="none")};if(!r)return i(`${n} HTMLElement not found.`),"";const a=e+((e="product",t=150)=>{const n=[];return e&&n.push(`impolicy=${e}`),t&&n.push(`imwidth=${t}`),`?${n.join("&")}`})();if(!a)return i(`${a} source file is empty.`),"";!function(e,t,n,r,i){const a=(t,n)=>{e.setAttribute(t,n);const a=()=>e.classList.add("lazy-loaded");if(r){const t=new Image;return t.src=r,t.onload=a,void(t.onerror=()=>{i&&i(`Image ${r} cannot be loaded.`),e.classList.add("lazy-loaded-error")})}a()};if(/Trident\/|MSIE/.test(window.navigator.userAgent)||(s=window.navigator.userAgent,o=s.indexOf("OS "),(s.indexOf("iPhone")>-1||s.indexOf("iPad")>-1)&&o>-1&&window.Number(s.substr(o+3,3).replace("_","."))<14))a(t,n);else if("IntersectionObserver"in window){e.classList.add("lazy-load");let r=new IntersectionObserver((function(e){e.forEach((function(e){e.isIntersecting&&(a(t,n),r.unobserve(e.target))}))}));r.observe(e)}else a(t,n);var s,o}(r,"src",`${a}`,a,i)},a="plp",s=e=>"pdp"===e,o=e=>{const{url:t,name:n="",name_custom:r=""}=e;if(!n)return"";const i=""!==r?r:n,a=[],o=(({variation:e})=>s(e)?"h1":"h3")(e);return a.push(`<${o} class="cb-heading">`),t&&s(e.variation)?a.push((({url:e,a11y_product_card:t="",name:n="",name_custom:r=""})=>{const i=t.replace("{productName}",n);return`<a href="${e}" target="_self" title="${i}" aria-label="${i}">${""!==r?r:n}</a>`})(e)):a.push(`${i}`),a.push(`</${o}>`),a.join("")},l=async e=>{const t=await(async()=>await window.napi.priceFormat())(),n=window[window.config.padl.namespace].dataLayer.app.app.currency;return t.html?t.html(n,e):t.short(n,e)||""},d=e=>e.querySelector(".cb-price-old"),c=({strikethrough_price:e},t)=>{return e?((n=e,l(n)).then((e=>{const n=d(t);n&&(n.innerHTML=e)})).catch((e=>{console.error(`Error: Component SKU - Strike Through Price  - ${e}`);const n=d(t);n&&(n.style.display="none")})),'<p class="cb-price-old"></p>'):"";var n};class u extends e{constructor(){super(),this.type="default",this.boundOnPDPLinkClick=this.onPDPLinkClick.bind(this)}loadTemplate(){this.classList.add("nb-sku"),this.classList.add(`nb-sku__${this.type}`),(({variation:e,type:t},n)=>{"pdp"!==e?"capsule"===t&&r.is.mobile?n.setAttribute("landscape","true"):n.setAttribute("portrait","true"):n.setAttribute("pdp","true")})(this.props,this),this.template=`${this.renderVisual()}\n                          ${this.renderHeader()}\n                          <div class="cb-content">\n                              ${this.renderInformation()}\n                              <div class="cb-shop">\n                                  <div class="cb-price">\n                                      ${this.renderPricing()}\n                                  </div>\n                                  ${this.renderAction()}\n                              </div>\n                              ${this.renderFooter()}\n                          </div>`,this.render()}onReady(){const{sku:e,category_name:t,position:n=0}=this.props;this.setAttribute("data-product-item-id",e),this.setAttribute("data-product-section",t),this.setAttribute("data-product-position",n.toString()),this.activateLazyLoad(),this.bindEvent()}activateLazyLoad(){const{image:e}=this.props;if(!e)return"";i(this.props,this)}renderHeaderDefault(){return`${(({labels:e=[]},n=null)=>{if(!n||!e||!e.length)return"";n&&e.length&&n.classList.add("has-labels");const i=r.is.mobile?"row":"column";return`<nb-card-labels data="${t({labels:e})}" direction="${i}"></nb-card-labels>`})(this.props,this)}${((e,n)=>{const{fair_trade:r,alt_fair_trade:i,is_organic:a,alt_organic:s,only_vertuo_next:o,alt_vertuo_next:l,is_rainforest:d,alt_rainforest:c,is_sustainable:u,alt_sustainable:h,is_q_certified_arabica:p,alt_q_certification_arabica:m,logos:b}=e;return r||a||o||d||u||p||!(null==b||b.length<1)?(n.classList.add("has-logos"),`<nb-card-logos data='${t({fair_trade:r,alt_fair_trade:i,is_organic:a,alt_organic:s,only_vertuo_next:o,alt_vertuo_next:l,is_rainforest:d,alt_rainforest:c,is_sustainable:u,alt_sustainable:h,is_q_certified_arabica:p,alt_q_certification_arabica:m,logos:b})}'></nb-card-logos>`):""})(this.props,this)}`}renderHeader(){return this.renderHeaderDefault()}renderVisualDefault(){return(({url:e,image_alt_text:t,image:n})=>{if(!n)return"";let r=`<img src="" alt="${t||"loading"}"/>`;return e&&(r=`<a href="${e}" target="_self" aria-hidden="true" tabindex="-1">${r}</a>`),`<div class="cb-image">\n                ${r}\n            </div>`})(this.props)}renderVisual(){return this.renderVisualDefault()}renderInformationDefault(){return`${(({label_technology:e})=>e?`<p class="cb-technology t-xs-700">${e}</p>`:"")(this.props)}\n        ${(({label_range:e})=>e?`<p class="cb-range t-xs-500">${e}</p>`:"")(this.props)}\n        ${o(this.props)}\n        ${(({headline:e="",is_headline_hidden:t=!1})=>t&&r.is.mobile||!e?"":`<p class="cb-text">${e}</p>`)(this.props)}`}renderInformation(){return this.renderInformationDefault()}renderPricingDefault(){return`${c(this.props,this)}\n                ${(({price:e,hidePrice:t,giftcard_price:n})=>!e&&!n||t?"":`<p class="cb-price-current"><span>${e||n}</span></p>`)(this.props)}`}renderPricing(){return this.renderPricingDefault()}renderActionDefault(){return(e=>{const{category_name:t="",sku:n,longSku:i="",position:s,variation:o=a,hidePrice:l,url:d,view_details_label:c="View details",rendererName:u=""}=e;let h="large";return o===a&&(h=r.is.mobile?"small":"large"),"small"===o&&(h="small"),l?`<nb-cta link="${d}" variation="primary">${c}</nb-cta>`:`\n        <nb-add-to-cart\n            sku="${n}"\n            longSku="${i}"\n            buttonSize="${h}"\n            showPrice\n            range='${t}'\n            position='${s}'\n            rendererName='${u}'\n        ></nb-add-to-cart>\n    `})(this.props)}renderAction(){return this.renderActionDefault()}renderFooterDefault(){return(({additional_message_icon:e,additional_message:t,additional_message_link:n})=>{if(!t&&!n)return"";let r="";if(t){let n="";e&&(n=`<nb-icon icon="${e}" class="additionalMsgIcon"></nb-icon>`),r=`<p class="cb-warn t-sm-500-sl">\n            ${n}\n            ${t}</p>`}return n&&n.link&&n.label&&(r+=`<nb-link\n            link='${n.link}'\n            color="${n.color}"\n            size="${n.size}"\n            seo_label="${n.seo_label}">\n            ${n.label}\n        </nb-link>`),r})(this.props)}renderFooter(){return this.renderFooterDefault()}async onPDPLinkClick(){window.napi&&window.napi.data&&window.napi.data().product().setProductClickData(await window.productHelper.getPadlProductDetail(await window.napi.catalog().getProduct(this.props.longSku)))}bindEvent(){this.linkElements=[],this.unbindEvent(),this.linkElements=this.querySelectorAll("a[href]"),this.linkElements.length&&Array.from(this.linkElements).forEach((e=>{e.addEventListener("click",this.boundOnPDPLinkClick)}))}unbindEvent(){this.linkElements.length&&(Array.from(this.linkElements).forEach((e=>{e.removeEventListener("click",this.boundOnPDPLinkClick)})),this.linkElements=[])}disconnectedCallback(){this.unbindEvent()}}customElements.get("nb-sku")||customElements.define("nb-sku",u);export{u as default};
