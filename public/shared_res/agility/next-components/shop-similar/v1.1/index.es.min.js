const e=e=>null==e;class t extends HTMLElement{constructor(){super(),this.template=""}connectedCallback(){this.props=this._createProps(),this.onStart?.(),this.loadTemplate(),this.onReady?.()}_createProps(e=null){const t=e||this.attributes;let n;try{n=[...t].reduce(((e,t)=>({...e,[t.nodeName]:t.nodeValue})),{});const e=[...t].find((e=>"data"===e.nodeName));return null==e?n:{...n,...JSON.parse(e.nodeValue)}}catch(e){console.log("ERROR: No data",e)}}render(e=!1){e&&(this.innerHTML="");const t=(e,n)=>{const i=e=>3===e.nodeType?"text":8===e.nodeType?"comment":e.tagName.toLowerCase(),s=e=>e.childNodes&&e.childNodes.length>0?null:e.textContent;var a=Array.prototype.slice.call(n.childNodes),l=Array.prototype.slice.call(e.childNodes),r=a.length-l.length;if(r>0)for(;r>0;r--)a[a.length-r].parentNode.removeChild(a[a.length-r]);l.forEach((function(e,l){if(a[l])if(i(e)===i(a[l])){var r=s(e);if(r&&r!==s(a[l])&&(a[l].textContent=r),a[l].childNodes.length>0&&e.childNodes.length<1)a[l].innerHTML="";else{if(a[l].childNodes.length<1&&e.childNodes.length>0){var o=document.createDocumentFragment();return t(e,o),void a[l].appendChild(o)}e.childNodes.length>0&&t(e,a[l])}}else a[l].parentNode.replaceChild(e.cloneNode(!0),a[l]);else n.appendChild(e.cloneNode(!0))}))},n=(i=this.template,(new DOMParser).parseFromString(i,"text/html").body);var i;t(n,this)}loadTemplate(e="",t=!1){this.template=""===e?this.template:`${e}`,this.render(t)}disconnectedCallback(){this.onDestroy?.()}}customElements.get("nb-nespresso-element")||customElements.define("nb-nespresso-element",t);class n extends HTMLElement{constructor(){super(),this.props={}}connectedCallback(){this.props=(t=>{const n=(e=>e.find((e=>"data"===e.nodeName)))([...t]),i=[...t].filter((e=>"data"!==e.nodeName)).reduce(((e,t)=>({...e,[t.nodeName]:t.nodeValue})),{});if(e(n))return i;try{return{...i,...JSON.parse(n.nodeValue)}}catch(e){console.log("ERROR: No data",e)}})(this.attributes),this.renderLoader(),this.bindEvents(),this.init().then()}async init(){this.priceFormatter=await window.napi.priceFormat(),this.currency=window[window?.padlNamespace]?.dataLayer.currency,this.render()}renderLoader(){this.innerHTML='<nb-loader state="loading"></nb-loader>'}render(){const{image_url:e,image_alt_text:t,label_main_sku:n,label_unavailable:i,label_similar:s}=this.props.copywriting,{products:a=[]}=this.props;e&&n&&i&&s&&a&&0!==a.length&&(this.innerHTML=`\n            <div class="mainSku">\n                <img loading="lazy" src="${e}" alt="${t}"/>\n                <p class="t-md-700-caps">${n}</p>\n                <p class="t-md-400">${i}</p>\n            </div>\n            <h2 class="h-lg-700-caps-sl">${s}</h2>\n            <div class="cardGrid"></div>\n        `,this.imageMainSku=this.querySelector(".mainSku img"),this.labelMainSku=this.querySelector(".mainSku .t-md-700-caps"),this.labelUnavailable=this.querySelector(".mainSku .t-md-400"),this.labelSimilar=this.querySelector("h2"),this.productContainerElement=this.querySelector(".cardGrid"),this.renderCards())}async onPopinOpen(e){await this.ready;const{detail:t={}}=e;"shop-similar-popin-id"===t.id&&null!=t.products&&(this.props.image_url=t.image_url,this.props.image_alt_text=t.image_alt_text,this.props.label_main_sku=t.label_main_sku,this.props.label_unavailable=t.label_unavailable,this.props.label_similar=t.label_similar,this.render(),this.props.products=t.products,this.renderCards())}renderCards(){this.props.products.forEach((async(e,t)=>{const n=e.sku,i=await window.napi.catalog().getProduct(n);if(null!=i.inStock&&!i.inStock)return;let s={...i,...e};s.name=e.name||i.name,s.headline=e.headline||i.headline,s.technologies||(s.technologies=["/original"]),s.pdpURLs||(s.pdpURLs=[{desktop:""}]),s.images||(s.images=[{icon:""}]),this.renderProductElement(s,t)}))}renderProductElement(e,t){const{options:n={}}=this.props,{show_sleeve:i,label_sleeve:s,label_sleeves:a,label_capsules:l,a11y_intensity_max:r,intensity_label:o,show_slider:d,show_ratings:c,minimum_rating:p=3,a11y_price:h="",a11y_extra_color:m=""}=n;let u="";const _=(({technologies:e})=>e.indexOf("original")?14:12)(e);u=`${r} ${_}`;const g=this.priceFormatter.html?this.priceFormatter.html(this.currency,e.price):this.priceFormatter.short(this.currency,e.price),b={url:"giftcard"===e.type?"":e.pdpURLs.desktop||"",image:e.images.icon||"",price:g,image_alt_text:e.name,intensity_label:o,max_intensity:_,type:e.type,bundled:e.bundled,unit_quantity:e.unitQuantity,sales_multiple:e.salesMultiple,name:e.name,description:e.description,headline:e.headline,intensity:e.capsuleProperties?e.capsuleProperties.intensity:"0",sku:e.internationalId,longSku:e.id,show_ratings:c,show_slider:d,minimum_rating:p,label_sleeve:s,label_sleeves:a,show_sleeve:i,label_capsules:l,a11y_price:h,a11y_intensity_max:u,a11y_extra_color:m,position:t+1,inStock:e.inStock},y=document.createElement("nb-plp-product-card");y.setAttribute("data",JSON.stringify(b));const N=this.productContainerElement.children;t>N.length-1?this.productContainerElement.appendChild(y):this.productContainerElement.insertBefore(y,N[t])}bindEvents(){this.boundOnPopinOpen=this.onPopinOpen.bind(this),window.addEventListener("WEB_COMPONENT_POPIN_OPEN",this.boundOnPopinOpen)}unbindEvents(){this.boundOnPopinOpen&&window.removeEventListener("WEB_COMPONENT_POPIN_OPEN",this.boundOnPopinOpen)}disconnectedCallback(){this.unbindEvents()}}customElements.get("nb-shop-similar")||customElements.define("nb-shop-similar",n);export{n as default};
