class e extends HTMLElement{constructor(){super(),this.template=""}connectedCallback(){this.props=this._createProps(),this.onStart?.(),this.loadTemplate(),this.onReady?.()}_createProps(e=null){const n=e||this.attributes;let t;try{t=[...n].reduce(((e,n)=>({...e,[n.nodeName]:n.nodeValue})),{});const e=[...n].find((e=>"data"===e.nodeName));return null==e?t:{...t,...JSON.parse(e.nodeValue)}}catch(e){console.log("ERROR: No data",e)}}render(e=!1){e&&(this.innerHTML="");const n=(e,t)=>{const i=e=>3===e.nodeType?"text":8===e.nodeType?"comment":e.tagName.toLowerCase(),s=e=>e.childNodes&&e.childNodes.length>0?null:e.textContent;var o=Array.prototype.slice.call(t.childNodes),a=Array.prototype.slice.call(e.childNodes),r=o.length-a.length;if(r>0)for(;r>0;r--)o[o.length-r].parentNode.removeChild(o[o.length-r]);a.forEach((function(e,a){if(o[a])if(i(e)===i(o[a])){var r=s(e);if(r&&r!==s(o[a])&&(o[a].textContent=r),o[a].childNodes.length>0&&e.childNodes.length<1)o[a].innerHTML="";else{if(o[a].childNodes.length<1&&e.childNodes.length>0){var l=document.createDocumentFragment();return n(e,l),void o[a].appendChild(l)}e.childNodes.length>0&&n(e,o[a])}}else o[a].parentNode.replaceChild(e.cloneNode(!0),o[a]);else t.appendChild(e.cloneNode(!0))}))},t=(i=this.template,(new DOMParser).parseFromString(i,"text/html").body);var i;n(t,this)}loadTemplate(e="",n=!1){this.template=""===e?this.template:`${e}`,this.render(n)}disconnectedCallback(){this.onDestroy?.()}}customElements.get("nb-nespresso-element")||customElements.define("nb-nespresso-element",e);const n=(()=>{let e=null,n="L";const t=e=>e>=768?"L":"S";return{observe:(i,s)=>{i&&(n=t(window.innerWidth),e=(e=>new ResizeObserver((i=>i.forEach((i=>{if(i.contentBoxSize){const s=Array.isArray(i.contentBoxSize)?i.contentBoxSize[0]:i.contentBoxSize,o=t(s.inlineSize);o!==n&&(n=o,e())}})))))(s),e.observe(i))},unobserve:n=>{n&&e.unobserve(n)},setSuffix:e=>e.replace(/(?:\.([^.]+))?$/,`_${n}.$1`)}})(),t=e=>null==e;const i={get is(){const{innerWidth:e,devicePixelRatio:n}=window;return{mobile:e<768,mobile_tablet:e<1024,tablet:e>=768&&e<1024,desktop:e>=1024&&n<=1,retina:e>=1024&&n>1}},lt:e=>window.innerWidth<e},s={getResponsiveSrc:e=>{const n=(t=e,Array.isArray(t)||"object"==typeof t?["mobile","tablet","desktop","retina"].find((e=>!0===i.is[e]&&e in t&&""!==t[e])):null);var t;return n?e[n]:e.desktop}};class o extends HTMLElement{constructor(){super()}connectedCallback(){this.props=(e=>{const n=(e=>e.find((e=>"data"===e.nodeName)))([...e]),i=[...e].filter((e=>"data"!==e.nodeName)).reduce(((e,n)=>({...e,[n.nodeName]:n.nodeValue})),{});if(t(n))return i;try{return{...i,...JSON.parse(n.nodeValue)}}catch(e){console.log("ERROR: No data",e)}})(this.attributes),this.render(),this.eventListeners=this.createEventListeners(),this.addEventListeners()}createEventListeners(){const e=[],n=this.querySelector("button.visual");return n&&e.push({element:n,type:"click",listener:this.openPlayer.bind(this)}),e}createLayout(){const{position:e="left"}=this.props.copywriting;this.classList.add(`text-${e}`)}render(){const{layout:e,campaign:n,copywriting:t}=this.props,{heading:s="",hide_title:o,subtitle:a="",visual_secondary:r,video:l}=t,{mobile:c="",desktop:d=""}=r,{video_id:p="",video_service:h=""}=l,{background_color:v,padding_top:m,padding_bottom:u}=e,{id:g,name:$,creative:y,position:b}=n,_="h-2xl-300-sl "+("false"!==o?"sr-only":"");this.hasSecondary=i.is.mobile&&""!==c||!i.is.mobile&&""!==d,this.hasVideo=""!==p&&""!==h,this.createLayout(),this.innerHTML=`<nb-container\n                            campaign_id="${g}"\n                            campaign_name="${$}"\n                            campaign_creative="${y}"\n                            campaign_position="${b}"\n                            background_color='${v}'\n                            classname="${m} ${u}"\n                            contrast="light">\n                            <div class="caption">\n                                ${s&&`<h2 class="${_}">${s}</h2>`}\n                                ${a&&`<p class="t-md-400">${a}</p>`}\n                                ${this.renderContent()}\n                                ${this.renderLink()}\n                                ${this.renderCta()}\n                            </div>\n                            <div class="cover ${this.hasSecondary&&"cover-secondary"}">\n                                ${this.renderCover()}\n                            </div>\n                        </nb-container>\n                        ${this.renderPlayer()}`}renderCover(){const{visual:e,visual_secondary:n={},video:t={}}=this.props.copywriting;if(!e)return"";if("string"==typeof e)return this.renderSimpleVisual();const i=s.getResponsiveSrc(e),o=this.hasSecondary?s.getResponsiveSrc(n):"";let a="";this.hasVideo?(this.classList.add("has-video"),a=`<button class="visual">\n                <nb-icon icon="play"></nb-icon>\n                <img loading="lazy" src="${i}" alt="${e.alt_text+"."}"/>\n                ${""!==t.a11y_play_video?`<span class="sr-only">${t.a11y_play_video}</span>`:""}\n            </button>`):a=`<div class="visual">\n                <img loading="lazy" src="${i}" alt="${e.alt_text}"/>\n            </div>`;let r="";return this.hasSecondary&&(r=`<img alt="${n.alt_text}" loading="lazy" class="visual secondary" src="${o}" aria-hidden="true" />`),`${r+a}`}renderSimpleVisual(){const{visual:e,visual_alt:t=""}=this.props.copywriting;return`<div class="visual">\n                <img loading="lazy" src="${n.setSuffix(e)}" alt="${t}"/>\n            </div>`}renderLink(){const{label:e,link:n,color:t,size:i,seo_label:s}=this.props.copywriting.link;if(!e||!n)return"";const{id:o,name:a,creative:r,position:l}=this.props.campaign;return`<nb-link\n            campaign_id="${o}"\n            campaign_name="${a}"\n            campaign_creative="${r}"\n            campaign_position="${l}"\n            link="${n}"\n            color="${t}"\n            size="${i}"\n            seo_label="${s}"\n            >${e}</nb-link>`}renderCta(){const{label:e,link:n,variation:t,seo_label:i,popin_id:s}=this.props.copywriting.cta;if(!e||!n&&!s)return"";const{id:o,name:a,creative:r,position:l}=this.props.campaign;return`<nb-cta\n            campaign_id="${o}"\n            campaign_name="${a}"\n            campaign_creative="${r}"\n            campaign_position="${l}"\n            ${n?`link="${n}"`:""}\n            ${s?`popin_id="${s}"`:""}\n            variation="${t}"\n            seo_label="${i}"\n        >${e}</nb-cta>`}renderContent(){const{text:e}=this.props.copywriting;if(!e)return"";return`<div class="content t-sm-400">${e.replaceAll(new RegExp(/<li>([^<>]*)<\/li>/,"g"),'<li><nb-icon icon="check"></nb-icon>$1</li>')}</div>`}renderPlayer(){const{video_id:e,video_mobile:n="",display_ui_controls:t,cc_policy_language:i,video_service:s}=this.props.copywriting.video;return this.hasVideo?(this.popinId=this.createPopinID(),`<nb-popin id="${this.popinId}" popin_id="${this.popinId}" variation="before" bgcolor="white">\n                    <nb-video\n                        container_id="player-${this.popinId}"\n                        video_id="${e}"\n                        video_mobile="${n}"\n                        video_service="${s}"\n                        popin_id="${this.popinId}"\n                        display_controls="${t}"\n                        ccPolicy_language="${i}"\n                        allow_popin_autoplay="true"\n                    />\n                  </nb-popin>`):""}createPopinID(){const{heading:e=""}=this.props.copywriting;return this.stripedHeading=function(e){const n=document.implementation.createHTMLDocument("");return n.body.innerHTML=e,n.body.innerText.replace(RegExp("[\\s|'|\"]","g"),"")}(e).substr(0,10),`image-text-${this.stripedHeading}`}addEventListeners(){this.eventListeners&&this.eventListeners.forEach((e=>e.element.addEventListener(e.type,e.listener,e.options)))}removeEventListeners(){this.eventListeners&&this.eventListeners.forEach((e=>e.element.removeEventListener(e.type,e.listener)))}openPlayer(){(({eventName:e,args:n,element:t})=>{let i;t=t||window,n?i=new CustomEvent(e,{detail:n,bubbles:!0}):"function"==typeof Event?i=new Event(e):(i=document.createEvent("Event"),i.initEvent(e,!0,!0)),t.dispatchEvent(i)})({eventName:"WEB_COMPONENT_POPIN_OPEN",args:{id:this.popinId}})}disconnectedCallback(){this.removeEventListeners()}}customElements.get("nb-image-text")||customElements.define("nb-image-text",o);export{o as default};
