const e=e=>null==e;const t=e=>n(JSON.stringify(e)),n=e=>e?e.toString().replace(/"/g,"&quot;").replace(/'/g,"&apos;"):"";class i extends HTMLElement{constructor(){super(),this.template=""}connectedCallback(){this.props=this._createProps(),this.onStart?.(),this.loadTemplate(),this.onReady?.()}_createProps(e=null){const t=e||this.attributes;let n;try{n=[...t].reduce(((e,t)=>({...e,[t.nodeName]:t.nodeValue})),{});const e=[...t].find((e=>"data"===e.nodeName));return null==e?n:{...n,...JSON.parse(e.nodeValue)}}catch(e){console.log("ERROR: No data",e)}}render(e=!1){e&&(this.innerHTML="");const t=(e,n)=>{const i=e=>3===e.nodeType?"text":8===e.nodeType?"comment":e.tagName.toLowerCase(),s=e=>e.childNodes&&e.childNodes.length>0?null:e.textContent;var r=Array.prototype.slice.call(n.childNodes),o=Array.prototype.slice.call(e.childNodes),a=r.length-o.length;if(a>0)for(;a>0;a--)r[r.length-a].parentNode.removeChild(r[r.length-a]);o.forEach((function(e,o){if(r[o])if(i(e)===i(r[o])){var a=s(e);if(a&&a!==s(r[o])&&(r[o].textContent=a),r[o].childNodes.length>0&&e.childNodes.length<1)r[o].innerHTML="";else{if(r[o].childNodes.length<1&&e.childNodes.length>0){var l=document.createDocumentFragment();return t(e,l),void r[o].appendChild(l)}e.childNodes.length>0&&t(e,r[o])}}else r[o].parentNode.replaceChild(e.cloneNode(!0),r[o]);else n.appendChild(e.cloneNode(!0))}))},n=(i=this.template,(new DOMParser).parseFromString(i,"text/html").body);var i;t(n,this)}loadTemplate(e="",t=!1){this.template=""===e?this.template:`${e}`,this.render(t)}disconnectedCallback(){this.onDestroy?.()}}customElements.get("nb-nespresso-element")||customElements.define("nb-nespresso-element",i);const s=(e,t)=>{const{ref:n}=t.dataset,i=n.match(/(\w+)\[(.+)\]/);return null!==i?r(e,t,i):{...e,[t.dataset.ref]:t}},r=(e,t,[,n,i])=>(void 0===e[n]&&(e[n]=[]),e[n][i]=t,e),o={get is(){const{innerWidth:e,devicePixelRatio:t}=window;return{mobile:e<768,mobile_tablet:e<1024,tablet:e>=768&&e<1024,desktop:e>=1024&&t<=1,retina:e>=1024&&t>1}},lt:e=>window.innerWidth<e},a=(e="product",t=150)=>{const n=[];return e&&n.push(`impolicy=${e}`),t&&n.push(`imwidth=${t}`),`?${n.join("&")}`},l=(e="medium",t="375",n="1024",i="1920",s="3840")=>o.is.mobile?a(e,t):o.is.tablet?a(e,n):o.is.desktop?a(e,i):a(e,s);class d extends HTMLElement{constructor(){super(),this.buttonElements=null,this.boundHandleClick=this.handleClick.bind(this),this.boundOnPopinOpened=this.onPopinOpened.bind(this),this.popinId="gallery_popin_slider_full_screen"}connectedCallback(){this.props=(t=>{const n=(e=>e.find((e=>"data"===e.nodeName)))([...t]),i=[...t].filter((e=>"data"!==e.nodeName)).reduce(((e,t)=>({...e,[t.nodeName]:t.nodeValue})),{});if(e(n))return i;try{return{...i,...JSON.parse(n.nodeValue)}}catch(e){console.log("ERROR: No data",e)}})(this.attributes),this.a11yLabels=this.props.copywriting.a11y_labels,this.render(),this.refs=[...this.querySelectorAll("[data-ref]")].reduce(s,{}),this.initLazyLoad(),this.buttonElements=this.querySelectorAll("li button"),this.popin=this.querySelector("nb-popin"),this.bindEvent()}initLazyLoad(){Object.values(this.refs).forEach((e=>{const t=e.getAttribute("temp-src");e&&t&&function(e,t,n,i,s){const r=(t,n)=>{e.setAttribute(t,n);const r=()=>e.classList.add("lazy-loaded");if(i){const t=new Image;return t.src=i,t.onload=r,void(t.onerror=()=>{s&&s(`Image ${i} cannot be loaded.`),e.classList.add("lazy-loaded-error")})}r()};if(/Trident\/|MSIE/.test(window.navigator.userAgent)||(o=window.navigator.userAgent,a=o.indexOf("OS "),(o.indexOf("iPhone")>-1||o.indexOf("iPad")>-1)&&a>-1&&window.Number(o.substr(a+3,3).replace("_","."))<14))r(t,n);else if("IntersectionObserver"in window){e.classList.add("lazy-load");let i=new IntersectionObserver((function(e){e.forEach((function(e){e.isIntersecting&&(r(t,n),i.unobserve(e.target))}))}));i.observe(e)}else r(t,n);var o,a}(e,"src",`${t}`,t)}))}render(){const{layout:e,campaign:t}=this.props;this.innerHTML=`\n            <nb-container\n                campaign_id="${t.id}"\n                campaign_name="${t.name}"\n                campaign_position="${t.position}"\n                campaign_creative="${t.creative}"\n                contrast="${e.contrast}"\n                background_color="${e.background_color}"\n                background_mobile='${e.background.mobile}'\n                background_tablet='${e.background.tablet}'\n                background_desktop='${e.background.desktop}'\n                background_retina='${e.background.retina}'\n                classname="${e.padding_top} ${e.padding_bottom}">\n                ${this.renderTitle()}\n                ${this.renderSlider()}\n                ${this.renderPopin()}\n            </nb-container>\n        `}renderTitle(){const{a11y_heading:e}=this.props.copywriting;return e?`${e&&`<h2 class='sr-only'>${e}</h2>`}`:""}renderSlider(){const e={options:{mobile:{display_counter:"true",slide_width:"279",slide_min_height:"auto",slider_gap:"16"},tablet:{slide_width:"536",slide_min_height:"auto",slider_gap:"40"},desktop:{items_per_slide:"2",slide_width:"536",slide_min_height:"auto",slider_gap:"40"}},a11y_labels:{prev:this.a11yLabels.prev,next:this.a11yLabels.next,nav:this.a11yLabels.nav}};return`<nb-slider-natural data="${t(e)}">\n            ${this.renderSlides()}\n        </nb-slider-natural>`}renderSlides(){const{slides:e}=this.props.copywriting;return`${e.reduce(((e,t,n)=>`${e}${this.renderSlide(t,n)}`),"")}`}renderSlide(e,t){const n="thumb-"+t;let i=e.path+e.thumb;return i+=l("medium","279","536","536","1072"),`\n            <li class="slide">\n                <button role="img" index="${t}"\n                    aria-label="${e.description}"\n                    aria-description="${this.a11yLabels.expand}">\n                    <img data-ref="${n}" temp-src="${i}" alt=""/>\n                </button>\n            </li>\n        `}renderPopin(){return`\n            <nb-popin\n                id="${this.popinId}"\n                popin_id="${this.popinId}"\n                size="gallery"\n                variation="before"\n                bgcolor="black"\n                padding="false"\n                label_close="${this.a11yLabels.close}">\n                ${this.renderPopinSlider()}\n            </nb-popin>\n        `}renderPopinSlider(){const e={options:{mobile:{contrast:"dark",display_counter:"true",slider_gap:"0",overflow:"false"},tablet:{contrast:"dark",slider_gap:"0",overflow:"false"},desktop:{contrast:"dark",slider_gap:"0",overflow:"false"}},a11y_labels:{prev:this.a11yLabels.prev,next:this.a11yLabels.next,nav:this.a11yLabels.nav}};return`<nb-slider-natural data="${t(e)}">\n            ${this.renderPopinSlides()}\n        </nb-slider-natural>`}renderPopinSlides(){const{slides:e}=this.props.copywriting;return`${e.reduce(((e,t,n)=>`${e}${this.renderPopinSlide(t,n)}`),"")}`}renderPopinSlide(e,t){const n="modal-"+t;let i=e.path+e.modal;return i+=l("medium","375","728","775","1550"),`<li class="slide" tabindex="0" role="img" aria-label="${e.description}">\n            <img data-ref="${n}" temp-src="${i}" alt=""/>\n        </li>`}handleClick(e){this.updatedDefaultPosition=e.target.getAttribute("index"),this.popinSlider||(this.renderPopinSlider(),this.popinSlider=this.querySelector("nb-popin nb-slider-natural")),(({eventName:e,args:t,element:n})=>{let i;n=n||window,t?i=new CustomEvent(e,{detail:t,bubbles:!0}):"function"==typeof Event?i=new Event(e):(i=document.createEvent("Event"),i.initEvent(e,!0,!0)),n.dispatchEvent(i)})({eventName:"WEB_COMPONENT_POPIN_OPEN",args:{id:this.popinId}})}onPopinOpened(e){const{detail:t={}}=e;t.id===this.popinId&&this.popinSlider.updateSlider(this.updatedDefaultPosition,!0)}bindEvent(){this.unbindEvent(),this.buttonElements&&this.buttonElements.forEach((e=>{e.addEventListener("click",this.boundHandleClick)})),this.popin&&window.addEventListener("WEB_COMPONENT_POPIN_OPENED",this.boundOnPopinOpened)}unbindEvent(){this.buttonElements&&this.buttonElements.forEach((e=>{e.removeEventListener("click",e.boundHandleClick)})),this.popin&&window.removeEventListener("WEB_COMPONENT_POPIN_OPENED",this.boundOnPopinOpened)}disconnectedCallback(){this.unbindEvent()}}customElements.get("nb-gallery")||customElements.define("nb-gallery",d);export{d as default};
