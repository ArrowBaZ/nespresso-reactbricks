const e=e=>null==e;class t extends HTMLElement{constructor(){super(),this.template=""}connectedCallback(){this.props=this._createProps(),this.onStart?.(),this.loadTemplate(),this.onReady?.()}_createProps(e=null){const t=e||this.attributes;let n;try{n=[...t].reduce(((e,t)=>({...e,[t.nodeName]:t.nodeValue})),{});const e=[...t].find((e=>"data"===e.nodeName));return null==e?n:{...n,...JSON.parse(e.nodeValue)}}catch(e){console.log("ERROR: No data",e)}}render(e=!1){e&&(this.innerHTML="");const t=(e,n)=>{const s=e=>3===e.nodeType?"text":8===e.nodeType?"comment":e.tagName.toLowerCase(),i=e=>e.childNodes&&e.childNodes.length>0?null:e.textContent;var o=Array.prototype.slice.call(n.childNodes),l=Array.prototype.slice.call(e.childNodes),r=o.length-l.length;if(r>0)for(;r>0;r--)o[o.length-r].parentNode.removeChild(o[o.length-r]);l.forEach((function(e,l){if(o[l])if(s(e)===s(o[l])){var r=i(e);if(r&&r!==i(o[l])&&(o[l].textContent=r),o[l].childNodes.length>0&&e.childNodes.length<1)o[l].innerHTML="";else{if(o[l].childNodes.length<1&&e.childNodes.length>0){var a=document.createDocumentFragment();return t(e,a),void o[l].appendChild(a)}e.childNodes.length>0&&t(e,o[l])}}else o[l].parentNode.replaceChild(e.cloneNode(!0),o[l]);else n.appendChild(e.cloneNode(!0))}))},n=(s=this.template,(new DOMParser).parseFromString(s,"text/html").body);var s;t(n,this)}loadTemplate(e="",t=!1){this.template=""===e?this.template:`${e}`,this.render(t)}disconnectedCallback(){this.onDestroy?.()}}customElements.get("nb-nespresso-element")||customElements.define("nb-nespresso-element",t);const n=(e,t)=>{const{ref:n}=t.dataset,i=n.match(/(\w+)\[(.+)\]/);return null!==i?s(e,t,i):{...e,[t.dataset.ref]:t}},s=(e,t,[,n,s])=>(void 0===e[n]&&(e[n]=[]),e[n][s]=t,e);class i{constructor(){this.promise=new Promise(((e,t)=>{this.reject=t,this.resolve=e}))}}class o extends t{constructor(e){super(e),this.props={},this.detailLinks="",this.mainElement={}}connectedCallback(){this.btnScrollToTop=null,this.renderLoader(),this.refs=[...this.querySelectorAll("[data-ref]")].reduce(n,{}),this.props=(t=>{const n=(e=>e.find((e=>"data"===e.nodeName)))([...t]),s=[...t].filter((e=>"data"!==e.nodeName)).reduce(((e,t)=>({...e,[t.nodeName]:t.nodeValue})),{});if(e(n))return s;try{return{...s,...JSON.parse(n.nodeValue)}}catch(e){console.log("ERROR: No data",e)}})(this.attributes),this.loadProducts()}renderLoader(){this.mainElement=document.createElement("div"),this.mainElement.classList.add("loading"),this.mainElement.innerHTML="<nb-loader></nb-loader>",this.appendChild(this.mainElement)}loadProducts(){const{main_sku:e,skus:t}=this.props.copywriting;this.mainProduct=null,this.otherProducts=[];const n=window.napi,s=[e,...t.map((e=>e.sku))];let i=null;Promise.all(s.map((e=>(i=e,n.catalog().getProduct(e))))).then((e=>{this.mainProduct=e[0],this.otherProducts=e.slice(1)})).catch((()=>{throw new Error(`getProduct fail on sku ${i}`)})).finally((()=>{this.unbindEvents(),this.render(),this.bindEvents()}))}render(){if(!this.mainProduct||this.mainProduct.errorDate)return console.warn("Invalid SKU"),"";const{headline_desc:e}=this.props.copywriting,{contrast:t,padding_top:n,padding_bottom:s}=this.props.layout,{headline:i}=this.mainProduct,o=e||(i||"");this.mainElement.innerHTML=`\n            <nb-container contrast='${t}' classname="${n} ${s}">\n                <h2 class="t-md-400 pdp-assortments__header">${o}</h2>\n                <div class="pdp-assortments__list">\n                    <ul>\n                        ${this.otherProducts.map(((e,t)=>((e,t,n)=>{const{name:s}=e,i=s.toLowerCase(),{skus:o,intensity:l,sku_quick_view:r}=n.copywriting,a=e.capsuleProperties&&e.capsuleProperties.intensity?{intensity:e.capsuleProperties.intensity}:{},c={popin:{popin_id:e.id,close:r.popin.close,footer:!1},product:{type:e.type,technologies:e.technologies?e.technologies:null,name:i,images:{main:e.images.main},headline:e.headline,capsuleProperties:a,productRatings:e.productRatings?e.productRatings:null},intensity:l||null,cup_sizes:{heading:r.cup_sizes.heading,unit_is_oz:r.cup_sizes.unit_is_oz,items:e.capsuleCupSizes},aromatic_profile:{heading:r.aromatic_profile.heading,items:e.capsuleProductAromatics},showRating:{...r.showRating?r.showRating:null},showVoltage:{...r.showVoltage?r.showVoltage:null},colors:{...r.colors?r.colors:null},features:{...r.features?r.features:null},ingredients:{...r.ingredients?r.ingredients:null},link:{label:r.link.label,url:e.pdpURLs.desktop}};console.log(c);const d=e.capsuleProperties&&e.capsuleProperties.intensity?((e,t)=>{const{intensity_label:n,max_intensity:s,a11y_intensity_max:i}=t;return 0===e?"":`\n            <nb-intensity\n                intensity="${e}"\n                intensity_label="${n}"\n                max_intensity="${s}"\n                a11y_intensity_max="${i}"\n            ></nb-intensity>\n        `})(e.capsuleProperties.intensity,l):"",p=e.headline?`<h3 class="t-sm-400">${e.headline}</h3>`:"",h=`${(e=>{const{more_info:t}=n.copywriting;return t?`\n            <nb-link\n                data-ref="loadPopin"\n                size="xsmall"\n                color="black"\n                popin_id="${e}"\n                label="${t}"\n            ></nb-link>\n        `:""})(e.id)}\n        <nb-sku-quick-view data='${JSON.stringify(c)}'></nb-sku-quick-view>`;return`<li\n            data-index="liElement${t}"\n            data-name="${i}"\n            aria-label="${o[t].quantity} ${i}"\n            id="liElement${t}"\n            tabindex="0"\n            role="tab"\n            aria-selected="${t?"false":"true"}"\n        >\n            <div class="pdp-assortments-listing">\n                <div class="pdp-assortments-listing__image">\n                    ${((e,t)=>e.icon?`<img loading="lazy" src="${e.icon}" alt="${t}" />`:"")(e.images,"")}\n                </div>\n                <div class="pdp-assortments-listing__desc">\n                    <h3 class="t-sm-700-caps">${i}</h3>\n                    ${p}\n\n                    ${d}\n\n                    <p class="t-2xs-500-sl pdp-assortments-listing__more-info">x${o[t].quantity}</p>\n\n                    ${h}\n\n                </div>\n            </div>\n        </li>`})(e,t,this.props))).join("")}\n                    </ul>\n                </div>\n            </nb-container>\n\n            ${this.renderPageTop()}\n        `,this.btnScrollToTop=this.querySelector(".go-to-top")}renderPageTop(){const{go_to_top:e}=this.props.copywriting;return`<nb-link\n                    link="#"\n                    target="_self"\n                    phantom="${e}"\n                    class="go-to-top">${e}</nb-link>`}scroll(){((e,t={})=>{const n={scrollPaddingTop:140,scrollDuration:300,...t},s=new i;let o;const l=typeof e;if(["string","object"].indexOf(l)>-1){o=e,"string"===l&&(o=document.querySelector(e));try{e=window.pageYOffset+o.getBoundingClientRect().top-n.scrollPaddingTop}catch(t){throw new Error(`error: No element found with the selector "${e}"`)}}else"number"!=typeof e&&(e=0);let r=window.performance.now(),a=0,c=window.pageYOffset-e,d=window.innerHeight,p=document.body.clientHeight;c>d&&p-d>0&&(n.scrollDuration=Math.abs(n.scrollDuration+n.scrollDuration*(Math.abs(c)/(p-d))));let h=r+n.scrollDuration;window.requestAnimationFrame((function t(){let i=window.performance.now();if(i<h){a=(i-r)/n.scrollDuration,a=--a*a*a+1;const s=c*a;window.scrollTo(0,e+(c-s)),window.requestAnimationFrame(t)}else window.scrollTo(0,e),setTimeout((()=>s.resolve()),125);return s.promise})),s.promise})(0)}bindEvents(){this.btnScrollToTop&&(this.boundScroll=this.scroll.bind(this),this.btnScrollToTop.addEventListener("click",this.boundScroll))}unbindEvents(){this.btnScrollToTop&&this.btnScrollToTop.removeEventListener("click",this.boundScroll)}disconnectedCallback(){this.unbindEvents()}}customElements.get("nb-pdp-assortment-bundles")||customElements.define("nb-pdp-assortment-bundles",o);export{o as default};
