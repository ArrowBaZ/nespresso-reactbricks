const e=e=>null==e,t=({eventName:e,args:t,element:n})=>{let s;n=n||window,t?s=new CustomEvent(e,{detail:t,bubbles:!0}):"function"==typeof Event?s=new Event(e):(s=document.createEvent("Event"),s.initEvent(e,!0,!0)),n.dispatchEvent(s)};class n extends HTMLElement{constructor(){super(),this.template=""}connectedCallback(){this.props=this._createProps(),this.onStart?.(),this.loadTemplate(),this.onReady?.()}_createProps(e=null){const t=e||this.attributes;let n;try{n=[...t].reduce(((e,t)=>({...e,[t.nodeName]:t.nodeValue})),{});const e=[...t].find((e=>"data"===e.nodeName));return null==e?n:{...n,...JSON.parse(e.nodeValue)}}catch(e){console.log("ERROR: No data",e)}}render(e=!1){e&&(this.innerHTML="");const t=(e,n)=>{const s=e=>3===e.nodeType?"text":8===e.nodeType?"comment":e.tagName.toLowerCase(),o=e=>e.childNodes&&e.childNodes.length>0?null:e.textContent;var i=Array.prototype.slice.call(n.childNodes),d=Array.prototype.slice.call(e.childNodes),l=i.length-d.length;if(l>0)for(;l>0;l--)i[i.length-l].parentNode.removeChild(i[i.length-l]);d.forEach((function(e,d){if(i[d])if(s(e)===s(i[d])){var l=o(e);if(l&&l!==o(i[d])&&(i[d].textContent=l),i[d].childNodes.length>0&&e.childNodes.length<1)i[d].innerHTML="";else{if(i[d].childNodes.length<1&&e.childNodes.length>0){var a=document.createDocumentFragment();return t(e,a),void i[d].appendChild(a)}e.childNodes.length>0&&t(e,i[d])}}else i[d].parentNode.replaceChild(e.cloneNode(!0),i[d]);else n.appendChild(e.cloneNode(!0))}))},n=(s=this.template,(new DOMParser).parseFromString(s,"text/html").body);var s;t(n,this)}loadTemplate(e="",t=!1){this.template=""===e?this.template:`${e}`,this.render(t)}disconnectedCallback(){this.onDestroy?.()}}customElements.get("nb-nespresso-element")||customElements.define("nb-nespresso-element",n);const s={get is(){const{innerWidth:e,devicePixelRatio:t}=window;return{mobile:e<768,mobile_tablet:e<1024,tablet:e>=768&&e<1024,desktop:e>=1024&&t<=1,retina:e>=1024&&t>1}},lt:e=>window.innerWidth<e};function o(e,t){const n=e.parentNode;if(n===document.getElementsByTagName("body")[0])return;const s=n.children;for(const n of s)n!==e&&(t?n.setAttribute("aria-hidden",t):n.removeAttribute("aria-hidden"));o(n,t)}class i extends HTMLElement{constructor(){super(),this.isOpen=!1,this.selected=null,this.buttonElement=null,this.onClickOutside=this.onClickOutside.bind(this)}connectedCallback(){this.props=(t=>{const n=(e=>e.find((e=>"data"===e.nodeName)))([...t]),s=[...t].filter((e=>"data"!==e.nodeName)).reduce(((e,t)=>({...e,[t.nodeName]:t.nodeValue})),{});if(e(n))return s;try{return{...s,...JSON.parse(n.nodeValue)}}catch(e){console.log("ERROR: No data",e)}})(this.attributes),this.render()}render(){this.buttonElement=null;const{label:e="",aa_description:t}=this.props;let{options:n}=this.props;n=n.map((e=>{const t={...e};return t.checked=t.checked||t.selected,t})),this.unbindEvent(),this.innerHTML=`\n            <button\n                class='nb-dropdown__button'\n                aria-haspopup="listbox"\n                aria-expanded="${this.isOpen}"\n                aria-label="${e} ${n&&this.renderSelected()}"\n                ${""!==t?`aria-description="${t}"`:""}>\n                    <span class="nb-dropdown__button__label t-xs-700-caps-sl">${e}</span>\n                    <span class="nb-dropdown__button__value t-xs-500-sl" value="${n&&this.renderSelected()}">\n                    </span>\n                </button>\n            <div class="nb-dropdown__menu">\n                <div role="listbox">\n                    ${n&&n.length>0&&this.renderOptions()}\n                </div>\n            </div>\n        `,this.buttonElement=this.querySelector(".nb-dropdown__button"),this.buttonElementValue=this.querySelector(".nb-dropdown__button__value"),this.dropdownMenu=this.querySelector(".nb-dropdown__menu > div"),this.selectedOption=this.querySelector("button[aria-selected=true]"),this.selected||(this.selected=n[0]),function(e){const t=e.querySelectorAll('button, [href], input, select, textarea, [tabindex="0"]');e.firstFocusable=t[0],e.lastFocusable=t[t.length-1],e.lastFocused=e.firstFocusable}(this.dropdownMenu),this.bindEvent()}renderOptions(){const{label:e,aa_listbox_description:t,aa_select_description:n,icon_option:o,options:i}=this.props;return i.map((i=>`<button\n                    class="${s.is.mobile?"t-sm-400-sl":"t-xs-500-sl"}"\n                    role="option"\n                    aria-label='${e+" "+i.label}'\n                    value='${i.label}'\n                    aria-selected='${i.checked}'\n                    ${i.link&&`data-link='${i.link}'`}\n                    ${i.checked?void 0!==t&&`aria-description="${t}"`:void 0!==n&&`aria-description="${n}"`}>\n                  ${o&&`<nb-icon icon='${o}'></nb-icon>`} ${i.label}\n                </button>`)).join("")}renderSelected(){const e=this.props.options.find((e=>!0===e.checked||!0===e.selected));return`${e&&e.label||this.props.options[0].label}`}bindEvent(){this.boundHandleClick=this.handleClick.bind(this),this.boundHandleLabelClick=this.handleLabelClick.bind(this),this.boundHandleMobileClose=this.handleMobileClose.bind(this),this.boundFocus=this.focus.bind(this),this.boundFocusin=this.focusin.bind(this),this.boundKeyNav=this.keyNav.bind(this),this.buttonElement.addEventListener("click",this.boundHandleClick),this.querySelectorAll(".nb-dropdown__menu button").forEach((e=>{e.addEventListener("click",this.boundHandleLabelClick)})),this.dropdownMenu.addEventListener("click",this.boundHandleMobileClose),window.addEventListener("click",this.onClickOutside)}unbindEvent(){this.buttonElement&&(this.buttonElement.removeEventListener("click",this.boundHandleClick),this.querySelectorAll(".nb-dropdown__menu button").forEach((e=>{e.removeEventListener("click",this.boundHandleLabelClick)})),this.dropdownMenu.removeEventListener("click",this.boundHandleMobileClose),window.removeEventListener("click",this.onClickOutside),document.removeEventListener("keydown",this.boundKeyNav))}handleClick(){this.toogleDropdown(!this.isOpen)}handleMobileClose(){this.toogleDropdown(!1)}onClickOutside(e){!this.isOpen||e.target.classList.contains("nb-dropdown__button")||e.target.classList.contains("nb-dropdown__button__label")||e.target.classList.contains("nb-dropdown__button__value")||this.toogleDropdown(!1)}handleLabelClick(e){this.isOpen=!1,this.selectedOption.setAttribute("aria-selected","false"),this.selectedOption=e.target,this.selectedOption.setAttribute("aria-selected","true"),this.props.options=this.props.options.map((e=>({...e,checked:!1}))),this.selected=this.props.options.find((e=>e.label===this.selectedOption.value)),this.selected.checked=!0,this.reRender(),t({eventName:"WEB_COMPONENT_SORT_BY_CHANGE",args:{options:this.props.options,selected:this.selected},element:this})}reRender(){const{label:e,aa_listbox_description:t,aa_select_description:n}=this.props;this.buttonElementValue.setAttribute("value",this.selectedOption.value),this.buttonElement.setAttribute("aria-label",e+" "+this.renderSelected()),this.dropdownMenu.querySelectorAll("button").forEach((e=>{e.setAttribute("aria-description",n)})),this.selectedOption.setAttribute("aria-description",t)}setSelected(e,n=!1){const s=this.props.options.find((t=>t.value===e));s&&(this.selected.checked=!1,this.selected=s,this.selected.checked=!0),n&&t({eventName:"WEB_COMPONENT_SORT_BY_CHANGE",args:{options:this.props.options,selected:this.selected},element:this})}toogleDropdown(e){e?this.open():this.close(),this.isOpen=!this.isOpen,this.switchAriaModal(),this.buttonElement.setAttribute("aria-expanded",this.isOpen)}switchAriaModal(){this.dropdownMenu.setAttribute("aria-modal",this.isOpen),o(this.dropdownMenu,this.isOpen)}open(){this.dropdownMenu.addEventListener("transitionend",this.boundFocus),document.addEventListener("focusin",this.boundFocusin),document.addEventListener("keydown",this.boundKeyNav),this.buttonElement.classList.add("isOpen"),this.openingSource=document.activeElement}close(){this.dropdownMenu.addEventListener("transitionend",this.boundFocus),document.removeEventListener("focusin",this.boundFocusin),document.removeEventListener("keydown",this.boundKeyNav),this.buttonElement.classList.remove("isOpen"),this.buttonElement.setAttribute("aria-expanded",!1)}focus(){this.dropdownMenu.removeEventListener("transitionend",this.boundFocus),this.isOpen?(this.selectedOption.focus(),this.dropdownMenu.lastFocused=this.selectedOption):this.buttonElement.focus()}focusin(e){!function(e,t,n){t.contains(e.target)?t.lastFocused=e.target:t.lastFocused===t.firstFocusable?n?t.lastFocusable.focus():t.firstFocusable.focus():n?t.firstFocusable.focus():t.lastFocusable.focus()}(e,this.dropdownMenu,!1)}keyNav(e){switch(e.key){case"Escape":this.toogleDropdown(!1);break;case"ArrowUp":e.preventDefault(),this.prevOption();break;case"ArrowDown":e.preventDefault(),this.nextOption();break;case"Home":case"PageUp":e.preventDefault(),this.firstOption();break;case"End":case"PageDown":e.preventDefault(),this.lastOption()}}prevOption(){if(this.dropdownMenu.lastFocused!==this.dropdownMenu.firstFocusable){const e=this.dropdownMenu.lastFocused.previousElementSibling;e.focus(),this.dropdownMenu.lastFocused=e}}nextOption(){if(this.dropdownMenu.lastFocused!==this.dropdownMenu.lastFocusable){const e=this.dropdownMenu.lastFocused.nextElementSibling;e.focus(),this.dropdownMenu.lastFocused=e}}firstOption(){this.dropdownMenu.lastFocused!==this.dropdownMenu.firstFocusable&&(this.dropdownMenu.firstFocusable.focus(),this.dropdownMenu.lastFocused=this.dropdownMenu.firstFocusable)}lastOption(){this.dropdownMenu.lastFocused!==this.dropdownMenu.lastFocusable&&(this.dropdownMenu.lastFocusable.focus(),this.dropdownMenu.lastFocused=this.dropdownMenu.lastFocusable)}disconnectedCallback(){this.unbindEvent()}}customElements.get("nb-dropdown")||customElements.define("nb-dropdown",i);export{i as default};
