class t{constructor(t){this._carousel=t,this._carousel._container.addEventListener("dragstart",(t=>t.preventDefault())),this._carousel._container.addEventListener("touchstart",(t=>this.startDrag(t)),{passive:!0}),this._carousel._container.addEventListener("mousedown",(t=>this.startDrag(t))),this._carousel._container.addEventListener("touchstart",(t=>this.startDrag(t)),{passive:!0}),window.addEventListener("mousemove",(t=>this.drag(t)),{passive:!1}),window.addEventListener("touchmove",(t=>this.drag(t)),{passive:!1}),window.addEventListener("mouseup",(()=>this.endDrag())),window.addEventListener("touchend",(()=>this.endDrag())),window.addEventListener("touchcancel",(()=>this.endDrag())),this.translateFactor=150}startDrag(t){t.touches&&t.touches.length>1||(t.touches&&(t=t.touches[0]),this._origin={x:t.screenX,y:t.screenY},this._width=this._carousel.containerWidth)}drag(t){if(!this._origin)return;const e=t.touches?t.touches[0]:t,i={x:e.screenX-this._origin.x,y:e.screenY-this._origin.y};this._lastTranslate=i;const s=this._carousel._currentIndex*this._carousel._widthSlide-this.translateFactor*i.x/this._width;this._carousel.translate(s)}preventMobileYTranslate(t,e){t.touches&&(t.touches&&Math.abs(e.x)>Math.abs(e.y)||t.touches&&Math.abs(e.y)>Math.abs(e.x))&&(t.preventDefault(),t.stopPropagation())}endDrag(){if(!this._origin||!this._lastTranslate)return this._origin=null,void(this._lastTranslate=null);const t=this._lastTranslate.x/this._carousel.carouselWidth;if(Math.abs(t)>.1){const t=this._lastTranslate.x<0?"next":"prev";this._carousel[t]()}else this._carousel.goToItem(this._carousel._currentIndex);this._origin=null,this._lastTranslate=null}}class e{constructor(t){this._carousel=t,new MutationObserver((t=>{t.forEach((function(t){if(!t||!t.oldValue||!t.classList)return;const e=t.classList.contains("has-overlay-absolute"),i=document.body.classList.contains("has-overlay");e&&!i&&this._carousel.goToItem(this._carousel._currentIndex)}))})).observe(document.body,{attributes:!0,attributeFilter:["class"],attributeOldValue:!0})}}class i{constructor(i,s={}){this._element=i,this._slides=[].slice.call(i.children);const n=s.index||0;this._options=Object.assign({},{slidesToScroll:1,slidesVisible:1,spaceBetween:0,navigationButton:!0,loop:!0,pagination:!0,hookGetRightBoundary:null,hookSlideChange:null,hookMove:null,hookNext:null,hookPrevious:null,pagination_variation:null,nav_centered:!1},s),this.moveCallbacks=[],this._ratio=this._slides.length/this._options.slidesVisible,this.buildIHM(),new e(this),this.hasPagination()&&(new t(this),this.goToItem(n))}get element(){return this._element}get slidesToScroll(){return this._options.slidesToScroll}get slidesVisible(){return this._options.slidesVisible}get slidesTotal(){return this._slides.length}get navigationButton(){return this._options.navigationButton}get navigationVariation(){return this._options.navigation_variation}get navigationSize(){return this._options.navigation_size}get loop(){return this._options.loop}get pagination(){return this._options.pagination}get containerWidth(){return this._container.offsetWidth}get carouselWidth(){return this._root.offsetWidth}get wrapperWidth(){return this._wrapper.offsetWidth}get paginationVariation(){return this._options.pagination_variation}get nav_centered(){return this._options.nav_centered}getSlideWidth(t){const{slidesVisible:e,spaceBetween:i}=this._options;return(t+parseInt(i))/e}buildIHM(){this._root=this.createElement("div","carousel"),this._container=this.createElement("div","container"),this._wrapper=this.createElement("div","wrapper"),this._children=this._slides.map((t=>{const e=this.createElement("div","item");return e.appendChild(t),this._container.appendChild(e),e})),this._wrapper.appendChild(this._container),this._root.appendChild(this._wrapper),this._element.appendChild(this._root),this.setWrapperStyle(),this.hasPagination()&&(this.navigationButton&&this.createNavigation(),this.pagination&&this.createPagination())}setWrapperStyle(){const t=this.wrapperWidth,e=this.getSlideWidth(t),i=e*this._children.length;this.setContainerWidth(i),this.setWrapperWidth(t);for(const t of this._children)this.setSlideWidth(t,e);this._widthContainer=i,this._widthSlide=e,this._widthWrapper=t}setSlideWidth(t,e){t.style.width=e-this._options.spaceBetween+"px",this._options.spaceBetween&&(t.style.marginRight=`${this._options.spaceBetween}px`)}setContainerWidth(t){this._container.style.width=`${t}px`}setWrapperWidth(t){this._wrapper.style.width=`${t}px`}disableTransition(){this._container.style.transition="none"}enableTransition(){this._container.style.transition=""}translate(t){this._container.style.left=-t+"px"}createElement(t,e){let i=document.createElement(t);return i.setAttribute("class",e),i}createNavigation(){const t=this.createElement("nb-cta","prev");t.setAttribute("variation","navigation"),t.setAttribute("contrast",this.navigationVariation),t.setAttribute("size",this.navigationSize),t.setAttribute("icon_right","chevron-left"),t.setAttribute("label","a11y_slider_previous_button");const e=this.createElement("nb-cta","next");e.setAttribute("variation","navigation"),e.setAttribute("contrast",this.navigationVariation),e.setAttribute("size",this.navigationSize),e.setAttribute("icon_right","chevron-right"),e.setAttribute("label","a11y_slider_next_button"),e.addEventListener("click",(()=>this.next())),t.addEventListener("click",(()=>this.prev())),e.addEventListener("keydown",(t=>"Enter"===t.key||"Space"===t.key?this.next():null)),t.addEventListener("keydown",(t=>"Enter"===t.key||"Space"===t.key?this.prev():null));let i=this._root.parentElement;i.appendChild(t),i.appendChild(e),this.onMove((i=>{const s=i._currentIndex+this.slidesVisible;this.loop||(i._currentIndex<=0?t.classList.add("hidden"):t.classList.remove("hidden"),this._slides.length===s?e.classList.add("hidden"):e.classList.remove("hidden"),this._options.hookMove&&this._options.hookMove(e))}))}getSlideNotVisible(){return this._children.length-(this.slidesVisible-1)}hasPagination(){return this.getSlideNotVisible()>1}createPaginationBullets(){const t=document.createElement("nav"),e=[];for(let i=0;i<this.getSlideNotVisible();i+=this.slidesToScroll){let s=document.createElement("span");s.innerText=(i+1).toString();let n=document.createElement("button");n.addEventListener("click",(()=>this.goToItem(i))),n.appendChild(s),t.appendChild(n),e.push(n)}const i=t=>{let i=e[t/this.slidesToScroll];i&&(e.forEach((t=>t.classList.remove("active"))),i.classList.add("active"))};i(this._currentIndex),this.onMove((()=>i(this._currentIndex))),this._root.parentElement.parentElement.appendChild(t)}createPaginationStepper(){const t=document.createElement("nav");let e=document.createElement("div");e.innerText=this.slidesTotal-this.slidesVisible+1,e.classList.add("totalPages");let i=document.createElement("div");i.innerText="/";let s=document.createElement("div");s.classList.add("currentPage"),t.appendChild(s),t.appendChild(i),t.appendChild(e),this.onMove((()=>s.innerText=this._currentIndex+1)),this.onMove((()=>t.setAttribute("aria-label",s.innerText+" "+i.innerHTML+" "+e.innerHTML))),this._root.parentElement.parentElement.appendChild(t)}createPagination(){this.slidesTotal<=5?this.createPaginationBullets():"stepper"===this.paginationVariation?(this.createPaginationStepper(),console.info("paginationVariation >> enabled")):(this.createPaginationBullets(),console.info("bullets enabled"))}next(){let t=this._currentIndex+this.slidesToScroll;this._options.hookNext&&(t=this._options.hookNext(t)),this.goToItem(t)}prev(){let t=this._currentIndex-this.slidesToScroll;this._options.hookPrevious&&(t=this._options.hookPrevious(t)),this.goToItem(t)}goToItem(t){this.hackUi();const e=this.getOverflowingIndex(t);let i=e*this._widthSlide;this._options.hookSlideChange&&(i=this._options.hookSlideChange(e,i)),this.translate(i),this._currentIndex=e,this.indexHasChange()}hackUi(){const t=document.querySelector("html");!t.classList.contains("has-overlay-absolute")&&t.classList.contains("has-overlay")}getOverflowingIndex(t){const e=this.getLeftBoundary(t),i=this.getRightBoundary(t),s=this._children.length-this._options.slidesVisible;return e?this.loop?s:0:i?this.loop?0:s:t}getLeftBoundary(t){return t<0}getRightBoundary(t){const e=t>=this._children.length,i=this.currentIndex+this.slidesVisible,s=void 0!==this._children[i],n=t>this.currentIndex;let a=e||n&&!s;return this._options.hookGetRightBoundary&&(a=this._options.hookGetRightBoundary(a,t)),a}_getMaxSlideWidth(t){return t.reduce(((t,e)=>Math.max(t,e.offsetWidth)),0)}onSlideChange(t){this.onMove(t)}onMove(t){this.moveCallbacks.push(t)}indexHasChange(){this.moveCallbacks.forEach((t=>t(this))),this.activateItems()}activateItems(){const t=this._currentIndex+this.slidesVisible;this._slides.map(((e,i)=>{e.classList.remove("active"),e.parentElement.classList.remove("activeParent"),i>=this._currentIndex&&i<t&&(e.classList.add("active"),e.parentElement.classList.add("activeParent"))}))}setClass(t){this._element.classList.add(t)}unsetClass(t){this._element.classList.remove(t)}get currentIndex(){return this._currentIndex}}const s=t=>null==t;window.gtmDataObject=window.gtmDataObject||[];class n extends HTMLElement{constructor(){super(),this.template=""}connectedCallback(){this.props=this._createProps(),this.onStart?.(),this.loadTemplate(),this.onReady?.()}_createProps(t=null){const e=t||this.attributes;let i;try{i=[...e].reduce(((t,e)=>({...t,[e.nodeName]:e.nodeValue})),{});const t=[...e].find((t=>"data"===t.nodeName));return null==t?i:{...i,...JSON.parse(t.nodeValue)}}catch(t){console.log("ERROR: No data",t)}}render(t=!1){t&&(this.innerHTML="");const e=(t,i)=>{const s=t=>3===t.nodeType?"text":8===t.nodeType?"comment":t.tagName.toLowerCase(),n=t=>t.childNodes&&t.childNodes.length>0?null:t.textContent;var a=Array.prototype.slice.call(i.childNodes),o=Array.prototype.slice.call(t.childNodes),r=a.length-o.length;if(r>0)for(;r>0;r--)a[a.length-r].parentNode.removeChild(a[a.length-r]);o.forEach((function(t,o){if(a[o])if(s(t)===s(a[o])){var r=n(t);if(r&&r!==n(a[o])&&(a[o].textContent=r),a[o].childNodes.length>0&&t.childNodes.length<1)a[o].innerHTML="";else{if(a[o].childNodes.length<1&&t.childNodes.length>0){var l=document.createDocumentFragment();return e(t,l),void a[o].appendChild(l)}t.childNodes.length>0&&e(t,a[o])}}else a[o].parentNode.replaceChild(t.cloneNode(!0),a[o]);else i.appendChild(t.cloneNode(!0))}))},i=(s=this.template,(new DOMParser).parseFromString(s,"text/html").body);var s;e(i,this)}loadTemplate(t="",e=!1){this.template=""===t?this.template:`${t}`,this.render(e)}disconnectedCallback(){this.onDestroy?.()}}customElements.get("nb-nespresso-element")||customElements.define("nb-nespresso-element",n);class a extends HTMLElement{constructor(){super(),this._slider=null,this.randomId="slider_"+function(t){for(var e="",i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",s=i.length,n=0;n<t;n++)e+=i.charAt(Math.floor(Math.random()*s));return e}(5)}static get observedAttributes(){return["slides_to_scroll","slides_visible","pagination","pagination_variation","nav_centered"]}connectedCallback(){this.slot=this.innerHTML,this.props=(t=>{const e=(t=>t.find((t=>"data"===t.nodeName)))([...t]),i=[...t].filter((t=>"data"!==t.nodeName)).reduce(((t,e)=>({...t,[e.nodeName]:e.nodeValue})),{});if(s(e))return i;try{return{...i,...JSON.parse(e.nodeValue)}}catch(t){console.log("ERROR: No data",t)}})(this.attributes),this.render()}createProps(){return[...this.attributes].reduce(((t,e)=>({...t,[e.nodeName]:e.nodeValue})),{})}render(){this.innerHTML=`<div class="slider ${this.randomId}">${this.slot}</div>`,this.loadSlider()}loadSlider(){const{indexSlider:t=0,slides_loop:e="true",slides_visible:s=4,slides_to_scroll:n=1,navigation:a="true",pagination:o="true",space_between:r=0,navigation_variation:l="dark",navigation_size:h="48",pagination_variation:d="stepper",nav_centered:c="false"}=this.props,u=this.querySelector(`.${this.randomId}`),p={index:parseInt(t),slidesToScroll:parseInt(n),slidesVisible:parseInt(s),spaceBetween:r,loop:"true"===e,navigationButton:"true"===a,pagination:"true"===o,navigation_variation:l,navigation_size:h,pagination_variation:d,nav_centered:c};this._slider=new i(u,p),this._slider.setClass("first"),this._slider.onSlideChange(this.handleClick.bind(this))}handleClick(){var t;(({eventName:t,args:e,element:i})=>{let s;i=i||window,e?s=new CustomEvent(t,{detail:e,bubbles:!0}):"function"==typeof Event?s=new Event(t):(s=document.createEvent("Event"),s.initEvent(t,!0,!0)),i.dispatchEvent(s)})({eventName:"WEB_COMPONENT_SLIDE_CHANGE"}),this.toggleClasses(),t={rootElement:["nb-slider"]},window.gtmDataObject.push({event:"itemDisplay",eventRaisedBy:"Web component",eventAction:"Click",itemTypes:["products"],...t})}toggleClasses(){const t=0===this._slider.currentIndex,e=this._slider.slidesTotal===this._slider.currentIndex+this._slider.slidesVisible;this._slider.unsetClass("last"),this._slider.unsetClass("first"),t?this._slider.setClass("first"):e&&this._slider.setClass("last")}}customElements.get("nb-slider")||customElements.define("nb-slider",a);export{a as default};
