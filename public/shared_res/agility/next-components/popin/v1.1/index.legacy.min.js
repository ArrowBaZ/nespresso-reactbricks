const e=({eventName:e,args:t,element:i})=>{let s;i=i||window,t?s=new CustomEvent(e,{detail:t,bubbles:!0}):"function"==typeof Event?s=new Event(e):(s=document.createEvent("Event"),s.initEvent(e,!0,!0)),i.dispatchEvent(s)},t=(e,t,i)=>{if(e.nwcSwipeEvents)return;e.nwcSwipeEvents=!0,t.addEventListener("touchstart",(function(e){if("true"===e.target.getAttribute("data-swipe-ignore"))return;r=e.target,function(e){if(void 0===i||!i.contains(e))return;d=[],c=[];for(;e!==i;)d.push(e.scrollTop),c.push(e.scrollLeft),e=e.parentNode}(r),l=Date.now(),s=e.touches[0].clientX,n=e.touches[0].clientY,o=0,a=0}),!1),t.addEventListener("touchmove",(function(e){if(!s||!n)return;let t=e.touches[0].clientX,i=e.touches[0].clientY;o=s-t,a=n-i}),!1),t.addEventListener("touchend",(function(t){if(r!==t.target)return;const i=.25*e.innerHeight,d=.5*e.innerWidth;let c=parseInt(p(r,"data-swipe-threshold",i),10),u=parseInt(p(r,"data-swipe-threshold",d),10),b=parseInt(p(r,"data-swipe-timeout","500"),10),m=Date.now()-l,v="",E=t.changedTouches||t.touches||[];Math.abs(o)>Math.abs(a)?Math.abs(o)>u&&m<b&&(o>0?h("left",t)&&(v="swiped-left"):h("right",t)&&(v="swiped-right")):Math.abs(a)>c&&m<b&&(a>0?h("up",t)&&(v="swiped-up"):h("down",t)&&(v="swiped-down"));if(""!==v){let e={dir:v.replace(/swiped-/,""),touchType:(E[0]||{}).touchType||"direct",xStart:parseInt(s,10),xEnd:parseInt((E[0]||{}).clientX||-1,10),yStart:parseInt(n,10),yEnd:parseInt((E[0]||{}).clientY||-1,10)};r.dispatchEvent(new CustomEvent("swiped",{bubbles:!0,cancelable:!0,detail:e})),r.dispatchEvent(new CustomEvent(v,{bubbles:!0,cancelable:!0,detail:e}))}s=null,n=null,l=null}),!1);let s=null,n=null,o=null,a=null,l=null,r=null,d=[],c=[];function h(e,t){if(void 0===i)return!0;let s=t.target,n=!0,o=0;for(;s!==i&&n;){if(u(s))switch(e){case"up":n=d[o]===s.scrollHeight-s.clientHeight;break;case"down":n=0===d[o];break;case"left":n=c[o]===s.scrollWidth-s.clientWidth;break;case"right":n=0===c[o];break;default:n=!0}s=s.parentNode,o++}return n}function u(e){return e.scrollHeight>e.clientHeight||e.scrollWidth>e.clientWidth}function p(e,i,s){for(;e&&e!==t.documentElement;){let t=e.getAttribute(i);if(t)return t;e=e.parentNode}return s}},i=e=>{const t=(e=>e.find((e=>"data"===e.nodeName)))([...e]),i=[...e].filter((e=>"data"!==e.nodeName)).reduce(((e,t)=>({...e,[t.nodeName]:t.nodeValue})),{});if(s(t))return i;try{return{...i,...JSON.parse(t.nodeValue)}}catch(e){console.log("ERROR: No data",e)}},s=e=>null==e;function n(e,t){const i=e.parentNode;if(i===document.getElementsByTagName("body")[0])return;const s=i.children;for(const i of s)i!==e&&(t?i.setAttribute("aria-hidden",t):i.removeAttribute("aria-hidden"));n(i,t)}class o extends HTMLElement{constructor(){super(),this.template=""}connectedCallback(){this.props=this._createProps(),this.onStart?.(),this.loadTemplate(),this.onReady?.()}_createProps(e=null){const t=e||this.attributes;let i;try{i=[...t].reduce(((e,t)=>({...e,[t.nodeName]:t.nodeValue})),{});const e=[...t].find((e=>"data"===e.nodeName));return null==e?i:{...i,...JSON.parse(e.nodeValue)}}catch(e){console.log("ERROR: No data",e)}}render(e=!1){e&&(this.innerHTML="");const t=(e,i)=>{const s=e=>3===e.nodeType?"text":8===e.nodeType?"comment":e.tagName.toLowerCase(),n=e=>e.childNodes&&e.childNodes.length>0?null:e.textContent;var o=Array.prototype.slice.call(i.childNodes),a=Array.prototype.slice.call(e.childNodes),l=o.length-a.length;if(l>0)for(;l>0;l--)o[o.length-l].parentNode.removeChild(o[o.length-l]);a.forEach((function(e,a){if(o[a])if(s(e)===s(o[a])){var l=n(e);if(l&&l!==n(o[a])&&(o[a].textContent=l),o[a].childNodes.length>0&&e.childNodes.length<1)o[a].innerHTML="";else{if(o[a].childNodes.length<1&&e.childNodes.length>0){var r=document.createDocumentFragment();return t(e,r),void o[a].appendChild(r)}e.childNodes.length>0&&t(e,o[a])}}else o[a].parentNode.replaceChild(e.cloneNode(!0),o[a]);else i.appendChild(e.cloneNode(!0))}))},i=(s=this.template,(new DOMParser).parseFromString(s,"text/html").body);var s;t(i,this)}loadTemplate(e="",t=!1){this.template=""===e?this.template:`${e}`,this.render(t)}disconnectedCallback(){this.onDestroy?.()}}customElements.get("nb-nespresso-element")||customElements.define("nb-nespresso-element",o);var a=t=>{const i=document.createElement("DIV");i.classList.add("nb-overlay"),i.addEventListener("click",(()=>{e({eventName:"WEB_COMPONENT_POPIN_CLOSE",args:{id:t}})})),document.body.appendChild(i),setTimeout((()=>{i.classList.add("fadein")}),1)},l=()=>{if(!document.getElementsByClassName("nb-overlay").length)return;const e=document.getElementsByClassName("nb-overlay")[0];e.classList.remove("fadein"),setTimeout((()=>{e.remove()}),1200)};const r={get is(){const{innerWidth:e,devicePixelRatio:t}=window;return{mobile:e<768,mobile_tablet:e<1024,tablet:e>=768&&e<1024,desktop:e>=1024&&t<=1,retina:e>=1024&&t>1}},lt:e=>window.innerWidth<e};class d extends HTMLElement{constructor(){super(),this.props={},this.ariaModal=null,this.isVideo=null,this.boundOpen=this.open.bind(this),this.boundClose=this.close.bind(this),this.boundEscapeClose=this.escapeClose.bind(this),this.boundFocus=this.focus.bind(this),this.boundFocusin=this.focusin.bind(this)}connectedCallback(){this.style.display="none",this.props=i(this.attributes),this.content||this.slot||(this.slot=this.innerHTML),this.id||null==this.props.popin_id||""==this.props.popin_id||(this.id=this.props.popin_id),this.ariaModal=!1,this.isVideo=!1,this.render()}attributeChangedCallback(e,t,s){this.props=i(this.attributes),"content"===e&&(this.props.content=s)}static get observedAttributes(){return["content"]}disconnectedCallback(){this.hasEvent&&this.unbindEvent()}render(){this.hasEvent&&this.unbindEvent();const{heading:e="",bgcolor:t="highlight",size:i="M",label_close:s="Close",image:n="",image_alt:o="",content:a=""}=this.props,l=a||this.slot;if(""===l)return this.bindEvent(),this.classList.remove("isOpen"),this.isOpen=!1,!1;this.checkIsVideo(l),this.isVideo?this.setAttribute("size","L"):this.setAttribute("size",i),this.setAttribute("role","dialog"),this.setAttribute("aria-hidden","true"),this.setAttribute("bgcolor",t),this.innerHTML=`\n            <nb-cta\n                variation="navigation"\n                ${"white"===t?'contrast="highlight"':'contrast="light"'}\n                icon_right="close-2"\n                label="${s}"></nb-cta>\n            <div class="wrapper">\n                <div class="title">\n                    ${e&&`<h2 class="h-lg-700-caps-sl">${e}</h2>`}\n                </div>\n                <div class="content" tabindex="-1">\n                    ${n&&`<div class="popin-header-img"><img loading="lazy" src="${n}" alt="${o}" title="${o}" width="300" height="225" /></div>`}\n                    ${l}\n                </div>\n                ${this.renderFooter()}\n            </div>\n            ${this.isVideo&&r.is.mobile?'<div class="swipeOverlay"></div>':""}\n        `,setTimeout((()=>{this.style.display="inherit"}),100),function(e){const t=e.querySelectorAll('button, [href], input, select, textarea, [tabindex="0"]');e.firstFocusable=t[0],e.lastFocusable=t[t.length-1],e.lastFocused=e.firstFocusable}(this),this.buttonElement=this.querySelector("button"),this.bindEvent()}renderFooter(){const{footer:e}=this.props;var t;return!(!(t=e)||"false"===t)?"<footer></footer>":""}checkIsVideo(e){const t=document.createElement("div");t.innerHTML=e,1===t.children.length&&"NB-VIDEO"===t.children[0].tagName&&(this.isVideo=!0,this.setAttribute("video","true"))}addLock(){document.getElementsByTagName("html")[0].classList.add("scroll-lock"),a(this.props.popin_id)}removeLock(){this.parentNode.closest("nb-popin")||document.getElementsByTagName("html")[0].classList.remove("scroll-lock"),l()}switchAriaModal(){this.ariaModal=!this.ariaModal,this.setAttribute("aria-modal",this.ariaModal),n(this,this.ariaModal)}async open(t){this.addEventListener("transitionend",this.boundFocus),document.addEventListener("focusin",this.boundFocusin),this.openingSource=document.activeElement;const i=(e=>{if(e.detail)return e.detail})(t);i.id===this.id?(this.addLock(),this.switchAriaModal(),this.setAttribute("aria-hidden","false"),this.isOpen=!this.isOpen,await new Promise((e=>{setTimeout((()=>{this.classList.add("isOpen"),e()}),300)})),e({eventName:"WEB_COMPONENT_POPIN_OPENED",args:{id:this.props.popin_id}})):console.log("return",i.id,this.id)}close(t){t.cancelBubble=!0,t.stopPropagation&&t.stopPropagation(),this.addEventListener("transitionend",this.boundFocus),document.removeEventListener("focusin",this.boundFocusin),this.removeLock(),this.switchAriaModal(),this.setAttribute("aria-hidden","true"),this.isOpen=!this.isOpen,this.classList.remove("isOpen"),e({eventName:"WEB_COMPONENT_POPIN_CLOSED",args:{id:this.props.popin_id}})}focus(){this.removeEventListener("transitionend",this.boundFocus),this.isOpen?this.buttonElement.focus():this.openingSource.focus()}focusin(e){!function(e,t,i){t.contains(e.target)?t.lastFocused=e.target:t.lastFocused===t.firstFocusable?i?t.lastFocusable.focus():t.firstFocusable.focus():i?t.firstFocusable.focus():t.lastFocusable.focus()}(e,this,!0)}escapeClose(e){"Escape"===e.key&&this.isOpen&&this.close(e)}swipeDown(e){this.isOpen&&this.close(e)}swipeOverlayTogglePlayPause(){e({eventName:"WEB_COMPONENT_VIDEO_TOGGLE",args:{id:this.props.popin_id}})}bindEvent(){this.hasEvent=!0,null!=this.buttonElement&&this.buttonElement.addEventListener("click",this.boundClose),window.addEventListener("WEB_COMPONENT_POPIN_OPEN",this.boundOpen),window.addEventListener("WEB_COMPONENT_POPIN_CLOSE",this.boundClose),document.addEventListener("keydown",this.boundEscapeClose),r.is.mobile&&(t(window,document,this),this.boundSwipeDown=this.swipeDown.bind(this),document.addEventListener("swiped-down",this.boundSwipeDown),this.isVideo&&(this.swipeOverlay=this.querySelector(".swipeOverlay"),this.boundSwipeOverlayTogglePlayPause=this.swipeOverlayTogglePlayPause.bind(this),this.swipeOverlay.addEventListener("click",this.boundSwipeOverlayTogglePlayPause)))}unbindEvent(){this.hasEvent=!1,null!=this.buttonElement&&this.buttonElement.removeEventListener("click",this.boundClose),window.removeEventListener("WEB_COMPONENT_POPIN_OPEN",this.boundOpen),window.removeEventListener("WEB_COMPONENT_POPIN_CLOSE",this.boundClose),document.removeEventListener("keydown",this.boundEscapeClose),this.boundSwipeDown&&(document.removeEventListener("swiped-down",this.boundSwipeDown),this.boundSwipeDown=null),this.boundSwipeOverlayTogglePlayPause&&(this.swipeOverlay.removeEventListener("click",this.boundSwipeOverlayTogglePlayPause),this.boundSwipeOverlayTogglePlayPause=null)}}customElements.get("nb-popin")||customElements.define("nb-popin",d);export{d as default};
