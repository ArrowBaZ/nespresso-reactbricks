const e=e=>null==e,t=(e,t)=>{const{ref:r}=t.dataset,i=r.match(/(\w+)\[(.+)\]/);return null!==i?s(e,t,i):{...e,[t.dataset.ref]:t}},s=(e,t,[,s,r])=>(void 0===e[s]&&(e[s]=[]),e[s][r]=t,e);var r=(e=[])=>{e.forEach((e=>{if(e&&e.element)return e.element.addEventListener(e.type,e.listener,e.options)}))},i=(e=[])=>{e.forEach((e=>{e&&e.element&&e.element.removeEventListener(e.type,e.listener)}))};class a extends HTMLElement{static get observedAttributes(){return["active-item","aria-expanded"]}constructor(){super()}connectedCallback(){this.props=(t=>{const s=(e=>e.find((e=>"data"===e.nodeName)))([...t]),r=[...t].filter((e=>"data"!==e.nodeName)).reduce(((e,t)=>({...e,[t.nodeName]:t.nodeValue})),{});if(e(s))return r;try{return{...r,...JSON.parse(s.nodeValue)}}catch(e){console.log("ERROR: No data",e)}})(this.attributes),this.createProperties(),this.render(),this.refs=[...this.querySelectorAll("[data-ref]")].reduce(t,{}),this.eventListeners=this.createEventListeners(),r(this.eventListeners),this.refreshCollapses()}createProperties(){const{limit:e,collapses:t=[],auto_collapse:s="false"}=this.props;this.autoCollapse="true"===s,this.maxItems=t.length,null!==e&&e>0&&this.maxItems>e&&(this.limit=e),this.hasShowMore=null!==e&&this.maxItems>e,this.hasShowMore&&(this.expanded=!1)}render(){const{accordion:e=""}=this.props.a11y_label;this.innerHTML=`\n            <div class="list" role="list" data-ref="list"\n                aria-label="${e}"\n                ${this.hasShowMore?'aria-expanded="'+this.expanded+'"':""}>\n                ${this.renderCollapses()}\n            </div>\n            ${this.renderShowMore()}\n        `}renderCollapses(){const{collapses:e=[]}=this.props;return e.reduce(((e,t,s)=>`${e}${this.renderCollapse(t,s)}`),"")}renderCollapse(e,t){return`\n            <nb-collapse data='${JSON.stringify({...e,id:t,nested:"true"})}' data-ref="collapses[${t}]" role="listitem"></nb-collapse>\n        `}renderShowMore(){return this.hasShowMore?`\n            <div class="show-more">\n                <nb-link size="large" color="gold" data-ref="showmore">\n                    ${this.renderShowMoreLabel()}\n                </nb-link>\n            </div>\n        `:""}renderShowMoreLabel(){const{cta:e}=this.props;return`${this.expanded?e.less:e.more}`}updateShowMoreLabel(){this.refs.showmore.querySelector("span").innerText=this.renderShowMoreLabel();this.refs.showmore.querySelector("button").setAttribute("aria-description",`${this.expanded?this.renderA11YShowLess():this.renderA11YShowMore()}`)}renderA11YAccordionDescription(){const{accordion_description:e=""}=this.props.a11y_label;return e.replace("{limitItems}",this.limit).replace("{totalItems}",this.maxItems)}renderA11YShowMore(){const{show_more:e=""}=this.props.a11y_label;return e.replace("{totalItems}",this.maxItems)}renderA11YShowLess(){const{show_less:e=""}=this.props.a11y_label;return e.replace("{limitItems}",this.limit)}createEventListeners(){return[{element:this,type:"EVENT_COLLAPSE_TOGGLE",listener:this.updateActiveCollapse.bind(this)},{element:this.refs.showmore,type:"click",listener:this.updateExpanded.bind(this)}]}updateActiveCollapse(e){if(this.autoCollapse){const{id:t}=(e=>{if(e.detail)return e.detail})(e);this.setAttribute("active-item",t)}}updateExpanded(e){e.preventDefault(),this.expanded=!this.expanded,this.refs.list.setAttribute("aria-expanded",this.expanded),this.refreshCollapses()}attributeChangedCallback(e,t,s){this.props[e]=s,this.autoCollapse&&"active-item"===e&&t!==s&&this.closeOldActiveItem(t)}closeOldActiveItem(e){null!==e&&this.refs.collapses[e].close()}refreshCollapses(){if(this.hasShowMore){this.refs.list.setAttribute("aria-description",this.renderA11YAccordionDescription());this.refs.collapses.slice(this.limit,this.refs.collapses.length).forEach((e=>e.setAttribute("aria-hidden",!this.expanded))),this.updateShowMoreLabel()}}disconnectedCallback(){i(this.eventListeners)}}customElements.get("nb-accordion")||customElements.define("nb-accordion",a);export{a as default};
