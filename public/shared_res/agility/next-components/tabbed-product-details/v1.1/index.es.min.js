class e extends HTMLElement{constructor(){super(),this.template=""}connectedCallback(){this.props=this._createProps(),this.onStart?.(),this.loadTemplate(),this.onReady?.()}_createProps(e=null){const t=e||this.attributes;let n;try{n=[...t].reduce(((e,t)=>({...e,[t.nodeName]:t.nodeValue})),{});const e=[...t].find((e=>"data"===e.nodeName));return null==e?n:{...n,...JSON.parse(e.nodeValue)}}catch(e){console.log("ERROR: No data",e)}}render(e=!1){e&&(this.innerHTML="");const t=(e,n)=>{const a=e=>3===e.nodeType?"text":8===e.nodeType?"comment":e.tagName.toLowerCase(),i=e=>e.childNodes&&e.childNodes.length>0?null:e.textContent;var s=Array.prototype.slice.call(n.childNodes),r=Array.prototype.slice.call(e.childNodes),o=s.length-r.length;if(o>0)for(;o>0;o--)s[s.length-o].parentNode.removeChild(s[s.length-o]);r.forEach((function(e,r){if(s[r])if(a(e)===a(s[r])){var o=i(e);if(o&&o!==i(s[r])&&(s[r].textContent=o),s[r].childNodes.length>0&&e.childNodes.length<1)s[r].innerHTML="";else{if(s[r].childNodes.length<1&&e.childNodes.length>0){var l=document.createDocumentFragment();return t(e,l),void s[r].appendChild(l)}e.childNodes.length>0&&t(e,s[r])}}else s[r].parentNode.replaceChild(e.cloneNode(!0),s[r]);else n.appendChild(e.cloneNode(!0))}))},n=(a=this.template,(new DOMParser).parseFromString(a,"text/html").body);var a;t(n,this)}loadTemplate(e="",t=!1){this.template=""===e?this.template:`${e}`,this.render(t)}disconnectedCallback(){this.onDestroy?.()}}customElements.get("nb-nespresso-element")||customElements.define("nb-nespresso-element",e);var t=(e=[])=>{e.forEach((e=>{if(e&&e.element)return e.element.addEventListener(e.type,e.listener,e.options)}))},n=(e=[])=>{e.forEach((e=>{e&&e.element&&e.element.removeEventListener(e.type,e.listener)}))};const a=e=>null==e,i=(e,t)=>{const{ref:n}=t.dataset,a=n.match(/(\w+)\[(.+)\]/);return null!==a?s(e,t,a):{...e,[t.dataset.ref]:t}},s=(e,t,[,n,a])=>(void 0===e[n]&&(e[n]=[]),e[n][a]=t,e);function r(e=""){return e.toLowerCase().trim().replace(/\s+/g,"-").replace(/[^\w-]+/g,"").replace(/--+/g,"-")}const o=e=>e?e.toString().replace(/"/g,"&quot;").replace(/'/g,"&apos;"):"";const l=e=>{const t={...e};return delete t.show_slider,`\n        <nb-plp-product-card\n            class="product"\n            data='${n=t,JSON.stringify(n).replace("'","â€™")}'\n            variation="pdp"\n        ></nb-plp-product-card>\n    `;var n},d={get is(){const{innerWidth:e,devicePixelRatio:t}=window;return{mobile:e<768,mobile_tablet:e<1024,tablet:e>=768&&e<1024,desktop:e>=1024&&t<=1,retina:e>=1024&&t>1}},lt:e=>window.innerWidth<e};const c=(e,t)=>{return`<nb-link data='${n={link:e.link,color:"black",cta_link_type:"true",size:"medium"},o(JSON.stringify(n))}'>${t}</nb-link>`;var n},p=(e,t,n)=>{let a="";""!==e.icon&&(a=`<nb-icon icon="${e.icon}"></nb-icon>`);let i="";return t&&(i=`<span class="t-sm-700-caps-sl">${t}</span>`),`<button\n        aria-controls="tabbed-product-details-tabpanel-${n}"\n        aria-label="${e.a11y_label}"\n        data-index="${n}"\n        data-ref="tabs[${n}]"\n        id="tabbed-product-details-tab-${n}"\n        role="tab"\n    >\n        ${a}\n        ${i}\n    </button>`};const u=e=>window.napi.catalog().getProduct(e);const h=async e=>{const t=await(async()=>await window.napi.priceFormat())(),n=window[window.config.padl.namespace].dataLayer.app.app.currency;return t.html?t.html(n,e):t.short(n,e)||""},b=async(e,t,n)=>({...f(t),...await g(t,h),...await y(t,e,h),position:n+1}),m=(e,t)=>e.find((({sku:e})=>e===t)),f=e=>({bundled:e.bundled,description:e.description,image_alt_text:e.name,inStock:e.inStock,keyFeatures:e.features,longSku:e.id,name:e.name,sales_multiple:e.salesMultiple,sku:e.internationalId,slides:e.slides,type:e.type,unit_quantity:e.unitQuantity}),g=async(e,t)=>{const n=e.images&&e.images.icon?e.images.icon:"",a=e.capsuleProperties&&e.capsuleProperties.intensity?e.capsuleProperties.intensity:"0",i=await t(e.price),s=e.productRatings&&e.productRatings.ratingEnabled,r="giftcard"!==e.type&&e.pdpURLs&&e.pdpURLs.desktop?e.pdpURLs.desktop:"";return{image:n,intensity:a,popin_id:`popin-product-${e.internationalId}`,price:i,rating_enabled:s,url:r}},y=async(e,t,n)=>{const{orders:a}=t.subscription,i={text:t.subscription.text.replace("{price}",await n(e.price/a)).replace("{orders}",a),orders:a};return{colors:t.colors,hide_add_to_cart:!0,features:t.features,labels:t.labels,show_ratings:!0,show_slider:!0,show_voltage:!0,subscription:i,voltage_label:t.voltage_label,a11y_voltage_label:t.a11y_voltage_label,voltage_list:t.voltage_list,key_3d:t.key_3d,label_button_3d:t.label_button_3d}};async function v(e){try{const t=e.map((({sku:e})=>e));await function(e){const t=[];if(!window.napi)return Promise.reject();Array.isArray(e)||(e=[e]);for(const n of e)t.push(u(n).then((t=>e.splice(e.indexOf(n),1,t))).catch((()=>{e.splice(e.indexOf(n),1),console.error(`getProduct fail on sku ${n}`)})));return Promise.all(t)}(t);const n=_(t);return await(async(e,t)=>{const n=e.map((async(e,n)=>{const a=m(t,e.internationalId);return b(a,e,n)}));return Promise.all(n)})(n,e)}catch(e){console.error(e)}}const _=e=>e.filter((e=>void 0!==e.internationalId));function w(e,t=!0){const n=e.querySelectorAll('button, [href], [tabindex="0"]');if(n.length>0)for(const e of n)t?e.setAttribute("tabindex","-1"):e.removeAttribute("tabindex")}class x extends HTMLElement{constructor(){super(),this.indexCurrent=-1,this.productsCached={},this.events={onTabClick:this.handleTabClick.bind(this),onKeyNavTab:this.handleKeyNavTab.bind(this)},this.eventListeners=[]}connectedCallback(){this.props=(e=>{const t=(e=>e.find((e=>"data"===e.nodeName)))([...e]),n=[...e].filter((e=>"data"!==e.nodeName)).reduce(((e,t)=>({...e,[t.nodeName]:t.nodeValue})),{});if(a(t))return n;try{return{...n,...JSON.parse(t.nodeValue)}}catch(e){console.log("ERROR: No data",e)}})(this.attributes),this.render(),this.refs=[...this.querySelectorAll("[data-ref]")].reduce(i,{}),this.bindEvent();const e=function(e,t){if(!window.location.hash)return t;const n=window.location.hash.substring(1);if(!n)return t;const{tabs:a=[]}=e.copywriting,i=a.findIndex((e=>r(e.label)===n));return-1!==i?i:t}(this.props,0);this.navigateToTab(e)}render(){const{layout:e,campaign:t,copywriting:n}=this.props;this.innerHTML=`\n            <nb-container\n                background_color="${e.background_color}"\n                contrast="${e.contrast}"\n                campaign_id="${t.id}"\n                campaign_name="${t.name}"\n                campaign_position="${t.position}"\n                campaign_creative="${t.creative}"\n                classname="${e.padding_top} ${e.padding_bottom}"\n            >\n                ${this.renderHeading(n)}\n                ${this.renderContent(n)}\n            </nb-container>\n        `}renderHeading({heading:e,description:t}){return`\n            ${e?`<h3 class="h-xl-700-sl">${e}</h3>`:""}\n            ${t?`<p class='text t-md-400'>${t}</p>`:""}\n        `}renderContent({a11y_label_tablist:e,tabs:t=[]}){return t.length?`\n            <div class="tabs" aria-label="${e}" role="tablist">\n                ${t.map(((e,t)=>function(e,t){let n=e.label;return d.is.mobile&&e.label_mobile&&""!==e.label_mobile&&(n=e.label_mobile),e.link?c(e,n):p(e,n,t)}(e,t))).join("")}\n            </div>\n            <div class="panels">\n                ${t.map(((e,t)=>((e,t,n=0)=>`\n        <div class="panel"\n            role="tabpanel"\n            data-ref="panels[${t}]"\n            id="tabbed-product-details-tabpanel-${t}"\n            aria-label="${e.a11y_label}"\n        >\n            ${t===n?"<nb-loader></nb-loader>":""}\n        </div>\n    `)(e,t,0))).join("")}\n            </div>\n        `:""}async navigateToTab(e,t=!1){const{tabs:n=[]}=this.props.copywriting,a=n[e];if(void 0===this.productsCached[e]){const t=a.products;this.productsCached[e]=await v(t)}var i;this.selectTab(e,t),this.transitionPanels(e,n),i=a.label,window.location.hash=r(i)}transitionPanels(e,t){const{img_text_box:n}=this.props.copywriting;if(e===this.indexCurrent)return null;const a=this.refs.panels[this.indexCurrent],i=this.refs.panels[e],s={onCompleteExit:()=>{i.innerHTML=((e,t,n)=>`<h3 class="sr-only">${e}</h3>\n        <div class="products">\n            ${t.map((e=>l({...e,img_text_box:n}))).join("")}\n        </div>`)(t[e].label,this.productsCached[e],n)},onCompleteEnter:()=>{this.indexCurrent=e}};void 0!==a?function(e,t,{onCompleteExit:n,onCompleteEnter:a}){const i=e.scrollHeight;e.classList.add("fade-out"),setTimeout((()=>{e.innerHTML="",e.classList.remove("fade-out"),t.style.minHeight=`${i}px`,t.classList.add("fade-in"),n()}),200),setTimeout((()=>{t.style=null,t.classList.remove("fade-in"),a()}),450)}(a,i,s):function(e,{onCompleteExit:t,onCompleteEnter:n}){setTimeout((()=>{e.classList.add("fade-in"),t()}),200),setTimeout((()=>{e.style=null,e.classList.remove("fade-in"),n()}),450)}(i,s)}selectTab(e,t=!1){!function(e){for(const t of e)t.setAttribute("tabindex","-1"),t.setAttribute("aria-selected","false")}(this.refs.tabs),function(e){for(const t of e)t.setAttribute("tabindex","-1"),t.setAttribute("aria-hidden",!0),w(t,!0)}(this.refs.panels);const n=this.refs.tabs[e],a=this.refs.panels[e];var i,s;s=a,(i=n).setAttribute("aria-selected","true"),i.removeAttribute("tabindex"),s.setAttribute("tabindex","0"),s.removeAttribute("aria-hidden"),w(a,!1),t&&n.focus()}handleTabClick(e){this.navigateToTab(e.target.dataset.index)}handleKeyNavTab(e){const t=this.refs.tabs.length-1;let n=this.indexCurrent;switch(e.key){case"ArrowLeft":this.indexCurrent>0&&(n=this.indexCurrent-1);break;case"ArrowRight":this.indexCurrent<t&&(n=this.indexCurrent+1);break;case"Home":n=0;break;case"End":n=t}n!==this.indexCurrent&&(e.preventDefault(),this.navigateToTab(n,!0))}bindEvent(){this.eventListeners=this.refs.tabs.map((e=>[{element:e,type:"click",listener:this.events.onTabClick},{element:e,type:"keydown",listener:this.events.onKeyNavTab}])).flat(),t(this.eventListeners)}unbindEvent(){n(this.eventListeners)}disconnectedCallback(){this.unbindEvent()}}customElements.get("nb-tabbed-product-details")||customElements.define("nb-tabbed-product-details",x);export{x as default};
