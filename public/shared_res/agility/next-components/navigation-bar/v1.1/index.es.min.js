class t extends HTMLElement{constructor(){super(),this.template=""}connectedCallback(){this.props=this._createProps(),this.onStart?.(),this.loadTemplate(),this.onReady?.()}_createProps(t=null){const e=t||this.attributes;let n;try{n=[...e].reduce(((t,e)=>({...t,[e.nodeName]:e.nodeValue})),{});const t=[...e].find((t=>"data"===t.nodeName));return null==t?n:{...n,...JSON.parse(t.nodeValue)}}catch(t){console.log("ERROR: No data",t)}}render(t=!1){t&&(this.innerHTML="");const e=(t,n)=>{const i=t=>3===t.nodeType?"text":8===t.nodeType?"comment":t.tagName.toLowerCase(),s=t=>t.childNodes&&t.childNodes.length>0?null:t.textContent;var r=Array.prototype.slice.call(n.childNodes),o=Array.prototype.slice.call(t.childNodes),a=r.length-o.length;if(a>0)for(;a>0;a--)r[r.length-a].parentNode.removeChild(r[r.length-a]);o.forEach((function(t,o){if(r[o])if(i(t)===i(r[o])){var a=s(t);if(a&&a!==s(r[o])&&(r[o].textContent=a),r[o].childNodes.length>0&&t.childNodes.length<1)r[o].innerHTML="";else{if(r[o].childNodes.length<1&&t.childNodes.length>0){var l=document.createDocumentFragment();return e(t,l),void r[o].appendChild(l)}t.childNodes.length>0&&e(t,r[o])}}else r[o].parentNode.replaceChild(t.cloneNode(!0),r[o]);else n.appendChild(t.cloneNode(!0))}))},n=(i=this.template,(new DOMParser).parseFromString(i,"text/html").body);var i;e(n,this)}loadTemplate(t="",e=!1){this.template=""===t?this.template:`${t}`,this.render(e)}disconnectedCallback(){this.onDestroy?.()}}customElements.get("nb-nespresso-element")||customElements.define("nb-nespresso-element",t);const e={get is(){const{innerWidth:t,devicePixelRatio:e}=window;return{mobile:t<768,mobile_tablet:t<1024,tablet:t>=768&&t<1024,desktop:t>=1024&&e<=1,retina:t>=1024&&e>1}},lt:t=>window.innerWidth<t};window.gtmDataObject=window.gtmDataObject||[];const n=t=>{window.gtmDataObject.push({event:"impression",eventRaisedBy:"Web component",eventAction:"Promo Impression - On Scroll",ecommerce:{},...t})};class i extends class{constructor(t,e){this.observer=new IntersectionObserver((t=>this.onChange(t)),{threshold:[0],rootMargin:"0% 0%"}),this.el=t,this.data=e,this.el instanceof Element&&this.observer.observe(this.el)}onChange(t){t.forEach((t=>{t.isIntersecting&&(this.track(t),this.observer.unobserve(t.target))}))}track(){window.requestIdleCallback((()=>this.runTrack()))}runTrack(){this.data.id&&null!==this.data.id&&""!==this.data.id&&n({ecommerce:{promoView:{promotions:[this.data]}}})}}{constructor(t,e){super(t),this.data=e}runTrack(){this.data.id&&null!==this.data.id&&""!==this.data.id&&n({ecommerce:{promoView:{promotions:[this.data]}}})}}const s=t=>null==t,r=(t,e)=>{const{ref:n}=e.dataset,i=n.match(/(\w+)\[(.+)\]/);return null!==i?o(t,e,i):{...t,[e.dataset.ref]:e}},o=(t,e,[,n,i])=>(void 0===t[n]&&(t[n]=[]),t[n][i]=e,t),a=({eventName:t,args:e,element:n})=>{let i;n=n||window,e?i=new CustomEvent(t,{detail:e,bubbles:!0}):"function"==typeof Event?i=new Event(t):(i=document.createEvent("Event"),i.initEvent(t,!0,!0)),n.dispatchEvent(i)},l="pnAdvancerRight",c="pnAdvancerLeft",d="#000000";class h{constructor(t,e={}){return this.boundNextClick=this.onNextClick.bind(this),this.boundPrevClick=this.onPrevClick.bind(this),this.boundLinkClick=this.onLinkClick.bind(this),this.boundTouchEnd=this.onTouchEnd.bind(this),this.disableAutoScroll="true"===e.disableAutoScroll||!1,this._entriesBounds=null,new Promise((n=>{this._element=t,this._slides=[].slice.call(t.children),this._options=Object.assign({},{id:"uuid",last_known_scroll_position:0,ticking:!1,navBarTravelDirection:"",navBarTravelling:!1,navBarTravelDistance:150,scrollAmount:220},e),this.buildIHM(),n(this),setTimeout((()=>{this.setOverflowAttribute(),this.initializeIndicatorPosition()}),0)}))}get element(){return this._element}buildIHM(){this._root=this.createElement("div","pn-ProductNav"),this._container=this.createElement("div","pn-ProductNavContents"),this._pnIndicator=null,this._containerSlidesContent=null,this.hasContainer()&&(this._containerSlidesContent=this.createElement("div","pn-ProductContainer")),this.wrapItems(),this._root.appendChild(this._container),this._containerSlidesContent&&this._element.appendChild(this._containerSlidesContent),this._element.insertBefore(this._root,this._element.childNodes[2]),this.createIndicator()}hasContainer(){return!!document.querySelector(".slider-container")}wrapItems(){const t=[];this._slides.map((e=>{const n=function(t){for(var e="",n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",i=n.length,s=0;s<t;s++)e+=n.charAt(Math.floor(Math.random()*i));return e}(5);if(this.hasContainer()&&e.classList.contains("slider-container")&&(e.children&&e.children.length&&[...e.children].forEach(((e,n)=>{0!==n&&(e.style.display="none"),e.id=t[n],this._containerSlidesContent.appendChild(e)})),e.remove()),!e.classList.contains("pn-Advancer")){const i=this.createElement("div","pn-ProductNavLinkWrapper");i.appendChild(e),i.setAttribute("data-inner-content-id",n),t.push(n),this._container.appendChild(i)}}))}createElement(t,e){let n=document.createElement(t);return n.setAttribute("class",e),n}createIndicator(){this.elements=[],this._pnIndicator=this.createElement("div","pn-ProductNavIndicator"),this._container.appendChild(this._pnIndicator),this.elements=Array.from(this._container.querySelectorAll("nb-link a")),this.elements.forEach((t=>{t.addEventListener("click",this.boundLinkClick)}));const t=document.getElementById(`${c}-${this._options.id}`);t&&t.addEventListener("click",this.boundPrevClick);const e=document.getElementById(`${l}-${this._options.id}`);e&&e.addEventListener("click",this.boundNextClick),this._root&&this._container.addEventListener("touchend",this.boundTouchEnd)}onLinkClick(t){this.goToElement(t.currentTarget)}goToSlide(t){this.goToElement(this._slides[t])}showContent(t){const e=document.querySelector(".pn-ProductContainer");e.children&&[...e.children].forEach((t=>t.style.display="none")),document.getElementById(t).style.display="block"}goToElement(t){if(this.hasContainer()){const e=t.closest("[data-inner-content-id]").getAttribute("data-inner-content-id");this.showContent(e)}if(this.deselectAllLinkBut(t),t.setAttribute("aria-selected","true"),!t||!this._entriesBounds)return;let e=0;for(const n of this._entriesBounds){if(n.target.getAttribute("data-href")===t.getAttribute("data-href"))break;e=e+n.boundingClientRect.width+10}this.disableAutoScroll||this._root.scroll({left:e,behavior:"smooth"})}deselectAllLinkBut(t){this.elements.map((e=>{e!==t&&e.setAttribute("aria-selected","false")}))}sideScroll(t,e,n,i,s){this.setOverflowAttribute();let r=0,o=setInterval((function(){"left"===e?t.scrollLeft-=s:t.scrollLeft+=s,r+=s,r>=i&&window.clearInterval(o)}),n);return{slideTimer:o}}onPrevClick(){this.sideScroll(this._root,"left",25,this._options.scrollAmount,10),setTimeout((()=>{this.setOverflowAttribute()}),300)}onNextClick(){this.sideScroll(this._root,"right",25,this._options.scrollAmount,10),setTimeout((()=>{this.setOverflowAttribute()}),300)}onTouchEnd(){this.setOverflowAttribute()}initializeIndicatorPosition(){const t=this._root.querySelector('[aria-selected="true"]');t&&this.moveIndicator(t,d)}determineOverflow(t,e){let n=e.getBoundingClientRect(),i=Math.floor(n.right),s=Math.floor(n.left),r=t.getBoundingClientRect(),o=Math.floor(r.right),a=Math.floor(r.left);return s>a&&i<o?"both":a<s?"left":o>i?"right":"none"}moveIndicator(t,e){if(!this._pnIndicator)return;let n=t.getBoundingClientRect(),i=this._container.getBoundingClientRect().left,s=n.left-i;this._pnIndicator.style.transform="translateX("+(s+this._container.scrollLeft+10)+"px) scaleX("+.01*(n.width-20)+")",this._root.scrollLeft=Math.floor(s+this._container.getBoundingClientRect().left/2),e&&(this._pnIndicator.style.backgroundColor=e)}onResize(){this.setOverflowAttribute(),this.initializeIndicatorPosition()}clearListeners(){this.elements.forEach((t=>{t.removeEventListener("click",this.boundLinkClick)}));const t=document.getElementById(`${c}-${this._options.id}`);t&&t.removeEventListener("click",this.boundPrevClick);const e=document.getElementById(`${l}-${this._options.id}`);e&&e.removeEventListener("click",this.boundNextClick)}kill(){this.clearListeners()}setOverflowAttribute(){this._element.setAttribute("data-overflowing",this.determineOverflow(this._container,this._root)),this.observe()}observe(){if(!("IntersectionObserver"in window))return!1;this._entriesBounds=[];const t=new IntersectionObserver((e=>{for(const t of e)this._entriesBounds.push({target:t.target,intersection:t.boundingClientRect.right<=window.innerWidth-10&&t.boundingClientRect.left>=10,boundingClientRect:t.boundingClientRect});t.disconnect()}),{root:this._container});this._slides.map((e=>t.observe(e)))}isInViewport(t){if(!this._entriesBounds)return!1;return this._entriesBounds.find((e=>t===e.target)).intersection}}class u extends HTMLElement{constructor(){super(),this.slot=this.innerHTML,this.navBarTravelling=!0,this.disableAutoScroll=!1,this.navBarTravelDirection="",this.navBarTravelDistance=200,this.randomId="swiperMenu_"+function(t){for(var e="",n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",i=n.length,s=0;s<t;s++)e+=n.charAt(Math.floor(Math.random()*i));return e}(5),this.sliderMenu=null,this.boundOnResize=this.onResize.bind(this),this.onLoad=this.onLoad.bind(this),this.debouncedOnResize=function(t,e){let n;return e=e||100,function(i){n&&clearTimeout(n),n=setTimeout(t,e,i)}}(this.boundOnResize,250)}static get observedAttributes(){return["navBarTravelling","navBarTravelDirection","navBarTravelDistance"]}render(){const t="true"===this.getAttribute("navigation")||"",e=this.getAttribute("a11y_slider_previous_button")||"",n=this.getAttribute("a11y_slider_next_button")||"";this.innerHTML=`\n            <div id="pnProductNav-${this.randomId}" class="pn-ProductNavWrapper ${this.randomId}">\n                ${t&&`<nb-cta id="pnAdvancerLeft-${this.randomId}"\n                        class="pn-Advancer pn-AdvancerLeft"\n                        variation="navigation"\n                        contrast="highlight"\n                        size="32"\n                        icon_right="chevron-left"\n                        label="${e}"></nb-cta>`}\n                ${this.slot}\n                ${t&&`<nb-cta id="pnAdvancerRight-${this.randomId}"\n                        class="pn-Advancer pn-AdvancerRight"\n                        variation="navigation"\n                        contrast="highlight"\n                        size="32"\n                        icon_right="chevron-right"\n                        label="${n}"></nb-cta>`}\n                <span id="pnIndicator-${this.randomId}"\n                    class="pn-ProductNavIndicator">\n                </span>\n            </div>\n\n            `,this.loadSwiper()}connectedCallback(){this.navBarTravelling=this.getAttribute("navBarTravelling")||this.navBarTravelling,this.navBarTravelDirection=this.getAttribute("navBarTravelDirection")||this.navBarTravelDirection,this.navBarTravelDistance=this.getAttribute("navBarTravelDistance")||this.navBarTravelDistance,this.disableAutoScroll=this.getAttribute("disable_auto_scroll")||"",this.render(),window.addEventListener("resize",this.debouncedOnResize)}loadSwiper(){let t=this.navBarTravelDirection,e=this.navBarTravelDistance;this.sliderMenu=new h(this.querySelector("."+this.randomId),{id:this.randomId,index:this.index,navBarTravelDirection:t,navBarTravelDistance:e,disableAutoScroll:this.disableAutoScroll}),this.sliderMenu.then((()=>{this.classList.add("is-show"),a({eventName:"WEB_COMPONENT_SLIDER_READY",args:{className:this.randomId},element:this})}))}handleClick(){var t;a({eventName:"WEB_COMPONENT_SLIDE_CHANGE"}),t={rootElement:["nb-slider-menu"]},window.gtmDataObject.push({event:"itemDisplay",eventRaisedBy:"Web component",eventAction:"Click",itemTypes:["products"],...t})}onLoad(){this.sliderMenu.then((t=>t.onLoad()))}onResize(){this.sliderMenu.then((t=>t.onResize()))}onNavigationClick(t){let e="";var n;t.target&&t.target.closest(".link")&&t.target.closest(".link").getAttribute("tracking_label")&&(e=t.target.closest(".link").getAttribute("tracking_label")),n={eventAction:"PLP Content Tab",eventLabel:e},window.gtmDataObject.push({event:"customEvent",eventRaisedBy:"Web component",eventCategory:"User Engagement",eventAction:"Click",eventLabel:"",nonInteraction:0,...n})}disconnectedCallback(){window.removeEventListener("resize",this.debouncedOnResize),this.sliderMenu.then((t=>t.kill()))}}customElements.get("nb-slider-menu")||customElements.define("nb-slider-menu",u);class v extends HTMLElement{constructor(){super(),this.boundOnSliderReady=this.onSliderReady.bind(this),this.boundOnNavigationClick=this.onNavigationClick.bind(this)}connectedCallback(){this.props=(t=>{const e=(t=>t.find((t=>"data"===t.nodeName)))([...t]),n=[...t].filter((t=>"data"!==t.nodeName)).reduce(((t,e)=>({...t,[e.nodeName]:e.nodeValue})),{});if(s(e))return n;try{return{...n,...JSON.parse(e.nodeValue)}}catch(t){console.log("ERROR: No data",t)}})(this.attributes),this.disableAutoScroll=this.getAttribute("disable-auto-scroll")||this.disableAutoScroll,this.render(),this.refs=[...this.querySelectorAll("[data-ref]")].reduce(r,{}),this.bindEvent(),this.initTracking()}bindEvent(){this.refs.navLink&&this.refs.navLink.addEventListener("WEB_COMPONENT_SLIDER_READY",this.boundOnSliderReady,{once:!0})}unbindEvent(){this.refs.navLink&&(this.refs.navLink.removeEventListener("WEB_COMPONENT_SLIDER_READY",this.boundOnSliderReady,{once:!0}),this.refs.navLink.querySelectorAll("a").forEach((t=>{t.removeEventListener("click",this.boundOnNavigationClick)})))}initTracking(){const{campaign:t}=this.props;t&&function(t,e){const n=new i(t,e)}(this,t)}render(){const{copywriting:t}=this.props,{a11y_slider_previous_button:n,a11y_slider_next_button:i}=t,s=this.innerHTML;this.innerHTML=`\n                    <div contrast="light">\n                        <div class="cb-navigation-bar">\n                        <nav class="cb-navigation-bar--links_list">\n                            <nb-slider-menu\n                                a11y_slider_previous_button="${n}"\n                                a11y_slider_next_button="${i}"\n                                navigation="${!e.is.mobile}"\n                                disable_auto_scroll="${this.disableAutoScroll}"\n                                data-ref="navLink">\n                                    ${this.renderLinksList()}\n                                    ${s}\n                            </nb-slider-menu>\n                        </nav>\n                    </div>\n                </div>`}onSliderReady(t){const e=(t=>{if(t.detail)return t.detail})(t),{className:n}=e,{campaign:i}=this.props;i&&this.refs.navLink&&this.refs.navLink.querySelector(`.${n}`)&&this.refs.navLink.querySelectorAll("a").forEach((t=>{t.addEventListener("click",this.boundOnNavigationClick)}))}onNavigationClick(){const{campaign:t}=this.props;var e;e={ecommerce:{promoClick:{promotions:[{...t}]}}},window.gtmDataObject.push({event:"promoClick",eventRaisedBy:"Web component",ecommerce:{},...e})}renderLinksList(){const{navigation:t=[]}=this.props;return t.map((t=>this.renderLink(t))).join("")}renderLink({link:t="",icon_left:e="",image:n="",image_alt:i="",seo_label:s="",label:r="",selected:o=!1}){return`\n        <nb-link\n            link="${this.props["id-links-auto"]?"#"+r:t}"\n            phantom="true"\n            color="black"\n            selected=${o}\n            ${s&&`seo_label="${s}"`}\n            ${n&&`image="${n}"`}\n            ${i&&`image_alt="${i}"`}\n            ${e&&`icon_left="${e}"`}>${r}</nb-link>`}disconnectedCallback(){this.unbindEvent()}}customElements.get("nb-navigation-bar")||customElements.define("nb-navigation-bar",v);export{v as default};
