const e=e=>null==e,t=(e,t)=>{const{ref:i}=t.dataset,s=i.match(/(\w+)\[(.+)\]/);return null!==s?n(e,t,s):{...e,[t.dataset.ref]:t}},n=(e,t,[,n,i])=>(void 0===e[n]&&(e[n]=[]),e[n][i]=t,e);var i=(e=[])=>{e.forEach((e=>{if(e&&e.element)return e.element.addEventListener(e.type,e.listener,e.options)}))},s=(e=[])=>{e.forEach((e=>{e&&e.element&&e.element.removeEventListener(e.type,e.listener)}))};class r extends HTMLElement{constructor(){super(),this.template=""}connectedCallback(){this.props=this._createProps(),this.onStart?.(),this.loadTemplate(),this.onReady?.()}_createProps(e=null){const t=e||this.attributes;let n;try{n=[...t].reduce(((e,t)=>({...e,[t.nodeName]:t.nodeValue})),{});const e=[...t].find((e=>"data"===e.nodeName));return null==e?n:{...n,...JSON.parse(e.nodeValue)}}catch(e){console.log("ERROR: No data",e)}}render(e=!1){e&&(this.innerHTML="");const t=(e,n)=>{const i=e=>3===e.nodeType?"text":8===e.nodeType?"comment":e.tagName.toLowerCase(),s=e=>e.childNodes&&e.childNodes.length>0?null:e.textContent;var r=Array.prototype.slice.call(n.childNodes),o=Array.prototype.slice.call(e.childNodes),a=r.length-o.length;if(a>0)for(;a>0;a--)r[r.length-a].parentNode.removeChild(r[r.length-a]);o.forEach((function(e,o){if(r[o])if(i(e)===i(r[o])){var a=s(e);if(a&&a!==s(r[o])&&(r[o].textContent=a),r[o].childNodes.length>0&&e.childNodes.length<1)r[o].innerHTML="";else{if(r[o].childNodes.length<1&&e.childNodes.length>0){var d=document.createDocumentFragment();return t(e,d),void r[o].appendChild(d)}e.childNodes.length>0&&t(e,r[o])}}else r[o].parentNode.replaceChild(e.cloneNode(!0),r[o]);else n.appendChild(e.cloneNode(!0))}))},n=(i=this.template,(new DOMParser).parseFromString(i,"text/html").body);var i;t(n,this)}loadTemplate(e="",t=!1){this.template=""===e?this.template:`${e}`,this.render(t)}disconnectedCallback(){this.onDestroy?.()}}customElements.get("nb-nespresso-element")||customElements.define("nb-nespresso-element",r);const o={get is(){const{innerWidth:e,devicePixelRatio:t}=window;return{mobile:e<768,mobile_tablet:e<1024,tablet:e>=768&&e<1024,desktop:e>=1024&&t<=1,retina:e>=1024&&t>1}},lt:e=>window.innerWidth<e};window.gtmDataObject=window.gtmDataObject||[];const a=({eventName:e,args:t,element:n})=>{let i;n=n||window,t?i=new CustomEvent(e,{detail:t,bubbles:!0}):"function"==typeof Event?i=new Event(e):(i=document.createEvent("Event"),i.initEvent(e,!0,!0)),n.dispatchEvent(i)};class d extends HTMLElement{connectedCallback(){this.props=(t=>{const n=(e=>e.find((e=>"data"===e.nodeName)))([...t]),i=[...t].filter((e=>"data"!==e.nodeName)).reduce(((e,t)=>({...e,[t.nodeName]:t.nodeValue})),{});if(e(n))return i;try{return{...i,...JSON.parse(n.nodeValue)}}catch(e){console.log("ERROR: No data",e)}})(this.attributes),this.isSingle=1===this.props.copywriting.recipes.length,this.popinId="",this.render(),this.refs=[...this.querySelectorAll("[data-ref]")].reduce(t,{}),this.eventListeners=this.createEventListeners(),i(this.eventListeners),this.watchAndClosePopin()}render(){const{campaign:e,layout:t}=this.props,{background_color:n,padding_top:i,padding_bottom:s}=t;this.isSingle&&this.classList.add("isSingle"),this.innerHTML=`<nb-container\n                            background_color='${n}'\n                            contrast="light"\n                            campaign_id="${e.id}"\n                            campaign_name="${e.name}"\n                            campaign_creative="${e.creative}"\n                            campaign_position="${e.position}"\n                            classname="${i} ${s}">\n                            <div class="cb-col1">\n                                ${this.renderHeading()}\n                                ${this.renderDescription()}\n                            </div>\n                            <div class="cb-col2">\n                                ${this.renderPattern()}\n                                ${this.renderRecipes()}\n                            </div>\n                            ${this.renderModals()}\n                        </nb-container>`}watchAndClosePopin(){this.popinId&&window.addEventListener("resize",function(e,t){let n;return t=t||100,function(i){n&&clearTimeout(n),n=setTimeout(e,t,i)}}((()=>{a({element:this,eventName:"WEB_COMPONENT_POPIN_CLOSE",args:{id:this.popinId}})})))}renderHeading(){const{heading:e=""}=this.props.copywriting;return e&&`<h2 class="h-xl-300">${e}</h2>`}renderDescription(){const{description:e=""}=this.props.copywriting;return e&&`<div class="wysiwyg t-sm-400">${e}</div>`}renderPattern(){const{background:{desktop:e}={}}=this.props.layout;return e&&`<img class="pattern" src="${e}" alt="" aria-hidden="true" loading="lazy" />`}renderRecipes(){const{recipes:e=[]}=this.props.copywriting,t=e.length>(o.is.mobile?1:2)?"Slider":"List",n=e.reduce(((e,t,n)=>`${e}${this.renderCard(t,n)}`),"");return this[`render${t}`](n)}renderCard({card:e},t){const{a11y_recipe:n="",a11y_time:i="",a11y_difficulty:s="",a11y_open_modal:r=""}=this.props.options,o=this.isSingle?"true":"false";return`<nb-card-recipe data='${JSON.stringify({...e,single:o,a11y_recipe:n,a11y_time:i,a11y_difficulty:s,a11y_open_modal:r})}' data-ref="cards[${t}]" data-trackRecipeName="${e.heading}"></nb-card-recipe>`}renderSlider(e){const{recipes:t=[]}=this.props.copywriting;return`<nb-slider\n                navigation="${!o.is.mobile}"\n                pagination="${t.length>3}"\n                slides_loop="false"\n                slides_visible="${o.is.mobile?1:2}"\n                space_between="${o.is.mobile||o.is.tablet?16:40}">\n                  ${e}\n                </nb-slider>`}renderList(e){return`<div class="list">${e}</div>`}renderModals(){const{recipes:e=[]}=this.props.copywriting;return e.reduce(((e,t,n)=>`${e}${this.renderModal(t,n)}`),"")}renderModal({modal:e},t){const{a11y_time:n="",a11y_difficulty:i=""}=this.props.options,s=JSON.stringify({...e,options:{a11y_time:n,a11y_difficulty:i}}),r=this.createPopinID(t);return`<nb-popin variation="before" bgcolor="highlight" size="XL" id="${r}" popin_id="${r}">\n                    <nb-modal-recipe data='${s}' popin_id="${r}"></nb-modal-recipe>\n                </nb-popin>`}createPopinID(e){const{heading:t=""}=this.props.copywriting;return this.stripedHeading=function(e){const t=document.implementation.createHTMLDocument("");return t.body.innerHTML=e,t.body.innerText.replace(RegExp("[\\s|'|\"]","g"),"")}(t).substr(0,10),`modal-recipe-${this.stripedHeading}-${e}`}createEventListeners(){return this.refs.cards.map(((e,t)=>({element:e,type:"click",listener:this.openPopin.bind(this,t)})))}openPopin(e){this.popinId=this.createPopinID(e),a({element:this,eventName:"WEB_COMPONENT_POPIN_OPEN",args:{id:this.popinId}}),this.trackRecipeEvents("WEB_COMPONENT_POPIN_OPEN",this.querySelectorAll("[data-trackRecipeName]")[e].getAttribute("data-trackRecipeName"))}trackRecipeEvents(e,t){var n;"WEB_COMPONENT_POPIN_OPEN"===e&&(n={eventAction:"Click Recipe",eventLabel:`Page Builder - Next V1 Recipe  - ${t}`},window.gtmDataObject.push({event:"customEvent",eventRaisedBy:"Web component",eventCategory:"User Engagement",eventAction:"Click",eventLabel:"",nonInteraction:0,...n}))}disconnectedCallback(){s(this.events)}}customElements.get("nb-recipes")||customElements.define("nb-recipes",d);export{d as default};
