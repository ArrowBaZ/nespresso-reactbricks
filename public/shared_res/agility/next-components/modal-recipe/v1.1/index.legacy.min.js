const e=e=>null==e,n=(e,n)=>{const{ref:s}=n.dataset,i=s.match(/(\w+)\[(.+)\]/);return null!==i?t(e,n,i):{...e,[n.dataset.ref]:n}},t=(e,n,[,t,s])=>(void 0===e[t]&&(e[t]=[]),e[t][s]=n,e);var s=(e=[])=>{e.forEach((e=>{if(e&&e.element)return e.element.addEventListener(e.type,e.listener,e.options)}))},i=(e=[])=>{e.forEach((e=>{e&&e.element&&e.element.removeEventListener(e.type,e.listener)}))};class r extends HTMLElement{constructor(){super(),this.template=""}connectedCallback(){this.props=this._createProps(),this.onStart?.(),this.loadTemplate(),this.onReady?.()}_createProps(e=null){const n=e||this.attributes;let t;try{t=[...n].reduce(((e,n)=>({...e,[n.nodeName]:n.nodeValue})),{});const e=[...n].find((e=>"data"===e.nodeName));return null==e?t:{...t,...JSON.parse(e.nodeValue)}}catch(e){console.log("ERROR: No data",e)}}render(e=!1){e&&(this.innerHTML="");const n=(e,t)=>{const s=e=>3===e.nodeType?"text":8===e.nodeType?"comment":e.tagName.toLowerCase(),i=e=>e.childNodes&&e.childNodes.length>0?null:e.textContent;var r=Array.prototype.slice.call(t.childNodes),o=Array.prototype.slice.call(e.childNodes),d=r.length-o.length;if(d>0)for(;d>0;d--)r[r.length-d].parentNode.removeChild(r[r.length-d]);o.forEach((function(e,o){if(r[o])if(s(e)===s(r[o])){var d=i(e);if(d&&d!==i(r[o])&&(r[o].textContent=d),r[o].childNodes.length>0&&e.childNodes.length<1)r[o].innerHTML="";else{if(r[o].childNodes.length<1&&e.childNodes.length>0){var l=document.createDocumentFragment();return n(e,l),void r[o].appendChild(l)}e.childNodes.length>0&&n(e,r[o])}}else r[o].parentNode.replaceChild(e.cloneNode(!0),r[o]);else t.appendChild(e.cloneNode(!0))}))},t=(s=this.template,(new DOMParser).parseFromString(s,"text/html").body);var s;n(t,this)}loadTemplate(e="",n=!1){this.template=""===e?this.template:`${e}`,this.render(n)}disconnectedCallback(){this.onDestroy?.()}}customElements.get("nb-nespresso-element")||customElements.define("nb-nespresso-element",r);const o={get is(){const{innerWidth:e,devicePixelRatio:n}=window;return{mobile:e<768,mobile_tablet:e<1024,tablet:e>=768&&e<1024,desktop:e>=1024&&n<=1,retina:e>=1024&&n>1}},lt:e=>window.innerWidth<e},d={getResponsiveSrc:e=>{const n=(t=e,Array.isArray(t)||"object"==typeof t?["mobile","tablet","desktop","retina"].find((e=>!0===o.is[e]&&e in t&&""!==t[e])):null);var t;return n?e[n]:e.desktop}},l=({eventName:e,args:n,element:t})=>{let s;t=t||window,n?s=new CustomEvent(e,{detail:n,bubbles:!0}):"function"==typeof Event?s=new Event(e):(s=document.createEvent("Event"),s.initEvent(e,!0,!0)),t.dispatchEvent(s)};class a extends HTMLElement{connectedCallback(){this.props=(n=>{const t=(e=>e.find((e=>"data"===e.nodeName)))([...n]),s=[...n].filter((e=>"data"!==e.nodeName)).reduce(((e,n)=>({...e,[n.nodeName]:n.nodeValue})),{});if(e(t))return s;try{return{...s,...JSON.parse(t.nodeValue)}}catch(e){console.log("ERROR: No data",e)}})(this.attributes);const{popin_id:t}=this.props;this.popinId=t,this.videoPopinId="video-"+t,this.videoPlayerId="player-"+t,this.isPlaying=!1,this.render(),this.refs=[...this.querySelectorAll("[data-ref]")].reduce(n,{}),this.hasMedia()&&this.refs.cover&&(this.eventListeners=this.createEventListeners(),s(this.eventListeners))}createEventListeners(){return[{element:this.refs.cover,type:"click",listener:this.openPlayer.bind(this)}]}hasMedia(){const{video:e}=this.props;return void 0!==e&&Object.keys(e).length&&e.video_id&&e.video_service||""}render(){this.innerHTML=`\n            <div class="cb-row">\n                <div class="cb-col1">\n                    ${this.renderHeader()}\n                    ${o.is.mobile_tablet?this.renderCover():""}\n                    ${this.renderRequirements()}\n                </div>\n                <div class="cb-col2">\n                    ${o.is.mobile_tablet?"":this.renderCover()}\n                    ${this.renderInstructions()}\n                </div>\n            </div>\n            <footer>\n                ${this.renderLink()}\n            </footer>\n            ${o.is.mobile&&this.hasMedia()?this.renderPlayer():""}`}renderHeader(){const{header:{heading:e="",subheading:n=""}={}}=this.props;return`<header>\n                ${e&&`<h2 class="h-2xl-700">${e}</h2>`}\n                ${n&&`<p class="t-md-400">${n}</p>`}\n                ${this.renderMetas()}\n             </header>`}renderMetas(){const{header:{metas:e={}}={}}=this.props;return`<div class="metas">${Object.entries(e).reduce(this.renderMeta.bind(this),"")}</div>`}renderMeta(e="",[n,t]){const s={time:"clock",difficulty:"speed"}[n],{a11y_time:i="",a11y_difficulty:r=""}=this.props.options;let o=`<span class="sr-only">${i}</span>`;return"difficulty"===n&&(o=`<span class="sr-only">${r}</span>`),`${e}\n            <div class="meta">\n                <nb-icon icon='${s}'></nb-icon>\n                ${o}\n                <span>${t}</span>\n            </div>`}renderCover(){const{visual:e,video:n=null}=this.props;if(e&&e.src){if(this.hasMedia()){if(o.is.mobile)return`<div class="cover" data-ref="cover">\n                        <button class="visual">\n                            ${this.renderVisual(e)}\n                            <nb-icon icon="play"></nb-icon>\n                        </button>\n                   </div>`;{if(!n)return"";const{video_id:t="",video_mobile:s="",video_service:i=""}=n;return`<div class="cover" data-ref="cover">\n                        <button class="visual">\n                            ${this.renderVisual(e)}\n                            <nb-icon icon="play"></nb-icon>\n                        </button>\n                        <nb-video\n                            container_id="${this.videoPlayerId}"\n                            video_service="${i}"\n                            video_id="${t}"\n                            video_mobile="${s}"\n                            popin_id="${this.popinId}"\n                            display_controls="1"\n                        />\n                   </div>`}}return`<div class="cover" data-ref="cover">\n                        <div class="visual">\n                        ${this.renderVisual(e)}\n                        </div>\n                   </div>`}}renderRequirements(){const{requirements:{heading:e="",ingredients:n={},materials:t={}}={}}=this.props;return`<section class="ingredients" aria-label="${e}">\n                <h3 class="h-lg-300-caps">${e}</h3>\n                ${this.renderList(n)}\n                ${this.renderList(t)}\n            </section>`}renderList(e){const{heading:n="",items:t=[]}=e;return`<h4 class="t-md-700-caps">${n}</h4>\n                <table cellspacing="0" cellpadding="0">\n                    <tbody>\n                        ${this.renderListItems(t)}\n                    </tbody>\n                </table>`}renderListItems(e=[]){return e.reduce(((e,n)=>`\n                ${e}\n                ${this.renderListItem(n)}\n            `),"")}renderListItem(e){const{visual:n={},proportion:t="",label:s=""}=e;return 0===Object.keys(n).length&&""===t?`<tr><td class="t-sm-500-sl" colspan="2">${s}</td></tr>`:`<tr>\n                        <td class="t-sm-400-sl">\n                            ${this.renderVisual(n)}\n                            ${t&&`<em>${t}</em>`}\n                        </td>\n                        <td class="t-sm-500-sl">${s}</td>\n                    </tr>`}renderVisual(e){const{src:n,alt:t=""}=e;if(!n)return"";const s=d.getResponsiveSrc(n);return s&&`<img src="${s}" alt="${t}" />`}renderInstructions(){const{instructions:{heading:e="",steps:n=[]}={}}=this.props;return`<section class="instructions" aria-label="${e}">\n                    <h3 class="h-lg-300-caps">${e}</h3>\n                    <ol class="steps">\n                        ${this.renderSteps(n,this.renderStep.bind(this))}\n                    </ol>\n                </section>`}renderSteps(e,n){return e.reduce(((e,t)=>`${e}${n(t)}`),"")}renderStep(e){const{heading:n="",substeps:t=[]}=e;return`<li>\n                    <h4 class="${o.is.mobile?"t-sm-700-caps":"t-md-700-caps"}">${n}</h4>\n                    <ol class="substeps">\n                        ${this.renderSteps(t,this.renderSubStep.bind(this))}\n                    </ol>\n                </li>`}renderSubStep(e){const{visual:n={}}=e;return`<li class="t-sm-400">\n                    ${e.text}<br/>\n                    ${this.renderVisual(n)}\n                </li>`}renderLink(){const{link:{label:e="",target:n=""}={}}=this.props;return e&&n&&`<nb-link\n                color="gold"\n                link="${n}"\n                size="large"\n                label="${e}">\n                ${e}\n            </nb-link>`}renderPlayer(){const{video:{video_id:e="",video_mobile:n="",video_service:t=""}={}}=this.props;return e&&t?`<nb-popin id="${this.videoPopinId}" popin_id="${this.videoPopinId}" variation="before" bgcolor="white">\n                    <nb-video\n                        container_id="${this.videoPlayerId}"\n                        video_service="${t}"\n                        video_id="${e}"\n                        video_mobile="${n}"\n                        popin_id="${this.videoPopinId}"\n                        display_controls="1"\n                        allow_popin_autoplay="true"\n                    />\n                </nb-popin>`:""}openPlayer(){o.is.mobile?l({eventName:"WEB_COMPONENT_POPIN_OPEN",args:{id:this.videoPopinId},element:this}):(this.togglePlayPause(),l({eventName:"WEB_COMPONENT_VIDEO_TOGGLE",args:{id:this.popinId},element:this}))}togglePlayPause(){this.isPlaying?this.classList.remove("play"):this.classList.add("play"),this.isPlaying=!this.isPlaying}updateRender(){this.refs.cover.innerHTML=this.renderCoverInner()}disconnectedCallback(){i(this.eventListeners)}}customElements.get("nb-modal-recipe")||customElements.define("nb-modal-recipe",a);export{a as default};
