const e=({eventName:e,args:t,element:n})=>{let i;n=n||window,t?i=new CustomEvent(e,{detail:t,bubbles:!0}):"function"==typeof Event?i=new Event(e):(i=document.createEvent("Event"),i.initEvent(e,!0,!0)),n.dispatchEvent(i)},t=(e,t,n)=>{if(e.nwcSwipeEvents)return;e.nwcSwipeEvents=!0,t.addEventListener("touchstart",(function(e){if("true"===e.target.getAttribute("data-swipe-ignore"))return;r=e.target,function(e){if(void 0===n||!n.contains(e))return;l=[],u=[];for(;e!==n;)l.push(e.scrollTop),u.push(e.scrollLeft),e=e.parentNode}(r),d=Date.now(),i=e.touches[0].clientX,s=e.touches[0].clientY,o=0,a=0}),!1),t.addEventListener("touchmove",(function(e){if(!i||!s)return;let t=e.touches[0].clientX,n=e.touches[0].clientY;o=i-t,a=s-n}),!1),t.addEventListener("touchend",(function(t){if(r!==t.target)return;const n=.25*e.innerHeight,l=.5*e.innerWidth;let u=parseInt(p(r,"data-swipe-threshold",n),10),h=parseInt(p(r,"data-swipe-threshold",l),10),b=parseInt(p(r,"data-swipe-timeout","500"),10),m=Date.now()-d,E="",v=t.changedTouches||t.touches||[];Math.abs(o)>Math.abs(a)?Math.abs(o)>h&&m<b&&(o>0?c("left",t)&&(E="swiped-left"):c("right",t)&&(E="swiped-right")):Math.abs(a)>u&&m<b&&(a>0?c("up",t)&&(E="swiped-up"):c("down",t)&&(E="swiped-down"));if(""!==E){let e={dir:E.replace(/swiped-/,""),touchType:(v[0]||{}).touchType||"direct",xStart:parseInt(i,10),xEnd:parseInt((v[0]||{}).clientX||-1,10),yStart:parseInt(s,10),yEnd:parseInt((v[0]||{}).clientY||-1,10)};r.dispatchEvent(new CustomEvent("swiped",{bubbles:!0,cancelable:!0,detail:e})),r.dispatchEvent(new CustomEvent(E,{bubbles:!0,cancelable:!0,detail:e}))}i=null,s=null,d=null}),!1);let i=null,s=null,o=null,a=null,d=null,r=null,l=[],u=[];function c(e,t){if(void 0===n)return!0;let i=t.target,s=!0,o=0;for(;i!==n&&s;){if(h(i))switch(e){case"up":s=l[o]===i.scrollHeight-i.clientHeight;break;case"down":s=0===l[o];break;case"left":s=u[o]===i.scrollWidth-i.clientWidth;break;case"right":s=0===u[o];break;default:s=!0}i=i.parentNode,o++}return s}function h(e){return e.scrollHeight>e.clientHeight||e.scrollWidth>e.clientWidth}function p(e,n,i){for(;e&&e!==t.documentElement;){let t=e.getAttribute(n);if(t)return t;e=e.parentNode}return i}},n=e=>null==e;function i(e,t){const n=e.parentNode;if(n===document.getElementsByTagName("body")[0])return;const s=n.children;for(const n of s)n!==e&&(t?n.setAttribute("aria-hidden",t):n.removeAttribute("aria-hidden"));i(n,t)}class s extends HTMLElement{constructor(){super(),this.template=""}connectedCallback(){this.props=this._createProps(),this.onStart?.(),this.loadTemplate(),this.onReady?.()}_createProps(e=null){const t=e||this.attributes;let n;try{n=[...t].reduce(((e,t)=>({...e,[t.nodeName]:t.nodeValue})),{});const e=[...t].find((e=>"data"===e.nodeName));return null==e?n:{...n,...JSON.parse(e.nodeValue)}}catch(e){console.log("ERROR: No data",e)}}render(e=!1){e&&(this.innerHTML="");const t=(e,n)=>{const i=e=>3===e.nodeType?"text":8===e.nodeType?"comment":e.tagName.toLowerCase(),s=e=>e.childNodes&&e.childNodes.length>0?null:e.textContent;var o=Array.prototype.slice.call(n.childNodes),a=Array.prototype.slice.call(e.childNodes),d=o.length-a.length;if(d>0)for(;d>0;d--)o[o.length-d].parentNode.removeChild(o[o.length-d]);a.forEach((function(e,a){if(o[a])if(i(e)===i(o[a])){var d=s(e);if(d&&d!==s(o[a])&&(o[a].textContent=d),o[a].childNodes.length>0&&e.childNodes.length<1)o[a].innerHTML="";else{if(o[a].childNodes.length<1&&e.childNodes.length>0){var r=document.createDocumentFragment();return t(e,r),void o[a].appendChild(r)}e.childNodes.length>0&&t(e,o[a])}}else o[a].parentNode.replaceChild(e.cloneNode(!0),o[a]);else n.appendChild(e.cloneNode(!0))}))},n=(i=this.template,(new DOMParser).parseFromString(i,"text/html").body);var i;t(n,this)}loadTemplate(e="",t=!1){this.template=""===e?this.template:`${e}`,this.render(t)}disconnectedCallback(){this.onDestroy?.()}}customElements.get("nb-nespresso-element")||customElements.define("nb-nespresso-element",s);var o=t=>{const n=document.createElement("DIV");n.classList.add("nb-overlay"),n.addEventListener("click",(()=>{e({eventName:"WEB_COMPONENT_QS_CLOSE",args:{id:t}})})),document.body.appendChild(n),setTimeout((()=>{n.classList.add("fadein")}),1)},a=()=>{if(!document.getElementsByClassName("nb-overlay").length)return;const e=document.getElementsByClassName("nb-overlay")[0];e.classList.remove("fadein"),setTimeout((()=>{e.remove()}),1200)};const d={get is(){const{innerWidth:e,devicePixelRatio:t}=window;return{mobile:e<768,mobile_tablet:e<1024,tablet:e>=768&&e<1024,desktop:e>=1024&&t<=1,retina:e>=1024&&t>1}},lt:e=>window.innerWidth<e};class r extends HTMLElement{constructor(){super(),this.props={},this.boundOpen=this.open.bind(this),this.boundClose=this.close.bind(this),this.boundEscapeClose=this.escapeClose.bind(this),this.boundFocus=this.focus.bind(this),this.boundFocusin=this.focusIn.bind(this),this.boundClickOutside=this.clickOutside.bind(this),this.boundSwipeDown=this.swipeDown.bind(this),this.boundNumericKeypress=this.numericKeypress.bind(this),this.boundValueChanged=this.valueChanged.bind(this),this.boundAddToCart=this.addToCart.bind(this)}connectedCallback(){this.props=(e=>{const t=(e=>e.find((e=>"data"===e.nodeName)))([...e]),i=[...e].filter((e=>"data"!==e.nodeName)).reduce(((e,t)=>({...e,[t.nodeName]:t.nodeValue})),{});if(n(t))return i;try{return{...i,...JSON.parse(t.nodeValue)}}catch(e){console.log("ERROR: No data",e)}})(this.attributes),this.setAttribute("id","quantity-selector-id"),this.style.display="none",this.ariaModal=!1,this.oldValue="",this.render()}disconnectedCallback(){this.hasEvent&&this.unbindEvent()}render(){this.hasEvent&&this.unbindEvent();const{a11y_qs_label:e,a11y_qs_description:t,a11y_predefined_quantity:n,a11y_predefined_description:i,a11y_custom_quantity:s,a11y_custom_description:o,label_choose_quantity:a,label_button_ok:d,step:r,max:l}=this.props;this.setAttribute("role","dialog"),this.setAttribute("aria-hidden","true"),this.innerHTML=`\n            <form aria-label="${e}" aria-description="${t}">\n                <fieldset aria-label="${n}" aria-description="${i}">\n                    ${this.renderItems()}\n                </fieldset>\n                <fieldset class="custom" aria-label="${s}" aria-description="${o}">\n                    <div>\n                        <input id="other_quantity" type="number" min="0" step="${r}" max="${l}" aria-label="${a}" pattern="[0-9]*"/>\n                        <label for="other_quantity" aria-hidden="true">${a}</label>\n                    </div>\n                    <button type="button">${d}</button>\n                </fieldset>\n            </form>\n        `,setTimeout((()=>{this.style.display="inherit"}),100),function(e){const t=e.querySelectorAll('button, [href], input, select, textarea, [tabindex="0"]');e.firstFocusable=t[0],e.lastFocusable=t[t.length-1],e.lastFocused=e.firstFocusable}(this),this.firstButtonElement=this.querySelector("ul li:first-child button"),this.buttonElements=this.querySelectorAll("ul button"),this.inputElement=this.querySelector("input"),this.buttonOK=this.querySelector(".custom button"),this.bindEvent()}renderItems(){const{quantities:e=[]}=this.props;return`<ul>${e.reduce(((e,t)=>`${e}${this.renderItem(t)}`),"")}</ul>`}renderItem(e){const{a11y_add_label:t}=this.props;return`<li><button aria-label="${t} ${e}" value="${e}" type="button">${e}</button></li>`}addLock(){d.is.mobile&&(document.documentElement.classList.add("scroll-lock"),o(this.id))}removeLock(){d.is.mobile&&(document.documentElement.classList.remove("scroll-lock"),a())}switchAriaModal(){this.ariaModal=!this.ariaModal,this.setAttribute("aria-modal",this.ariaModal),i(this,this.ariaModal)}setOpeningPosition(){const{top:e}=this.parentNode.getBoundingClientRect();e<280?this.classList.add("open-bottom"):this.classList.remove("open-bottom")}async open(e){if(await this.ready,this.isOpen)return;const t=(e=>{if(e.detail)return e.detail})(e);t.id===this.id&&(this.isOpen=!0,this.addEventListener("transitionend",this.boundFocus),document.addEventListener("focusin",this.boundFocusin),this.openingSource=document.activeElement,d.is.mobile||this.setOpeningPosition(),this.addLock(),this.switchAriaModal(),this.setAttribute("aria-hidden","false"),await new Promise((e=>{setTimeout((()=>{this.classList.add("isOpen"),e()}),300)})),d.is.mobile||document.body.addEventListener("click",this.boundClickOutside))}close(){this.isOpen&&(this.isOpen=!1,this.addEventListener("transitionend",this.boundFocus),document.removeEventListener("focusin",this.boundFocusin),d.is.mobile||document.body.removeEventListener("click",this.boundClickOutside),this.removeLock(),this.switchAriaModal(),this.setAttribute("aria-hidden","true"),this.classList.remove("isOpen"),e({eventName:"WEB_COMPONENT_QS_CLOSED",args:{id:this.id},element:this}))}focus(){this.removeEventListener("transitionend",this.boundFocus),this.isOpen?this.firstButtonElement.focus():this.openingSource.focus()}focusIn(e){!function(e,t,n){t.contains(e.target)?t.lastFocused=e.target:t.lastFocused===t.firstFocusable?n?t.lastFocusable.focus():t.firstFocusable.focus():n?t.firstFocusable.focus():t.lastFocusable.focus()}(e,this,!0)}escapeClose(e){"Escape"===e.key&&this.isOpen&&this.close()}swipeDown(){this.isOpen&&this.close()}clickOutside(e){!this.contains(e.target)&&this.isOpen&&this.close()}numericKeypress(e){(!/\d/i.test(e.key)||e.target.value.length+1>this.props.max.length)&&e.preventDefault()}valueChanged(e){""!==e.target.value?e.target.classList.add("filled"):e.target.classList.remove("filled"),e.target.value>this.props.max&&(e.target.value=this.props.max)}async addToCart(t){let n="";if(t.target===this.buttonOK){if(n=this.inputElement.value,""===n)return}else n=t.target.value;e({eventName:"WEB_COMPONENT_ADD_TO_CART",args:{quantity:n},element:this}),this.close()}bindEvent(){this.hasEvent=!0,window.addEventListener("WEB_COMPONENT_QS_OPEN",this.boundOpen),window.addEventListener("WEB_COMPONENT_QS_CLOSE",this.boundClose),document.addEventListener("keydown",this.boundEscapeClose),this.buttonElements.forEach((e=>{e.boundAddToCart=this.addToCart.bind(e),e.addEventListener("click",this.boundAddToCart)})),this.inputElement&&(this.inputElement.addEventListener("keypress",this.boundNumericKeypress),this.inputElement.addEventListener("change",this.boundValueChanged)),this.buttonOK&&this.buttonOK.addEventListener("click",this.boundAddToCart),d.is.mobile&&(t(window,document,this),document.addEventListener("swiped-down",this.boundSwipeDown),this.hasSwipeEvent=!0)}unbindEvent(){window.removeEventListener("WEB_COMPONENT_QS_OPEN",this.boundOpen),window.removeEventListener("WEB_COMPONENT_QS_CLOSE",this.boundClose),document.removeEventListener("keydown",this.boundEscapeClose),this.buttonElements.forEach((e=>{e.removeEventListener("click",this.boundAddToCart)})),this.inputElement&&(this.inputElement.removeEventListener("keypress",this.boundNumericKeypress),this.inputElement.removeEventListener("change",this.boundValueChanged)),this.buttonOK&&this.buttonOK.removeEventListener("click",this.boundAddToCart),this.hasSwipeEvent&&(document.removeEventListener("swiped-down",this.boundSwipeDown),this.hasSwipeEvent=!1),this.hasEvent=!1}}customElements.get("nb-qs")||customElements.define("nb-qs",r);export{r as default};
