class e extends HTMLElement{constructor(){super(),this.template=""}connectedCallback(){this.props=this._createProps(),this.onStart?.(),this.loadTemplate(),this.onReady?.()}_createProps(e=null){const t=e||this.attributes;let n;try{n=[...t].reduce(((e,t)=>({...e,[t.nodeName]:t.nodeValue})),{});const e=[...t].find((e=>"data"===e.nodeName));return null==e?n:{...n,...JSON.parse(e.nodeValue)}}catch(e){console.log("ERROR: No data",e)}}render(e=!1){e&&(this.innerHTML="");const t=(e,n)=>{const i=e=>3===e.nodeType?"text":8===e.nodeType?"comment":e.tagName.toLowerCase(),a=e=>e.childNodes&&e.childNodes.length>0?null:e.textContent;var r=Array.prototype.slice.call(n.childNodes),s=Array.prototype.slice.call(e.childNodes),o=r.length-s.length;if(o>0)for(;o>0;o--)r[r.length-o].parentNode.removeChild(r[r.length-o]);s.forEach((function(e,s){if(r[s])if(i(e)===i(r[s])){var o=a(e);if(o&&o!==a(r[s])&&(r[s].textContent=o),r[s].childNodes.length>0&&e.childNodes.length<1)r[s].innerHTML="";else{if(r[s].childNodes.length<1&&e.childNodes.length>0){var c=document.createDocumentFragment();return t(e,c),void r[s].appendChild(c)}e.childNodes.length>0&&t(e,r[s])}}else r[s].parentNode.replaceChild(e.cloneNode(!0),r[s]);else n.appendChild(e.cloneNode(!0))}))},n=(i=this.template,(new DOMParser).parseFromString(i,"text/html").body);var i;t(n,this)}loadTemplate(e="",t=!1){this.template=""===e?this.template:`${e}`,this.render(t)}disconnectedCallback(){this.onDestroy?.()}}customElements.get("nb-nespresso-element")||customElements.define("nb-nespresso-element",e);function t(e){return e.sales_multiple=e.sales_multiple||e.salesMultiple,!(e.sales_multiple>1&&1===e.unitQuantity)&&(1===e.sales_multiple&&e.unitQuantity>1)}const n=(e,t)=>{if(!e||!t)return{};const{images:n,name:i,headline:a,description:r}=e,{api_override:s}=t;return s?{image:s?.image||n?.icon||n?.url,name:s?.name||i,headline:s?.headline||a,description:s?.description||r}:{}},i=()=>{const e=window[window?.padlNamespace]?.dataLayer;return e?e.app.app.market.toLocaleLowerCase():"ch"};function a(e){return e.find((e=>function(e){return p("cat/capsule-attribute-only-vertuo-next").test(e.id)}(e)))}function r(e){return e.find((e=>function(e){return p("capsule-attribute-organic-eu").test(e.id)}(e)))}function s(e){return e.find((e=>function(e){return p("capsule-attribute-rainforest").test(e.id)}(e)))}function o(e){return e.find((e=>function(e){return p("capsule-attribute-sustainability").test(e.id)}(e)))}function c(e){return e.find((e=>function(e){return p("capsule-attribute-arabica").test(e.id)}(e)))}function l(e){return e.filter((e=>function(e){return p("cat/capsule-range-label").test(e.id)}(e)))}function d(e){return e.find((e=>function(e){return p("cat/capsule-attribute-highlight").test(e.id)}(e)))}function u(e){return e.find((e=>function(e){return p("cat/capsule-range-fair-trade").test(e.id)}(e)))}function p(e){return new RegExp(e.replace(/\//g,"\\/"))}async function h(e){const{configuration:{eCommerceData:{categories:t,product:n}={}}={}}=e;if(n.ranges&&n.ranges.length>0){const e=n.ranges[0],i=t.find((t=>t.id===e));null!=i&&(n.rangeData=i)}return function(e,t){const n=l(e).map((e=>e.description));t.labels=n}(t,n),function(e,t){const n=u(e);if(!n)return;t.fairTrade=n.name}(t,n),function(e,t){if(!d(e))return;t.highlighted=!0}(t,n),function(e,t){if(!a(e))return;t.onlyVertuoNext=!0}(t,n),function(e,t){r(e)&&(t.organicEu=!0)}(t,n),function(e,t){s(e)&&(t.rainforest=!0)}(t,n),function(e,t){o(e)&&(t.sustainability=!0)}(t,n),function(e,t){c(e)&&(t.arabica=!0)}(t,n),e}(function(){let e="https://www.nespresso.com/shared_res/agility/commons/img/icons/logo-organic-eu.svg";switch(i()){case"us":e="https://www.nespresso.com/shared_res/agility/commons/img/icons/logo-organic-us.svg";break;case"ca":e="https://www.nespresso.com/shared_res/agility/commons/img/icons/logo-organic-ca.svg";break;case"br":e="https://www.nespresso.com/shared_res/agility/commons/img/icons/logo-organic-br.svg";break;case"jp":e="https://www.nespresso.com/shared_res/agility/commons/img/icons/logo-organic-jp.svg";break;case"be":e="https://www.nespresso.com/shared_res/agility/commons/img/icons/logo-organic-be.png"}})();const g=e=>e?e.toString().replace(/"/g,"&quot;").replace(/'/g,"&apos;"):"";const m=({technologies:e})=>e.indexOf("original")?14:12,f=(e,n,i,a)=>{const{variant:r}=n.copywriting,{show_sleeve_price:s}=r,{product:o}=e.configuration.eCommerceData,c=t(o);o.bundled=c;const{showCapsulePrice:l,price_per_capsule:d,price:u}=function(e,t,n){let i,a,r=e;const s=n(t);return e&&"capsule"===t.type&&!s?(i=!1===s?t.price*t.salesMultiple:t.price,i=Math.round(100*i)/100,a=t.price):(r=!1,i=t.price),{showCapsulePrice:r,price:i,price_per_capsule:a}}(s,o,t),p={bundled:c,intensity_label:e.configuration.translations["productdetailsrespblock.capsule.a11y.intensity"].replace("{intensity}","").trim(),intensity:o.intensity,max_intensity:m(o),variation:"pdp",price_per_capsule:d?i.short(a,d):null,showCapsulePrice:l,show_capsule_price:l};return s&&(p.price=i.short(a,u)),p},b=e=>e.name.indexOf("110")>-1?"110":"220",w=e=>({category:e.colorCategories&&e.colorCategories[0]?e.colorCategories[0]:null,name:e.colorShade?e.colorShade.name:null,code:e.colorShade?e.colorShade.cssColorCode:null,sku:e.internationalId,link:e.url}),y=(e,t,n)=>{const i=b(n),a=t.filter((e=>e.label!==i));if(!a||!a.length)return t;const r=a.pop().label,s=n.name.replace(i,r),o=e.find((e=>e.name===s&&n.colorShade.cssColorCode===e.colorShade.cssColorCode));if(!o)return t;const{url:c=""}=o;return t.map((e=>(e.label!==i?(e.url=c,e.selected=!1):e.selected=!0,e)))},_=(e,t,i,a)=>{const{variant:r}=t.copywriting,{strikethrough_price:s,labels:o,additional_message:c,additional_message_icon:l}=r,{product:d}=e.configuration.eCommerceData;let u={sku:d.internationalId,technologies:d.technologies,longSku:d.id,name:d.name,headline:g(d.headline),sales_multiple:d.salesMultiple,unit_quantity:d.unitQuantity,type:d.type,category_name:d.rangeData?.name||"",label_range:d.rangeData?.name||"",price:d.price?i.short(a,d.price):null,strikethrough_price:s||"",variation:"pdp",image_alt_text:d.name,image:d.images?.icon,additional_message:c||"",additional_message_icon:l||"",...n(e,t)};const p=function(e){if(!e||!e.technologies||!e.technologies.length)return null;const t=e.technologies[0];return t.substring(t.indexOf("/machineTechno/")+"/machineTechno/".length)}(d);p&&(u.label_technology=p),o&&o.length&&(u.labels=o),d.labels&&d.labels.length&&(u.labels=d.labels.map((e=>JSON.parse(e)))),d.highlighted&&(u.highlighted=d.highlighted);let h={};return"capsule"===d.type?h=f(e,t,i,a):"machine"===d.type?h=((e,t)=>{const{variant:n}=t.copywriting,{show_voltage:i,voltage_label:a,a11y_voltage_label:r,voltage_list:s}=n,{colorVariants:o,product:c,ratingsAndReviews:l}=e.configuration.eCommerceData;let d={activeSku:c.internationalId,max_colors:99,...l};if(i){const e=b(c),t=y(o,s,c),n=o.filter((t=>t.name.indexOf(e)>-1)).map((e=>w(e)));d={...d,colors:n,show_voltage:i,voltage_label:a,a11y_voltage_label:r,voltage_list:t}}return d})(e,t):"accessory"===d.type?h={}:"giftcard"===d.type&&(h=((e,t)=>{const{variant:n}=t;return{image:n&&n.default_image}})(0,t)),{...d,...r,...u,...h}};async function k(){return await window.pdpData}async function v(){return napi.market().read()}async function C(){return napi.priceFormat()}const x={get is(){const{innerWidth:e,devicePixelRatio:t}=window;return{mobile:e<768,mobile_tablet:e<1024,tablet:e>=768&&e<1024,desktop:e>=1024&&t<=1,retina:e>=1024&&t>1}},lt:e=>window.innerWidth<e},D={getResponsiveSrc:e=>{const t=(n=e,Array.isArray(n)||"object"==typeof n?["mobile","tablet","desktop","retina"].find((e=>!0===x.is[e]&&e in n&&""!==n[e])):null);var n;return t?e[t]:e.desktop}},N=e=>[...e.querySelectorAll("[data-ref]")].reduce(E,{}),E=(e,t)=>{const{ref:n}=t.dataset,i=n.match(/(\w+)\[(.+)\]/);return null!==i?S(e,t,i):{...e,[t.dataset.ref]:t}},S=(e,t,[,n,i])=>(void 0===e[n]&&(e[n]=[]),e[n][i]=t,e),L=e=>null==e;var $=(e=[])=>{e.forEach((e=>{if(e&&e.element)return e.element.addEventListener(e.type,e.listener,e.options)}))};const P=e=>{const{key_3d:t=""}=e.props,{cta:n}=e.refs,i=()=>{n.addEventListener("mouseover",a,{once:!0})},a=()=>{if(o()||!window.seek.state.availableFeatures.webgl)return;const e=s();window.seek.launchExperience(c(),{modelKey:t,requestedEngine:"webgl"},{experienceTarget:e})},r=()=>{window.seek.removeEventListener("experienceLaunched",r),n.removeAttribute("disabled")},s=()=>{const e=document.createElement("div");e.style.display="none";const t=document.getElementsByTagName("body")[0];return t.parentNode.insertBefore(e,t),e},o=()=>["iOS","Android"].includes(window.seek.state.platform.os),c=()=>o()?"seekview":"viewer-qr-showcase";return window.seek||(({src:e,callback:t=null,async:n=!1,defer:i=!1,id:a=""})=>{const r=document.createElement("script");r.type="text/javascript",r.src=e,a&&(r.id=a),"function"==typeof t&&(r.onload=t),r.async=n,r.defer=i,document.body.appendChild(r)})({src:"//view.seekxr.com/nespresso/seek.min.js",defer:!0,callback:i}),{launch:()=>{window.seek.addEventListener("experienceLaunched",r),window.seek.config.defaultContext.selectedLanguageCode=(()=>{const{dataLayer:{page:{page:{pageInfo:{language:e="en"}}}}}=window[window.config.padl.namespace];return e})(),window.seek.launchExperience(c(),{modelKey:t}),n.setAttribute("disabled","disabled")}}};class T extends HTMLElement{connectedCallback(){this.props=(e=>{const t=(e=>e.find((e=>"data"===e.nodeName)))([...e]),n=[...e].filter((e=>"data"!==e.nodeName)).reduce(((e,t)=>({...e,[t.nodeName]:t.nodeValue})),{});if(L(t))return n;try{return{...n,...JSON.parse(t.nodeValue)}}catch(e){console.log("ERROR: No data",e)}})(this.attributes),this.render(),this.refs=N(this),this.createEventListeners(),this.arService=P(this)}createEventListeners(){const e=[{element:this.refs.cta,type:"click",listener:this.onClick.bind(this)}];$(e),this.eventListeners=e}render(){const{key_3d:e="",label_button_3d:t="",tracking_label:n,variation:i="secondary"}=this.props;this.innerHTML=`\n            <nb-cta\n                data-ref="cta"\n                class="cta__3d"\n                icon_right="link"\n                link="${e}"\n                tracking_label="${n}"\n                variation="${i}"\n            >${t}</nb-cta>\n        `}async onClick(e){e.preventDefault(),this.arService.launch()}}customElements.get("nb-cta-3d")||customElements.define("nb-cta-3d",T);class R extends e{constructor(e){super(e),this.pdpData=null,this.currency=null,this.priceFormatter=null,this.product=null}onStart(){!async function(){window.getPDPData=window.getPDPData||k}();const{contrast:e,background:t}=this.props.layout;this.template=`<nb-container\n                contrast='${e}'\n                background_mobile='${t.mobile}'\n                background_desktop='${t.desktop}'\n                background_retina='${t.retina}'>\n                <div class="cb-col1">\n                    ${this.renderLink()}\n                    ${this.renderImage()}\n                    <div data-ref="checkIn3D"></div>\n                    ${this.renderDisclaimer()}\n                </div>\n                <div class="cb-col2" data-ref="col2">\n                    <div class="cn_card">\n                        <div class="cn_card__content">\n                            <nb-loader></nb-loader>\n                        </div>\n                    </div>\n                </div>\n            </nb-container>`}async onReady(){this.refs=N(this);const e=await Promise.all([h(await window.getPDPData()),v(),C()]),[t,{currency:n},i]=e;this.pdpData=t,this.product=_(this.pdpData,this.props,i,n),this.renderSku(),this.renderCheck3D(),await this.trackDetailView()}getColorFromContrast(){const{contrast:e}=this.props.layout;return"light"===e?"black":"white"}renderLink(){const{link:e,label:t,seo_label:n}=this.props.copywriting.link;return t?`<nb-link link='${e}' seo_label='${n}' color='${this.getColorFromContrast()}' size='large'\n                                >${t}</nb-link>`:""}renderImage(){const{image:e}=this.props.copywriting;if(!e.alt_text)return"";const t=D.getResponsiveSrc(e);return`<img alt="${e.alt_text}" class="sku" src="${t}" fetchpriority="high"/>`}renderDisclaimer(){const{disclaimer_text:e}=this.props.copywriting;return e?`<small class="t-xs-500">${e}</small>`:""}renderSku(){const{col2:e}=this.refs,t=(({type:e})=>{let t="nb-sku";return"capsule"===e?t="nb-sku-coffee":"machine"===e?t="nb-sku-machine":"accessory"===e?t="nb-sku-accessory":"giftcard"===e&&(t="nb-sku-gift-card"),t})(this.product);var n;this.classList.add(`is-${t}`),e.innerHTML=`<${t}\n                            data="${n=this.product,g(JSON.stringify(n))}"\n                          ></${t}>`}async trackDetailView(){window.napi&&window.napi.data&&window.napi.data().product().setProductData(await window.productHelper.getPadlProductDetail(await window.napi.catalog().getProduct(this.product.longSku)))}renderCheck3D(){const{checkIn3D:e}=this.refs,{label_button_3d:t,key_3d:n}=this.product;if(!n)return e.parentNode.removeChild(e),"";const i=document.createElement("nb-cta-3d");i.setAttribute("class","link__3d"),i.setAttribute("key_3d",n),i.setAttribute("label_button_3d",t),e.replaceWith(i)}}customElements.get("nb-sku-main-info")||customElements.define("nb-sku-main-info",R);export{R as default};
