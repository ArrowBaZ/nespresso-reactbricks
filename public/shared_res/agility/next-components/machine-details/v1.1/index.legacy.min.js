const e=e=>n(JSON.stringify(e)),n=e=>e?e.toString().replace(/"/g,"&quot;").replace(/'/g,"&apos;"):"";class t extends HTMLElement{constructor(){super(),this.template=""}connectedCallback(){this.props=this._createProps(),this.onStart?.(),this.loadTemplate(),this.onReady?.()}_createProps(e=null){const n=e||this.attributes;let t;try{t=[...n].reduce(((e,n)=>({...e,[n.nodeName]:n.nodeValue})),{});const e=[...n].find((e=>"data"===e.nodeName));return null==e?t:{...t,...JSON.parse(e.nodeValue)}}catch(e){console.log("ERROR: No data",e)}}render(e=!1){e&&(this.innerHTML="");const n=(e,t)=>{const s=e=>3===e.nodeType?"text":8===e.nodeType?"comment":e.tagName.toLowerCase(),i=e=>e.childNodes&&e.childNodes.length>0?null:e.textContent;var a=Array.prototype.slice.call(t.childNodes),r=Array.prototype.slice.call(e.childNodes),l=a.length-r.length;if(l>0)for(;l>0;l--)a[a.length-l].parentNode.removeChild(a[a.length-l]);r.forEach((function(e,r){if(a[r])if(s(e)===s(a[r])){var l=i(e);if(l&&l!==i(a[r])&&(a[r].textContent=l),a[r].childNodes.length>0&&e.childNodes.length<1)a[r].innerHTML="";else{if(a[r].childNodes.length<1&&e.childNodes.length>0){var o=document.createDocumentFragment();return n(e,o),void a[r].appendChild(o)}e.childNodes.length>0&&n(e,a[r])}}else a[r].parentNode.replaceChild(e.cloneNode(!0),a[r]);else t.appendChild(e.cloneNode(!0))}))},t=(s=this.template,(new DOMParser).parseFromString(s,"text/html").body);var s;n(t,this)}loadTemplate(e="",n=!1){this.template=""===e?this.template:`${e}`,this.render(n)}disconnectedCallback(){this.onDestroy?.()}}customElements.get("nb-nespresso-element")||customElements.define("nb-nespresso-element",t);const s={get is(){const{innerWidth:e,devicePixelRatio:n}=window;return{mobile:e<768,mobile_tablet:e<1024,tablet:e>=768&&e<1024,desktop:e>=1024&&n<=1,retina:e>=1024&&n>1}},lt:e=>window.innerWidth<e},i=(e,n)=>{const{image:t=""}=e,s=n.querySelector("img.cn_card__image__single"),i="?impolicy=product&imwidth=150";s&&function(e,n,t,s,i){const a=(n,t)=>{e.setAttribute(n,t);const a=()=>e.classList.add("lazy-loaded");if(s){const n=new Image;return n.src=s,n.onload=a,void(n.onerror=()=>{i&&i(`Image ${s} cannot be loaded.`),e.classList.add("lazy-loaded-error")})}a()};if(/Trident\/|MSIE/.test(window.navigator.userAgent)||(r=window.navigator.userAgent,l=r.indexOf("OS "),(r.indexOf("iPhone")>-1||r.indexOf("iPad")>-1)&&l>-1&&window.Number(r.substr(l+3,3).replace("_","."))<14))a(n,t);else if("IntersectionObserver"in window){e.classList.add("lazy-load");let s=new IntersectionObserver((function(e){e.forEach((function(e){e.isIntersecting&&(a(n,t),s.unobserve(e.target))}))}));s.observe(e)}else a(n,t);var r,l}(s,"src",`${t+i}`,t+i)};function a({icon:n,text:t}){return`<nb-icon-text data="${e({icon:n,icon_size:"32",label:t,classname:"t-xs-500"})}"></nb-icon-text>`}function r({type:n,show_slider:t,slides:s,image:i,image_alt_text:a,plp_type:r},l){if(void 0===i||""===i||"pdp"===r)return"";const o=!l.is.mobile&&t&&s&&s.length>1;return("machine"===n||"machine"===r)&&o?function(n,t){return!n||n.length<=0?"":`<div class="cn_card__image">\n                <nb-product-card-image-slider\n                    data='${e({slides:n})}'\n                    image_alt_text=${t}>\n                </nb-product-card-image-slider>\n            </div>`}(s,a):function(e,n,t){return e?`<div class="cn_card__image">\n            ${t?`<a href="${t}" target="_self" aria-hidden="true" tabindex="-1">`:""}\n                <img class="cn_card__image__single" src=${e} alt="${n}"/>\n            ${t?"</a>":""}\n            </div>`:""}(i,a)}var l=(e=[])=>{e.forEach((e=>{if(e&&e.element)return e.element.addEventListener(e.type,e.listener,e.options)}))},o=(e=[])=>{e.forEach((e=>{e&&e.element&&e.element.removeEventListener(e.type,e.listener)}))};const c=e=>null==e,d=(e,n)=>{const{ref:t}=n.dataset,s=t.match(/(\w+)\[(.+)\]/);return null!==s?p(e,n,s):{...e,[n.dataset.ref]:n}},p=(e,n,[,t,s])=>(void 0===e[t]&&(e[t]=[]),e[t][s]=n,e);function u(e,n){if(!1===n||!e.price)return"";const{label_by:t="Buy at",price:s}=e;return`<nb-cta data-ref="buy" class="cn_card__buy" variation="primary">${t} ${s}</nb-cta>`}function h({headline:e,description:n=""}){let t=function(e){const n=document.createElement("div");return n.innerHTML=e,n.firstChild instanceof HTMLElement?n.firstChild.innerHTML:e}(n);return t||(t=e),t?`<p class="machine-details__description t-sm-400">${t}</p>`:""}async function m({sku:e,minimum_rating:n=0},t){const s=await function(e){try{return window.napi.ratings().summary(e)}catch(n){return console.error(`Failed to add item ${e} in cart: ${n}`),null}}(e);s&&0!==s.ratingAverage&&s.ratingAverage!==n||t.loader.remove();const i=parseFloat(s.ratingAverage.toFixed(2));t.rating.innerHTML=`<nb-rating stars=${i} />`}class _ extends HTMLElement{constructor(){super(),this.props={},this.events={onBuyClick:this.handleBuyClick.bind(this)},this.eventListeners=[],this.boundOnColorClick=this.onColorClick.bind(this)}connectedCallback(){this.props=(e=>{const n=(e=>e.find((e=>"data"===e.nodeName)))([...e]),t=[...e].filter((e=>"data"!==e.nodeName)).reduce(((e,n)=>({...e,[n.nodeName]:n.nodeValue})),{});if(c(n))return t;try{return{...t,...JSON.parse(n.nodeValue)}}catch(e){console.log("ERROR: No data",e)}})(this.attributes),this.render(),this.refs=[...this.querySelectorAll("[data-ref]")].reduce(d,{}),this.bindEvents(),m(this.props,this.refs),i(this.props,this)}render(){const{img_text_box:n}=this.props;this.innerHTML=`\n        <div class="md-top_block">\n            ${(({labels:n=[]})=>0===n.length?"":`<nb-card-labels data='${e({labels:n})}' direction="${s.is.mobile?"row":"column"}"></nb-card-labels>`)(this.props)}\n            <div class="left">\n                ${r(this.props,s)}\n                ${function(e){const{key_3d:n="",label_button_3d:t,label_tracking_3d:s}=e;return""===n?"":`\n        <div data-ref="cta3d">\n            <nb-cta-3d\n                key_3d="${n}"\n                label_button_3d="${t}"\n                tracking_label="${s}"\n                variation="tertiary"\n            ></nb-cta-3d>\n        </div>\n    `}(this.props)}\n            </div>\n            <div class="right">\n                ${(({url:e,a11y_product_card:n="",name:t="",label_decaffeinato:s,src_page:i=""},a)=>{const r=new RegExp(s,"ig"),l=s&&""!==s&&r.test(t);n=n.replace("{productName}",t),l?t=t.replace(r,"").trim():s="";const o="pdp"===i?"h1":"h3";return`${e?`<${o} class='cn_card__title'><a href="${e}" target="_self" title="${n}" aria-label="${n}">`:`<${o} class='cn_card__title'>`}\n${t}\n${s?`<span class='${a.is.mobile?"t-xs-700-caps":"t-sm-700-caps"}'>${s}</span>`:""}\n${e?`</a></${o}>`:`</${o}>`}`})(this.props,s)}\n                ${function({rating_enabled:e=!1,show_ratings:n=!1}){return n&&e&&void 0!==window.napi.ratings?'\n        <div class="machine-details__rating" data-ref="rating">\n            <nb-loader data-ref="loader" />\n        </div>\n    ':""}(this.props)}\n                ${(({colors:n,sku:t,max_colors:i=4,a11y_extra_color:a="",url:r,activeSku:l,name:o})=>n?`<nb-colors data="${e({colors:n,max_colors:i,activeSku:l||t,extra_url:r,extra_title:o+", "+a})}" size="${s.is.mobile?"small":"large"}"></nb-colors>`:"")(this.props)}\n                ${(({show_voltage:e,voltage_label:n,voltage_list:t,a11y_voltage_label:s,a11y_volts_label:i})=>e&&n&&t&&t.length?`<div class="cb-sku-tab">\n        <span class="sr-only">${s}</span>\n        <p class='t-sm-400' aria-hidden="true">${n}</p>\n        ${t.map((({label:e,url:n})=>n?`<a href="${n}" target="_self"><span class="t-sm-400-caps">${e}<span aria-hidden="true">V</span><span class='sr-only'> ${i}</span></span></a>`:`<div aria-current="page"><span class="t-sm-700-caps">${e}<span aria-hidden="true">V</span><span class='sr-only'> ${i}</span></span></div>`)).join("")}\n    </div>`:"")(this.props)}\n                ${function({features:e=[]}){return 0===e.length?"":`<div class="cn_card__features">${e.map(a).join("")}</div>`}(this.props)}\n                ${h(this.props)}\n                ${function({key_features:e=[],key_feature_heading:n=""}){return 0===e.length?"":`\n        <div class="machine-details__key-features">\n            <p class="t-xs-700-caps-sl">${n}</p>\n            <ul class="t-sm-400">\n                ${e.map((e=>function({name:e,description:n="",unitOfMeasure:t=""}){return`\n        <li>\n            ${e}${""!==n?`: ${n}`:""}\n            ${t?`(${t})`:""}\n        </li>\n    `}(e))).join("")}\n            </ul>\n        </div>\n    `}(this.props)}\n                ${function(e,n){const{subscription:t,url:s,view_more_label:i="View more details"}=e;return`\n        <div class="machine-details__subscription-wrapper">\n            ${(({price:e,giftcard_price:n,type:t,hidePrice:s})=>!e||"giftcard"===t&&!n||s?"":`<p class="cn_card__priceWrapper--current"><span>${e}</span></p>`)(e)}\n            <p class="t-sm-400">${t.text}</p>\n            <div class="machine-details__subscription-actions">\n                ${u(e,!n.is.mobile)}\n                <nb-link link="${s}" link_new_tab="true">${i}</nb-link>\n            </div>\n        </div>\n    `}(this.props,s)}\n            </div>\n            ${u(this.props,s.is.mobile)}\n        </div>\n        ${n?function(e,n){const{heading:t,subtitle:s,text:i,visual:a}=e;return t?`<div class="md-bottom-block">\n            <div class="left">\n                <h2 class="h-2xl-300-sl">${t}</h2>\n                <div class="content t-sm-400">\n                    ${s?`<p class="t-md-400">${s}</p>`:""}\n                    ${i||""}\n                </div>\n            </div>\n            <div class="right">\n                <div class="visual">\n                    <img loading="lazy" src="${n?a.mobile:a.desktop}" \n                        alt="${a.alt}"/>\n                </div>\n            </div>\n        </div>`:""}(n,s.is.mobile):""}\n        `}async handleBuyClick(){await async function(e){if(void 0!==window.CartManager)try{await window.CartManager.updateItem(e,1,null,null,!1)}catch(n){console.error(`Failed to add item ${e} in cart: ${n}`)}else console.error("The cart service is not available")}(this.props.sku)}onColorClick(){(({eventName:e,args:n,element:t})=>{let s;t=t||window,n?s=new CustomEvent(e,{detail:n,bubbles:!0}):"function"==typeof Event?s=new Event(e):(s=document.createEvent("Event"),s.initEvent(e,!0,!0)),t.dispatchEvent(s)})({eventName:"WEB_COMPONENT_POPIN_CLOSE",element:window})}bindEvents(){this.eventListeners=[{element:this.refs.buy,type:"click",listener:this.events.onBuyClick}],l(this.eventListeners),this.addEventListener("EVENT_COLOR_CLICKED",this.boundOnColorClick)}unbindEvent(){o(this.eventListeners),this.removeEventListener("EVENT_COLOR_CLICKED",this.boundOnColorClick)}disconnectedCallback(){this.unbindEvent()}}customElements.get("nb-machine-details")||customElements.define("nb-machine-details",_);export{_ as default};
