class e extends HTMLElement{constructor(){super(),this.template=""}connectedCallback(){this.props=this._createProps(),this.onStart?.(),this.loadTemplate(),this.onReady?.()}_createProps(e=null){const t=e||this.attributes;let n;try{n=[...t].reduce(((e,t)=>({...e,[t.nodeName]:t.nodeValue})),{});const e=[...t].find((e=>"data"===e.nodeName));return null==e?n:{...n,...JSON.parse(e.nodeValue)}}catch(e){console.log("ERROR: No data",e)}}render(e=!1){e&&(this.innerHTML="");const t=(e,n)=>{const i=e=>3===e.nodeType?"text":8===e.nodeType?"comment":e.tagName.toLowerCase(),s=e=>e.childNodes&&e.childNodes.length>0?null:e.textContent;var r=Array.prototype.slice.call(n.childNodes),a=Array.prototype.slice.call(e.childNodes),l=r.length-a.length;if(l>0)for(;l>0;l--)r[r.length-l].parentNode.removeChild(r[r.length-l]);a.forEach((function(e,a){if(r[a])if(i(e)===i(r[a])){var l=s(e);if(l&&l!==s(r[a])&&(r[a].textContent=l),r[a].childNodes.length>0&&e.childNodes.length<1)r[a].innerHTML="";else{if(r[a].childNodes.length<1&&e.childNodes.length>0){var o=document.createDocumentFragment();return t(e,o),void r[a].appendChild(o)}e.childNodes.length>0&&t(e,r[a])}}else r[a].parentNode.replaceChild(e.cloneNode(!0),r[a]);else n.appendChild(e.cloneNode(!0))}))},n=(i=this.template,(new DOMParser).parseFromString(i,"text/html").body);var i;t(n,this)}loadTemplate(e="",t=!1){this.template=""===e?this.template:`${e}`,this.render(t)}disconnectedCallback(){this.onDestroy?.()}}customElements.get("nb-nespresso-element")||customElements.define("nb-nespresso-element",e);const t=e=>null==e;class n extends HTMLElement{constructor(){super(),this.props={},this.detailLinks="",this.popinCenter="",this.popinRight="",this.boundShowHide=this.showHideDetailBlock.bind(this),this.boundBlockGtmPush=this.blockGtmPush.bind(this)}connectedCallback(){this.renderLoader(),this.props=(e=>{const n=(e=>e.find((e=>"data"===e.nodeName)))([...e]),i=[...e].filter((e=>"data"!==e.nodeName)).reduce(((e,t)=>({...e,[t.nodeName]:t.nodeValue})),{});if(t(n))return i;try{return{...i,...JSON.parse(n.nodeValue)}}catch(e){console.log("ERROR: No data",e)}})(this.attributes),this.loadProducts()}renderLoader(){this.innerHTML='<div class="loading"><nb-loader></nb-loader></div>'}loadProducts(){const{main_sku:e,other_skus:t}=this.props,n=t.split(",").map((e=>e.trim()));this.mainProduct=null,this.otherProducts=[];const i=window.napi,s=[e,...n];let r=null;Promise.all(s.map((e=>(r=e,i.catalog().getProduct(e))))).then((e=>{this.mainProduct=e[0],this.otherProducts=e.slice(1)})).catch((()=>{throw new Error(`getProduct fail on sku ${r}`)})).finally((()=>{this.renderContainer()}))}render(){if(!this.mainProduct||this.mainProduct.errorDate)return console.warn("Invalid SKU"),"";const{main_sku:e,headline_desc:t,position:n,range:i}=this.props,{name:s,headline:r,images:a,id:l}=this.mainProduct,o=t||(r||"");return`\n            <div class="left">\n                ${this.renderImage(a,s)}\n                <nb-add-to-cart\n                    sku="${e}"\n                    longSku="${l}"\n                    position="${n}"\n                    range="${i}"\n                    buttonSize="large"\n                    showPrice\n                ></nb-add-to-cart>\n\n            </div>\n\n            <div class="center">\n                <h2 class="h-lg-700-caps-sl">${s}</h2>\n                <p class="t-sm-400">${o}</p>\n                <ul>\n                    ${this.otherProducts.map(((e,t)=>this.renderLi(e,t))).join("")}\n                </ul>\n            </div>\n\n            <div class="right">\n                ${this.otherProducts.map(((e,t)=>this.renderSubItemDetail(e,t))).join("")}\n            </div>\n        `}renderImage(e,t){return e.icon?`<img loading="lazy" src="${e.icon}" alt="${t}" />`:""}renderLi(e,t){const{other_skus_quantity:n}=this.props,i=n.split(","),{name:s,images:r}=e;return`<li\n            data-index="liElement${t}"\n            data-name="${s.toLowerCase()}"\n            aria-label="${i[t]} ${s.toLowerCase()}"\n            id="liElement${t}"\n            tabindex="0"\n            role="tab"\n            aria-selected="${t?"false":"true"}"\n        >\n            ${this.renderImage(r,"")}\n            <span>\n                <h3 class="t-3xs-700-sl">${s.toLowerCase()}</h3>\n                <p class="t-2xs-500-sl">x${i[t]}</p>\n            </span>\n        </li>`}renderSubItemDetail(e,t){const{name:n,images:i}=e;return`\n            <aside\n                data-show-index="liElement${t}"\n                role="tabpanel"\n                aria-labelledby="liElement${t}"\n                id="panel${t}"\n                aria-hidden="${t?"true":"false"}">\n                    ${this.renderImage(i,n)}\n                    <h3 class="t-md-700-caps-sl">${n}</h3>\n                    ${this.renderTypes(e)}\n            </aside>\n        `}renderTypes(e){const{type:t,headline:n="",category:i,capsuleProperties:s}=e;return"capsule"===t?`\n                <div class="capsule">\n                    ${i?`<h4>${i}</h4>`:""}\n                    <p class="t-xs-500">${n}</p>\n                    ${this.renderCapsuleIntensity(s.intensity,e)}\n                </div>\n            `:"accessory"===t?`\n                <div class="accessory">\n                    <p class="t-xs-500">${n}</p>\n                </div>\n            `:"machine"===t?`\n                <div class="machine">\n                    <p class="t-xs-500">${n}</p>\n                </div>\n            `:""}renderCapsuleIntensity(e,t){if(!e)return"";const{intensity_label:n="Intensity"}=this.props;return`<nb-intensity intensity="${e}" max_intensity="${(({technologies:e})=>e.indexOf("original")?14:12)(t)}" intensity_label="${n}"></nb-intensity>`}renderContainer(){this.innerHTML=this.render(),this.popinCenter=this.querySelector(".center"),this.popinRight=this.querySelector(".right"),this.detailLinks=this.querySelectorAll("li"),this.detailBlocks=this.querySelectorAll("aside"),this.bindEvents()}blockGtmPush(e){e.stopPropagation()}showHideDetailBlock(e){if(e.stopPropagation(),"click"===e.type||"keypress"===e.type&&("Enter"===e.key||"Space"===e.key)){const t=e.currentTarget.getAttribute("data-index");for(let e=0;e<this.detailLinks.length;e++)this.detailLinks[e].setAttribute("aria-selected","false");for(let e=0;e<this.detailBlocks.length;e++)this.detailBlocks[e].setAttribute("aria-hidden","true");this.querySelector(`li[data-index=${t}]`).setAttribute("aria-selected","true"),this.querySelector(`aside[data-show-index=${t}]`).setAttribute("aria-hidden","false")}}bindEvents(){if(this.detailLinks.length){const e=this;Array.from(this.detailLinks).forEach((t=>{t.addEventListener("click",e.boundShowHide.bind(this)),t.addEventListener("keypress",e.boundShowHide.bind(this))}))}this.popinCenter&&this.popinCenter.addEventListener("click",this.boundBlockGtmPush.bind(this)),this.popinRight&&this.popinRight.addEventListener("click",this.boundBlockGtmPush.bind(this))}unbindEvents(){this.detailLinks.length&&Array.from(this.detailLinks).forEach((e=>{e.removeEventListener("click",this.showHideDetailBlock.bind(this)),e.removeEventListener("keydown",this.showHideDetailBlock.bind(this))})),this.popinCenter&&this.popinCenter.removeEventListener("click",this.boundBlockGtmPush.bind(this)),this.popinRight&&this.popinRight.removeEventListener("click",this.boundBlockGtmPush.bind(this))}disconnectedCallback(){this.unbindEvents()}}customElements.get("nb-bundle-details")||customElements.define("nb-bundle-details",n);export{n as default};
