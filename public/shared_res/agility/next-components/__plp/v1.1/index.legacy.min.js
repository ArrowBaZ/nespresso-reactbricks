const e=e=>{const n=(e=>e.find((e=>"data"===e.nodeName)))([...e]),i=[...e].filter((e=>"data"!==e.nodeName)).reduce(((e,t)=>({...e,[t.nodeName]:t.nodeValue})),{});if(t(n))return i;try{return{...i,...JSON.parse(n.nodeValue)}}catch(e){console.log("ERROR: No data",e)}},t=e=>null==e;window.gtmDataObject=window.gtmDataObject||[];const n=e=>{window.gtmDataObject.push({event:"itemDisplay",eventRaisedBy:"Web component",eventAction:"Click",itemTypes:["products"],...e})},i=e=>{window.gtmDataObject.push({event:"customEvent",eventRaisedBy:"Web component",eventCategory:"User Engagement",eventAction:"Click",eventLabel:"",nonInteraction:0,...e})},s=e=>{window.gtmDataObject.push({event:"impression",eventRaisedBy:"Web component",eventAction:"Promo Impression - On Scroll",ecommerce:{},...e})},r=({eventName:e,args:t,element:n})=>{let i;n=n||window,t?i=new CustomEvent(e,{detail:t,bubbles:!0}):"function"==typeof Event?i=new Event(e):(i=document.createEvent("Event"),i.initEvent(e,!0,!0)),n.dispatchEvent(i)},o=e=>{if(e.detail)return e.detail},a="WEB_COMPONENT_POPIN_OPEN",l="WEB_COMPONENT_SLIDER_READY",c=()=>window[window?.padlNamespace]?.dataLayer,d=()=>{const e=c();return e?e.app.app.market.toLocaleLowerCase():"ch"};class u extends HTMLElement{constructor(){super(),this.slot=this.innerHTML,this.boundHandleClick=this.handleClick.bind(this),this.market=d(),this.language=c()?c().page.page.pageInfo.language.toLocaleLowerCase():"en"}connectedCallback(){this.props=e(this.attributes),this.render(),this.setClassHelper(),this.bindEvents()}render(){const{size:e="large",color:t="gold",link:n="",icon_right:i="",icon_left:s="",image:r="",image_alt:o=""}=this.props;e&&this.setAttribute("size",e),t&&this.setAttribute("color",t),r&&this.setAttribute("image",r),o&&this.setAttribute("image_alt",o),s&&this.setAttribute("icon_left",s),i&&this.setAttribute("icon_right",i),""===n?this.renderButton():this.renderLink(),this.link=this.firstElementChild}renderLink(){const{label:e,seo_label:t="",tracking_label:n="",link_new_tab:i="false",a11y_label_new_tab:s="",icon_right:r="",image:o="",image_alt:a="",icon_left:l="",selected:c="",phantom:d=""}=this.props;let{link:u}=this.props;const h=this.slot?this.slot:e;u&&(u=u.replace("{market}",this.market),u=u.replace("{lang}",this.language)),this.innerHTML=`\n        <a\n            href="${u}"\n            ${"true"===i?'target="_blank"':""}\n            ${"true"===i&&""!==s?`aria-description='${s}'`:""}\n            ${n&&`tracking_label='${n}'`}\n            ${t?`title="${t}"`:""}\n            ${"true"===c?'aria-selected="true"':""}\n            ${"true"===d?`phantom="${h}"`:""}\n        >\n            ${l&&`<nb-icon icon='${l}'></nb-icon>`}\n            ${o&&`<img src='${o}' alt='${a}'/>`}\n            <span>${h}</span>\n            ${r&&`<nb-icon icon='${r}'></nb-icon>`}\n        </a>`}renderButton(){const{label:e,tracking_label:t="",icon_right:n="",icon_left:i="",selected:s="",image:r="",image_alt:o="",phantom:a=""}=this.props,l=this.slot?this.slot:e;this.innerHTML=`\n        <button\n            ${t&&`tracking_label='${t}'`}\n            ${"true"===s?'aria-selected="true"':""}\n            ${"true"===a?`phantom="${l}"`:""}\n        >\n            ${r&&`<img src='${r}' alt='${o}'/>`}\n            ${i&&`<nb-icon icon='${i}'></nb-icon>`}\n            <span>${l}</span>\n            ${n&&`<nb-icon icon='${n}'></nb-icon>`}\n        </button>`}setClassHelper(){const{size:e="large",cta_link_type:t="false"}=this.props;let n="";switch(e){case"xsmall":n="t-2xs-500";break;case"small":n="t-xs-500-sl";break;case"medium":n="t-sm-400-sl";break;default:n="t-xs-700-caps-sl"}"true"===t&&(n="t-sm-700-caps-sl",this.setAttribute("underline","false")),this.querySelector("a, button").classList.add(n)}handleClick(){this.track();const{popin_id:e=""}=this.props;e&&this.popin(e)}popin(e){r({eventName:a,args:{id:e}})}track(){this.props.campaign_id&&this.handlePromoClick(),this.props.custom_tracking&&this.handleCustomEvent()}handlePromoClick(){const{campaign_id:e="",campaign_name:t="",campaign_position:n="",campaign_creative:i=""}=this.props;var s;""!==e&&(s={ecommerce:{promoClick:{promotions:[{id:e,name:t,position:n,creative:i}]}}},window.gtmDataObject.push({event:"promoClick",eventRaisedBy:"Web component",ecommerce:{},...s}))}handleCustomEvent(){const{tracking_label:e=""}=this.props;""!==e&&i({eventAction:"Click",eventLabel:e})}bindEvents(){this.unbindEvents(),this.link.addEventListener("click",this.boundHandleClick)}unbindEvents(){this.link.removeEventListener("click",this.boundHandleClick)}disconnectedCallback(){this.unbindEvents()}}customElements.get("nb-link")||customElements.define("nb-link",u);const h=["notes-almonds","notes-balanced","notes-bergamot","notes-berry","notes-biscuity","notes-blueberry","notes-cardamom","notes-cereal","notes-citrus","notes-cocoa","notes-default","notes-flowery","notes-fruity","notes-hazelnut","notes-herbal","notes-honey","notes-leather","notes-malted","notes-roasted","notes-spicy","notes-sugar","notes-winey","notes-wood","notes-brand-coffee-roasted","notes-brand-coffee-caramel","notes-brand-coffee-intense-roasted"],p=["upvote","19-bar","24-7-service","360-view","accessories-and-sweets","address-2","address","amex-card","android","apple-pay-card","apple-pay","apple","arrow-bottom","arrow-filled-down","arrow-left","arrow-right","arrow-top","assistance-alt","assistance-videos","assistance","boutique","brand_coffee_capsule-vl-carafe","brand_coffee_capsule-vl-double-espresso-gran-lungo","brand_coffee_capsule-vl-espresso","brand_coffee_capsule-vl-mug","brand_coffee_capsule_ol","brand_coffee_capsule_pro","brand_coffee_capsule_vl","brand_coffee_cereals","brand_coffee_citrus","brand_coffee_cocoa","brand_coffee_coffee-assortment","brand_coffee_coffee-discovery-set","brand_coffee_machines","brand_coffee_malted","brand_coffee_notes-herbal","brand_delivery_boutique-location","brand_delivery_delivery","brand_delivery_free_delivery","brand_delivery_package","brand_delivery_schedule_delivery","brand_general_coffee","brand_machines_auto_clean_system","brand_machines_automatic_off","brand_machines_digital_display","brand_machines_energy_class","brand_machines_fast_heat_up","brand_machines_low_water_alert","brand_machines_milk_frothing","brand_machines_pump_pressure_bar","brand_payment_credit_card","brand_payment_gift_card","brand_payment_invoice","brand_payment_secure","brand_services_assistance","brand_services_boutique","brand_services_easy_order","brand_services_help","brand_services_promotions","brand_services_recycling","brand_services_recycling_ol","brand_services_recycling_vl","brand_services_subscription","brand_services_sustainability","calendar","capsule-cupSize-Cappuccino-And-Latte-Macchiato","capsule-cupSize-Cortado-Cappuccino","capsule-cupSize-icedRecipe-vertuo","capsule-cupSize-icedRecipe","capsule-cupSize-alto","capsule-cupSize-carafe-vertuo","capsule-cupSize-coffee","capsule-cupSize-double-espresso-vertuo","capsule-cupSize-espresso-vertuo","capsule-cupSize-espresso","capsule-cupSize-gran-lungo","capsule-cupSize-lungo","capsule-cupSize-mug","capsule-cupSize-ristretto","capsule-cupSize-americano","capsule-cupSize-large-americano","check","chevron-down","chevron-left","chevron-right","chevron-up","check-mark","clock","close-2","close","coffee","coffee_capsule-ol_24","credit-card-flag","credit-card","delivery-fast","delivery-scheduled","delivery-standard","eco-mode","edit","error","espresso-vertuo-capsule","eye-closed","eye-opened","facebook","filter","find-us-alt","find-us","free-return","gift-card","globe","gran-lungo-vertuo-capsule","help","hero-chat","huawei","information-24","information","instagram","invoice","language","linkedin","link","live-chat","loading-nitro","loading","loan","logout","machine_machines_ol_24","machines-2","machines","mail","mastercard-card","mastercard","menu","minus-16","minus-24","minus-o","modal-alert","modal-check","more-info","nespresso-logo","nespresso-monogram","nespresso-professional-2","nespresso-professional","nespresso","notification","orders","original","package-box","payment-bcorp","payment-bvr","payment-google-pay","payment-ideal","payment-klarna","payment-lsv","payment-postfinance","payment-twint","paypal-card","paypal","phone","pin","pinterest","play-button","play-mini","play","plus-16","plus-24","plus-o","promotions","recycling-point","recycling","remove","search","secure","set-up","shopping-bag","signal-high","signal-low","signal-med","speed","star","rating","subscription-2","subscription","sustainability","tag","twitter","ui_payment_cash","ui_coffee_bergamot","ui_coffee_capsule-ol","ui_coffee_capsule-vl-carafe","ui_coffee_capsule-vl-double-espresso_gran-lungo","ui_coffee_capsule-vl-espresso","ui_coffee_capsule-vl-mug","ui_coffee_capsule-vl","ui_coffee_capsule_professional","ui_coffee_cardamom","ui_coffee_cocoa","ui_coffee_hazelnut","ui_coffee_honey","ui_coffee_notes-cereal","ui_coffee_notes-malted","ui_coffee_winey","ui_delivery_calendar","ui_delivery_clock","ui_general_alerts","ui_general_arrow-right","ui_general_check","ui_general_chevron-bottom","ui_general_chevron-left","ui_general_chevron-right","ui_general_chevron-top","ui_general_credit-card","ui_general_edit","ui_general_error","ui_general_eye-close","ui_general_eye-open","ui_general_faq","ui_general_filter","ui_general_gift-card","ui_general_globe","ui_general_information","ui_general_language","ui_general_link","ui_general_loading","ui_general_log-out","ui_general_map_view","ui_general_menu","ui_general_minus","ui_general_notification","ui_general_order","ui_general_play","ui_general_plus","ui_general_promotions","ui_general_remove","ui_general_search","ui_general_secure","ui_general_shopping-bag","ui_general_tag","ui_general_user-account","ui_general_warranty","ui_general_wifi","ui_general_x","ui_map_directions","ui_payment_invoice","ui_services_assistance","ui_services_delivery","ui_services_easy_order","ui_services_find-us","ui_services_free-return","ui_services_mail","ui_services_phone","ui_services_subscription","ui_sustainability_climate","ui_sustainability_recycling","ui_sustainability_recycling_ol","ui_sustainability_recycling_vl","ui_sustainability_social_sustainability","ui_user_member_status","ui_user_my-address","ui_user_my_information","ultra-compact","user-account","versatil-coffee-system","video-play","vertuo","visa-card","visa","warranty","youtube","services-anticipation-of-maintenance","services-assistance","services-avant-premiere","services-avant-premiere-ol","services-avant-premiere-vl","services-coffee-assortment","services-coffee-coffee-sample","services-coffee-discovery-set","services-coffee-experiences","services-contact-chat","services-contact-community-forum","services-contact-mobile","services-contact-sms","services-contact-video-assistance","services-contact-virtual","services-data-insight","services-delivery-boutique-location","services-delivery-boutique-pick-up","services-delivery-delivery","services-delivery-delivery-bike","services-delivery-delivery-fast","services-delivery-free-delivery","services-delivery-next-day-delivery","services-delivery-package","services-delivery-pick-up-points","services-delivery-schedule-delivery","services-easy-maintenance","services-easy-order","services-easy-stock-management","services-generic","services-gifting-card","services-help","services-orders","services-payments-credit-card","services-payments-gift-card","services-payments-invoice","services-phone","services-reorder","services-satisfied-or-reimbursed","services-services-boutique","services-subscription","services-vip-masterclass","services-voice-enabled","payments-cash","delivery-same-day-delivery","contact-voice-assistant-chatbot","contact-video-chat","contact-mobile-push-notification","contact-chat-bot","coffee-coffee-tasting","contact-video-assistance","filter-style_step-01","filter-style_step-02","filter-style_step-03","filter-style_step-04"].concat(h).concat(["machine_technology_machine-ol","machine_technology_machine-vl","machine_details_deluxe-version","machine_details_machine-tutorial-ol","machine_details_machine-tutorial-vl","machine_warranty_warranty-ol","machine_warranty_warranty-vl","machine_features_generic","machine_features_auto-clean-system","machine_features_automatic-off","machine_features_blend-specific-brewing","machine_features_bluetooth","machine_features_capsule-ejection-ol","machine_features_capsule-ejection-vl","machine_features_centrifusion","machine_features_cold-foam-ol","machine_features_cold-foam-vl","machine_features_descale-alert","machine_features_descale","machine_features_digital-display","machine_features_dimensions","machine_features_eco-mode","machine_features_energy-class","machine_features_fast-heat-up","machine_features_hot-foam-ol","machine_features_hot-foam-vl","machine_features_hot-milk","machine_features_hot-foam","machine_features_hot-water","machine_features_low-water-alert","machine_features_manual-lever","machine_features_milk-frothing","machine_features_mobile-push-notification","machine_features_one-touch","machine_features_power-off","machine_features_pump-pressure-bar","machine_features_rinse","machine_features_settings","machine_features_steam","machine_features_temperature-settings-invert","machine_features_temperature-settings","machine_features_temperature","machine_features_ultra-compact","machine_features_water-tank","machine_features_weight"]);function b(e){const t=document.implementation.createHTMLDocument("");return t.body.innerHTML=e,t.body.childNodes}function _(e){for(var t="",n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",i=n.length,s=0;s<e;s++)t+=n.charAt(Math.floor(Math.random()*i));return t}function g(e,t,n,i,s){const r=(t,n)=>{e.setAttribute(t,n);const r=()=>e.classList.add("lazy-loaded");if(i){const t=new Image;return t.src=i,t.onload=r,void(t.onerror=()=>{s&&s(`Image ${i} cannot be loaded.`),e.classList.add("lazy-loaded-error")})}r()};if(/Trident\/|MSIE/.test(window.navigator.userAgent)||(o=window.navigator.userAgent,a=o.indexOf("OS "),(o.indexOf("iPhone")>-1||o.indexOf("iPad")>-1)&&a>-1&&window.Number(o.substr(a+3,3).replace("_","."))<14))r(t,n);else if("IntersectionObserver"in window){e.classList.add("lazy-load");let i=new IntersectionObserver((function(e){e.forEach((function(e){e.isIntersecting&&(r(t,n),i.unobserve(e.target))}))}));i.observe(e)}else r(t,n);var o,a}function m(e,t){let n;return t=t||100,function(i){n&&clearTimeout(n),n=setTimeout(e,t,i)}}function f(e,t,n,i){let s=0;for(;e;){const r=e.indexOf(n,s);if(-1===r)break;const o=e.indexOf(i,r+1);if(-1===o)break;const a=e.substring(r+n.length,o);null!=t[a]?(e=e.substr(0,r)+t[a]+e.substr(o+i.length),s=r):s=o}return e}const v=e=>y(JSON.stringify(e)),y=e=>e?e.toString().replace(/"/g,"&quot;").replace(/'/g,"&apos;"):"",w=(e,t)=>{for(let n in t)e.setAttribute(n,t[n])},k=window.memoPromiseCache?window.memoPromiseCache:{};class E{constructor(e){this.getPromise=e,this.request=this.request.bind(this)}request({uniqueKey:e,url:t}){if(!e)return Promise.reject(new Error("Unique key not passed"));if(!k[e]){const n=this.getPromise(t);k[e]=n.then((e=>e.text())).catch((t=>{throw delete k[e],t}))}return k[e]}}class C extends HTMLElement{constructor(){super(),this.props={},this.path="",this.source=""}connectedCallback(){this.props=e(this.attributes),this.classList.add("lazy-load"),this.classList.add("nb-svg"),this.beforeRender(),this.render()}beforeRender(){}render(){if(""===this.source)return void console.error(`Error: Component SVG - render - 'source' property is not set:${this.source}`);this.innerHTML="<svg></svg>",this.afterHtmlRender();const e=this;!function(e,t){if(/Trident\/|MSIE/.test(window.navigator.userAgent)||(n=window.navigator.userAgent,i=n.indexOf("OS "),(n.indexOf("iPhone")>-1||n.indexOf("iPad")>-1)&&i>-1&&window.Number(n.substr(i+3,3).replace("_","."))<14))t();else if("IntersectionObserver"in window){let n=new IntersectionObserver((function(e){e.forEach((function(e){e.isIntersecting&&(t(),n.unobserve(e.target))}))}),{above:[0],rootMargin:"150% 0px"});n.observe(e)}var n,i}(e,(()=>{e.fetchSVG(this.source,`${this.path}${this.source}.svg`)}))}afterHtmlRender(){}request(e){return fetch(e)}async fetchSVG(e,t){const n=this.firstElementChild,i=new E(this.request),{request:s}=i;let r=await s({uniqueKey:e,url:t});let o=(new DOMParser).parseFromString(r,"image/svg+xml").getElementsByTagName("svg");if(!o.length)return console.error(`Error: Component SVG - fetchSVG - SVG not found ${o}`),this.classList.remove("lazy-load"),void this.classList.add("lazy-loaded-error");this.classList.remove("lazy-load"),this.classList.add("lazy-loaded"),o=o[0];const a=o.attributes,l=a.length;for(let e=0;e<l;++e)if(a[e].specified)if("class"===a[e].name){const t=a[e].value.replace(/\s+/g," ").trim().split(" "),i=t.length;for(let e=0;e<i;++e)n.classList.add(t[e])}else n.setAttribute(a[e].name,a[e].value);for(;o.childNodes.length;)n.appendChild(o.childNodes[0])}}customElements.get("nb-svg")||customElements.define("nb-svg",C);customElements.get("nb-icon")||customElements.define("nb-icon",class extends C{beforeRender(){const{icon:e}=this.props;-1!==p.indexOf(e)?(this.classList.add("nb-icon"),this.path="/shared_res/agility/next-components/assets/icons/",this.source=e):console.error(`Error: Component Icon - beforeRender - 'icon' is not part of the authorized list - Icon name:${e}`)}afterHtmlRender(){this.setAttribute("aria-hidden","true")}});class L extends HTMLElement{constructor(){super(),this.slot=this.innerHTML,this.checkbox=null}static get observedAttributes(){return["disabled","checked"]}connectedCallback(){this.props=e(this.attributes),this.render()}render(){const{content:e,icon:t="",color:n="",background_image:i="",filter_label_AA:s="filter",rounded:r="true",checked:o="false",disabled:a="false"}=this.props,l=this.slot?this.slot:e;const c="true"===o?"checked":"",d="true"===a?"disabled":"";this.innerHTML=`\n            <input type='checkbox' name='options' aria-label="${l+" "+s}" ${c} ${d}>\n            <label style=''>\n                ${t&&`<nb-icon icon='${t}'></nb-icon>\n                `}\n                ${n&&`<div class='chip-color' style='background:${n}'></div>\n                `}\n                ${i&&`<div class='chip-image ${"true"===r?"rounded":""}' style='background-image:url("${i}")'></div>\n                `}\n                <span aria-hidden="true" phantom="${l}">${l}</span>\n            </label>\n        `,this.querySelector("label").addEventListener("click",(e=>{e.preventDefault(),this.querySelector("input").click()})),this.checkbox=this.getElementsByTagName("input")[0]}attributeChangedCallback(e,t,n){this.checkbox&&("disabled"===e?this.checkbox.disabled="true"===n:"checked"===e&&(this.checkbox.checked="true"===n))}disconnectedCallback(){this.querySelector("label").removeEventListener("click",(e=>{e.preventDefault(),this.querySelector("input").click()}))}}customElements.get("nb-chip")||customElements.define("nb-chip",L);class $ extends HTMLElement{constructor(){super(),this.template=""}connectedCallback(){this.props=this._createProps(),this.onStart?.(),this.loadTemplate(),this.onReady?.()}_createProps(e=null){const t=e||this.attributes;let n;try{n=[...t].reduce(((e,t)=>({...e,[t.nodeName]:t.nodeValue})),{});const e=[...t].find((e=>"data"===e.nodeName));return null==e?n:{...n,...JSON.parse(e.nodeValue)}}catch(e){console.log("ERROR: No data",e)}}render(e=!1){e&&(this.innerHTML="");const t=(e,n)=>{const i=e=>3===e.nodeType?"text":8===e.nodeType?"comment":e.tagName.toLowerCase(),s=e=>e.childNodes&&e.childNodes.length>0?null:e.textContent;var r=Array.prototype.slice.call(n.childNodes),o=Array.prototype.slice.call(e.childNodes),a=r.length-o.length;if(a>0)for(;a>0;a--)r[r.length-a].parentNode.removeChild(r[r.length-a]);o.forEach((function(e,o){if(r[o])if(i(e)===i(r[o])){var a=s(e);if(a&&a!==s(r[o])&&(r[o].textContent=a),r[o].childNodes.length>0&&e.childNodes.length<1)r[o].innerHTML="";else{if(r[o].childNodes.length<1&&e.childNodes.length>0){var l=document.createDocumentFragment();return t(e,l),void r[o].appendChild(l)}e.childNodes.length>0&&t(e,r[o])}}else r[o].parentNode.replaceChild(e.cloneNode(!0),r[o]);else n.appendChild(e.cloneNode(!0))}))},n=(i=this.template,(new DOMParser).parseFromString(i,"text/html").body);var i;t(n,this)}loadTemplate(e="",t=!1){this.template=""===e?this.template:`${e}`,this.render(t)}disconnectedCallback(){this.onDestroy?.()}}customElements.get("nb-nespresso-element")||customElements.define("nb-nespresso-element",$);const S={get is(){const{innerWidth:e,devicePixelRatio:t}=window;return{mobile:e<768,mobile_tablet:e<1024,tablet:e>=768&&e<1024,desktop:e>=1024&&t<=1,retina:e>=1024&&t>1}},lt:e=>window.innerWidth<e};function O(e,t){const n=e.parentNode;if(n===document.getElementsByTagName("body")[0])return;const i=n.children;for(const n of i)n!==e&&(t?n.setAttribute("aria-hidden",t):n.removeAttribute("aria-hidden"));O(n,t)}function T(e,t,n){t.contains(e.target)?t.lastFocused=e.target:t.lastFocused===t.firstFocusable?n?t.lastFocusable.focus():t.firstFocusable.focus():n?t.firstFocusable.focus():t.lastFocusable.focus()}function A(e){const t=e.querySelectorAll('button, [href], input, select, textarea, [tabindex="0"]');e.firstFocusable=t[0],e.lastFocusable=t[t.length-1],e.lastFocused=e.firstFocusable}class P extends HTMLElement{constructor(){super(),this.isOpen=!1,this.selected=null,this.buttonElement=null,this.onClickOutside=this.onClickOutside.bind(this)}connectedCallback(){this.props=e(this.attributes),this.render()}render(){this.buttonElement=null;const{label:e="",aa_description:t}=this.props;let{options:n}=this.props;n=n.map((e=>{const t={...e};return t.checked=t.checked||t.selected,t})),this.unbindEvent(),this.innerHTML=`\n            <button\n                class='nb-dropdown__button'\n                aria-haspopup="listbox"\n                aria-expanded="${this.isOpen}"\n                aria-label="${e} ${n&&this.renderSelected()}"\n                ${""!==t?`aria-description="${t}"`:""}>\n                    <span class="nb-dropdown__button__label t-xs-700-caps-sl">${e}</span>\n                    <span class="nb-dropdown__button__value t-xs-500-sl" value="${n&&this.renderSelected()}">\n                    </span>\n                </button>\n            <div class="nb-dropdown__menu">\n                <div role="listbox">\n                    ${n&&n.length>0&&this.renderOptions()}\n                </div>\n            </div>\n        `,this.buttonElement=this.querySelector(".nb-dropdown__button"),this.buttonElementValue=this.querySelector(".nb-dropdown__button__value"),this.dropdownMenu=this.querySelector(".nb-dropdown__menu > div"),this.selectedOption=this.querySelector("button[aria-selected=true]"),this.selected||(this.selected=n[0]),A(this.dropdownMenu),this.bindEvent()}renderOptions(){const{label:e,aa_listbox_description:t,aa_select_description:n,icon_option:i,options:s}=this.props;return s.map((s=>`<button\n                    class="${S.is.mobile?"t-sm-400-sl":"t-xs-500-sl"}"\n                    role="option"\n                    aria-label='${e+" "+s.label}'\n                    value='${s.label}'\n                    aria-selected='${s.checked}'\n                    ${s.link&&`data-link='${s.link}'`}\n                    ${s.checked?void 0!==t&&`aria-description="${t}"`:void 0!==n&&`aria-description="${n}"`}>\n                  ${i&&`<nb-icon icon='${i}'></nb-icon>`} ${s.label}\n                </button>`)).join("")}renderSelected(){const e=this.props.options.find((e=>!0===e.checked||!0===e.selected));return`${e&&e.label||this.props.options[0].label}`}bindEvent(){this.boundHandleClick=this.handleClick.bind(this),this.boundHandleLabelClick=this.handleLabelClick.bind(this),this.boundHandleMobileClose=this.handleMobileClose.bind(this),this.boundFocus=this.focus.bind(this),this.boundFocusin=this.focusin.bind(this),this.boundKeyNav=this.keyNav.bind(this),this.buttonElement.addEventListener("click",this.boundHandleClick),this.querySelectorAll(".nb-dropdown__menu button").forEach((e=>{e.addEventListener("click",this.boundHandleLabelClick)})),this.dropdownMenu.addEventListener("click",this.boundHandleMobileClose),window.addEventListener("click",this.onClickOutside)}unbindEvent(){this.buttonElement&&(this.buttonElement.removeEventListener("click",this.boundHandleClick),this.querySelectorAll(".nb-dropdown__menu button").forEach((e=>{e.removeEventListener("click",this.boundHandleLabelClick)})),this.dropdownMenu.removeEventListener("click",this.boundHandleMobileClose),window.removeEventListener("click",this.onClickOutside),document.removeEventListener("keydown",this.boundKeyNav))}handleClick(){this.toogleDropdown(!this.isOpen)}handleMobileClose(){this.toogleDropdown(!1)}onClickOutside(e){!this.isOpen||e.target.classList.contains("nb-dropdown__button")||e.target.classList.contains("nb-dropdown__button__label")||e.target.classList.contains("nb-dropdown__button__value")||this.toogleDropdown(!1)}handleLabelClick(e){this.isOpen=!1,this.selectedOption.setAttribute("aria-selected","false"),this.selectedOption=e.target,this.selectedOption.setAttribute("aria-selected","true"),this.props.options=this.props.options.map((e=>({...e,checked:!1}))),this.selected=this.props.options.find((e=>e.label===this.selectedOption.value)),this.selected.checked=!0,this.reRender(),r({eventName:"WEB_COMPONENT_SORT_BY_CHANGE",args:{options:this.props.options,selected:this.selected},element:this})}reRender(){const{label:e,aa_listbox_description:t,aa_select_description:n}=this.props;this.buttonElementValue.setAttribute("value",this.selectedOption.value),this.buttonElement.setAttribute("aria-label",e+" "+this.renderSelected()),this.dropdownMenu.querySelectorAll("button").forEach((e=>{e.setAttribute("aria-description",n)})),this.selectedOption.setAttribute("aria-description",t)}setSelected(e,t=!1){const n=this.props.options.find((t=>t.value===e));n&&(this.selected.checked=!1,this.selected=n,this.selected.checked=!0),t&&r({eventName:"WEB_COMPONENT_SORT_BY_CHANGE",args:{options:this.props.options,selected:this.selected},element:this})}toogleDropdown(e){e?this.open():this.close(),this.isOpen=!this.isOpen,this.switchAriaModal(),this.buttonElement.setAttribute("aria-expanded",this.isOpen)}switchAriaModal(){this.dropdownMenu.setAttribute("aria-modal",this.isOpen),O(this.dropdownMenu,this.isOpen)}open(){this.dropdownMenu.addEventListener("transitionend",this.boundFocus),document.addEventListener("focusin",this.boundFocusin),document.addEventListener("keydown",this.boundKeyNav),this.buttonElement.classList.add("isOpen"),this.openingSource=document.activeElement}close(){this.dropdownMenu.addEventListener("transitionend",this.boundFocus),document.removeEventListener("focusin",this.boundFocusin),document.removeEventListener("keydown",this.boundKeyNav),this.buttonElement.classList.remove("isOpen"),this.buttonElement.setAttribute("aria-expanded",!1)}focus(){this.dropdownMenu.removeEventListener("transitionend",this.boundFocus),this.isOpen?(this.selectedOption.focus(),this.dropdownMenu.lastFocused=this.selectedOption):this.buttonElement.focus()}focusin(e){T(e,this.dropdownMenu,!1)}keyNav(e){switch(e.key){case"Escape":this.toogleDropdown(!1);break;case"ArrowUp":e.preventDefault(),this.prevOption();break;case"ArrowDown":e.preventDefault(),this.nextOption();break;case"Home":case"PageUp":e.preventDefault(),this.firstOption();break;case"End":case"PageDown":e.preventDefault(),this.lastOption()}}prevOption(){if(this.dropdownMenu.lastFocused!==this.dropdownMenu.firstFocusable){const e=this.dropdownMenu.lastFocused.previousElementSibling;e.focus(),this.dropdownMenu.lastFocused=e}}nextOption(){if(this.dropdownMenu.lastFocused!==this.dropdownMenu.lastFocusable){const e=this.dropdownMenu.lastFocused.nextElementSibling;e.focus(),this.dropdownMenu.lastFocused=e}}firstOption(){this.dropdownMenu.lastFocused!==this.dropdownMenu.firstFocusable&&(this.dropdownMenu.firstFocusable.focus(),this.dropdownMenu.lastFocused=this.dropdownMenu.firstFocusable)}lastOption(){this.dropdownMenu.lastFocused!==this.dropdownMenu.lastFocusable&&(this.dropdownMenu.lastFocusable.focus(),this.dropdownMenu.lastFocused=this.dropdownMenu.lastFocusable)}disconnectedCallback(){this.unbindEvent()}}customElements.get("nb-dropdown")||customElements.define("nb-dropdown",P);class x{constructor(e,t){this.observer=new IntersectionObserver((e=>this.onChange(e)),{threshold:[0],rootMargin:"0% 0%"}),this.el=e,this.data=t,this.el instanceof Element&&this.observer.observe(this.el)}onChange(e){e.forEach((e=>{e.isIntersecting&&(this.track(e),this.observer.unobserve(e.target))}))}track(){window.requestIdleCallback((()=>this.runTrack()))}runTrack(){this.data.id&&null!==this.data.id&&""!==this.data.id&&s({ecommerce:{promoView:{promotions:[this.data]}}})}}class I extends x{constructor(e,t,n,i,s){super(e),this.data=t,this.currency=n,this.range=i,this.position=s}async runTrack(){if(!this.data)return;const e=await this.getCategories(this.data);window.impressionsOnScroll=window.impressionsOnScroll||{},window.impressionsOnScroll[this.data.internationalId]=this.buildGTMProductObject(this.data,e)}async getPLPCategory(e){return(await window.getPLPData()).data.configuration.eCommerceData.categories.find((t=>t.id===e))}async getCategoriesWithPlpData(e){const t="/machineTechno/",n=[...e.cupSizes,...e.flavors,...e.ranges,...e.technologies];return(await Promise.all(n.map((async e=>{const n=await this.getPLPCategory(e);return!n&&(e=>-1!==e.indexOf(t))(e)?(e=>e.substr(e.indexOf(t)+t.length))(e):n.name})))).join("|")}async getCategories(e){return e?window.getPLPData?this.getCategoriesWithPlpData(e):Promise.all(e.supercategories.map((e=>window.napi.catalog().getCategory(e)))).then((e=>{const t=[];for(const n of e){const e=n.code;if(!e)return;(~e.indexOf("-cupSize-")||~e.indexOf("-range-")||~e.indexOf("capsule-aromatic-")||~e.indexOf("machine-keyFeature-")||~e.indexOf("machine-color-")||~e.indexOf("accessory-collection-")||~e.indexOf("accessory-hero-month"))&&t.push(n.name.toLowerCase())}return t.join("|")})):""}buildGTMProductObject(e,t){let n;"capsule"===e.type?n="capsules":"accessory"===e.type?n="accessories":"machine"===e.type&&(n="machines");let i=null;e.technologies&&(i=e.technologies.map((e=>function(e=""){return e[0].toUpperCase()+e.slice(1)}(e.split("/")[2]))).join("|||"));let s="";null!=e.productSelections&&(s=e.productSelections.join("|"));const r={brand:"Nespresso",category:n,dimension43:"false",dimension44:"false",dimension53:e.legacyId,dimension54:b(e.name)[0].textContent,dimension55:t,dimension56:i,dimension57:this.isBundled(e)?"bundled":"single",dimension130:s,id:e.internationalId,name:b(e.internationalName)[0].textContent,price:e.price};return this.range&&(r.list=this.range),this.position&&(r.position=parseInt(this.position)),r}isBundled(e){let t=1===e.salesMultiple&&e.unitQuantity>1;return e.bundled?t=e.bundled:e.salesMultiple>1&&1===e.unitQuantity&&(t=!1),t}}class N extends HTMLElement{connectedCallback(){this.sku=(this.getAttribute("sku")||"").trim(),this.range=this.getAttribute("range"),this.position=this.getAttribute("position"),this.longSku=(this.getAttribute("longSku")||"").trim(),this.buttonSize=this.getAttribute("buttonSize")||"small",this.rendererName=this.getAttribute("rendererName")||"default",this.elementID=`u-product-${""!==this.range?this.range.replace(/(\s|\W)/g,"")+"-":""}${this.position}-${this.sku}-${this.longSku.replace(/(\s|\W)/g,"")}-${this.rendererName}`,this.render(),this.isWindowNapiActive()&&(window.napi.getConfig().then((()=>{this.pushButton()})).catch((e=>console.error(e))),this.tracking().then((()=>{})).catch((e=>console.error(e))))}render(){this.innerHTML=`<div class="cb-AddToCart" id="${this.elementID}">\n                <button class='AddToBagButtonLarge'>\n                    <span class='AddToBagButtonLarge__label'>+</span>\n                </button>\n            </div>`}isWindowNapiActive(){return!!window.napi}pushButton(){if(!document.getElementById(this.elementID))return;const e=this.buttonSize;window.ui=window.ui||[],window.ui.push({id:this.elementID,module:"AddToBagButton",configuration:{props:{productId:this.longSku,buttonSize:e}},ecommerceData:{activated:!0}})}async tracking(){if(!this.isWindowNapiActive())return new Promise.resolve;!function(e,t,n,i,s){const r=new I(e,t,n,i,s)}(this,await this.getProductData(),window[window.config.padl.namespace].dataLayer.app.app.currency,this.range,this.position)}getSkuKey(e){return-1!==e.indexOf("prod/")?"id":"legacyId"}async getProductData(){if(null!=window.getPLPData){const e=this.getSkuKey(this.sku),t=await window.getPLPData(),n=[e,"internationalId","id","legacyId"];let i=0,s=null;for(;!s&&i<n.length-1;){const e=n[i];s=t.data.configuration.eCommerceData.products.find((t=>t[e]===this.sku)),i++}return s}if(this.isWindowNapiActive())return await window.napi.catalog().getProduct(this.longSku);console.error("Error: napi is not found.")}}customElements.get("nb-add-to-cart")||customElements.define("nb-add-to-cart",N);const M=e=>[...e.querySelectorAll("[data-ref]")].reduce(B,{}),B=(e,t)=>{const{ref:n}=t.dataset,i=n.match(/(\w+)\[(.+)\]/);return null!==i?D(e,t,i):{...e,[t.dataset.ref]:t}},D=(e,t,[,n,i])=>(void 0===e[n]&&(e[n]=[]),e[n][i]=t,e);class R extends HTMLElement{constructor(){super(),this.baseClass="nb-bubble",this.boundOnSelected=this.onSelected.bind(this)}static get observedAttributes(){return["state"]}attributeChangedCallback(e){"state"===e&&this.updateState()}connectedCallback(){this.props=e(this.attributes),this.classes=this.createClasses(),this.render(),this.refs=M(this),this.bindEvent(),this.initLazyLoad()}initLazyLoad(){let{visual:{src:e="",src_retina:t=""}={}}=this.props;const{visual:n}=this.refs;S.is.retina&&t&&(e=t),n&&e&&g(n,"src",`${e}`,e)}createClasses(){const{state:e="default"}=this.props;return{base:`${this.baseClass} ${this.baseClass}--${e}`,label:this.getLabelClassName(),theme:`${this.baseClass}__theme`,visual:`${this.baseClass}__visual `,avatar:`${this.baseClass}__avatar`,outline:`${this.baseClass}__outline`}}getLabelClassName(){const{state:e="default"}=this.props,t=["selected","focus"].includes(e);return[`${this.baseClass}__label`,t?"t-xs-700-sl":"t-xs-500-sl"].join(" ")}render(){this.innerHTML=`\n            <div data-ref="button" class='${this.classes.base}'>\n                <div class='${this.classes.avatar}'>\n                    <div class='${this.classes.outline}'></div>\n                    ${this.renderBackground()}\n                    ${this.renderVisual()}\n                </div>\n                ${this.renderLabel()}\n            </div>\n        `}renderBackground(){const{theme:e="#e1dad0"}=this.props;return`\n            <div\n                class='${this.classes.theme}'\n                style='background-color: ${e};'\n            ></div>\n        `}renderVisual(){const{visual:{alt:e="",src:t=""}={}}=this.props;return`${t&&`<img class="${this.classes.visual}" src="" alt="${e}" data-ref="visual"/>`}`}renderLabel(){const{label:e}=this.props;return`${e&&`<div class="${this.classes.label}" data-ref="label">${e}</div>`}`}updateState(){if(this.refs){const{button:t,label:n}=this.refs;t.className="",n.className="",this.props=e(this.attributes),this.classes=this.createClasses(),t.className=this.classes.base,n.className=this.classes.label}}bindEvent(){window.addEventListener("EVENT_BUBBLE_SELECTED",this.boundOnSelected)}unbindEvent(){window.removeEventListener("EVENT_BUBBLE_SELECTED",this.boundOnSelected)}onSelected(e){const t=o(e),{bubble:n}=t;this.setAttribute("state",n===this?"selected":"default")}disconnectedCallback(){this.unbindEvent()}}customElements.get("nb-bubble")||customElements.define("nb-bubble",R);class H extends HTMLElement{connectedCallback(){this.props=e(this.attributes),this.render()}render(){const{name:e="",description:t=""}=this.props;this.innerHTML=`\n            ${e&&`<h2 class="h-xl-300-sl">${e}</h2>`}\n            ${t&&`<p class="t-sm-400">${t}</p>`}\n            <hr aria-hidden="true"/>\n        `}}customElements.get("nb-plp-segment")||customElements.define("nb-plp-segment",H);class F extends HTMLElement{constructor(){super(),this.props={},this.labels=[]}connectedCallback(){this.props=e(this.attributes),this.render()}render(){const{labels:e=[],direction:t="column"}=this.props;if(this.classList.add(""+("row"===t?"direction-row":"direction-"+t)),0===e.length)return"";this.labels=e,this.innerHTML=`${this.renderLabels()}`}renderLabels(){return this.labels.map((e=>{const{name:t="",bgColor:n="",color:i=""}=e;return`<mark class="t-3xs-500"\n                            ${n&&i&&`style="background: ${n}; color: ${i}"`}>\n                            <span aria-hidden="true">${t}</span>\n                            <span class="sr-only">${t}</span>\n                        </mark>`})).join("")}}customElements.get("nb-card-labels")||customElements.define("nb-card-labels",F);const z={fair_trade:"https://www.nespresso.com/shared_res/agility/commons/img/icons/fairTrade.svg",is_organic:function(){let e="https://www.nespresso.com/shared_res/agility/commons/img/icons/logo-organic-eu.svg";switch(d()){case"us":e="https://www.nespresso.com/shared_res/agility/commons/img/icons/logo-organic-us.svg";break;case"ca":e="https://www.nespresso.com/shared_res/agility/commons/img/icons/logo-organic-ca.svg";break;case"br":e="https://www.nespresso.com/shared_res/agility/commons/img/icons/logo-organic-br.svg";break;case"jp":e="https://www.nespresso.com/shared_res/agility/commons/img/icons/logo-organic-jp.svg";break;case"be":e="https://www.nespresso.com/shared_res/agility/commons/img/icons/logo-organic-be.png"}return e}(),only_vertuo_next:"https://www.nespresso.com/shared_res/agility/commons/img/icons/logo-only-vertuo-next.svg",is_q_certified_arabica:"https://www.nespresso.com/shared_res/agility/commons/img/icons/q_grade_certification_arabica.svg",is_rainforest:"https://www.nespresso.com/shared_res/agility/commons/img/icons/logo-rainforest.svg",is_sustainable:"https://www.nespresso.com/shared_res/agility/commons/img/icons/logo-sustainability.svg",is_design_award_2021:"https://www.nespresso.com/shared_res/agility/commons/img/icons/design_award_2021.svg"};function q(e){return e.find((e=>function(e){return J("cat/capsule-attribute-only-vertuo-next").test(e.id)}(e)))}function W(e){return e.find((e=>function(e){return J("capsule-attribute-organic-eu").test(e.id)}(e)))}function V(e){return e.find((e=>function(e){return J("capsule-attribute-rainforest").test(e.id)}(e)))}function j(e){return e.find((e=>function(e){return J("capsule-attribute-sustainability").test(e.id)}(e)))}function G(e){return e.find((e=>function(e){return J("capsule-attribute-arabica").test(e.id)}(e)))}function U(e){return e.filter((e=>function(e){return J("cat/capsule-range-label").test(e.id)}(e)))}function Q(e){return e.find((e=>function(e){return J("cat/capsule-attribute-highlight").test(e.id)}(e)))}function Y(e){return e.find((e=>function(e){return J("cat/capsule-range-fair-trade").test(e.id)}(e)))}function J(e){return new RegExp(e.replace(/\//g,"\\/"))}class K extends HTMLElement{constructor(){super(),this.props={}}connectedCallback(){this.props=e(this.attributes),this.render()}render(){let e,t,n,i,s,r,o,a,l,c,d,u,{direction:h="row",logos:p}=this.props;this.classList.add(""+("column"===h?"direction-column":"direction-"+h));let b=[];null==p?(e=this.props?.fair_trade,t=this.props?.alt_fair_trade,n=this.props?.is_organic,i=this.props?.alt_organic,s=this.props?.only_vertuo_next,r=this.props?.alt_vertuo_next,o=this.props?.is_rainforest,a=this.props?.alt_rainforest,l=this.props?.is_sustainable,c=this.props?.alt_sustainable,d=this.props?.is_q_certified_arabica,u=this.props?.alt_q_certification_arabica):void 0===p.length?(e=p?.fair_trade,t=p?.alt_fair_trade,n=p?.is_organic,i=p?.alt_organic,s=p?.only_vertuo_next,r=p?.alt_vertuo_next,o=p?.is_rainforest,a=p?.alt_rainforest,l=p?.is_sustainable,c=p?.alt_sustainable,d=p?.is_q_certified_arabica,u=p?.alt_q_certification_arabica):p.length&&(b=[...p]),[[e,"fair_trade",t,b],[n,"is_organic",i,b],[s,"only_vertuo_next",r,b],[o,"is_rainforest",a,b],[l,"is_sustainable",c,b],[d,"is_q_certified_arabica",u,b]].map((e=>this.appendLogo.apply(this,e))),this.innerHTML=b.map((e=>`<img src="${z[e.name]}" alt="${e.alt}" loading="lazy">`)).join("")}appendLogo(e,t,n,i){e&&!this.hasLogo(i,t)&&i.push({name:t,alt:n})}hasLogo(e,t){return e.some((e=>e.name===t))}}customElements.get("nb-card-logos")||customElements.define("nb-card-logos",K);class X extends HTMLElement{constructor(){super(),this.props={},this.level="",this.levelPlus=""}connectedCallback(){this.props=e(this.attributes),this.render()}render(){const{a11y_label:e,level:t}=this.props;if(""===e||""===t)return"";switch(this.classList.add(`level_${t}`),t){case"g":this.level="G";break;case"f":this.level="F";break;case"e":this.level="E";break;case"d":this.level="D";break;case"c":this.level="C";break;case"b":this.level="B";break;case"a4":this.level="A";break;case"a3":this.level="A",this.levelPlus="+";break;case"a2":this.level="A",this.levelPlus="++";break;default:this.level="A",this.levelPlus="+++"}this.innerHTML=`\n            <mark aria-label='${e} ${this.level}${this.levelPlus}'>\n                ${this.level}\n                ${""!==this.levelPlus?`<sup>${this.levelPlus}</sup>`:""}\n            </mark>\n        `}}customElements.get("nb-energy-label")||customElements.define("nb-energy-label",X);class Z extends HTMLElement{constructor(){super(),this.props={}}connectedCallback(){this.props=e(this.attributes),this.render()}render(){const{intensity_label:e="Intensity",a11y_intensity_max:t,max_intensity:n}=this.props,i=parseInt(this.props.intensity);if(!i||isNaN(i))return"";const s=t.replace("{max_intensity}",n);this.innerHTML=`\n            <div aria-label="${e} ${i} ${s}">\n                ${e}${this.renderIntensityMin(i)}\n                ${i}\n                ${this.renderIntensityMax(i)}\n            </div>\n        `}renderIntensityMin(e){return new Array(Math.max(e,0)-0).fill('<span class="bar filled"></span>').join("")}renderIntensityMax(e){let{max_intensity:t}=this.props;return t&&"undefined"!==t||(t=14),new Array(parseInt(t)-Math.min(e,parseInt(t))).fill('<span class="bar"></span>').join("")}}customElements.get("nb-intensity")||customElements.define("nb-intensity",Z);let ee,te="";const ne=e=>{ie(e),e.bundlePopIn=document.getElementById("bundle-popin-id"),e.appendChild(e.bundlePopIn),w(e.bundlePopIn,{variation:"before",bgcolor:"white",size:"L",padding:"false",label_close:ee,content:te}),e.bundlePopIn.classList.add("nb-popin--bundle"),r({eventName:a,args:{id:"bundle-popin-id"}})},ie=e=>{if(null!=document.getElementById("bundle-popin-id"))return;let t=document.createElement("nb-popin");t=e.appendChild(t),t.setAttribute("id","bundle-popin-id"),t.setAttribute("content","")};function se({icon:e,text:t}){return`<nb-icon-text data="${v({icon:e,label:t,classname:"t-xs-500"})}"></nb-icon-text>`}const re=({price:e,giftcard_price:t,type:n,hidePrice:i})=>!e||"giftcard"===n&&!t||i?"":`<p class="cn_card__priceWrapper--current"><span>${e}</span></p>`;function oe(e){return e.sales_multiple=e.sales_multiple||e.salesMultiple,!(e.sales_multiple>1&&1===e.unitQuantity)&&(1===e.sales_multiple&&e.unitQuantity>1)}const ae=async e=>{const t=await(async()=>await window.napi.priceFormat())(),n=window[window.config.padl.namespace].dataLayer.app.app.currency;return t.html?t.html(n,e):t.short(n,e)||""},le=e=>{const{sales_multiple:t,label_sleeve:n,label_sleeves:i,show_sleeve:s=!1,sleeve_syntax:r="{numberOfSleeves} {sleeveLabel} ({quantity} {label_capsules})",number_of_sleeves:o,label_capsules:a,type:l,bundled:c,unit_quantity:d,unitQuantity:u}=e,h=o,p=h>1&&i?i:n,b=!1===c?t:d||u||0;let _;return s&&"capsule"===l&&h&&n&&a?(_=r,`<p class="cn_card__priceWrapper--items showSleeve">${f(_,{numberOfSleeves:h,sleeveLabel:p,quantity:b,label_capsules:a,label_sleeve:n},"{","}")}</p>`):""};async function ce(e){const{in_stock:t,strikethrough_price:n,hide_add_to_cart:i=!1}=e,s=null!=t&&!t;return!0===i?"":`\n        <div class="cn_card__priceWrapper">\n            <div class="cn_card__priceInnerWrapper">\n                ${n?await(async e=>e?`<p class="cn_card__strikethroughPrice">${await ae(e)}</p>`:"")(n):""}\n                ${re(e)}\n                ${s?"":le(e)}\n                ${s?"":(e=>{const{show_capsule_price:t=!1,price_per_capsule:n,capsule_price_label:i,capsule_price_syntax:s="{capsule_price_label}: {price_per_capsule}"}=e;return t?`<p class="cn_card__priceWrapper--items capsulePrice">${f(s,{capsule_price_label:i,price_per_capsule:n},"{","}")}</p>`:""})(e)}\n                ${(({type:e,price:t,price_per_capsule:n,a11y_price:i="euros per sleeve",a11y_capsule_price:s="Capsule price",sleeve_variation_pdp:r="false"})=>`<span class="sr-only">\n      ${"true"===r?"capsule"===e?`${s}: ${n}`:"":`${t} ${i}`}\n    </span>`)(e)}\n                ${s?(e=>{const{label_outofstock:t}=e.shop_similar;return""===t?"":`<p class="cn_card__priceWrapper--items t-xs-500-sl">${t}</p>`})(e):""}\n            </div>\n            ${(e=>{const{category_name:t="",type:n,sku:i,longSku:s="",position:r,giftcard_price:o,variation:a="plp",quantity_selector:l,hidePrice:c,url:d,view_details_label:u="View details"}=e;let h="large";if("plp"===a&&(h=S.is.mobile?"small":"large"),"giftcard"===n&&o)return`<nb-add-gift-card data="${v({price:o,sku:i,add_to_cart:h,quantity_selector:l})}"></nb-add-gift-card>`;return c?`<nb-cta link="${d}" variation="primary">${u}</nb-cta>`:`\n        <nb-add-to-cart\n            sku="${i}"\n            longSku="${s}"\n            buttonSize="${h}"\n            showPrice\n            range='${t}'\n            position='${r}'\n        ></nb-add-to-cart>\n    `})(e)}\n        </div>`}class de{constructor(e){this._carousel=e,this._carousel._container.addEventListener("dragstart",(e=>e.preventDefault())),this._carousel._container.addEventListener("touchstart",(e=>this.startDrag(e)),{passive:!0}),this._carousel._container.addEventListener("mousedown",(e=>this.startDrag(e))),this._carousel._container.addEventListener("touchstart",(e=>this.startDrag(e)),{passive:!0}),window.addEventListener("mousemove",(e=>this.drag(e)),{passive:!1}),window.addEventListener("touchmove",(e=>this.drag(e)),{passive:!1}),window.addEventListener("mouseup",(()=>this.endDrag())),window.addEventListener("touchend",(()=>this.endDrag())),window.addEventListener("touchcancel",(()=>this.endDrag())),this.translateFactor=150}startDrag(e){e.touches&&e.touches.length>1||(e.touches&&(e=e.touches[0]),this._origin={x:e.screenX,y:e.screenY},this._width=this._carousel.containerWidth)}drag(e){if(!this._origin)return;const t=e.touches?e.touches[0]:e,n={x:t.screenX-this._origin.x,y:t.screenY-this._origin.y};this._lastTranslate=n;const i=this._carousel._currentIndex*this._carousel._widthSlide-this.translateFactor*n.x/this._width;this._carousel.translate(i)}preventMobileYTranslate(e,t){e.touches&&(e.touches&&Math.abs(t.x)>Math.abs(t.y)||e.touches&&Math.abs(t.y)>Math.abs(t.x))&&(e.preventDefault(),e.stopPropagation())}endDrag(){if(!this._origin||!this._lastTranslate)return this._origin=null,void(this._lastTranslate=null);const e=this._lastTranslate.x/this._carousel.carouselWidth;if(Math.abs(e)>.1){const e=this._lastTranslate.x<0?"next":"prev";this._carousel[e]()}else this._carousel.goToItem(this._carousel._currentIndex);this._origin=null,this._lastTranslate=null}}class ue{constructor(e){this._carousel=e,new MutationObserver((e=>{e.forEach((function(e){if(!e||!e.oldValue||!e.classList)return;const t=e.classList.contains("has-overlay-absolute"),n=document.body.classList.contains("has-overlay");t&&!n&&this._carousel.goToItem(this._carousel._currentIndex)}))})).observe(document.body,{attributes:!0,attributeFilter:["class"],attributeOldValue:!0})}}class he{constructor(e,t={}){this._element=e,this._slides=[].slice.call(e.children);const n=t.index||0;this._options=Object.assign({},{slidesToScroll:1,slidesVisible:1,spaceBetween:0,navigationButton:!0,loop:!0,pagination:!0,hookGetRightBoundary:null,hookSlideChange:null,hookMove:null,hookNext:null,hookPrevious:null,pagination_variation:null,nav_centered:!1},t),this.moveCallbacks=[],this._ratio=this._slides.length/this._options.slidesVisible,this.buildIHM(),new ue(this),this.hasPagination()&&(new de(this),this.goToItem(n))}get element(){return this._element}get slidesToScroll(){return this._options.slidesToScroll}get slidesVisible(){return this._options.slidesVisible}get slidesTotal(){return this._slides.length}get navigationButton(){return this._options.navigationButton}get navigationVariation(){return this._options.navigation_variation}get navigationSize(){return this._options.navigation_size}get loop(){return this._options.loop}get pagination(){return this._options.pagination}get containerWidth(){return this._container.offsetWidth}get carouselWidth(){return this._root.offsetWidth}get wrapperWidth(){return this._wrapper.offsetWidth}get paginationVariation(){return this._options.pagination_variation}get nav_centered(){return this._options.nav_centered}getSlideWidth(e){const{slidesVisible:t,spaceBetween:n}=this._options;return(e+parseInt(n))/t}buildIHM(){this._root=this.createElement("div","carousel"),this._container=this.createElement("div","container"),this._wrapper=this.createElement("div","wrapper"),this._children=this._slides.map((e=>{const t=this.createElement("div","item");return t.appendChild(e),this._container.appendChild(t),t})),this._wrapper.appendChild(this._container),this._root.appendChild(this._wrapper),this._element.appendChild(this._root),this.setWrapperStyle(),this.hasPagination()&&(this.navigationButton&&this.createNavigation(),this.pagination&&this.createPagination())}setWrapperStyle(){const e=this.wrapperWidth,t=this.getSlideWidth(e),n=t*this._children.length;this.setContainerWidth(n),this.setWrapperWidth(e);for(const e of this._children)this.setSlideWidth(e,t);this._widthContainer=n,this._widthSlide=t,this._widthWrapper=e}setSlideWidth(e,t){e.style.width=t-this._options.spaceBetween+"px",this._options.spaceBetween&&(e.style.marginRight=`${this._options.spaceBetween}px`)}setContainerWidth(e){this._container.style.width=`${e}px`}setWrapperWidth(e){this._wrapper.style.width=`${e}px`}disableTransition(){this._container.style.transition="none"}enableTransition(){this._container.style.transition=""}translate(e){this._container.style.left=-e+"px"}createElement(e,t){let n=document.createElement(e);return n.setAttribute("class",t),n}createNavigation(){const e=this.createElement("nb-cta","prev");e.setAttribute("variation","navigation"),e.setAttribute("contrast",this.navigationVariation),e.setAttribute("size",this.navigationSize),e.setAttribute("icon_right","chevron-left"),e.setAttribute("label","a11y_slider_previous_button");const t=this.createElement("nb-cta","next");t.setAttribute("variation","navigation"),t.setAttribute("contrast",this.navigationVariation),t.setAttribute("size",this.navigationSize),t.setAttribute("icon_right","chevron-right"),t.setAttribute("label","a11y_slider_next_button"),t.addEventListener("click",(()=>this.next())),e.addEventListener("click",(()=>this.prev())),t.addEventListener("keydown",(e=>"Enter"===e.key||"Space"===e.key?this.next():null)),e.addEventListener("keydown",(e=>"Enter"===e.key||"Space"===e.key?this.prev():null));let n=this._root.parentElement;n.appendChild(e),n.appendChild(t),this.onMove((n=>{const i=n._currentIndex+this.slidesVisible;this.loop||(n._currentIndex<=0?e.classList.add("hidden"):e.classList.remove("hidden"),this._slides.length===i?t.classList.add("hidden"):t.classList.remove("hidden"),this._options.hookMove&&this._options.hookMove(t))}))}getSlideNotVisible(){return this._children.length-(this.slidesVisible-1)}hasPagination(){return this.getSlideNotVisible()>1}createPaginationBullets(){const e=document.createElement("nav"),t=[];for(let n=0;n<this.getSlideNotVisible();n+=this.slidesToScroll){let i=document.createElement("span");i.innerText=(n+1).toString();let s=document.createElement("button");s.addEventListener("click",(()=>this.goToItem(n))),s.appendChild(i),e.appendChild(s),t.push(s)}const n=e=>{let n=t[e/this.slidesToScroll];n&&(t.forEach((e=>e.classList.remove("active"))),n.classList.add("active"))};n(this._currentIndex),this.onMove((()=>n(this._currentIndex))),this._root.parentElement.parentElement.appendChild(e)}createPaginationStepper(){const e=document.createElement("nav");let t=document.createElement("div");t.innerText=this.slidesTotal-this.slidesVisible+1,t.classList.add("totalPages");let n=document.createElement("div");n.innerText="/";let i=document.createElement("div");i.classList.add("currentPage"),e.appendChild(i),e.appendChild(n),e.appendChild(t),this.onMove((()=>i.innerText=this._currentIndex+1)),this.onMove((()=>e.setAttribute("aria-label",i.innerText+" "+n.innerHTML+" "+t.innerHTML))),this._root.parentElement.parentElement.appendChild(e)}createPagination(){this.slidesTotal<=5?this.createPaginationBullets():"stepper"===this.paginationVariation?(this.createPaginationStepper(),console.info("paginationVariation >> enabled")):(this.createPaginationBullets(),console.info("bullets enabled"))}next(){let e=this._currentIndex+this.slidesToScroll;this._options.hookNext&&(e=this._options.hookNext(e)),this.goToItem(e)}prev(){let e=this._currentIndex-this.slidesToScroll;this._options.hookPrevious&&(e=this._options.hookPrevious(e)),this.goToItem(e)}goToItem(e){this.hackUi();const t=this.getOverflowingIndex(e);let n=t*this._widthSlide;this._options.hookSlideChange&&(n=this._options.hookSlideChange(t,n)),this.translate(n),this._currentIndex=t,this.indexHasChange()}hackUi(){const e=document.querySelector("html");!e.classList.contains("has-overlay-absolute")&&e.classList.contains("has-overlay")}getOverflowingIndex(e){const t=this.getLeftBoundary(e),n=this.getRightBoundary(e),i=this._children.length-this._options.slidesVisible;return t?this.loop?i:0:n?this.loop?0:i:e}getLeftBoundary(e){return e<0}getRightBoundary(e){const t=e>=this._children.length,n=this.currentIndex+this.slidesVisible,i=void 0!==this._children[n],s=e>this.currentIndex;let r=t||s&&!i;return this._options.hookGetRightBoundary&&(r=this._options.hookGetRightBoundary(r,e)),r}_getMaxSlideWidth(e){return e.reduce(((e,t)=>Math.max(e,t.offsetWidth)),0)}onSlideChange(e){this.onMove(e)}onMove(e){this.moveCallbacks.push(e)}indexHasChange(){this.moveCallbacks.forEach((e=>e(this))),this.activateItems()}activateItems(){const e=this._currentIndex+this.slidesVisible;this._slides.map(((t,n)=>{t.classList.remove("active"),t.parentElement.classList.remove("activeParent"),n>=this._currentIndex&&n<e&&(t.classList.add("active"),t.parentElement.classList.add("activeParent"))}))}setClass(e){this._element.classList.add(e)}unsetClass(e){this._element.classList.remove(e)}get currentIndex(){return this._currentIndex}}class pe extends HTMLElement{constructor(){super(),this._slider=null,this.randomId="slider_"+_(5)}static get observedAttributes(){return["slides_to_scroll","slides_visible","pagination","pagination_variation","nav_centered"]}connectedCallback(){this.slot=this.innerHTML,this.props=e(this.attributes),this.render()}createProps(){return[...this.attributes].reduce(((e,t)=>({...e,[t.nodeName]:t.nodeValue})),{})}render(){this.innerHTML=`<div class="slider ${this.randomId}">${this.slot}</div>`,this.loadSlider()}loadSlider(){const{indexSlider:e=0,slides_loop:t="true",slides_visible:n=4,slides_to_scroll:i=1,navigation:s="true",pagination:r="true",space_between:o=0,navigation_variation:a="dark",navigation_size:l="48",pagination_variation:c="stepper",nav_centered:d="false"}=this.props,u=this.querySelector(`.${this.randomId}`),h={index:parseInt(e),slidesToScroll:parseInt(i),slidesVisible:parseInt(n),spaceBetween:o,loop:"true"===t,navigationButton:"true"===s,pagination:"true"===r,navigation_variation:a,navigation_size:l,pagination_variation:c,nav_centered:d};this._slider=new he(u,h),this._slider.setClass("first"),this._slider.onSlideChange(this.handleClick.bind(this))}handleClick(){r({eventName:"WEB_COMPONENT_SLIDE_CHANGE"}),this.toggleClasses(),n({rootElement:["nb-slider"]})}toggleClasses(){const e=0===this._slider.currentIndex,t=this._slider.slidesTotal===this._slider.currentIndex+this._slider.slidesVisible;this._slider.unsetClass("last"),this._slider.unsetClass("first"),e?this._slider.setClass("first"):t&&this._slider.setClass("last")}}customElements.get("nb-slider")||customElements.define("nb-slider",pe);class be extends HTMLElement{constructor(){super(),this.props={}}connectedCallback(){this.props=e(this.attributes),this.render()}render(){const{slides:e,image_alt_text:t}=this.props;let n=document.createElement("nb-slider");w(n,{slides_to_scroll:"1",slides_visible:"1",navigation:"true",navigation_variation:"highlight",navigation_size:"32",pagination:"true"});let i=document.createElement("nb-loader");w(i,{icon:"loading"}),this.appendChild(i);e.forEach((e=>{const i=`${e.url}?impolicy=product&imwidth=600`;let s=document.createElement("img");s.setAttribute("alt",t),s.setAttribute("title",t),s.setAttribute("data-src",i),n.appendChild(s)})),this.appendChild(n),e.forEach((e=>{const t=`${e.url}?impolicy=product&imwidth=600`;g(n.querySelector(`img[data-src="${t}"]`),"src",t,t)}))}}customElements.get("nb-product-card-image-slider")||customElements.define("nb-product-card-image-slider",be);function _e({type:e,show_slider:t,slides:n,image:i,image_alt_text:s,plp_type:r},o){if(void 0===i||""===i||"pdp"===r)return"";const a=!o.is.mobile&&t&&n&&n.length>1;return("machine"===e||"machine"===r)&&a?function(e,t){return!e||e.length<=0?"":`<div class="cn_card__image">\n                <nb-product-card-image-slider\n                    data='${v({slides:e})}'\n                    image_alt_text=${t}>\n                </nb-product-card-image-slider>\n            </div>`}(n,s):function(e,t,n){return e?`<div class="cn_card__image">\n            ${n?`<a href="${n}" target="_self" aria-hidden="true" tabindex="-1">`:""}\n                <img class="cn_card__image__single" src=${e} alt="${t}"/>\n            ${n?"</a>":""}\n            </div>`:""}(i,s)}class ge extends HTMLElement{async connectedCallback(){this.props=e(this.attributes),this.boundOnPDPLinkClick=this.onPDPLinkClick.bind(this),this.boundOnColorClick=this.onColorClick.bind(this),await this.render(),((e,t)=>{const{image:n=""}=e,i=t.querySelector("img.cn_card__image__single"),s="?impolicy=product&imwidth=150";i&&g(i,"src",`${n+s}`,n+s)})(this.props,this)}async render(){const{additional_message_icon:e,additional_message:t,category_name:n="",giftcard_price:i,hide_header:s,image:r,label_technology:o,label_range:a,labels:l=[],plp_type:c,position:d,rating_enabled:u=!1,show_ratings:h=!1,sku:p,src_page:b,type:_}=this.props;if("giftcard"===_&&!i)return null;!s&&r||this.classList.add("hide-header"),l.length&&this.classList.add("has-labels"),this.innerHTML=`\n            ${_e(this.props,S)}\n            ${(({labels:e=[]})=>0===e.length?"":`<nb-card-labels data='${v({labels:e})}' direction="${S.is.mobile?"row":"column"}"></nb-card-labels>`)(this.props)}\n            ${((e,t)=>{const{fair_trade:n,alt_fair_trade:i,is_organic:s,alt_organic:r,only_vertuo_next:o,alt_vertuo_next:a,is_rainforest:l,alt_rainforest:c,is_sustainable:d,alt_sustainable:u,is_q_certified_arabica:h,alt_q_certification_arabica:p,logos:b}=e;return n||s||o||l||d||h||!(null==b||b.length<1)?(t.classList.add("has-logos"),`<nb-card-logos data='${v({fair_trade:n,alt_fair_trade:i,is_organic:s,alt_organic:r,only_vertuo_next:o,alt_vertuo_next:a,is_rainforest:l,alt_rainforest:c,is_sustainable:d,alt_sustainable:u,is_q_certified_arabica:h,alt_q_certification_arabica:p,logos:b})}'></nb-card-logos>`):""})(this.props,this)}\n            ${(({a11y_energy_label:e,energy_level:t})=>t?`<nb-energy-label data='${v({a11y_label:e,level:t})}'></nb-energy-label>`:"")(this.props)}\n            <div class="cn_card__content">\n                ${function(e){return e?`<p class="cn_card__technology t-xs-700">${e}</p>`:""}(o)}\n                ${function(e){return e?`<p class="cn_card__range t-xs-500">${e}</p>`:""}(a)}\n\n                ${(({url:e,a11y_product_card:t="",name:n="",label_decaffeinato:i,src_page:s=""},r)=>{const o=new RegExp(i,"ig"),a=i&&""!==i&&o.test(n);t=t.replace("{productName}",n),a?n=n.replace(o,"").trim():i="";const l="pdp"===s?"h1":"h3";return`${e?`<${l} class='cn_card__title'><a href="${e}" target="_self" title="${t}" aria-label="${t}">`:`<${l} class='cn_card__title'>`}\n${n}\n${i?`<span class='${r.is.mobile?"t-xs-700-caps":"t-sm-700-caps"}'>${i}</span>`:""}\n${e?`</a></${l}>`:`</${l}>`}`})(this.props,S)}\n                ${h&&u?'<div class="cn_card__rating"><nb-loader></nb-loader></div>':""}\n\n                ${function({headline:e="",is_headline_hidden:t=!1}){return""===e||t&&S.is.mobile?"":`<p class="cn_card__text">${e}</p>`}(this.props)}\n\n                ${"machine"===_?(({colors:e,sku:t,max_colors:n=4,a11y_extra_color:i="",url:s,activeSku:r,name:o})=>e?`<nb-colors data="${v({colors:e,max_colors:n,activeSku:r||t,extra_url:s,extra_title:o+", "+i})}" size="${S.is.mobile?"small":"large"}"></nb-colors>`:"")(this.props):""}\n                ${"machine"===_?function({features:e=[]}){return 0===e.length?"":`<div class="cn_card__features">${e.map(se).join("")}</div>`}(this.props):""}\n\n                ${"capsule"===_?(({type:e,bundle_details:t,bundled:n,sku:i,position:s,range:r},o)=>"capsule"===e&&t&&t.popin_link_text&&!0===n?(te=`<nb-bundle-details\n                main_sku='${i}'\n                description='${t.description}'\n                other_skus='${t.other_skus}'\n                other_skus_quantity= '${t.other_skus_quantity}'\n                range='${r}'\n                position='${s}'>\n            </nb-bundle-details>`,o.variation="white",ee=t.popin_label_close,`<nb-link class="cn_card__cta__bundle" size="large" color="gold" label="${t.popin_link_text}"></nb-link>`):"")(this.props,this):""}\n                ${"capsule"===_?(({intensity:e,a11y_intensity_max:t,intensity_label:n=""})=>0===e||isNaN(parseInt(e))?"":`<nb-intensity\n        class="t-xs-500-sl"\n        intensity="${e}"\n        a11y_intensity_max="${t}"\n        intensity_label="${n}">\n    </nb-intensity>`)(this.props):""}\n\n                ${await ce(this.props)}\n\n                ${"machine"===_?function(e){const{popin_id:t,subscription:n,view_details_label:i="View details"}=e;return void 0===n?"":`\n        <div class="cn_card__subscriptionWrapper">\n            ${re(e)}\n            <p class="t-sm-400">${n.text}</p>\n            <nb-cta class="cn_card__viewDetails" popin_id="${t}" variation="primary">${i}</nb-cta>\n        </div>\n        <nb-popin\n            id="${t}"\n            variation="before"\n            bgcolor="highlight"\n            size="L"\n            padding="false"\n            label_close="Close"\n            content="<nb-machine-details data='${v(e)}' />">\n        </nb-popin>\n    `}(this.props):""}\n\n                ${function(e,t){return t?`<p class="cn_card__additionalMessage t-sm-500-sl">\n        <nb-icon\n            icon="${e}"\n            class="additionalMsgIcon"\n        ></nb-icon> ${t}</p>`:""}(e,t)}\n            </div>\n        `,w(this,{"data-product-item-id":p,"data-product-section":n,"data-product-position":d,"data-src-page":b,"data-plp-type":c}),((e,t)=>{const{src_page:n,plp_type:i}=e;"plp"===n?"coffee"===i&&S.is.mobile?t.setAttribute("theme","landscape"):t.setAttribute("theme","portrait"):t.setAttribute("theme","pdp")})(this.props,this),this.bundlePopinLink=this.querySelector(".cn_card__cta__bundle button"),this.classList.add("cn_card"),this.bindEvent(),h&&u&&(({sku:e,minimum_rating:t=0},n)=>{if(!window.napi.ratings)return"";window.napi.ratings().summary(e).then((e=>e&&e.ratingAverage>0&&e.ratingAverage>t?e:"")).then((e=>e?{stars:e?parseFloat(e.ratingAverage.toFixed(2)):0}:"")).then((e=>{if(e){const t=document.createElement("nb-rating");t.setAttribute("stars",e?e.stars:0),n.querySelector("nb-loader").replaceWith(t)}else n.querySelector("nb-loader").remove()}))})(this.props,this.querySelector(".cn_card__rating"))}async onPDPLinkClick(){window.napi.data().product().setProductClickData(await window.productHelper.getPadlProductDetail(await window.napi.catalog().getProduct(this.props.lonGgSku)))}onColorClick(e){const t=o(e);var n;t.sku&&(this.template="<nb-loader></nb-loader>",this.render(),(n=t.sku,window.napi.catalog().getProduct(n)).then((e=>{e&&(this.props={...this.props,sku:e.internationalId||"",longSku:e.id||"",image:e.images?.icon||"",image_alt_text:e.name||"",price:e.price,activeSku:e.internationalId||""})})).catch((()=>{console.error(`getProduct fail on sku ${t.sku}`)})))}bindEvent(){this.linkElements=[],this.unbindEvent(),this.linkElements=this.querySelectorAll("a[href]"),this.addEventListener("EVENT_COLOR_CLICKED",this.boundOnColorClick),this.linkElements.length&&Array.from(this.linkElements).forEach((e=>{e.addEventListener("click",this.boundOnPDPLinkClick)})),this.bundlePopinLink&&(this.boundBundlePopinLinkClick=ne.bind(null,this),this.bundlePopinLink.addEventListener("click",this.boundBundlePopinLinkClick))}unbindEvent(){this.removeEventListener("EVENT_COLOR_CLICKED",this.boundOnColorClick),this.linkElements?.length&&(Array.from(this.linkElements).forEach((e=>{e.removeEventListener("click",this.boundOnPDPLinkClick)})),this.linkElements=[]),this.bundlePopinLink&&this.bundlePopinLink.removeEventListener("click",this.boundBundlePopinLinkClick)}disconnectedCallback(){this.unbindEvent()}}customElements.get("nb-plp-product-card")||customElements.define("nb-plp-product-card",ge);class me extends class{constructor(){this.observers=new Set}addObserver(e){this.observers.add(e)}removeObserver(e){this.observers.delete(e)}notify(e){this.observers.size>0&&this.observers.forEach((t=>t.update(e)))}}{constructor(e){super(),this.state=e}update(e){this.state=e,this.notify(this.state)}get(){return this.state}}async function fe(){window.getPLPData=window.getPLPData||ve}async function ve(){return await window.plpData}async function ye(){return napi.market().read()}async function we(){return napi.priceFormat()}const ke="intensity",Ee="type",Ce="color",Le="price",$e="recommended",Se={lightMax:5,mildMin:6,mildMax:8,intenseMin:9};let Oe,Te,Ae,Pe,xe,Ie,Ne,Me,Be,De,Re,He,Fe=$e;async function ze(){await fe();const e=await window.getPLPData();Be=e.data.configuration.eCommerceData.products,De=e.data.configuration.eCommerceData.categories,Re=e.data.configuration.props,Me=e.data.configuration.translations,Ne={sortPriceAscending:tt,sortPriceDescending:nt,sortIntensityAscending:it,sortIntensityDescending:st},Oe=function(){const{cupSizeFiltersCategory:e,aromaticFiltersCategory:t,colorFiltersCategory:n,typeFiltersCategory:i,collectionFiltersCategory:s,priceFilterMinValue:r}=Re,o={};e&&(o.cupsize=e);t&&(o.aromatic=t);n&&(o.color=n);i&&(o.type=i);s&&(o.collection=s);r&&(o.price=Le);null==n&&null==s&&(o.intensity=ke);return o}();const t=function(){const e={};for(const t in Oe)e[t]=new Set;const t=De;Be.forEach((t=>{Object.keys(e).forEach((n=>{const i=bt(t,n);n===ke&&0===i||(Array.isArray(i)?i.forEach((t=>{var i,s;n===Ce&&(i=e[n],s=t,Array.from(i).some((e=>e.name===s.name)))||e[n].add(t)})):e[n].add(i))}))}));const n=e=>De.findIndex((t=>t.id===e)),i=(e,t)=>n(e)-n(t),s={[ke]:(e,t)=>e-t,cupsize:i,aromatic:i,[Ce]:(e,t)=>e.name-t.name,[Le]:(e,t)=>e-t,collection:i,[Ee]:i},r={};for(const n in e){e[n]=Array.from(e[n]),e[n].sort(s[n]),r[n]={};for(let i of e[n]){const e=lt(n,i);r[n][e]=rt(t,n,i)}}return{filterValues:e,filterData:r}}();Te=t.filterValues,Ae=t.filterData,Pe=function(){const e={};for(const t in Te){const n={};for(const e of Te[t]){n[lt(t,e)]=new me(!1)}e[t]=n}return e}(),xe=function(){const e={};for(const t in Te){const n={};for(const e of Te[t]){n[lt(t,e)]=new me(!1)}e[t]=n}return e}(),yt(),null!=window.filteredProducts&&Ve(),window.addEventListener("hashchange",yt),gt()}function qe(e,t){return xe[e][lt(e,t)]}function We(){for(const e in et)for(const t of et[e].values())et[e].delete(t),t.enabled=!1;gt()}function Ve(){window.dispatchEvent(_t("filteredProductDisplay")),mt()}function je(e,t){Array.isArray(e)?e.filter((e=>Te.intensity)).forEach((e=>ht(ke,e,t))):ht(ke,e,t),gt()}function Ge(e,t){ht("cupsize",e,t),gt()}function Ue(e,t){ht("collection",e,t),gt()}function Qe(e,t){ht(Ee,e,t),gt()}function Ye(e,t){ht("aromatic",e,t),gt()}function Je(e,t){const n=Te.color.find((t=>t.name===e));null!=n&&(ht(Ce,n,t),gt())}function Ke(e,t){ht(Le,e,t),gt()}function Xe(e){Fe=Fe===e?$e:e,gt(),Ve(),mt(!0)}function Ze(){return function(e){const t=document.querySelector("nb-plp-filter");if(null===t)return;const{filter_group_intensity_light_max_label:n,filter_group_intensity_mild_min_label:i,filter_group_intensity_mild_max_label:s,filter_group_intensity_intense_min_label:r}=t.getAttribute("data-response")?JSON.parse(t.getAttribute("data-response")):Se;return[[e[0],n],[i,s],[r,e[1]]]}([Te.intensity[0],Te.intensity[Te.intensity.length-1]])}const et={[ke]:new Set,cupsize:new Set,aromatic:new Set,[Ce]:new Set,[Le]:new Set,collection:new Set,[Ee]:new Set};function tt(e,t){return e.price-t.price}function nt(e,t){return t.price-e.price}function it(e,t){return e.intensity-t.intensity}function st(e,t){return t.intensity-e.intensity}function rt(e,t,n){return t===ke||t===Ce||t===Le?n:e.find((e=>e.id===n))}const ot={};function at(e,t){return!!(ot[e]&&ot[e][t]&&ot[e][t].enabled)}function lt(e,t){return e===Ce?t.name:t}function ct(e){const t={};for(const n in e)t[n]=ut(n);return t}function dt(){const e=function(){const e=JSON.parse(JSON.stringify(Te));for(const t in e){const n={};for(const i of e[t])n[lt(t,i)]=!1;e[t]=n}return e}(),t=ct(e);He.length>0?He.forEach((n=>{Object.entries(Te).forEach((([i,s])=>{s.forEach((s=>{const r=pt(i,s,!0)(n),o=lt(i,s);e[i][o]=e[i][o]||(t[i],r)}))}))})):Object.entries(Te).forEach((([n,i])=>{i.forEach((i=>e[n][lt(n,i)]=t[n]))}));for(const t in e)for(const n in e[t])e[t][n]!==xe[t][n].get()&&xe[t][n].update(e[t][n])}function ut(e){return Object.values(Pe[e]).some((e=>e.get()))}function ht(e,t,n=null){e===Ce&&"string"==typeof t&&(t=Te.color.find((e=>e.name===t)));const i=pt(e,t,!0);null==n&&(n=!i.enabled),n?(et[e].add(i),i.enabled=!0):(et[e].delete(i),i.enabled=!1)}function pt(e,t,n=!1){const i=lt(e,t);return null!=ot[e]&&null!=ot[e][i]?ot[e][i]:(null==ot[e]&&(ot[e]={}),ot[e][i]=i=>function(e,t,n){switch(e){case ke:return e=>e===t||0===e&&!n;case"cupsize":return e=>e.some((e=>new RegExp(t+"$","g").test(e)));case"aromatic":return e=>e.some((e=>new RegExp(t+"$","g").test(e)));case Ce:return e=>e.some((e=>e.name===t.name));case Le:return e=>e===t;case"collection":return e=>e.some((e=>new RegExp(t+"$","g").test(e)));case Ee:return e=>e.some((e=>new RegExp(t+"$","g").test(e)))}}(e,t,n)(bt(i,e)))}function bt(e,t){switch(t){case ke:return e.intensity;case"cupsize":return e.cupSizes;case"aromatic":return e.flavors;case Ce:return e.colors;case Le:return e.price;case"collection":return e.collections;case Ee:return e.types}}function _t(e){let t;return"function"==typeof Event?t=new Event(e):(t=document.createEvent("Event"),t.initEvent(e,!0,!0)),t}function gt(e=!0){He=Be.filter((e=>Object.values(et).every((t=>function(e,t){return 0===t.size||Array.from(t).some((t=>t(e)))}(e,t))))),function(){for(const e in Pe)for(const t in Pe[e]){const n=at(e,t);Pe[e][t].get()!==n&&Pe[e][t].update(n)}}(),dt(),e&&(Ie=new URLSearchParams(ft()).toString()),Fe!==$e&&(He=He.sort(Ne[Fe])),window.filteredProducts=He.length===Be.length&&Fe===$e?null:He,window.dispatchEvent(_t("filteredProductUpdate"))}function mt(e){const t=function(){let e=[];const t=ft();for(const n in t)try{e.push(n+":"+t[n].join(","))}catch(e){}return e.join("|")}();(e||""!==t)&&i({eventAction:"PLP Filter click",eventLabel:[`sort:${Fe}`,t].join("|")})}function ft(){const e={};for(const t in Pe){const n=[];for(const e in Pe[t])at(t,e)&&n.push(t!==ke&&t!==Ce?rt(De,t,e).name:e);n.length>0&&(e[t]=n)}return Fe!==$e&&(e.sort=Fe),e}function vt(e){return isNaN(parseInt(e))?e:parseInt(e)}function yt(){Ie!==window.location.hash.substr(1)&&(!function(){const e=window.location.hash.substr(1),t=new URLSearchParams(e);if(Object.values(t).some((e=>""===e)))return;const n={};for(const e in Pe)t.has(e)&&(n[e]=t.get(e).split(","));for(const e in Pe)for(const t in Pe[e]){const i=rt(De,e,t),s="object"==typeof i?i.name:i,r=at(e,t),o=n[e]&&-1!==n[e].indexOf(s);!r&&o?ht(e,vt(t),!0):r&&!o&&ht(e,vt(t),!1)}t.has("sort")&&void 0!==Ne[t.get("sort")]?Fe=t.get("sort"):t.has("sort")||Fe===$e||(Fe=$e);let i=null;null!=window.filteredProducts&&(i=window.filteredProducts.map((e=>({id:e.id})))),gt(!1),s=i,r=window.filteredProducts,(null==s&&null!=r||null==r&&null!=s||(null!=s||null!=r)&&s&&r&&(s.length!==r.length||s.some((e=>{if(null===r.find((t=>t.id===e.id)))return!0}))))&&Ve();var s,r}(),Ie=window.location.hash.substr(1))}class wt{constructor(e){this.callBack=e}update(e){this.callBack(e)}}const kt={"productlistrespblock.filterlabels.intensity.chip.light":"Light {range}","productlistrespblock.filterlabels.intensity.chip.medium":"Mild {range}","productlistrespblock.filterlabels.intensity.chip.intense":"Intense {range}"};class Et extends HTMLElement{connectedCallback(){this.props=[...this.attributes].reduce(((e,t)=>({...e,[t.nodeName]:t.nodeValue})),{});const{filter_group_intensity_light:e,filter_group_intensity_medium:t,filter_group_intensity_intense:n}=this.props;kt["productlistrespblock.filterlabels.intensity.chip.light"]=e,kt["productlistrespblock.filterlabels.intensity.chip.medium"]=t,kt["productlistrespblock.filterlabels.intensity.chip.intense"]=n,this.init().finally((()=>this.render()))}async init(){this.priceFormatter=await we(),this.currency=ye().currency}getFilterValueData(e,t,n){return t===ke||t===Ce?n:e[t][n]}async render(){const{title:e,filter_type:t,properties:n}=this.props;this.filter_type=t,this.inputs=JSON.parse(n);const i=Ae;this.innerHTML=`\n            <fieldset>\n                <legend>${e}</legend>\n                ${this.inputs.map(((e,n)=>{const s=this.getFilterValueData(i,t,e);return this.render_input(s,t,n)})).join("")}\n            </fieldset>\n        `,this.boundOnIntensityClick=this.onIntensityClick.bind(this),this.boundOnSizeClick=this.onSizeClick.bind(this),this.boundOnAromaticClick=this.onAromaticClick.bind(this),this.boundOnColorClick=this.onColorClick.bind(this),this.boundOnPriceClick=this.onPriceClick.bind(this),this.boundOnCollectionClick=this.onCollectionClick.bind(this),this.boundOnTypeClick=this.onTypeClick.bind(this),this.inputs.forEach(this.handleInput.bind(this))}getId(e,t){switch(e){case ke:return t.join("-");case Ce:return t.name;case Le:return t;default:return t.id}}getName(e,t,n){const i=["light","medium","intense"];switch(t){case ke:return f(kt["productlistrespblock.filterlabels.intensity.chip."+i[n]],{range:e[0]+" - "+e[1]},"{","}");case Le:return this.priceFormatter.short(this.currency,e);default:return e.name}}render_input(e,t,n){const i=this.getId(t,e),s=this.getName(e,t,n);if(t!==ke&&"group"===e.type)return`<nb-chip color="#FAF9F8" value="${i}">${s}</nb-chip>`;const r="aromatic"===t?e.id.split("/")?.pop():"";return`<nb-chip value="${i}" ${this.isCupSize(e)?`icon='${this.getCupSize(e)}'`:r?`icon='${(e=>{const t=(e=>(e=e.replace("capsule-aromatic-","").replace("recipe-",""),["peppery"].includes(e)?"spicy":["woody"].includes(e)?"wood":["sweet","caramel"].includes(e)?"sugar":["maltedCereal"].includes(e)?"malted":["veryRoasted","roastedCereal"].includes(e)?"roasted":["fruityWiney"].includes(e)?"fruity":["citric"].includes(e)?"citrus":["chocolate"].includes(e)?"cocoa":["nutty"].includes(e)?"hazelnut":["hintOfFruity"].includes(e)?"berry":["smooth-b2b"].includes(e)?"brand-coffee-roasted":["sweetnotes-b2b","toffeenotes-b2b","caramellynotes-b2b"].includes(e)?"brand-coffee-caramel":["rich-b2b"].includes(e)?"brand-coffee-intense-roasted":e.toLowerCase()))(e);let n=h.find((e=>t.split("-").includes(e.replace("notes-",""))));return n||(n="notes-default"),n})(r)}'`:""}>${s}</nb-chip>`}addEnableObserver(e,t,n,i){const s=qe(e,t),r=new wt(i);s.addObserver(r),s.update(s.get())}handleInput(e){const{filter_type:t}=this.props;this.clickMap={[ke]:this.boundOnIntensityClick,cupsize:this.boundOnSizeClick,aromatic:this.boundOnAromaticClick,[Ce]:this.boundOnColorClick,[Le]:this.boundOnPriceClick,collection:this.boundOnCollectionClick,[Ee]:this.boundOnTypeClick};const n=this.getFilterValueData(Ae,t,e),i=this.getId(t,n),s=this.querySelector(`nb-chip[value="${i}"]`);s.addEventListener("change",this.clickMap[t]);let r=e;if(Array.isArray(e)&&t===ke&&(e=Ae[t][e[0]]?e[0]:e[1]),t===ke)for(let e=r[0];e<=r[1];e++)Ae[t][e]&&this.addEnableObserver(t,e,s,(()=>{const e=this.getIntRange(s.getAttribute("value")).filter((e=>Ae[t][e])).some((e=>qe(t,e).get()));s.setAttribute("disabled",!e)}));else this.addEnableObserver(t,e,s,(e=>{s.setAttribute("disabled",(!e).toString())}));const o=(l=e,Pe[a=t][lt(a,l)]);var a,l;const c=new wt((e=>{e?s.setAttribute("checked","true"):s.setAttribute("checked","false")}));o.addObserver(c),o.update(o.get())}isCupSize(e){return e.superCategories&&e.superCategories.some((e=>"capsule-cupSize"===e.match(/([^/]*)\/*$/)[0]))}getCupSize(e){return e.id.match(/([^/]*)\/*$/)[0]}onIntensityClick(e){const t=e.currentTarget.getAttribute("disabled");let n=e.currentTarget.getAttribute("value");-1!==n.indexOf("-")&&(n=this.getIntRange(n)),null!=t&&"false"!==t||je(n)}getIntRange(e){const t=[],n=e.split("-");for(let e=parseInt(n[0]);e<=n[1];e++)t.push(e);return t}onSizeClick(e){const t=e.currentTarget.getAttribute("disabled"),n=e.currentTarget.getAttribute("value");null!=t&&"false"!==t||Ge(n)}onAromaticClick(e){const t=e.currentTarget.getAttribute("disabled"),n=e.currentTarget.getAttribute("value");null!=t&&"false"!==t||Ye(n)}onColorClick(e){const t=e.currentTarget.getAttribute("disabled"),n=e.currentTarget.getAttribute("value");null!=t&&"false"!==t||Je(n)}onPriceClick(e){const t=e.currentTarget.getAttribute("disabled"),n=e.currentTarget.getAttribute("value");null!=t&&"false"!==t||Ke(n)}onCollectionClick(e){const t=e.currentTarget.getAttribute("disabled"),n=e.currentTarget.getAttribute("value");null!=t&&"false"!==t||Ue(n)}onTypeClick(e){const t=e.currentTarget.getAttribute("disabled"),n=e.currentTarget.getAttribute("value");null!=t&&"false"!==t||Qe(n)}disconnectedCallback(){const e=this.filter_type===ke?Ze():this.inputs;e&&e.forEach((e=>{const t=Array.isArray(e)?e.join("-"):e;this.querySelector(`nb-chip[value="${t}"]`).removeEventListener("click",this.clickMap[this.filter_type])}))}}customElements.get("nb-filter-form")||customElements.define("nb-filter-form",Et);class Ct extends HTMLElement{constructor(){super(),this.slot=this.innerHTML}connectedCallback(){this.render()}render(){const e=this.slot;this.innerHTML=`\n        <div class="innerScrollContainer">\n            <div class="innerScroll">\n                <div class="innerScrollOverflow">\n                    <div class="innerScrollPadding">\n                        ${e}\n                    </div>\n                </div>\n            </div>\n        </div>`}}function Lt(e,t=!0){const n=[{label:e[$e],value:$e,checked:!Fe||Fe===$e},{label:e.sortPriceAscending,value:"sortPriceAscending",checked:"sortPriceAscending"===Fe},{label:e.sortPriceDescending,value:"sortPriceDescending",checked:"sortPriceDescending"===Fe}];return t&&n.push({label:e.sortIntensityAscending,value:"sortIntensityAscending",checked:"sortIntensityAscending"===Fe},{label:e.sortIntensityDescending,value:"sortIntensityDescending",checked:"sortIntensityDescending"===Fe}),n}customElements.get("nb-inner-scroll")||customElements.define("nb-inner-scroll",Ct);const $t={[ke]:0,cupsize:1,aromatic:2,[Le]:3,collection:4,[Ee]:5};class St extends HTMLElement{constructor(){super(),this.boundOnResetAll=this.onResetAll.bind(this),this.boundOnSeeResults=this.onSeeResults.bind(this),this.boundOnSortSelect=this.onSortSelect.bind(this)}connectedCallback(){this.props=[...this.attributes].reduce(((e,t)=>({...e,[t.nodeName]:t.nodeValue})),{}),this.boundOnFilteredProductsUpdate=this.onFilteredProductsUpdate.bind(this),window.addEventListener("filteredProductUpdate",this.boundOnFilteredProductsUpdate),this.boundPopinCloseClick=this.onPopinCloseClick.bind(this),window.addEventListener("WEB_COMPONENT_POPIN_CLOSE_CLICK",this.boundPopinCloseClick),this.previousState=this.isMobile(),this.render(),this.debouncedOnResize=m(this.onResize.bind(this),250),window.addEventListener("resize",this.debouncedOnResize),this.boundOpen=this.onResize.bind(this),window.addEventListener(a,this.boundOpen),this.props.popin_id&&(this.boundOnPopinClosed=this.onPopinClosed.bind(this),window.addEventListener("WEB_COMPONENT_POPIN_CLOSED",this.boundOnPopinClosed))}onPopinClosed(e){this.props.popin_id&&e.detail.id===this.props.popin_id&&Ve()}sortCategories(e,t){return $t[e[0]]-$t[t[0]]}render(){this.innerHTML=`\n            ${this.isMobile()?this.renderDropdown():""}\n            <div class="mobileShadow">\n                <header>\n                    <h2 class="t-sm-700-caps-sl">${Me["productlistrespblock.filter.label"]}</h2>\n                </header>\n                <section>\n                    ${this.isMobile()?this.renderFilterForms():this.renderFilterFormsDesktop()}\n                </section>\n                <footer>\n                    <nb-link\n                        id="nb-filter-popin-reset-all"\n                        size="large"\n                        color="black">${Me["productlistrespblock.resetfilters.label"]}</nb-link>\n                    ${this.renderSeeResults(He)}\n                </footer>\n            </div>`,this.resetAllButton=document.getElementById("nb-filter-popin-reset-all"),this.resetAllButton&&this.resetAllButton.addEventListener("click",this.boundOnResetAll),this.seeResultButton=document.getElementById("nb-filter-popin-see-results"),this.seeResultButton&&this.seeResultButton.addEventListener("click",this.boundOnSeeResults),this.closePopupButton=document.querySelector("#plp-filter .nb-popin--button--close"),this.closePopupButton&&this.closePopupButton.addEventListener("click",this.boundOnSeeResults),this.sortButton=document.getElementById("sortMenuMobile"),this.sortButton&&this.sortButton.addEventListener("WEB_COMPONENT_SORT_BY_CHANGE",this.boundOnSortSelect)}renderFilterFormsDesktop(){return`${this.renderFilterForms()}`}renderFilterForms(){const{filter_group_intensity_light:e,filter_group_intensity_medium:t,filter_group_intensity_intense:n}=this.props;return`${Object.entries(Te).sort(this.sortCategories).map((([i,s])=>{const r=i===ke?Ze():s;return`\n                    <nb-filter-form\n                        filter_group_intensity_light="${e}"\n                        filter_group_intensity_medium="${t}"\n                        filter_group_intensity_intense="${n}"\n                        title='${Me["productlistrespblock.filterlabels."+i]}'\n                        key='${i}'\n                        filter_type='${i}'\n                        properties='${JSON.stringify(r)}'\n                    ></nb-filter-form>`})).join("")}`}renderDropdown(){const{label_close_sort_by:e,label_sort_by:t,aa_description_sort_by:n,aa_listbox_description_sort_by:i,aa_select_description_sort_by:s,dropdown_recommended_option_label:r,dropdown_price_ascending_option_label:o,dropdown_price_descending_option_label:a,dropdown_intensity_ascending_option_label:l,dropdown_intensity_descending_option_label:c}=this.props;return`<nb-dropdown\n                    id="sortMenuMobile"\n                    data="${v({label:t,aa_description:n,aa_listbox_description:i,aa_select_description:s,icon_option:"check",label_close:e,options:Lt({[$e]:r,sortPriceAscending:o,sortPriceDescending:a,sortIntensityAscending:l,sortIntensityDescending:c})})}"></nb-dropdown>`}onSortSelect(e){Xe(e.detail.selected.value)}isMobile(){return window.innerWidth<=750}onResize(){this.isMobile()!==this.previousState&&(this.render(),this.previousState=this.isMobile())}renderSeeResults(e){return e&&e.length?`<nb-cta\n                    id="nb-filter-popin-see-results"\n                    variation="secondary"\n                    aria_label_after="${this.getA11ySeeResultsText(e.length)}">\n                    ${this.getSeeResultsText(e.length)}\n                </nb-cta>`:""}onPopinCloseClick(){We()}onResetAll(){We()}onSeeResults(){r({eventName:"WEB_COMPONENT_POPIN_CLOSE",element:window}),Ve()}getSeeResultsText(e){const{see_result_number_label:t="See {resultsLength} Results",see_result_number_label_one:n="",see_result_number_label_zero:i=""}=this.props;let s;return(isNaN(e)||null==e||0==e)&&(e="0"),s=0===e?i:1===e?n:t,f(s,{resultsLength:e},"{","}")}getA11ySeeResultsText(e){const{a11y_see_result_number_label:t="See {resultsLength} Results"}=this.props;return(isNaN(e)||null==e||0==e)&&(e="0"),f(t,{resultsLength:e},"{","}")}onFilteredProductsUpdate(){this.seeResultButton&&this.seeResultButton.setAttribute("slot",this.getSeeResultsText(He.length)),this.sortButton&&Fe!==this.sortButton.selected.value&&this.sortButton.setSelected(Fe)}disconnectedCallback(){this.resetAllButton&&this.resetAllButton.removeEventListener("click",this.boundOnResetAll),this.seeResultButton&&this.seeResultButton.removeEventListener("click",this.boundOnSeeResults),this.sortButton&&this.sortButton.removeEventListener("click",this.boundOnSortSelect),this.closePopupButton&&this.closePopupButton.removeEventListener("click",this.boundOnSeeResults),this.props.popin_id&&window.removeEventListener("WEB_COMPONENT_POPIN_CLOSED",this.boundOnPopinClosed),window.removeEventListener("resize",this.debouncedOnResize),window.removeEventListener(a,this.boundOpen)}}customElements.get("nb-filter-popin")||customElements.define("nb-filter-popin",St);class Ot extends HTMLElement{constructor(){super(),this.filterCounter=0,this.isBubbleReady=!1,this.labelElement={},this.iconElement={},this.fullButtonElement={},this.bubbleElement=null,this.updateTotalFiltersBubble=this.updateTotalFiltersBubble.bind(this)}connectedCallback(){this.render(),this.updateTotalFiltersBubble(),window.addEventListener("filteredProductDisplay",this.updateTotalFiltersBubble)}render(){this.innerHTML=`<nb-cta popin_id='plp-filter' variation='plpFilter' icon_right='filter'>${this.attributes.label.nodeValue}</nb-cta>`,this.initElements()}initElements(){this.bubbleElement=document.createElement("div"),this.bubbleElement.classList.add("t-2xs-700"),this.bubbleElement.classList.add("bubbleCounter");const e=document.getElementsByClassName("button--plpFilter");e&&e[0]&&(this.fullButtonElement=e[0],this.labelElement=this.fullButtonElement.firstElementChild,this.iconElement=this.fullButtonElement.lastElementChild)}updateTotalFiltersBubble(){0===Object.keys(this.fullButtonElement).length&&(this.filterCounter=function(){let e=0;for(const t in Pe)if(t===ke){const n=Ze();for(const i in n){let s=n[i][0],r=!1;for(;s<=n[i][1];s++)Pe[t][s]&&Pe[t][s].get()&&(r=!0);r&&++e}}else for(const n in Pe[t])e=Pe[t][n].get()?++e:e;return e}(),this.isBubbleReady||0===this.filterCounter?0===this.filterCounter&&this.isBubbleReady&&this.removeFiltersBubble():(this.isBubbleReady=!0,this.fullButtonElement.appendChild(this.bubbleElement),this.fullButtonElement.classList.add("bubbleActive")),this.bubbleElement.innerHTML=this.filterCounter)}removeFiltersBubble(){0===Object.keys(this.fullButtonElement).length&&this.isBubbleReady&&(this.fullButtonElement.lastElementChild.remove(),this.labelElement.classList.remove("bubbleActive"),this.iconElement.classList.remove("bubbleActive"),this.fullButtonElement.classList.remove("bubbleActive"),this.isBubbleReady=!1)}disconnectedCallback(){window.removeEventListener("filteredProductDisplay",this.updateTotalFiltersBubble)}}customElements.get("nb-plp-filter-cta")||customElements.define("nb-plp-filter-cta",Ot);class Tt extends HTMLElement{constructor(){super(),this.isMobile=window.innerWidth<750,this.sortButton=null,this.boundProductUpdate=this.onProductUpdate.bind(this),this.boundOnSortSelect=this.onSortSelect.bind(this),this.boundOnSliderReady=this.onSliderReady.bind(this)}connectedCallback(){this.props=e(this.attributes),this.render(),this.refs=M(this),this.bindEvent()}bindEvent(){window.addEventListener("filteredProductUpdate",this.boundProductUpdate),this.refs.navLink.addEventListener(l,this.boundOnSliderReady,{once:!0})}onProductUpdate(){Fe!==this.sortButton.selected.value&&this.sortButton.setSelected(Fe)}render(){this.sortButton&&this.sortButton.removeEventListener("click",this.boundOnSortSelect);const{cta_filter_label:e="Filters",label_sort_by:t="Sort By",aa_description_sort_by:n="You can select different sorting values from this listbox. To interact with this listbox press SPACE or ENTER key.",aa_listbox_description_sort_by:i="You can navigate through the options using UP or DOWN arrows keys. To exit this listbox press ESCAPE key.",aa_select_description_sort_by:s="To select this option press SPACE or ENTER key.",label_close_sort_by:r="Close",a11y_label_close_sort_by:o="Close filter popin",see_result_number_label:a="See {resultsLength} Results",see_result_number_label_zero:l="",see_result_number_label_one:c="",a11y_see_result_number_label:d="Close and validate filters",filter_group_intensity_light:u,filter_group_intensity_medium:h,filter_group_intensity_intense:p,dropdown_recommended_option_label:b,dropdown_price_ascending_option_label:_,dropdown_price_descending_option_label:g,dropdown_intensity_ascending_option_label:m,dropdown_intensity_descending_option_label:f,a11y_slider_previous_button:y,a11y_slider_next_button:w,dropdown_intensity_allow:k}=this.props;this.innerHTML=`\n                    <div class="cb-plp-filter">\n                        <div class='cb-plp-filter--side'>\n                            <nb-plp-filter-cta label='${e}'></nb-plp-filter-cta>\n                        </div>\n                        <div class='cb-plp-filter--links_list'>\n                        <nb-slider-menu\n                            a11y_slider_previous_button="${y}"\n                            a11y_slider_next_button="${w}"\n                            navigation="${!this.isMobile}"\n                            data-ref="navLink">\n                            ${this.renderLinksList()}\n                        </nb-slider-menu>\n                        </div>\n                        <div class='cb-plp-filter--side'>\n                            <nb-dropdown id="sortMenu"\n                                data="${v({label:t,aa_description:n,aa_listbox_description:i,aa_select_description:s,icon_option:"check",label_close:r,options:Lt({[$e]:b,sortPriceAscending:_,sortPriceDescending:g,sortIntensityAscending:m,sortIntensityDescending:f},"true"===k)})}"/>\n                        </div>\n                    </div>\n                    <nb-popin id='plp-filter' popin_id="plp-filter" variation='before' bgcolor="white" class='nb-popin--filter' heading='${Me["productlistrespblock.filter.label"]}' label_close='${o}'>\n                        <nb-filter-popin\n                            aa_description_sort_by="${n}"\n                            aa_listbox_description_sort_by="${i}"\n                            aa_select_description_sort_by="${s}"\n                            see_result_number_label="${a}"\n                            see_result_number_label_zero="${l}"\n                            see_result_number_label_one="${c}"\n                            a11y_see_result_number_label="${d}"\n                            label_close_sort_by="${r}"\n                            label_sort_by="${t}"\n                            filter_group_intensity_light="${u}"\n                            filter_group_intensity_medium="${h}"\n                            filter_group_intensity_intense="${p}"\n                            dropdown_recommended_option_label="${b}"\n                            dropdown_price_ascending_option_label="${_}"\n                            dropdown_price_descending_option_label="${g}"\n                            dropdown_intensity_ascending_option_label="${m}"\n                            dropdown_intensity_descending_option_label="${f}"\n                            popin_id="plp-filter"\n                            />\n                    </nb-popin>`,this.sortButton=document.getElementById("sortMenu"),this.sortButton&&this.sortButton.addEventListener("WEB_COMPONENT_SORT_BY_CHANGE",this.boundOnSortSelect)}onSortSelect(e){Xe(e.detail.selected.value)}onSliderReady(e){const t=o(e),{className:n}=t;this.refs.navLink.querySelector(`.${n}`)}renderLinksList(){const{navigation:e=[]}=this.props;return e.map((({link:e="",icon_left:t="",seo_label:n="",label:i="",selected:s=!1})=>`<nb-link\n                            link='${e}'\n                            phantom='true'\n                            color='black'\n                            selected=${s}\n                            ${n&&`seo_label='${n}'`}\n                            ${t&&`icon_left='${t}'`}>${i}</nb-link>`)).join("")}disconnectedCallback(){this.sortButton&&this.sortButton.removeEventListener("click",this.boundOnSortSelect),window.removeEventListener("filteredProductUpdate",this.boundProductUpdate)}}customElements.get("nb-plp-filter")||customElements.define("nb-plp-filter",Tt);const At={"productlistrespblock.filterlabels.intensity.chip.light":"Light {range}","productlistrespblock.filterlabels.intensity.chip.medium":"Mild {range}","productlistrespblock.filterlabels.intensity.chip.intense":"Intense {range}"};class Pt extends HTMLElement{constructor(){super(),this.props={},this.chipListeners=[]}connectedCallback(){this.props=e(this.attributes),this.boundOnFilterUpdate=this.onFilterUpdate.bind(this),window.addEventListener("filteredProductDisplay",this.boundOnFilterUpdate);const{filter_group_intensity_light:t,filter_group_intensity_medium:n,filter_group_intensity_intense:i}=this.props;At["productlistrespblock.filterlabels.intensity.chip.light"]=t,At["productlistrespblock.filterlabels.intensity.chip.medium"]=n,At["productlistrespblock.filterlabels.intensity.chip.intense"]=i,this.render()}onFilterUpdate(){this.clearChipListeners(),this.render()}clearChipListeners(){this.chipListeners.forEach((e=>{e.element.removeEventListener("click",e.listener)})),this.chipListeners.length=0}getFilterName(e,t){if(e===ke){const e=["light","medium","intense"],n=Ze(),i=n.findIndex((e=>e[0]===t[0]&&e[1]===t[1]));return f(At["productlistrespblock.filterlabels.intensity.chip."+e[i]],{range:n[i].join("-")},"{","}")}return Ae[e][t].name}getChipId(e,t){return`nb-plp-filter-results-chip-${e+t}`}filterActive(e){const t=[];for(let n=e[0];n<=e[1];n++)t.push(n);return t.some((e=>Pe.intensity[e]&&Pe.intensity[e].get()))}render(){const{label:e,label_reset:t,a11y_label_reset:n,label_results:i,label_results_zero:s,label_results_one:r,a11y_label_results:o}=this.props;this.innerHTML=`\n            ${e&&`<p class="t-sm-400-sl">${e}</p>`}\n            \x3c!-- TODO : loop on activated chips / here 2 elements to test --\x3e\n            ${this.renderActiveFilters()}\x3c!--\n            --\x3e<nb-link\n                id="nb-plp-filter-results-reset-all"\n                size="small"\n                color="black"\n                aria-label="${n}">${t}</nb-link>\n            \x3c!-- TODO : need to debug accessibility on this component, for a11y_label_reset and the rest --\x3e\n            \x3c!-- TODO : bind number of results --\x3e\n            ${this.renderResultsLabel(He,i,s,r,o)}\n        `,this.boundOnIntensityClick=this.onIntensityClick.bind(this),this.boundOnSizeClick=this.onSizeClick.bind(this),this.boundOnAromaticClick=this.onAromaticClick.bind(this),this.boundOnColorClick=this.onColorClick.bind(this),this.boundOnPriceClick=this.onPriceClick.bind(this),this.boundOnCollectionClick=this.onCollectionClick.bind(this),this.boundOnTypeClick=this.onTypeClick.bind(this),this.clickMap={[ke]:this.boundOnIntensityClick,cupsize:this.boundOnSizeClick,aromatic:this.boundOnAromaticClick,[Ce]:this.boundOnColorClick,[Le]:this.boundOnPriceClick,collection:this.boundOnCollectionClick,[Ee]:this.boundOnTypeClick},this.prepareActiveFiltersChips(),this.resetAllButton=document.getElementById("nb-plp-filter-results-reset-all"),this.boundOnResetAll=this.onResetAll.bind(this),this.resetAllButton.addEventListener("click",this.boundOnResetAll)}renderActiveFilters(){return Pe?`\n            ${Object.entries(Pe).reduce(((e,t)=>e+(t[0]!==ke?Object.entries(t[1]).filter((e=>!0===e[1].get())).map((e=>this.renderActiveFiltersIntensity(t,e))).join(""):Ze().filter(this.filterActive).map((e=>this.renderActiveFiltersIntensityRange(t,e))).join(""))),"")}`:""}renderActiveFiltersIntensity(e,t){const{a11y_label_button:n}=this.props;return`<nb-cta\n                    id="${this.getChipId(e[0],t[0])}"\n                    icon_right="close-2"\n                    variation="secondary"\n                    aria_label_after="${n}">\n                    ${this.getFilterName(e[0],t[0])}\n                </nb-cta>`}renderActiveFiltersIntensityRange(e,t){const{a11y_label_button:n}=this.props;return`<nb-cta\n                    id="${this.getChipId(ke,t.join("-"))}"\n                    icon_right="close"\n                    variation="secondary"\n                    aria_label_after="${n}">\n                    ${this.getFilterName(ke,t)}\n                </nb-cta>`}prepareActiveFiltersChips(){Pe&&Object.entries(Pe).reduce(((e,t)=>(t[0]!=ke?Object.entries(t[1]).filter((e=>!0===e[1].get())).forEach((e=>{this.createIntensityChip(t,e)})):Ze().filter(this.filterActive).forEach((e=>{this.createIntensityChipRange(e)})),e)),"")}createIntensityChip(e,t){const n=document.getElementById(this.getChipId(e[0],t[0]));n&&(n.addEventListener("click",this.clickMap[e[0]]),this.chipListeners.push({element:n,listener:this.clickMap[e[0]]}),n.setAttribute("value",t[0]))}createIntensityChipRange(e){const t=document.getElementById(this.getChipId(ke,e.join("-")));t&&(t.addEventListener("click",this.clickMap.intensity),this.chipListeners.push({element:t,listener:this.clickMap.intensity}),t.setAttribute("value",e.join("-")))}getIntRange(e){const t=[],n=e.split("-");for(let e=parseInt(n[0]);e<=n[1];e++)t.push(e);return t}onIntensityClick(e){let t=e.currentTarget.getAttribute("value");-1!==t.indexOf("-")&&(t=this.getIntRange(t)),je(t,!1),Ve()}onSizeClick(e){Ge(e.currentTarget.getAttribute("value"),!1),Ve()}onAromaticClick(e){Ye(e.currentTarget.getAttribute("value"),!1),Ve()}onColorClick(e){Je(e.currentTarget.getAttribute("value"),!1),Ve()}onPriceClick(e){Ke(e.currentTarget.getAttribute("value"),!1),Ve()}onCollectionClick(e){Ue(e.currentTarget.getAttribute("value"),!1),Ve()}onTypeClick(e){Qe(e.currentTarget.getAttribute("value"),!1),Ve()}onResetAll(){We(),Ve()}renderResultsLabel(e,t,n,i,s){let r;return r=e&&0!==e.length?1===e.length?i:t:n,t?`<p class="t-xs-700-caps-sl"><span class="sr-only">${s}</span> <span>${e?e.length:0}</span> ${r}:</p>`:""}disconnectedCallback(){this.clearChipListeners(),window.removeEventListener("filteredProductDisplay",this.boundOnFilterUpdate),this.resetAllButton&&this.resetAllButton.removeEventListener("click",this.boundOnResetAll)}}customElements.get("nb-plp-filter-results")||customElements.define("nb-plp-filter-results",Pt);class xt extends HTMLElement{constructor(){super(),this.slot=this.innerHTML}connectedCallback(){this.props=e(this.attributes),this.render()}render(){const{segments:e="false",background_retina:t="https://www.nespresso.com/shared_res/agility/next-components/assets/backgrounds/barista_creation_range_L.jpg",background_desktop:n="https://www.nespresso.com/shared_res/agility/next-components/assets/backgrounds/barista_creation_range_L.jpg",background_mobile:i="https://www.nespresso.com/shared_res/agility/next-components/assets/backgrounds/barista_creation_range_L.jpg",background_tablet:s="",contrast:r="dark",name:o="",description:a="",cta_text:l="",cta_link:c=""}=this.props;this.innerHTML=`\n            <article class='cb-plp-category ${"true"===e?"wSegments":"woSegments"}'>\n                <nb-container\n                    classname="cb-plp-category--header"\n                    contrast='${r}'\n                    background_retina='${t}'\n                    background_desktop='${n}'\n                    background_mobile='${i}'\n                    background_tablet='${s}'\n                >\n                    <header>\n                        ${o?this.renderHeading(o):""}\n                        <div class="cb-plp-category--description">\n                            ${a&&this.renderDescription(a)}\n                            ${c&&l&&this.renderCTA(c,l)}\n                        </divc>\n                    </header>\n                </nb-container>\n                <nb-container classname="cb-plp-category--coffees" contrast='light'>\n                    ${"true"===e?this.renderWithSegment():this.renderWithoutSegment()}\n                </nb-container>\n            </article>\n        `,this.setDesktopSegmentMarginTop()}setDesktopSegmentMarginTop(){let e=0,t=0;const n=this.querySelector("header");if(!n)return;const i=getComputedStyle(n);e=n.clientHeight-parseFloat(i.paddingBottom);const s=n.querySelector("h1");if(!s)return;const r=getComputedStyle(s);t=s.clientHeight+parseFloat(r.marginBottom);const o=e-t;n.closest(".cb-plp-category").style.setProperty("--woSegments-coffees-margin-top","-"+o+"px")}renderWithSegment(){return`${this.slot}`}renderWithoutSegment(){return`<div class="cb-plp-category--segment">\n            <div class='cb-plp-category--side'></div>\n            <div class='cb-plp-category--center'>${this.slot}</div>\n        </div>`}renderHeading(e){return`<h2 class="h-2xl-700-sl cb-plp-category--title">${e}</h2>`}renderDescription(e){return`<p class="t-md-400">${e}</p>`}renderCTA(e,t){const{contrast:n}=this.props;return`<nb-link class="top-range-link" color='${"dark"===n?"white":"black"}' size='large' link='${e}' seo_label="${t}">${t}</nb-link>`}}customElements.get("nb-plp-category")||customElements.define("nb-plp-category",xt);class It extends HTMLElement{constructor(){super(),this.boundGetChips=this.getChips.bind(this)}connectedCallback(){this.props=e(this.attributes),this.render(),this.addEventListener(l,this.boundGetChips),this.querySelectorAll(".nb-dropdown__menu button").forEach((e=>{e.addEventListener("click",this.clickChip)}))}render(){const{navigation:e=[],navigation_bubbles:t=""}=this.props;this.classList.add("nb-plp-sticky-bar"),this.innerHTML=`<div class="nb-plp-sticky-bar--inner">\n                ${this.renderLinksSelect(e)}\n                ${this.renderBubblesSlide(t)}\n            </div>`}renderLinksSelect(e){if(S.is.mobile||!e||e.length<=1)return"";const t=e.map((e=>(e.checked=e.selected,e)));return`<div class="nb-plp-sticky-bar--dropdown">\n            <nb-dropdown\n                data='${v({icon_option:"check",options:t})}'\n            ></nb-dropdown>\n        </div>`}renderBubblesSlide(e){const{a11y_slider_previous_button:t="",a11y_slider_next_button:n=""}=this.props;return`<nb-navigation-bubbles\n                a11y_slider_previous_button="${t}"\n                a11y_slider_next_button="${n}"\n                sticky='true' data='${e}'></nb-navigation-bubbles>`}getChips(){this.querySelectorAll("nb-chip").forEach((e=>{e.addEventListener("click",this.clickChip)}))}clickChip(e){e.preventDefault();const t=e.currentTarget.getAttribute("data-link");t&&(window.location.href=t)}disconnectedCallback(){this.removeEventListener(l,this.boundGetChips),this.querySelectorAll("nb-chip").forEach((e=>{e.removeEventListener("click",this.clickChip)})),this.querySelectorAll(".nb-dropdown__menu button").forEach((e=>{e.removeEventListener("click",this.clickChip)}))}}customElements.get("nb-plp-sticky-bar")||customElements.define("nb-plp-sticky-bar",It);var Nt=(e=[])=>{e.forEach((e=>{if(e&&e.element)return e.element.addEventListener(e.type,e.listener,e.options)}))},Mt=(e=[])=>{e.forEach((e=>{e&&e.element&&e.element.removeEventListener(e.type,e.listener)}))};const Bt=(()=>{const e=({identifier:e="",callback:t,options:n})=>{if(""===e)return{};const i=document.querySelectorAll(e),s=new IntersectionObserver(t,n);for(const e of i)s.observe(e);return{observer:s,targets:i}};return{initialize:t=>{t.map(e)},destroy:()=>{}}})(),Dt=[.2,.8],Rt=(()=>{let e=null,t=!1;const n=e=>{i(e[0])},i=t=>{if(t.isIntersecting&&!e.isScrolling){let{sectionId:e=""}=t.target.dataset;e=""===e?t.target.getAttribute("data-id"):"",r({eventName:"EVENT_NAVIGATION_SECTION_CHANGE",args:{sectionId:e}})}};return{initialize:i=>{e=i;const s=[{identifier:"[data-id]",callback:n,options:{threshold:Dt,rootMargin:"-160px 0px 0px 0px"}}],r=()=>{t||(t=!0,Bt.initialize(s))};setTimeout((()=>{r()}),2e3),window.addEventListener("WEB_COMPONENT_PROJECTS_LOADED",(()=>{r()}))},destroy:()=>{}}})(),Ht=e=>{const t=e=>{const t=e.querySelectorAll("a");for(const[e,i]of t.entries())i.addEventListener("click",n(e))},n=t=>n=>{n.preventDefault();const i=n.target.closest(".is-link");i&&(r({eventName:"EVENT_NAVIGATION_SECTION_CHANGE",args:{sectionId:i.getAttribute("data-href"),index:t}}),e.scroll&&e.scroll(i,t),window.location.hash=i.getAttribute("data-href"))},i=t=>{const{sectionId:n,index:i}=o(t);e.updateBubbles&&e.updateBubbles(n),e.updateChips&&e.updateChips(n),e.updateSlider&&e.updateSlider(n,i)};return{createListeners:()=>{const{containerBubble:n,containerChip:s,sliderBubble:r,sliderChip:o}=e.refs,a=[];return n&&a.push({element:n,type:l,listener:t(r),options:{once:!0}}),s&&a.push({element:s,type:l,listener:t(o),options:{once:!0}}),a.push({element:window,type:"EVENT_NAVIGATION_SECTION_CHANGE",listener:i}),a.push({element:window,type:"EVENT_HEADER_POSITION_CHANGED",listener:e.updateLayout.bind(e)}),Nt(a),a}}};class Ft{constructor(){this.promise=new Promise(((e,t)=>{this.reject=t,this.resolve=e}))}}class zt extends HTMLElement{static get observedAttributes(){return["sticky"]}constructor(){super(),this.isMobile=window.innerWidth<768,this.isScrolling=!1}connectedCallback(){this.props=e(this.attributes),this.classList.add("nb-navigation-bubbles"),this.init()}init(){this.render(),this.refs=M(this),this.geometry=this.getGeometry(),this.slidesVisibles=this.getSlidesVisible(),Rt.initialize(this),this.eventsListeners=Ht(this).createListeners()}update(){this.eventListeners&&Mt(this.eventListeners),this.updateClasses(),this.render(),this.refs=M(this),this.eventsListeners=Ht(this).createListeners()}attributeChangedCallback(e,t,n){"sticky"===e&&this.props&&n!==t&&(this.props.sticky=n,this.update())}render(){let e="";e=this.isSticky()?`${this.renderNavigation(32,"Chip","white_1000")}`:`${this.renderNavigation(16,"Bubble","")}`,this.innerHTML=e,this.updateClasses()}renderNavigation(e,t,n){const{a11y_slider_previous_button:i,a11y_slider_next_button:s}=this.props,r=this.renderList(`render${t}`);return`\n            <nb-container\n                background_color="${n}"\n                class="nb-navigation-bubbles__container--${t.toLowerCase()}"\n                contrast="light"\n                data-ref="container${t}"\n            >\n                <nb-slider-menu\n                    a11y_slider_previous_button="${i}"\n                    a11y_slider_next_button="${s}"\n                    navigation="true"\n                    pagination="false"\n                    slides_loop="false"\n                    slides_visible="${this.slidesVisibles}"\n                    space_between="${e}"\n                    data-ref="slider${t}"\n                >\n                    ${r}\n                </nb-slider-menu>\n            </nb-container>\n        `}renderList(e){const{bubbles:t=[]}=this.props;return t.map((t=>this[e](t))).join("")}renderBubble(e){let{link:t}=e;if(!t)return null;const{linkNoHash:n,linkHash:i}=this._getHashLink(t);return`\n            <a href="${i}" class="is-link" data-href='${n}'>\n                <nb-bubble data='${JSON.stringify(e).replace(/"/g,"&quot;")}' data-ref="bubbles[${n}]"></nb-bubble>\n            </a>\n        `}_getHashLink(e){let t=e,n=e;return-1!==e.indexOf("#")?n=e.replace("#",""):t="#"+e,{linkNoHash:n,linkHash:t}}renderChip(e){const{link:t}=e;if(!t)return null;const{linkNoHash:n,linkHash:i}=this._getHashLink(t);return`\n            <a href="${i}" data-href='${n}' class="is-link">\n                <nb-chip\n                    background_image="${e.visual.src}"\n                    data-ref="chips[${n}]"\n                    rounded="false"\n                >\n                    ${e.label}\n                </nb-chip>\n            </a>\n        `}isSticky(){if(!this.props)return!1;const{sticky:e="false"}=this.props;return"true"===e}getMethod(e){return["add","remove"][e?0:1]}addClass(e,...t){this.classList[this.getMethod(e)](...t)}updateClasses(){const e=this.isSticky(),{padding_top:t,padding_bottom:n}=this.props;null!=n&&null!=t&&this.addClass(!e,t,n)}updateLayout(){this.geometry=this.getGeometry(),this.updatePosition()}updateBubbles(e){const{bubbles:t={}}=this.refs;for(const n in t){const i=t[n],s=n===e?"selected":"default";i.setAttribute&&i.setAttribute("state",s)}}updateChips(e){const{chips:t={}}=this.refs;for(const n in t){const i=t[n],s=n===e?"true":"false";i.setAttribute&&i.setAttribute("checked",s)}}async updateSlider(e,t){let n=t;if(this.refs.sliderChip){const i=await this.refs.sliderChip.sliderMenu;if(void 0===t){document.querySelectorAll("#pnProductNav-"+i._options.id+" .pn-ProductNavLinkWrapper").forEach(((t,i)=>{t.childNodes[0].getAttribute("data-href")===e&&(n=i)}))}n&&i&&i.goToSlide&&i.goToSlide(n)}}emit(e){r({element:this,...e})}async scroll(e,t){this.isScrolling=!0;const n=e.getAttribute("data-href"),{header:i,chips:s,navigation:r}=this.geometry,o=0===t?r.height:s.height,a={scrollPaddingTop:i.top+i.height+o};await((e,t={})=>{const n={scrollPaddingTop:140,scrollDuration:300,...t},i=new Ft;let s;const r=typeof e;if(["string","object"].indexOf(r)>-1){s=e,"string"===r&&(s=document.querySelector(e));try{e=window.pageYOffset+s.getBoundingClientRect().top-n.scrollPaddingTop}catch(t){throw new Error(`error: No element found with the selector "${e}"`)}}else"number"!=typeof e&&(e=0);let o=window.performance.now(),a=0,l=window.pageYOffset-e,c=window.innerHeight,d=document.body.clientHeight;l>c&&d-c>0&&(n.scrollDuration=Math.abs(n.scrollDuration+n.scrollDuration*(Math.abs(l)/(d-c))));let u=o+n.scrollDuration;return window.requestAnimationFrame((function t(){let s=window.performance.now();if(s<u){a=(s-o)/n.scrollDuration,a=--a*a*a+1;const i=l*a;window.scrollTo(0,e+(l-i)),window.requestAnimationFrame(t)}else window.scrollTo(0,e),setTimeout((()=>i.resolve()),125);return i.promise})),i.promise})(`[data-id="${n}"]`,a),this.isScrolling=!1}track(e){const{customEventAction:t}=this.props;let n={eventRaisedBy:"Before",eventLabel:e};t&&(n.eventAction=t),i(n)}getGeometry(){const e=document.querySelector(".Header__top"),t=this?.getBoundingClientRect(),n=e?.getBoundingClientRect()||{height:0,y:0};return{header:{height:n.height,top:n.y},navigation:{height:t.height,top:window.scrollY+t.y},chips:{height:t.height,top:window.scrollY+t.y}}}getSlidesVisible(){const{sticky:e="false"}=this.props;return S.is.mobile?3:S.is.tablet?6:"true"===e?5:9}disconnectedCallback(){Mt(this.eventListeners)}}customElements.get("nb-navigation-bubbles")||customElements.define("nb-navigation-bubbles",zt);
/*!
 * swiped-events.js - v@version@
 * Pure JavaScript swipe events
 * https://github.com/john-doherty/swiped-events
 * @inspiration https://stackoverflow.com/questions/16348031/disable-scrolling-when-touch-moving-certain-element
 * @author John Doherty <www.johndoherty.info>
 * @license MIT
 */
const qt=(e,t,n)=>{if(e.nwcSwipeEvents)return;e.nwcSwipeEvents=!0,t.addEventListener("touchstart",(function(e){if("true"===e.target.getAttribute("data-swipe-ignore"))return;l=e.target,function(e){if(void 0===n||!n.contains(e))return;c=[],d=[];for(;e!==n;)c.push(e.scrollTop),d.push(e.scrollLeft),e=e.parentNode}(l),a=Date.now(),i=e.touches[0].clientX,s=e.touches[0].clientY,r=0,o=0}),!1),t.addEventListener("touchmove",(function(e){if(!i||!s)return;let t=e.touches[0].clientX,n=e.touches[0].clientY;r=i-t,o=s-n}),!1),t.addEventListener("touchend",(function(t){if(l!==t.target)return;const n=.25*e.innerHeight,c=.5*e.innerWidth;let d=parseInt(p(l,"data-swipe-threshold",n),10),h=parseInt(p(l,"data-swipe-threshold",c),10),b=parseInt(p(l,"data-swipe-timeout","500"),10),_=Date.now()-a,g="",m=t.changedTouches||t.touches||[];Math.abs(r)>Math.abs(o)?Math.abs(r)>h&&_<b&&(r>0?u("left",t)&&(g="swiped-left"):u("right",t)&&(g="swiped-right")):Math.abs(o)>d&&_<b&&(o>0?u("up",t)&&(g="swiped-up"):u("down",t)&&(g="swiped-down"));if(""!==g){let e={dir:g.replace(/swiped-/,""),touchType:(m[0]||{}).touchType||"direct",xStart:parseInt(i,10),xEnd:parseInt((m[0]||{}).clientX||-1,10),yStart:parseInt(s,10),yEnd:parseInt((m[0]||{}).clientY||-1,10)};l.dispatchEvent(new CustomEvent("swiped",{bubbles:!0,cancelable:!0,detail:e})),l.dispatchEvent(new CustomEvent(g,{bubbles:!0,cancelable:!0,detail:e}))}i=null,s=null,a=null}),!1);let i=null,s=null,r=null,o=null,a=null,l=null,c=[],d=[];function u(e,t){if(void 0===n)return!0;let i=t.target,s=!0,r=0;for(;i!==n&&s;){if(h(i))switch(e){case"up":s=c[r]===i.scrollHeight-i.clientHeight;break;case"down":s=0===c[r];break;case"left":s=d[r]===i.scrollWidth-i.clientWidth;break;case"right":s=0===d[r];break;default:s=!0}i=i.parentNode,r++}return s}function h(e){return e.scrollHeight>e.clientHeight||e.scrollWidth>e.clientWidth}function p(e,n,i){for(;e&&e!==t.documentElement;){let t=e.getAttribute(n);if(t)return t;e=e.parentNode}return i}};var Wt=e=>{const t=document.createElement("DIV");t.classList.add("nb-overlay"),t.addEventListener("click",(()=>{r({eventName:"WEB_COMPONENT_POPIN_CLOSE",args:{id:e}})})),document.body.appendChild(t),setTimeout((()=>{t.classList.add("fadein")}),1)},Vt=()=>{if(!document.getElementsByClassName("nb-overlay").length)return;const e=document.getElementsByClassName("nb-overlay")[0];e.classList.remove("fadein"),setTimeout((()=>{e.remove()}),1200)};class jt extends HTMLElement{constructor(){super(),this.props={},this.ariaModal=null,this.isVideo=null,this.boundOpen=this.open.bind(this),this.boundClose=this.close.bind(this),this.boundEscapeClose=this.escapeClose.bind(this),this.boundFocus=this.focus.bind(this),this.boundFocusin=this.focusin.bind(this)}connectedCallback(){this.style.display="none",this.props=e(this.attributes),this.content||this.slot||(this.slot=this.innerHTML),this.id||null==this.props.popin_id||""==this.props.popin_id||(this.id=this.props.popin_id),this.ariaModal=!1,this.isVideo=!1,this.render()}attributeChangedCallback(t,n,i){this.props=e(this.attributes),"content"===t&&(this.props.content=i)}static get observedAttributes(){return["content"]}disconnectedCallback(){this.hasEvent&&this.unbindEvent()}render(){this.hasEvent&&this.unbindEvent();const{heading:e="",bgcolor:t="highlight",size:n="M",label_close:i="Close",image:s="",image_alt:r="",content:o=""}=this.props,a=o||this.slot;if(""===a)return this.bindEvent(),this.classList.remove("isOpen"),this.isOpen=!1,!1;this.checkIsVideo(a),this.isVideo?this.setAttribute("size","L"):this.setAttribute("size",n),this.setAttribute("role","dialog"),this.setAttribute("aria-hidden","true"),this.setAttribute("bgcolor",t),this.innerHTML=`\n            <nb-cta\n                variation="navigation"\n                ${"white"===t?'contrast="highlight"':'contrast="light"'}\n                icon_right="close-2"\n                label="${i}"></nb-cta>\n            <div class="wrapper">\n                <div class="title">\n                    ${e&&`<h2 class="h-lg-700-caps-sl">${e}</h2>`}\n                </div>\n                <div class="content" tabindex="-1">\n                    ${s&&`<div class="popin-header-img"><img loading="lazy" src="${s}" alt="${r}" title="${r}" width="300" height="225" /></div>`}\n                    ${a}\n                </div>\n                ${this.renderFooter()}\n            </div>\n            ${this.isVideo&&S.is.mobile?'<div class="swipeOverlay"></div>':""}\n        `,setTimeout((()=>{this.style.display="inherit"}),100),A(this),this.buttonElement=this.querySelector("button"),this.bindEvent()}renderFooter(){const{footer:e}=this.props;var t;return!(!(t=e)||"false"===t)?"<footer></footer>":""}checkIsVideo(e){const t=document.createElement("div");t.innerHTML=e,1===t.children.length&&"NB-VIDEO"===t.children[0].tagName&&(this.isVideo=!0,this.setAttribute("video","true"))}addLock(){document.getElementsByTagName("html")[0].classList.add("scroll-lock"),Wt(this.props.popin_id)}removeLock(){this.parentNode.closest("nb-popin")||document.getElementsByTagName("html")[0].classList.remove("scroll-lock"),Vt()}switchAriaModal(){this.ariaModal=!this.ariaModal,this.setAttribute("aria-modal",this.ariaModal),O(this,this.ariaModal)}async open(e){this.addEventListener("transitionend",this.boundFocus),document.addEventListener("focusin",this.boundFocusin),this.openingSource=document.activeElement;const t=o(e);t.id===this.id?(this.addLock(),this.switchAriaModal(),this.setAttribute("aria-hidden","false"),this.isOpen=!this.isOpen,await new Promise((e=>{setTimeout((()=>{this.classList.add("isOpen"),e()}),300)})),r({eventName:"WEB_COMPONENT_POPIN_OPENED",args:{id:this.props.popin_id}})):console.log("return",t.id,this.id)}close(e){e.cancelBubble=!0,e.stopPropagation&&e.stopPropagation(),this.addEventListener("transitionend",this.boundFocus),document.removeEventListener("focusin",this.boundFocusin),this.removeLock(),this.switchAriaModal(),this.setAttribute("aria-hidden","true"),this.isOpen=!this.isOpen,this.classList.remove("isOpen"),r({eventName:"WEB_COMPONENT_POPIN_CLOSED",args:{id:this.props.popin_id}})}focus(){this.removeEventListener("transitionend",this.boundFocus),this.isOpen?this.buttonElement.focus():this.openingSource.focus()}focusin(e){T(e,this,!0)}escapeClose(e){"Escape"===e.key&&this.isOpen&&this.close(e)}swipeDown(e){this.isOpen&&this.close(e)}swipeOverlayTogglePlayPause(){r({eventName:"WEB_COMPONENT_VIDEO_TOGGLE",args:{id:this.props.popin_id}})}bindEvent(){this.hasEvent=!0,null!=this.buttonElement&&this.buttonElement.addEventListener("click",this.boundClose),window.addEventListener(a,this.boundOpen),window.addEventListener("WEB_COMPONENT_POPIN_CLOSE",this.boundClose),document.addEventListener("keydown",this.boundEscapeClose),S.is.mobile&&(qt(window,document,this),this.boundSwipeDown=this.swipeDown.bind(this),document.addEventListener("swiped-down",this.boundSwipeDown),this.isVideo&&(this.swipeOverlay=this.querySelector(".swipeOverlay"),this.boundSwipeOverlayTogglePlayPause=this.swipeOverlayTogglePlayPause.bind(this),this.swipeOverlay.addEventListener("click",this.boundSwipeOverlayTogglePlayPause)))}unbindEvent(){this.hasEvent=!1,null!=this.buttonElement&&this.buttonElement.removeEventListener("click",this.boundClose),window.removeEventListener(a,this.boundOpen),window.removeEventListener("WEB_COMPONENT_POPIN_CLOSE",this.boundClose),document.removeEventListener("keydown",this.boundEscapeClose),this.boundSwipeDown&&(document.removeEventListener("swiped-down",this.boundSwipeDown),this.boundSwipeDown=null),this.boundSwipeOverlayTogglePlayPause&&(this.swipeOverlay.removeEventListener("click",this.boundSwipeOverlayTogglePlayPause),this.boundSwipeOverlayTogglePlayPause=null)}}customElements.get("nb-popin")||customElements.define("nb-popin",jt);const Gt="pnAdvancerRight",Ut="pnAdvancerLeft",Qt="#000000";class Yt{constructor(e,t={}){return this.boundNextClick=this.onNextClick.bind(this),this.boundPrevClick=this.onPrevClick.bind(this),this.boundLinkClick=this.onLinkClick.bind(this),this.boundTouchEnd=this.onTouchEnd.bind(this),this.disableAutoScroll="true"===t.disableAutoScroll||!1,this._entriesBounds=null,new Promise((n=>{this._element=e,this._slides=[].slice.call(e.children),this._options=Object.assign({},{id:"uuid",last_known_scroll_position:0,ticking:!1,navBarTravelDirection:"",navBarTravelling:!1,navBarTravelDistance:150,scrollAmount:220},t),this.buildIHM(),n(this),setTimeout((()=>{this.setOverflowAttribute(),this.initializeIndicatorPosition()}),0)}))}get element(){return this._element}buildIHM(){this._root=this.createElement("div","pn-ProductNav"),this._container=this.createElement("div","pn-ProductNavContents"),this._pnIndicator=null,this._containerSlidesContent=null,this.hasContainer()&&(this._containerSlidesContent=this.createElement("div","pn-ProductContainer")),this.wrapItems(),this._root.appendChild(this._container),this._containerSlidesContent&&this._element.appendChild(this._containerSlidesContent),this._element.insertBefore(this._root,this._element.childNodes[2]),this.createIndicator()}hasContainer(){return!!document.querySelector(".slider-container")}wrapItems(){const e=[];this._slides.map((t=>{const n=function(e){for(var t="",n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",i=n.length,s=0;s<e;s++)t+=n.charAt(Math.floor(Math.random()*i));return t}(5);if(this.hasContainer()&&t.classList.contains("slider-container")&&(t.children&&t.children.length&&[...t.children].forEach(((t,n)=>{0!==n&&(t.style.display="none"),t.id=e[n],this._containerSlidesContent.appendChild(t)})),t.remove()),!t.classList.contains("pn-Advancer")){const i=this.createElement("div","pn-ProductNavLinkWrapper");i.appendChild(t),i.setAttribute("data-inner-content-id",n),e.push(n),this._container.appendChild(i)}}))}createElement(e,t){let n=document.createElement(e);return n.setAttribute("class",t),n}createIndicator(){this.elements=[],this._pnIndicator=this.createElement("div","pn-ProductNavIndicator"),this._container.appendChild(this._pnIndicator),this.elements=Array.from(this._container.querySelectorAll("nb-link a")),this.elements.forEach((e=>{e.addEventListener("click",this.boundLinkClick)}));const e=document.getElementById(`${Ut}-${this._options.id}`);e&&e.addEventListener("click",this.boundPrevClick);const t=document.getElementById(`${Gt}-${this._options.id}`);t&&t.addEventListener("click",this.boundNextClick),this._root&&this._container.addEventListener("touchend",this.boundTouchEnd)}onLinkClick(e){this.goToElement(e.currentTarget)}goToSlide(e){this.goToElement(this._slides[e])}showContent(e){const t=document.querySelector(".pn-ProductContainer");t.children&&[...t.children].forEach((e=>e.style.display="none")),document.getElementById(e).style.display="block"}goToElement(e){if(this.hasContainer()){const t=e.closest("[data-inner-content-id]").getAttribute("data-inner-content-id");this.showContent(t)}if(this.deselectAllLinkBut(e),e.setAttribute("aria-selected","true"),!e||!this._entriesBounds)return;let t=0;for(const n of this._entriesBounds){if(n.target.getAttribute("data-href")===e.getAttribute("data-href"))break;t=t+n.boundingClientRect.width+10}this.disableAutoScroll||this._root.scroll({left:t,behavior:"smooth"})}deselectAllLinkBut(e){this.elements.map((t=>{t!==e&&t.setAttribute("aria-selected","false")}))}sideScroll(e,t,n,i,s){this.setOverflowAttribute();let r=0,o=setInterval((function(){"left"===t?e.scrollLeft-=s:e.scrollLeft+=s,r+=s,r>=i&&window.clearInterval(o)}),n);return{slideTimer:o}}onPrevClick(){this.sideScroll(this._root,"left",25,this._options.scrollAmount,10),setTimeout((()=>{this.setOverflowAttribute()}),300)}onNextClick(){this.sideScroll(this._root,"right",25,this._options.scrollAmount,10),setTimeout((()=>{this.setOverflowAttribute()}),300)}onTouchEnd(){this.setOverflowAttribute()}initializeIndicatorPosition(){const e=this._root.querySelector('[aria-selected="true"]');e&&this.moveIndicator(e,Qt)}determineOverflow(e,t){let n=t.getBoundingClientRect(),i=Math.floor(n.right),s=Math.floor(n.left),r=e.getBoundingClientRect(),o=Math.floor(r.right),a=Math.floor(r.left);return s>a&&i<o?"both":a<s?"left":o>i?"right":"none"}moveIndicator(e,t){if(!this._pnIndicator)return;let n=e.getBoundingClientRect(),i=this._container.getBoundingClientRect().left,s=n.left-i;this._pnIndicator.style.transform="translateX("+(s+this._container.scrollLeft+10)+"px) scaleX("+.01*(n.width-20)+")",this._root.scrollLeft=Math.floor(s+this._container.getBoundingClientRect().left/2),t&&(this._pnIndicator.style.backgroundColor=t)}onResize(){this.setOverflowAttribute(),this.initializeIndicatorPosition()}clearListeners(){this.elements.forEach((e=>{e.removeEventListener("click",this.boundLinkClick)}));const e=document.getElementById(`${Ut}-${this._options.id}`);e&&e.removeEventListener("click",this.boundPrevClick);const t=document.getElementById(`${Gt}-${this._options.id}`);t&&t.removeEventListener("click",this.boundNextClick)}kill(){this.clearListeners()}setOverflowAttribute(){this._element.setAttribute("data-overflowing",this.determineOverflow(this._container,this._root)),this.observe()}observe(){if(!("IntersectionObserver"in window))return!1;this._entriesBounds=[];const e=new IntersectionObserver((t=>{for(const e of t)this._entriesBounds.push({target:e.target,intersection:e.boundingClientRect.right<=window.innerWidth-10&&e.boundingClientRect.left>=10,boundingClientRect:e.boundingClientRect});e.disconnect()}),{root:this._container});this._slides.map((t=>e.observe(t)))}isInViewport(e){if(!this._entriesBounds)return!1;return this._entriesBounds.find((t=>e===t.target)).intersection}}class Jt extends HTMLElement{constructor(){super(),this.slot=this.innerHTML,this.navBarTravelling=!0,this.disableAutoScroll=!1,this.navBarTravelDirection="",this.navBarTravelDistance=200,this.randomId="swiperMenu_"+_(5),this.sliderMenu=null,this.boundOnResize=this.onResize.bind(this),this.onLoad=this.onLoad.bind(this),this.debouncedOnResize=m(this.boundOnResize,250)}static get observedAttributes(){return["navBarTravelling","navBarTravelDirection","navBarTravelDistance"]}render(){const e="true"===this.getAttribute("navigation")||"",t=this.getAttribute("a11y_slider_previous_button")||"",n=this.getAttribute("a11y_slider_next_button")||"";this.innerHTML=`\n            <div id="pnProductNav-${this.randomId}" class="pn-ProductNavWrapper ${this.randomId}">\n                ${e&&`<nb-cta id="pnAdvancerLeft-${this.randomId}"\n                        class="pn-Advancer pn-AdvancerLeft"\n                        variation="navigation"\n                        contrast="highlight"\n                        size="32"\n                        icon_right="chevron-left"\n                        label="${t}"></nb-cta>`}\n                ${this.slot}\n                ${e&&`<nb-cta id="pnAdvancerRight-${this.randomId}"\n                        class="pn-Advancer pn-AdvancerRight"\n                        variation="navigation"\n                        contrast="highlight"\n                        size="32"\n                        icon_right="chevron-right"\n                        label="${n}"></nb-cta>`}\n                <span id="pnIndicator-${this.randomId}"\n                    class="pn-ProductNavIndicator">\n                </span>\n            </div>\n\n            `,this.loadSwiper()}connectedCallback(){this.navBarTravelling=this.getAttribute("navBarTravelling")||this.navBarTravelling,this.navBarTravelDirection=this.getAttribute("navBarTravelDirection")||this.navBarTravelDirection,this.navBarTravelDistance=this.getAttribute("navBarTravelDistance")||this.navBarTravelDistance,this.disableAutoScroll=this.getAttribute("disable_auto_scroll")||"",this.render(),window.addEventListener("resize",this.debouncedOnResize)}loadSwiper(){let e=this.navBarTravelDirection,t=this.navBarTravelDistance;this.sliderMenu=new Yt(this.querySelector("."+this.randomId),{id:this.randomId,index:this.index,navBarTravelDirection:e,navBarTravelDistance:t,disableAutoScroll:this.disableAutoScroll}),this.sliderMenu.then((()=>{this.classList.add("is-show"),r({eventName:l,args:{className:this.randomId},element:this})}))}handleClick(){r({eventName:"WEB_COMPONENT_SLIDE_CHANGE"}),n({rootElement:["nb-slider-menu"]})}onLoad(){this.sliderMenu.then((e=>e.onLoad()))}onResize(){this.sliderMenu.then((e=>e.onResize()))}onNavigationClick(e){let t="";e.target&&e.target.closest(".link")&&e.target.closest(".link").getAttribute("tracking_label")&&(t=e.target.closest(".link").getAttribute("tracking_label")),i({eventAction:"PLP Content Tab",eventLabel:t})}disconnectedCallback(){window.removeEventListener("resize",this.debouncedOnResize),this.sliderMenu.then((e=>e.kill()))}}customElements.get("nb-slider-menu")||customElements.define("nb-slider-menu",Jt);const Kt=(()=>{let e=null,t=0;const n=()=>{const n=e.getAttribute("sticky")||"false";let i=0,s=!1,r={};for(var o=0;o<e.parentElement.childNodes.length&&(e.parentElement.childNodes[o].tagName&&e.parentElement.childNodes[o].tagName===e.tagName&&(r=e.parentElement.childNodes[o+2],r&&(i=r.offsetTop-80,s=!0)),!s);o++);s&&0===i&&(i=e.parentElement.offsetTop+e.parentElement.offsetHeight);const a=window.scrollY-i>0;"true"===n!==a&&(e.setAttribute("sticky",a),t>0&&(document.body.style.paddingTop=a?t+"px":"0px"))},i=()=>{window.addEventListener("scroll",n)},s=()=>{window.removeEventListener("scroll",n)};return{initialize:(s,r=t)=>{e=s,t=r,e.setAttribute("sticky","false"),e.classList.add("nb-sticky-container"),n(),i()},destroy:()=>{s()},updatePosition:(t=0)=>{const n=document.querySelector(".Header__top")?.getBoundingClientRect()||{height:0,y:0},i=n.height,s=`${n.y+i+t}px`;return e.style.top=s,0}}})();class Xt extends HTMLElement{constructor(){super(),this.isScrolling=!1,this.isSticky=!1,this.boundOnFilteredProductsDisplay=this.onFilteredProductsDisplay.bind(this),this.isMobile=window.innerWidth<768,this.heightNoSticky=this.isMobile?132:180,this.plpData=null}async connectedCallback(){this.props=e(this.parentElement.attributes),this.plpData=await window.getPLPData(),this.isSticky=!0,this.refs=M(this),this.isSticky&&Kt.initialize(this,this.heightNoSticky),this.render(),window.addEventListener("filteredProductDisplay",this.boundOnFilteredProductsDisplay),this.onFilteredProductsDisplay()}static get observedAttributes(){return["sticky"]}attributeChangedCallback(e,t,n){"sticky"===e&&n!==t&&(this.props.sticky=n,this.isSticky&&Kt.updatePosition())}render(){const{nav_links:e,navigation_bubbles:t,a11y_slider_previous_button:n,a11y_slider_next_button:i}=this.props,s=v({navigation:this.updateNavLinks(e)}),r=this.filterAndSortBubble(t),o=t?v({a11y_slider_previous_button:n,a11y_slider_next_button:i,bubbles:r,customEventAction:"PLP Content Tab"}):"";this.classList.add("plp-bar"),this.innerHTML=`<nb-navigation-bubbles data='${o}'></nb-navigation-bubbles>\n                            ${this.isSticky?`<nb-plp-sticky-bar\n                                data="${s}"\n                                a11y_slider_previous_button="${n}"\n                                a11y_slider_next_button="${i}"\n                                navigation_bubbles="${o}"\n                            ></nb-plp-sticky-bar>`:""}\n                            `}updateNavLinks(e){const{enabledTechnologies:t}=this.plpData.data.configuration.eCommerceData;if(!e.length&&t.length)return this.transformCremaTechnologiesToLink(t);if(!t.length)return e;const n=[...e].filter(this.filterDefaultTechnology);return[...this.transformCremaTechnologiesToLink(t),...n]}transformCremaTechnologiesToLink(e){return e.map((({id:e,url:t,name:n,isSelected:i})=>({link:t,label:n,seo_label:n,icon_left:this.getIconByTechnology(e.split("/").pop()),selected:i})))}getIconByTechnology(e){let t="original";return"vertuo"===e?t="gran-lungo-vertuo-capsule":"pro"===e&&(t="brand_coffee_capsule_pro"),t}filterDefaultTechnology(e){const{icon_left:t}=e;if("coffee"!==t&&"gran-lungo-vertuo-capsule"!==t&&"brand_coffee_capsule_pro"!==t)return e}filterAndSortBubble({bubbles:e}){const{productGroups:t,categories:n}=this.plpData.data.configuration.eCommerceData,i=t.map((e=>e.categoryId)),s=[],r=e.map((e=>{const t={...e,link:e.link.replace("#","")};if(i.includes(t.link))return t})).filter((e=>void 0!==e));return i.forEach((e=>{const t=r.find((({link:t})=>t===e));if(t)s.push(t);else{const t=n.find((t=>t.id===e));if(t){const{name:e,id:n,icon:i}=t,r={link:n,label:e,visual:{src:i?.url||"",alt:i?.altText||e}};s.push(r)}}})),s}onFilteredProductsDisplay(){window.filteredProducts?(this.style.display="none",this.isSticky&&Kt.destroy()):(this.style.display="block",this.isSticky&&Kt.initialize(this,this.heightNoSticky))}disconnectedCallback(){window.removeEventListener("filteredProductDisplay",this.boundOnFilteredProductsDisplay),this.isSticky&&Kt.destroy()}}customElements.get("nb-plp-bar")||customElements.define("nb-plp-bar",Xt);class Zt extends x{constructor(e,t){super(e),this.data=t}runTrack(){this.data.id&&null!==this.data.id&&""!==this.data.id&&s({ecommerce:{promoView:{promotions:[this.data]}}})}}function en(e,t,n,i,s=!0){if(s){const t=e.getElementsByTagName(n);t.length>0&&t[0].parentElement&&t[0].parentElement.removeChild(t[0])}return e.children.length>=i+1?e.insertBefore(t,e.children[i]):e.appendChild(t)}async function tn(e){const{data:t}=e;if(!t)return[];const n=t.configuration.eCommerceData;return function(e){const{categories:t,productGroups:n,products:i}=e,s=U(t),r=function(e,t){return e.filter((e=>t.some((t=>t.id===e.categoryId))))}(n,s);r.forEach((e=>{const t=s.find((t=>t.id===e.categoryId));e.productIds.forEach((e=>{const n=i.find((t=>t.id===e));n.labels=n.labels||[],n.labels.push(t.description)}))})),r.forEach((e=>{const t=n.findIndex((t=>t.categoryId===e.categoryId));n.splice(t,1)}))}(n),sn(n,Y,((e,t)=>e.fairTrade=t.name)),sn(n,Q,(e=>e.highlighted=!0)),sn(n,q,(e=>e.onlyVertuoNext=!0)),sn(n,W,(e=>e.organicEu=!0)),sn(n,V,(e=>e.rainforest=!0)),sn(n,j,(e=>e.sustainability=!0)),sn(n,G,(e=>e.arabica=!0)),function(e){const{categories:t,productGroups:n,products:i}=e;t.forEach((e=>{const s=e.subCategories.length>0&&function(e){return e.superCategories.some((e=>J("cat/capsule-range").test(e)))}(e);s&&(e.segments=e.subCategories.map((e=>{const s=t.find((t=>t.id===e));return s&&function(e,t){return t.superCategories.some((e=>J("cat/capsule-range").test(e)))}(0,s)&&(s.products=nn(n,s.id,i),s.isSegment=!0),s}))),e.products=nn(n,e.id,i)}))}(n),n.categories}function nn(e,t,n){let i=[];try{const s=e.find((e=>e.categoryId===t));if(!s)return i;const{productIds:r}=s;return r.map((e=>n.find((t=>t.id===e))))}catch(e){console.log(e)}return i}function sn(e,t,n){const{categories:i,productGroups:s,products:r}=e,o=t(i);if(!o)return;const a=function(e,t){return e.find((e=>t.id===e.categoryId))}(s,o);if(!a)return;a.productIds.forEach((e=>{const i=r.find((t=>t.id===e));t===G&&console.log("addProductAttribute",i),n(i,o)}));const l=s.findIndex((e=>e.categoryId===a.categoryId));s.splice(l,1)}async function rn(e,t){const{data:n}=e;if(!n)return[];const{categories:i,productGroups:s,products:r}=n.configuration.eCommerceData;!function(e,t){e.categories=[{icon:null,detailsIcon:null,url:null,capacityLabel:null,rangeLink:null,subCategories:[],superCategories:["nesclub2.it.b2c/cat/machine-range","nesclub2.it.b2c/cat/machine-range-registration"],...t}]}(n.configuration.eCommerceData,t),function(e,t){let n;e.forEach((e=>{e.productIds.forEach(((e,i)=>{const s=t.find((t=>t.id===e));0===i?(n=s,n.colors=[ln(n)]):(n.variants=n.variants?n.variants:[],n.colors.push(ln(s)),n.variants.push(s))}))}))}(s,r),function(e,t,n){e.products=n.filter((e=>t.some((t=>t.productIds[0]&&t.productIds[0]===e.id))))}(n.configuration.eCommerceData,s,r),function(e,t){e.categories[0].products=t}(n.configuration.eCommerceData,n.configuration.eCommerceData.products),function(e,t,n){const i=function(e){return e.filter((e=>function(e){return cn("cat/machine-range-label").test(e.id)}(e)))}(e),s=function(e,t){return e.filter((e=>t.some((t=>t.id===e.categoryId))))}(t,i);s.forEach((e=>{const t=i.find((t=>t.id===e.categoryId));e.productIds.forEach((e=>{const i=n.find((t=>t.id===e));i.labels=i.labels||[],i.labels.push(t.description)}))})),s.forEach((e=>{const n=t.findIndex((t=>t.categoryId===e.categoryId));t.splice(n,1)}))}(i,s,r),function(e,t,n){const i=function(e){return e.find((e=>function(e){return cn("cat/machine-attribute-highlight").test(e.id)}(e)))}(e);if(!i)return;const s=function(e,t){return e.find((e=>t.id===e.categoryId))}(t,i);if(!s)return;s.productIds.forEach((e=>{n.find((t=>t.id===e)).highlighted=!0}));const r=t.findIndex((e=>e.categoryId===s.categoryId));t.splice(r,1)}(i,s,r);const o=await async function(e){let t=[];for(const n of e.products)t.push(await window.napi.catalog().getProduct(n.id));return t}(n.configuration.eCommerceData);return await async function(e,t){for(const n of e.products){const e=t.find((e=>e.id===n.id));null==e&&console.log("can't find product",n.id),await an(n,e),on(n,e)}}(n.configuration.eCommerceData,o),n.configuration.eCommerceData.categories}function on(e,t){e.slides=t.slides}async function an(e,t){if(null==t||null==t.supercategories)return;const n=await Promise.all(t.supercategories.map((async e=>await window.napi.catalog().getCategory(e))));e.supercategories=n}function ln(e){return{category:e.colorCategories[0],name:e.colorShade.name,code:e.colorShade.cssColorCode,sku:e.internationalId,link:e.url}}function cn(e){return new RegExp(e.replace(/\//g,"\\/"))}class dn extends HTMLElement{constructor(){super(),this.readyDeferred=new window.nwcFoundations.Deferred,this.ready=this.readyDeferred.promise,this.props=null,this.list=[],this.productCardBank={},this.productRenderQueue={},this.plpData=null,this.plpCategories=null,this.boundOnFilteredProductsDisplay=this.onFilteredProductsDisplay.bind(this)}connectedCallback(){this.props=e(this.attributes),this.init().finally((()=>{this.render(),this.initTracking(),this.readyDeferred.resolve()}))}async init(){const{categories:e=[]}=this.props;try{this.priceFormatter=await we(),this.currency=(await ye()).currency}catch(e){console.log(e)}fe(),this.plpData=await window.getPLPData(),this.productType=this.plpData.data.configuration.props.productTypeDisplayMode,this.plpCategories=this.plpData.data.configuration.eCommerceData.categories,"MACHINE"===this.productType?this.list=await rn(this.plpData,e[0]):this.list.push(...(await tn(this.plpData)).map((t=>{const n=e.find((e=>e.category_id===t.id));return n?(delete n.category_id,{...t,...n}):t})).filter((e=>!e.isSegment&&e.products&&e.products.length>0))),window.addEventListener("filteredProductDisplay",this.boundOnFilteredProductsDisplay),"CAPSULE"===this.productType&&(this.range=(Te||(Te={[ke]:[0,14]}),[Te.intensity[0],Te.intensity[Te.intensity.length-1]])),await ze()}onFilteredProductsDisplay(){setTimeout((()=>{this.updateList(),this.updateResultsHeader()}),0)}render(){const{nav_links:e=[],cta_filter_label:t="",label_sort_by:n="",label_close_sort_by:i="",a11y_label_close_sort_by:s="",see_result_number_label:r="See {resultsLength} Results",see_result_number_label_zero:o="",see_result_number_label_one:a="",a11y_see_result_number_label:l="Close and validate filters",filter_group_intensity_light:c="Light {range}",filter_group_intensity_medium:d="Mild {range}",filter_group_intensity_intense:u="Intense {range}",filter_group_intensity_light_max_label:h=Se.lightMax,filter_group_intensity_mild_min_label:p=Se.mildMin,filter_group_intensity_mild_max_label:b=Se.mildMax,filter_group_intensity_intense_min_label:_=Se.intenseMin,dropdown_recommended_option_label:g="Recommended",dropdown_price_ascending_option_label:m="Lower price",dropdown_price_descending_option_label:f="Higher price",dropdown_intensity_ascending_option_label:y="Lower intensity",dropdown_intensity_descending_option_label:w="Higher intensity",a11y_slider_previous_button:k="Slider menu to previous item",a11y_slider_next_button:E="Slider menu to next item"}=this.props,C=v({navigation:this.updateNavLinks(e)}),L=v({filter_group_intensity_light_max_label:h,filter_group_intensity_mild_min_label:p,filter_group_intensity_mild_max_label:b,filter_group_intensity_intense_min_label:_});this.innerHTML=`\n            <nb-plp-filter\n                data-response='${L}'\n                data='${C}'\n                cta_filter_label="${t}"\n                label_sort_by="${n}"\n                label_close_sort_by="${i}"\n                a11y_label_close_sort_by="${s}"\n                see_result_number_label="${r}"\n                see_result_number_label_zero="${o}"\n                see_result_number_label_one="${a}"\n                a11y_see_result_number_label="${l}"\n                filter_group_intensity_light="${c}"\n                filter_group_intensity_medium="${d}"\n                filter_group_intensity_intense="${u}"\n                dropdown_recommended_option_label="${g}"\n                dropdown_price_ascending_option_label="${m}"\n                dropdown_price_descending_option_label="${f}"\n                dropdown_intensity_ascending_option_label="${y}"\n                dropdown_intensity_descending_option_label="${w}"\n                dropdown_intensity_allow="${"CAPSULE"===this.productType}"\n                a11y_slider_previous_button="${k}"\n                a11y_slider_next_button="${E}"\n            ></nb-plp-filter>\n            <nb-plp-bar></nb-plp-bar>\n            ${this.renderResultsHeader()}\n            <div id="PLPListContainer">\n                ${this.renderList()}\n            </div>`,this.renderProductQueue()}updateNavLinks(e){const{enabledTechnologies:t}=this.plpData.data.configuration.eCommerceData;if(!e.length&&t.length)return this.transformCremaTechnologiesToLink(t);if(!t.length)return e;const n=[...e].filter(this.filterDefaultTechnology);return[...this.transformCremaTechnologiesToLink(t),...n]}transformCremaTechnologiesToLink(e){return e.map((({id:e,url:t,name:n,isSelected:i})=>({link:t,label:n,seo_label:n,icon_left:this.getIconByTechnology(e.split("/").pop()),selected:i})))}getIconByTechnology(e){let t="original";return"vertuo"===e?t="gran-lungo-vertuo-capsule":"pro"===e&&(t="brand_coffee_capsule_pro"),t}filterDefaultTechnology(e){const{icon_left:t}=e;if("coffee"!==t&&"gran-lungo-vertuo-capsule"!==t&&"brand_coffee_capsule_pro"!==t)return e}updateList(){this.listContainer=this.querySelector("#PLPListContainer"),this.listContainer&&(this.listContainer.innerHTML=this.renderList(),this.renderProductQueue())}async renderProductQueue(){for(const[e,t]of Object.entries(this.productRenderQueue)){let n=0;const i=Array.from(this.querySelectorAll(e));for(let e=0;e<i.length;e++){const s=i[e],{categoryID:r,data:o,parentCategory:a}=t[e];let l=0;for(const e of o){const t=this.getProductCardBankId(r,e),i=l++;this.getProductElement(r,e,1+n++,a).then((e=>{this.productCardBank[t]=en(s,e,"nb-plp-product-card",i,!1)}))}}}this.productRenderQueue={}}getProductCardBankId(e,t){return e+"-"+t.id}renderList(){return null==window.filteredProducts?this.list.map((e=>this.renderCategory(e))).join(""):(this.queueProductRender(".plp-grid","none",window.filteredProducts),"<nb-container>\n                        <div class='plp-grid plp-filtered'>\n                        </div>\n                    </nb-container>")}updateResultsHeader(){const e=this.getElementsByTagName("nb-plp-filter-results")[0];if(e&&null==window.filteredProducts)e.parentElement.removeChild(e);else if(null==e&&null!=window.filteredProducts){let e=document.createElement("DIV");const t=this.getElementsByTagName("nb-plp-filter")[0];t&&t.insertAdjacentElement("afterend",e),e.outerHTML=this.renderResultsHeader()}}renderResultsHeader(){return null!=window.filteredProducts&&Object.values(ct(Te)).some((e=>e))?`<nb-plp-filter-results\n                ${this.renderResultsHeaderProps()}\n            ></nb-plp-filter-results>`:""}renderResultsHeaderProps(){const{header_result_label:e="Currently shopping by",a11y_header_result_label_button:t="Reset filter",header_result_label_reset:n="Reset all",a11y_header_result_label_reset:i="Filters",header_result_label_results:s="Results",header_result_label_results_zero:r="",header_result_label_results_one:o="",a11y_header_result_label_results:a="With your filters activated, you have currently",filter_group_intensity_light:l="Light {range}",filter_group_intensity_medium:c="Mild {range}",filter_group_intensity_intense:d="Intense {range}"}=this.props;return`data='${v({label:e,a11y_label_button:t,label_reset:n,a11y_label_reset:i,label_results:s,label_results_zero:r,label_results_one:o,a11y_label_results:a,filter_group_intensity_light:l,filter_group_intensity_medium:c,filter_group_intensity_intense:d})}'`}queueProductRender(e,t,n,i){this.productRenderQueue[e]=this.productRenderQueue[e]||[],this.productRenderQueue[e].push({categoryID:t,data:n,parentCategory:i})}renderCategory(e){const{name:t="",description:n="",rangeLink:i,background_retina:s="https://www.nespresso.com/shared_res/agility/next-components/assets/backgrounds/barista_creation_range_L.jpg",background_desktop:r="https://www.nespresso.com/shared_res/agility/next-components/assets/backgrounds/barista_creation_range_L.jpg",background_mobile:o="https://www.nespresso.com/shared_res/agility/next-components/assets/backgrounds/barista_creation_range_L.jpg",contrast:a="dark",segments:l,products:c,id:d}=e,u=i&&i.name?i.name:"",h=i&&i.url?i.url:"",p=!!(l&&l.length>0);return l||this.queueProductRender(".plp-grid",d,c),`<div>\n                    <nb-plp-category\n                        data-id="${d}"\n                        name="${t}"\n                        description="${"string"==typeof n?n:""}"\n                        background_retina="${s}"\n                        background_desktop="${r}"\n                        background_mobile="${o}"\n                        cta_text="${u}"\n                        cta_link="${h}"\n                        segments="${p}"\n                        contrast="${a}"\n                        >\n                        ${this.renderContent(l,e)}\n                        ${u&&h?`<nb-link link='${h}' size='large' color='gold' class='bottom-range-link'>${u}</nb-link>`:""}\n                    </nb-plp-category>\n                </div>`}renderContent(e,t){return e&&e.length>0?this.renderSegments(e,t):"<div class='plp-grid'></div>"}renderSegments(e,t){return null==e||0===e.length?"":e.map((e=>{if(!e)return"";const{products:n}=e;return n&&n.length>0&&this.queueProductRender(".plp-grid",e.id,n,t),`<div class="cb-plp-category--segment">\n                            <div class='cb-plp-category--side'>\n                                <nb-plp-segment\n                                    name='${e.name}'\n                                    description='${e.description}'\n                                ></nb-plp-segment>\n                            </div>\n                            <div class='cb-plp-category--center'>\n                                <div class='plp-grid'>\n                                </div>\n                            </div>\n                        </div>`})).join("")}async getProductElement(e,t,n,i){const{label_sleeve:s="",label_sleeves:r="",show_sleeve:o=!1,label_capsules:a="",show_sleeve_price:l=!1,is_headline_hidden:c=!1,capsule_price_label:d,capsule_price_syntax:u,a11y_price:h="",alt_fair_trade:p="",alt_vertuo_next:b="",alt_organic:_="",alt_rainforest:g="",alt_sustainability:m="",alt_q_certification_arabica:f="",a11y_intensity_max:v="",a11y_product_card:y="",label_decaffeinato:w="",a11y_extra_color:k,show_ratings:E,minimum_rating:C,shop_similar:L,a11y_energy_label:$,src_page:S,plp_type:O}=this.props,T=this.getProductCardBankId(e,t);if(this.productCardBank[T])return this.productCardBank[T];{const A=document.createElement("nb-plp-product-card");let{showCapsulePrice:P,price:x,price_per_capsule:I}=function(e,t,n){let i,s,r=e;const o=n(t);return e&&"capsule"===t.type&&!o?(i=!1===o?t.price*t.salesMultiple:t.price,i=Math.round(100*i)/100,s=t.price):(r=!1,i=t.price),{showCapsulePrice:r,price:i,price_per_capsule:s}}(l,t,oe),N={...t,category_name:this.getCategoryName(null!=i?i.id:e),url:t.url||"",image:t.image.url||"",price:this.priceFormatter.short(this.currency,x),image_alt_text:t.image.altText||"",type:t.type||"",name:t.name||"",description:t.description||"",headline:t.headline||"",is_headline_hidden:c,technologies:t.technologies,sku:t.internationalId||"",bundled:oe(t),longSku:t.id||"",a11y_price:h,a11y_product_card:y,position:n,show_ratings:E,minimum_rating:C,a11y_extra_color:k,in_stock:t.inStock,shop_similar:L,a11y_energy_label:$,src_page:S,plp_type:O};if("CAPSULE"===this.productType){const e=function(e){function t(e,t){return e%t==0}return"original"===function(e){const t=e.technologies[0];return t.substring(t.indexOf("/machineTechno/")+"/machineTechno/".length)}(e)?1===e.sales_multiple?t(e.unitQuantity,10)?e.unitQuantity/10:NaN:t(e.sales_multiple,10)?e.sales_multiple/10:NaN:1===e.sales_multiple?t(e.unitQuantity,10)&&1!==e.unitQuantity?e.unitQuantity/10:t(e.unitQuantity,7)&&1!==e.unitQuantity?e.unitQuantity/7:NaN:t(e.sales_multiple,10)?e.sales_multiple/10:t(e.sales_multiple,7)?e.sales_multiple/7:NaN}(t);N={...N,sales_multiple:t.salesMultiple||"",intensity_label:Me["productlistrespblock.capsule.a11y.intensity"],intensity:t.intensity||"",number_of_sleeves:e,label_sleeve:s,label_sleeves:r,show_sleeve:!isNaN(e)&&o,label_capsules:a,a11y_intensity_max:v,label_decaffeinato:w,show_capsule_price:P,price_per_capsule:this.priceFormatter.short(this.currency,I),capsule_price_label:d,capsule_price_syntax:u,min_intensity:this.range[0],max_intensity:this.range[1]}}if(window.napi.ratings&&t.productRatings&&t.productRatings.ratingEnabled)try{N.ratings=await window.napi.ratings().summary(t.id)}catch(e){console.log("Rating API Error: ",e)}if(null!=t.labels)try{N.labels=t.labels.map((e=>JSON.parse(e)))}catch(e){console.error("Wrong JSON format in HMC label categories capsule-range-label",e)}null!=t.slides&&(N.slides=t.slides,N.show_slider="true"),t.highlighted&&(N.highlighted=t.highlighted,A.setAttribute("highlighted",t.highlighted));const M=N.logos=[];return null!=t.onlyVertuoNext&&M.push({name:"only_vertuo_next",alt:b}),null!=t.fairTrade&&M.push({name:"fair_trade",alt:p}),null!=t.organicEu&&M.push({name:"is_organic",alt:_}),null!=t.rainforest&&M.push({name:"is_rainforest",alt:g}),null!=t.sustainability&&M.push({name:"is_sustainable",alt:m}),null!=t.arabica&&M.push({name:"is_q_certified_arabica",alt:f}),A.setAttribute("data",JSON.stringify(N)),this.productCardBank[T]=A,A}}getCategoryName(e){const t=this.plpCategories.find((t=>t.id===e));return t?t.name:""}initTracking(){const{campaign_id:e=null,campaign_name:t=null,campaign_position:n=null,campaign_creative:i=null}=this.props;!function(e,t){const n=new Zt(e,t)}(this,{id:e,name:t,position:n,creative:i})}}customElements.get("nb-plp")||customElements.define("nb-plp",dn);export{dn as default};
