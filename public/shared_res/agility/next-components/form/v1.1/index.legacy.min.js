const e=e=>null==e;class t extends HTMLElement{constructor(){super(),this.boundCancel=this.onCancel.bind(this),this.boundSubmit=this.onSubmit.bind(this),this.boundFormData=this.onFormData.bind(this),this.boundBackToForm=this.onBackToForm.bind(this),this.boundClose=this.onClose.bind(this),this.url=null}connectedCallback(){this.props=(t=>{const s=(e=>e.find((e=>"data"===e.nodeName)))([...t]),n=[...t].filter((e=>"data"!==e.nodeName)).reduce(((e,t)=>({...e,[t.nodeName]:t.nodeValue})),{});if(e(s))return n;try{return{...n,...JSON.parse(s.nodeValue)}}catch(e){console.log("ERROR: No data",e)}})(this.attributes),this.classList.add("nb-form"),this.render(),this.bindEvent()}render(){const{element_id:e,element_name:t,heading:s,elements:n}=this.props;if(!n||!n.length)return null;this.innerHTML=`\n            <form id="${e}" name="${t}" method="post" tabindex="0" novalidate/>\n                <h2 class="h-lg-700-caps-sl">${s}</h2>\n                ${this.renderElements()}\n                ${this.renderTermsOfUse()}\n                <div class='cb-action'>\n                    ${this.renderSubmit()}\n                    ${this.renderCancel()}\n                </div>\n            </form>\n            <div class="cb-overlay"><nb-loader></nb-loader></div>\n        `,this.form=this.querySelector("form"),this.elements=this.querySelectorAll("nb-checkbox, nb-input-text, nb-textarea, nb-star-rating"),this.ctaCancel=this.querySelector(".cb-cancel"),this.ctaSubmit=this.querySelector(".cb-submit")}renderElements(){const{elements:e}=this.props;return e&&e.length?e.map((e=>`<nb-${e.type} data='${JSON.stringify(e)}'></nb-${e.type}>`)).join(""):""}renderTermsOfUse(){const{terms_of_use:e}=this.props;return e?`<p class="wysiwyg t-sm-400-sl">${e}</p>`:""}renderCancel(){const{cancel_cta:e}=this.props;return e?`<nb-cta class="cb-cancel" variation="tertiary">${e}</nb-cta>`:""}renderSubmit(){const{submit_cta:e}=this.props;return e?`<nb-cta class="cb-submit" variation="secondary">${e}</nb-cta>`:""}onCancel(e){e.preventDefault()}onSubmit(e){e.preventDefault(),new FormData(this.form)}onFormData(e){let t=!0;this.elements.forEach((e=>{let s=e.checkValidity();t=t&&s})),t&&(this.toggleLoader(),this.submitValidForm(e))}submitValidForm(){}toggleElement(e){this.classList.contains(e)?this.classList.remove(e):this.classList.add(e)}toggleLoader(){this.toggleElement("show-loader")}toggleForm(){this.toggleElement("hide-form")}onError(e){const{error:t}=this.props;this.error=!0,this.renderRequestMessage(t,e)}onSuccess(){const{success:e}=this.props;this.success=!0,this.renderRequestMessage(e)}renderRequestMessage(e,t){this.requestMessage=document.createElement("div"),this.requestMessage.classList.add("cb-message"),this.requestMessage.setAttribute("role","alert"),this.requestMessage.setAttribute("tabindex","0");let s="";t&&(s=`<p class='t-sm-400'>${t}</p>`),this.requestMessage.innerHTML=`\n            <nb-icon icon="${e.icon}"></nb-icon>\n            <h1 class="h-lg-700-caps-sl">${e.heading}</h1>\n            <p class='t-sm-400'>${e.description}</p>\n            ${s}\n            <nb-cta class='cb-back' variation="secondary">${e.cta}</nb-cta>\n        `,this.form.parentNode.insertBefore(this.requestMessage,this.form.nextSibling),this.bindRequestMessageCta(),this.toggleForm(),this.toggleLoader(),this.requestMessage.focus()}bindRequestMessageCta(){this.ctaBack=this.querySelector(".cb-back"),this.error&&this.ctaBack.addEventListener("click",this.boundBackToForm),this.success&&this.ctaBack.addEventListener("click",this.boundClose)}onBackToForm(){this.toggleLoader(),setTimeout((()=>{this.requestMessage.remove(),this.toggleForm(),this.toggleLoader(),this.form.focus()}),500)}onClose(){}setUrl(e){this.url=e}bindEvent(){this.ctaSubmit&&this.ctaSubmit.addEventListener("click",this.boundSubmit),this.ctaCancel&&this.ctaCancel.addEventListener("click",this.boundCancel),this.form&&this.form.addEventListener("formdata",this.boundFormData)}unbindEvent(){this.ctaSubmit&&this.ctaSubmit.removeEventListener("click",this.boundSubmit),this.ctaCancel&&this.ctaCancel.removeEventListener("click",this.boundCancel),this.form&&this.form.removeEventListener("formdata",this.boundFormData)}disconnectedCallback(){this.unbindEvent()}}customElements.get("nb-form")||customElements.define("nb-form",t);export{t as default};
