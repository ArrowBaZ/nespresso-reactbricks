const e=e=>{const s=(e=>e.find((e=>"data"===e.nodeName)))([...e]),i=[...e].filter((e=>"data"!==e.nodeName)).reduce(((e,t)=>({...e,[t.nodeName]:t.nodeValue})),{});if(t(s))return i;try{return{...i,...JSON.parse(s.nodeValue)}}catch(e){console.log("ERROR: No data",e)}},t=e=>null==e;class s extends HTMLElement{constructor(){super(),this.props={},this.labels=[]}connectedCallback(){this.props=e(this.attributes),this.render()}render(){const{labels:e=[],direction:t="column"}=this.props;if(this.classList.add(""+("row"===t?"direction-row":"direction-"+t)),0===e.length)return"";this.labels=e,this.innerHTML=`${this.renderLabels()}`}renderLabels(){return this.labels.map((e=>{const{name:t="",bgColor:s="",color:i=""}=e;return`<mark class="t-3xs-500"\n                            ${s&&i&&`style="background: ${s}; color: ${i}"`}>\n                            <span aria-hidden="true">${t}</span>\n                            <span class="sr-only">${t}</span>\n                        </mark>`})).join("")}}customElements.get("nb-card-labels")||customElements.define("nb-card-labels",s);const i=()=>{const e=window[window?.padlNamespace]?.dataLayer;return e?e.app.app.market.toLocaleLowerCase():"ch"},n={fair_trade:"https://www.nespresso.com/shared_res/agility/commons/img/icons/fairTrade.svg",is_organic:function(){let e="https://www.nespresso.com/shared_res/agility/commons/img/icons/logo-organic-eu.svg";switch(i()){case"us":e="https://www.nespresso.com/shared_res/agility/commons/img/icons/logo-organic-us.svg";break;case"ca":e="https://www.nespresso.com/shared_res/agility/commons/img/icons/logo-organic-ca.svg";break;case"br":e="https://www.nespresso.com/shared_res/agility/commons/img/icons/logo-organic-br.svg";break;case"jp":e="https://www.nespresso.com/shared_res/agility/commons/img/icons/logo-organic-jp.svg";break;case"be":e="https://www.nespresso.com/shared_res/agility/commons/img/icons/logo-organic-be.png"}return e}(),only_vertuo_next:"https://www.nespresso.com/shared_res/agility/commons/img/icons/logo-only-vertuo-next.svg",is_q_certified_arabica:"https://www.nespresso.com/shared_res/agility/commons/img/icons/q_grade_certification_arabica.svg",is_rainforest:"https://www.nespresso.com/shared_res/agility/commons/img/icons/logo-rainforest.svg",is_sustainable:"https://www.nespresso.com/shared_res/agility/commons/img/icons/logo-sustainability.svg",is_design_award_2021:"https://www.nespresso.com/shared_res/agility/commons/img/icons/design_award_2021.svg"};class r extends HTMLElement{constructor(){super(),this.props={}}connectedCallback(){this.props=e(this.attributes),this.render()}render(){let e,t,s,i,r,a,o,l,d,c,h,p,{direction:u="row",logos:_}=this.props;this.classList.add(""+("column"===u?"direction-column":"direction-"+u));let g=[];null==_?(e=this.props?.fair_trade,t=this.props?.alt_fair_trade,s=this.props?.is_organic,i=this.props?.alt_organic,r=this.props?.only_vertuo_next,a=this.props?.alt_vertuo_next,o=this.props?.is_rainforest,l=this.props?.alt_rainforest,d=this.props?.is_sustainable,c=this.props?.alt_sustainable,h=this.props?.is_q_certified_arabica,p=this.props?.alt_q_certification_arabica):void 0===_.length?(e=_?.fair_trade,t=_?.alt_fair_trade,s=_?.is_organic,i=_?.alt_organic,r=_?.only_vertuo_next,a=_?.alt_vertuo_next,o=_?.is_rainforest,l=_?.alt_rainforest,d=_?.is_sustainable,c=_?.alt_sustainable,h=_?.is_q_certified_arabica,p=_?.alt_q_certification_arabica):_.length&&(g=[..._]),[[e,"fair_trade",t,g],[s,"is_organic",i,g],[r,"only_vertuo_next",a,g],[o,"is_rainforest",l,g],[d,"is_sustainable",c,g],[h,"is_q_certified_arabica",p,g]].map((e=>this.appendLogo.apply(this,e))),this.innerHTML=g.map((e=>`<img src="${n[e.name]}" alt="${e.alt}" loading="lazy">`)).join("")}appendLogo(e,t,s,i){e&&!this.hasLogo(i,t)&&i.push({name:t,alt:s})}hasLogo(e,t){return e.some((e=>e.name===t))}}function a(e){for(var t="",s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",i=s.length,n=0;n<e;n++)t+=s.charAt(Math.floor(Math.random()*i));return t}customElements.get("nb-card-logos")||customElements.define("nb-card-logos",r);const o=e=>l(JSON.stringify(e)),l=e=>e?e.toString().replace(/"/g,"&quot;").replace(/'/g,"&apos;"):"",d=(e,t)=>{for(let s in t)e.setAttribute(s,t[s])};class c{constructor(e){this._carousel=e,this._carousel._container.addEventListener("dragstart",(e=>e.preventDefault())),this._carousel._container.addEventListener("touchstart",(e=>this.startDrag(e)),{passive:!0}),this._carousel._container.addEventListener("mousedown",(e=>this.startDrag(e))),this._carousel._container.addEventListener("touchstart",(e=>this.startDrag(e)),{passive:!0}),window.addEventListener("mousemove",(e=>this.drag(e)),{passive:!1}),window.addEventListener("touchmove",(e=>this.drag(e)),{passive:!1}),window.addEventListener("mouseup",(()=>this.endDrag())),window.addEventListener("touchend",(()=>this.endDrag())),window.addEventListener("touchcancel",(()=>this.endDrag())),this.translateFactor=150}startDrag(e){e.touches&&e.touches.length>1||(e.touches&&(e=e.touches[0]),this._origin={x:e.screenX,y:e.screenY},this._width=this._carousel.containerWidth)}drag(e){if(!this._origin)return;const t=e.touches?e.touches[0]:e,s={x:t.screenX-this._origin.x,y:t.screenY-this._origin.y};this._lastTranslate=s;const i=this._carousel._currentIndex*this._carousel._widthSlide-this.translateFactor*s.x/this._width;this._carousel.translate(i)}preventMobileYTranslate(e,t){e.touches&&(e.touches&&Math.abs(t.x)>Math.abs(t.y)||e.touches&&Math.abs(t.y)>Math.abs(t.x))&&(e.preventDefault(),e.stopPropagation())}endDrag(){if(!this._origin||!this._lastTranslate)return this._origin=null,void(this._lastTranslate=null);const e=this._lastTranslate.x/this._carousel.carouselWidth;if(Math.abs(e)>.1){const e=this._lastTranslate.x<0?"next":"prev";this._carousel[e]()}else this._carousel.goToItem(this._carousel._currentIndex);this._origin=null,this._lastTranslate=null}}class h{constructor(e){this._carousel=e,new MutationObserver((e=>{e.forEach((function(e){if(!e||!e.oldValue||!e.classList)return;const t=e.classList.contains("has-overlay-absolute"),s=document.body.classList.contains("has-overlay");t&&!s&&this._carousel.goToItem(this._carousel._currentIndex)}))})).observe(document.body,{attributes:!0,attributeFilter:["class"],attributeOldValue:!0})}}class p{constructor(e,t={}){this._element=e,this._slides=[].slice.call(e.children);const s=t.index||0;this._options=Object.assign({},{slidesToScroll:1,slidesVisible:1,spaceBetween:0,navigationButton:!0,loop:!0,pagination:!0,hookGetRightBoundary:null,hookSlideChange:null,hookMove:null,hookNext:null,hookPrevious:null,pagination_variation:null,nav_centered:!1},t),this.moveCallbacks=[],this._ratio=this._slides.length/this._options.slidesVisible,this.buildIHM(),new h(this),this.hasPagination()&&(new c(this),this.goToItem(s))}get element(){return this._element}get slidesToScroll(){return this._options.slidesToScroll}get slidesVisible(){return this._options.slidesVisible}get slidesTotal(){return this._slides.length}get navigationButton(){return this._options.navigationButton}get navigationVariation(){return this._options.navigation_variation}get navigationSize(){return this._options.navigation_size}get loop(){return this._options.loop}get pagination(){return this._options.pagination}get containerWidth(){return this._container.offsetWidth}get carouselWidth(){return this._root.offsetWidth}get wrapperWidth(){return this._wrapper.offsetWidth}get paginationVariation(){return this._options.pagination_variation}get nav_centered(){return this._options.nav_centered}getSlideWidth(e){const{slidesVisible:t,spaceBetween:s}=this._options;return(e+parseInt(s))/t}buildIHM(){this._root=this.createElement("div","carousel"),this._container=this.createElement("div","container"),this._wrapper=this.createElement("div","wrapper"),this._children=this._slides.map((e=>{const t=this.createElement("div","item");return t.appendChild(e),this._container.appendChild(t),t})),this._wrapper.appendChild(this._container),this._root.appendChild(this._wrapper),this._element.appendChild(this._root),this.setWrapperStyle(),this.hasPagination()&&(this.navigationButton&&this.createNavigation(),this.pagination&&this.createPagination())}setWrapperStyle(){const e=this.wrapperWidth,t=this.getSlideWidth(e),s=t*this._children.length;this.setContainerWidth(s),this.setWrapperWidth(e);for(const e of this._children)this.setSlideWidth(e,t);this._widthContainer=s,this._widthSlide=t,this._widthWrapper=e}setSlideWidth(e,t){e.style.width=t-this._options.spaceBetween+"px",this._options.spaceBetween&&(e.style.marginRight=`${this._options.spaceBetween}px`)}setContainerWidth(e){this._container.style.width=`${e}px`}setWrapperWidth(e){this._wrapper.style.width=`${e}px`}disableTransition(){this._container.style.transition="none"}enableTransition(){this._container.style.transition=""}translate(e){this._container.style.left=-e+"px"}createElement(e,t){let s=document.createElement(e);return s.setAttribute("class",t),s}createNavigation(){const e=this.createElement("nb-cta","prev");e.setAttribute("variation","navigation"),e.setAttribute("contrast",this.navigationVariation),e.setAttribute("size",this.navigationSize),e.setAttribute("icon_right","chevron-left"),e.setAttribute("label","a11y_slider_previous_button");const t=this.createElement("nb-cta","next");t.setAttribute("variation","navigation"),t.setAttribute("contrast",this.navigationVariation),t.setAttribute("size",this.navigationSize),t.setAttribute("icon_right","chevron-right"),t.setAttribute("label","a11y_slider_next_button"),t.addEventListener("click",(()=>this.next())),e.addEventListener("click",(()=>this.prev())),t.addEventListener("keydown",(e=>"Enter"===e.key||"Space"===e.key?this.next():null)),e.addEventListener("keydown",(e=>"Enter"===e.key||"Space"===e.key?this.prev():null));let s=this._root.parentElement;s.appendChild(e),s.appendChild(t),this.onMove((s=>{const i=s._currentIndex+this.slidesVisible;this.loop||(s._currentIndex<=0?e.classList.add("hidden"):e.classList.remove("hidden"),this._slides.length===i?t.classList.add("hidden"):t.classList.remove("hidden"),this._options.hookMove&&this._options.hookMove(t))}))}getSlideNotVisible(){return this._children.length-(this.slidesVisible-1)}hasPagination(){return this.getSlideNotVisible()>1}createPaginationBullets(){const e=document.createElement("nav"),t=[];for(let s=0;s<this.getSlideNotVisible();s+=this.slidesToScroll){let i=document.createElement("span");i.innerText=(s+1).toString();let n=document.createElement("button");n.addEventListener("click",(()=>this.goToItem(s))),n.appendChild(i),e.appendChild(n),t.push(n)}const s=e=>{let s=t[e/this.slidesToScroll];s&&(t.forEach((e=>e.classList.remove("active"))),s.classList.add("active"))};s(this._currentIndex),this.onMove((()=>s(this._currentIndex))),this._root.parentElement.parentElement.appendChild(e)}createPaginationStepper(){const e=document.createElement("nav");let t=document.createElement("div");t.innerText=this.slidesTotal-this.slidesVisible+1,t.classList.add("totalPages");let s=document.createElement("div");s.innerText="/";let i=document.createElement("div");i.classList.add("currentPage"),e.appendChild(i),e.appendChild(s),e.appendChild(t),this.onMove((()=>i.innerText=this._currentIndex+1)),this.onMove((()=>e.setAttribute("aria-label",i.innerText+" "+s.innerHTML+" "+t.innerHTML))),this._root.parentElement.parentElement.appendChild(e)}createPagination(){this.slidesTotal<=5?this.createPaginationBullets():"stepper"===this.paginationVariation?(this.createPaginationStepper(),console.info("paginationVariation >> enabled")):(this.createPaginationBullets(),console.info("bullets enabled"))}next(){let e=this._currentIndex+this.slidesToScroll;this._options.hookNext&&(e=this._options.hookNext(e)),this.goToItem(e)}prev(){let e=this._currentIndex-this.slidesToScroll;this._options.hookPrevious&&(e=this._options.hookPrevious(e)),this.goToItem(e)}goToItem(e){this.hackUi();const t=this.getOverflowingIndex(e);let s=t*this._widthSlide;this._options.hookSlideChange&&(s=this._options.hookSlideChange(t,s)),this.translate(s),this._currentIndex=t,this.indexHasChange()}hackUi(){const e=document.querySelector("html");!e.classList.contains("has-overlay-absolute")&&e.classList.contains("has-overlay")}getOverflowingIndex(e){const t=this.getLeftBoundary(e),s=this.getRightBoundary(e),i=this._children.length-this._options.slidesVisible;return t?this.loop?i:0:s?this.loop?0:i:e}getLeftBoundary(e){return e<0}getRightBoundary(e){const t=e>=this._children.length,s=this.currentIndex+this.slidesVisible,i=void 0!==this._children[s],n=e>this.currentIndex;let r=t||n&&!i;return this._options.hookGetRightBoundary&&(r=this._options.hookGetRightBoundary(r,e)),r}_getMaxSlideWidth(e){return e.reduce(((e,t)=>Math.max(e,t.offsetWidth)),0)}onSlideChange(e){this.onMove(e)}onMove(e){this.moveCallbacks.push(e)}indexHasChange(){this.moveCallbacks.forEach((e=>e(this))),this.activateItems()}activateItems(){const e=this._currentIndex+this.slidesVisible;this._slides.map(((t,s)=>{t.classList.remove("active"),t.parentElement.classList.remove("activeParent"),s>=this._currentIndex&&s<e&&(t.classList.add("active"),t.parentElement.classList.add("activeParent"))}))}setClass(e){this._element.classList.add(e)}unsetClass(e){this._element.classList.remove(e)}get currentIndex(){return this._currentIndex}}window.gtmDataObject=window.gtmDataObject||[];const u=({eventName:e,args:t,element:s})=>{let i;s=s||window,t?i=new CustomEvent(e,{detail:t,bubbles:!0}):"function"==typeof Event?i=new Event(e):(i=document.createEvent("Event"),i.initEvent(e,!0,!0)),s.dispatchEvent(i)};class _ extends HTMLElement{constructor(){super(),this.template=""}connectedCallback(){this.props=this._createProps(),this.onStart?.(),this.loadTemplate(),this.onReady?.()}_createProps(e=null){const t=e||this.attributes;let s;try{s=[...t].reduce(((e,t)=>({...e,[t.nodeName]:t.nodeValue})),{});const e=[...t].find((e=>"data"===e.nodeName));return null==e?s:{...s,...JSON.parse(e.nodeValue)}}catch(e){console.log("ERROR: No data",e)}}render(e=!1){e&&(this.innerHTML="");const t=(e,s)=>{const i=e=>3===e.nodeType?"text":8===e.nodeType?"comment":e.tagName.toLowerCase(),n=e=>e.childNodes&&e.childNodes.length>0?null:e.textContent;var r=Array.prototype.slice.call(s.childNodes),a=Array.prototype.slice.call(e.childNodes),o=r.length-a.length;if(o>0)for(;o>0;o--)r[r.length-o].parentNode.removeChild(r[r.length-o]);a.forEach((function(e,a){if(r[a])if(i(e)===i(r[a])){var o=n(e);if(o&&o!==n(r[a])&&(r[a].textContent=o),r[a].childNodes.length>0&&e.childNodes.length<1)r[a].innerHTML="";else{if(r[a].childNodes.length<1&&e.childNodes.length>0){var l=document.createDocumentFragment();return t(e,l),void r[a].appendChild(l)}e.childNodes.length>0&&t(e,r[a])}}else r[a].parentNode.replaceChild(e.cloneNode(!0),r[a]);else s.appendChild(e.cloneNode(!0))}))},s=(i=this.template,(new DOMParser).parseFromString(i,"text/html").body);var i;t(s,this)}loadTemplate(e="",t=!1){this.template=""===e?this.template:`${e}`,this.render(t)}disconnectedCallback(){this.onDestroy?.()}}customElements.get("nb-nespresso-element")||customElements.define("nb-nespresso-element",_);class g extends HTMLElement{constructor(){super(),this._slider=null,this.randomId="slider_"+a(5)}static get observedAttributes(){return["slides_to_scroll","slides_visible","pagination","pagination_variation","nav_centered"]}connectedCallback(){this.slot=this.innerHTML,this.props=e(this.attributes),this.render()}createProps(){return[...this.attributes].reduce(((e,t)=>({...e,[t.nodeName]:t.nodeValue})),{})}render(){this.innerHTML=`<div class="slider ${this.randomId}">${this.slot}</div>`,this.loadSlider()}loadSlider(){const{indexSlider:e=0,slides_loop:t="true",slides_visible:s=4,slides_to_scroll:i=1,navigation:n="true",pagination:r="true",space_between:a=0,navigation_variation:o="dark",navigation_size:l="48",pagination_variation:d="stepper",nav_centered:c="false"}=this.props,h=this.querySelector(`.${this.randomId}`),u={index:parseInt(e),slidesToScroll:parseInt(i),slidesVisible:parseInt(s),spaceBetween:a,loop:"true"===t,navigationButton:"true"===n,pagination:"true"===r,navigation_variation:o,navigation_size:l,pagination_variation:d,nav_centered:c};this._slider=new p(h,u),this._slider.setClass("first"),this._slider.onSlideChange(this.handleClick.bind(this))}handleClick(){var e;u({eventName:"WEB_COMPONENT_SLIDE_CHANGE"}),this.toggleClasses(),e={rootElement:["nb-slider"]},window.gtmDataObject.push({event:"itemDisplay",eventRaisedBy:"Web component",eventAction:"Click",itemTypes:["products"],...e})}toggleClasses(){const e=0===this._slider.currentIndex,t=this._slider.slidesTotal===this._slider.currentIndex+this._slider.slidesVisible;this._slider.unsetClass("last"),this._slider.unsetClass("first"),e?this._slider.setClass("first"):t&&this._slider.setClass("last")}}customElements.get("nb-slider")||customElements.define("nb-slider",g);class b extends HTMLElement{constructor(){super(),this.props={}}connectedCallback(){this.props=e(this.attributes),this.render()}render(){const{slides:e,image_alt_text:t}=this.props;let s=document.createElement("nb-slider");d(s,{slides_to_scroll:"1",slides_visible:"1",navigation:"true",navigation_variation:"highlight",navigation_size:"32",pagination:"true"});let i=document.createElement("nb-loader");d(i,{icon:"loading"}),this.appendChild(i);e.forEach((e=>{const i=`${e.url}?impolicy=product&imwidth=600`;let n=document.createElement("img");n.setAttribute("alt",t),n.setAttribute("title",t),n.setAttribute("data-src",i),s.appendChild(n)})),this.appendChild(s),e.forEach((e=>{const t=`${e.url}?impolicy=product&imwidth=600`;!function(e,t,s,i,n){const r=(t,s)=>{e.setAttribute(t,s);const r=()=>e.classList.add("lazy-loaded");if(i){const t=new Image;return t.src=i,t.onload=r,void(t.onerror=()=>{n&&n(`Image ${i} cannot be loaded.`),e.classList.add("lazy-loaded-error")})}r()};if(/Trident\/|MSIE/.test(window.navigator.userAgent)||(a=window.navigator.userAgent,o=a.indexOf("OS "),(a.indexOf("iPhone")>-1||a.indexOf("iPad")>-1)&&o>-1&&window.Number(a.substr(o+3,3).replace("_","."))<14))r(t,s);else if("IntersectionObserver"in window){e.classList.add("lazy-load");let i=new IntersectionObserver((function(e){e.forEach((function(e){e.isIntersecting&&(r(t,s),i.unobserve(e.target))}))}));i.observe(e)}else r(t,s);var a,o}(s.querySelector(`img[data-src="${t}"]`),"src",t,t)}))}}customElements.get("nb-product-card-image-slider")||customElements.define("nb-product-card-image-slider",b);var m=(e=[])=>{e.forEach((e=>{if(e&&e.element)return e.element.addEventListener(e.type,e.listener,e.options)}))},v=(e=[])=>{e.forEach((e=>{e&&e.element&&e.element.removeEventListener(e.type,e.listener)}))};const y=(e,t)=>{const{ref:s}=t.dataset,i=s.match(/(\w+)\[(.+)\]/);return null!==i?f(e,t,i):{...e,[t.dataset.ref]:t}},f=(e,t,[,s,i])=>(void 0===e[s]&&(e[s]=[]),e[s][i]=t,e),w={get is(){const{innerWidth:e,devicePixelRatio:t}=window;return{mobile:e<768,mobile_tablet:e<1024,tablet:e>=768&&e<1024,desktop:e>=1024&&t<=1,retina:e>=1024&&t>1}},lt:e=>window.innerWidth<e},x=async e=>{const t=await(async()=>await window.napi.priceFormat())(),s=window[window.config.padl.namespace].dataLayer.app.app.currency;return t.html?t.html(s,e):t.short(s,e)||""};class L extends HTMLElement{constructor(){super(),this.parent=null,this.popin=null,this.idPopin=`plp-product-card-expandable-${a(5)}`,this.button3DRendered=!1}static get observedAttributes(){return["data","expanded","class"]}async connectedCallback(){this.props=e(this.attributes),this.render(),this.refs=[...this.querySelectorAll("[data-ref]")].reduce(y,{}),this.createEventListeners()}attributeChangedCallback(e,t,s){"data"===e&&t&&(this.classList.add("loading"),setTimeout((()=>{v(this.eventListeners),this.initialize()}),300),setTimeout((()=>{this.classList.remove("loading")}),500)),"expanded"===e&&t!==s&&this.toggle("true"===s),"class"!==e||this.classList.contains("plp-product-card-expandable")||this.classList.add("plp-product-card-expandable")}createEventListeners(){const e=[{element:this,type:"EVENT_CROSS_SELL_READY",listener:this.onParentReady.bind(this)},this.refs.view&&{element:this.refs.view,type:"click",listener:this.onToggle.bind(this)}].filter(Boolean);!w.is.mobile&&this.refs.close&&e.push({element:this.refs.close,type:"click",listener:this.onToggle.bind(this)}),this.hasBundleDetails()&&this.refs.bundleDetails&&e.push({element:this.refs.bundleDetails,type:"click",listener:this.onOpenBundleDetails.bind(this)}),m(e),this.eventListeners=e}render(){this.innerHTML=`\n            ${this.renderCard()}\n            ${this.renderDetails()}\n            ${this.renderOverlay()}\n        `,this.loadStrikethroughPrice()}renderA11y(e){return e&&`<span class="sr-only">${e}</span>`}renderCover(e=!1){const{slides:t=[],variant:{show_slider:s=!1}={}}=this.props,i=s&&t.length>1;return!w.is.mobile&&this.isType("is_machine")&&i?this.renderCoverSlider():this.renderCoverImage(e)}renderCoverMobile(){return`\n            <div class="plp-product-card-expandable__cover">\n                ${this.renderCover(!0)}\n            </div>\n        `}renderCoverSlider(){const{slides:e=[],image_alt_text:t,name:s=""}=this.props;return`<nb-product-card-image-slider data="${o({slides:e,image_alt_text:t||s})}"></nb-product-card-image-slider>`}renderCoverImage(){const{image_alt_text:e,images:t={},api_override:s={}}=this.props,{icon:i=""}=t;return`\n            <img\n                alt="${e}"\n                src="${s.image||i}?impolicy=product&imwidth=300"\n                loading="lazy"\n            />\n        `}renderLogos(){const{variant:{logos:e=[]}}=this.props;if(!Array.isArray(e))return"";return`<div class="plp-product-card-expandable__logos">${e.map(this.renderLogo.bind(this)).join("")}</div>`}renderLogo({name:e,alt:t}){return n[e]?`<img src="${n[e]}" alt="${t}" loading="lazy">`:""}renderLabels(){const{labels:e=[]}=this.props;if(0===e.length)return"";return`<nb-card-labels data="${o({labels:e})}"></nb-card-labels>`}renderOverlay(){const{variant:{colors:e=[]}={}}=this.props;return!w.is.mobile&&this.isType("is_machine")&&0!==e.length?'\n                <div class="plp-product-card-expandable__overlay">\n                    <nb-loader></nb-loader>\n                </div>\n            ':""}renderCard(){const{a11y_product_card:e="",name:t,quick_view:s}=this.props;return`\n            <div class="plp-product-card-expandable__card">\n                ${this.renderA11y(e)}\n                <div class="plp-product-card-expandable__cover">\n                    ${this.renderCover()}\n                </div>\n                ${this.renderLabels()}\n                ${this.renderLogos()}\n                <div class="plp-product-card-expandable__content">\n                    <h3>${t}</h3>\n                    ${this.renderHeadline()}\n                    ${this.renderLink(s,"view")}\n                    <div class="plp-product-card-expandable__priceWrapper">\n                        <div class="plp-product-card-expandable__priceInnerWrapper">\n                            ${this.renderPrice(!0)}\n                        </div>\n                        ${this.renderAddToCart({mode:"card"})}\n                    </div>\n                </div>\n            </div>\n        `}async loadStrikethroughPrice(){const{strikethrough_price:e}=this.props;if(!e)return;const t=this.querySelector(".plp-product-card-expandable__priceInnerWrapper"),s=await(async e=>e?`<p class="cn_card__strikethroughPrice">${await x(e)}</p>`:"")(e);t.innerHTML=s+t.innerHTML}renderDetails(){const e=this.renderCardDetails();return w.is.mobile?this.popin?(this.popin.querySelector(".content").innerHTML=e,""):`<nb-popin id="${this.idPopin}" data-ref="popin" variation="before" bgcolor="white">${e}</nb-popin>`:e}renderCardDetails(){const{name:e="",discover_more:t,highlighted:s}=this.props;return`\n            <aside>\n                <div class="plp-product-card-expandable__details" data-ref="details" ${s?'highlighted="true"':""}>\n                    ${w.is.mobile?"":this.renderButtonClose()}\n                    ${w.is.mobile?this.renderCoverMobile():""}\n                    ${w.is.mobile?this.renderLabels():""}\n                    ${w.is.mobile?this.renderLogos():""}\n                    <div class="plp-product-card-expandable__content">\n                        <p class="plp-product-card-expandable__title h-lg-700-caps-sl">${e}</p>\n                        ${this.isType(["is_machine","is_accessory"])&&this.renderRating()}\n                        ${this.isType("is_capsule")&&this.renderIntensity()}\n                        ${this.renderDescription()}\n                        ${this.isType("is_capsule")&&this.renderBundleDetails()}\n                        ${this.renderExternalLink(t,"more")}\n                        ${this.isType("is_machine")&&this.renderColors()}\n                    </div>\n                    <div class="plp-product-card-expandable__priceWrapper">\n                        <div class="plp-product-card-expandable__priceInnerWrapper">\n                            ${this.renderPrice(!0)}\n                        </div>\n                        <div class="plp-product-card-expandable__actions">\n                            ${this.renderAddToCart({mode:"details"})}\n                            <div class="replace-with-button3d"></div>\n                        </div>\n                    </div>\n                </div>\n            </aside>\n        `}renderBundleDetails(){const{bundled:e=!1,variant:{bundle_details:{popin_link_text:t=""}={}}={}}=this.props;return e&&""!==t?`\n            <nb-link\n                class="plp-product-card-expandable__link--bundle-details"\n                data-ref="bundleDetails"\n                label="${t}"\n                size="large"\n                color="gold"\n            ></nb-link>\n        `:""}renderBundleDetailsPopin(){const{variant:{bundle_details:{popin_label_close:e=""}={}}={}}=this.props;let t=document.getElementById("bundle-popin-id");t||(this.parent.insertAdjacentHTML("beforeend",`<nb-popin\n                    content=""\n                    class="plp-product-card-expandable__popin-bundle-details"\n                    id="bundle-popin-id"\n                    label_close="${e}"\n                    variation="before"\n                    bgcolor="highlight"\n                    size="L"\n                    padding="false"\n                ></nb-popin>`),t=document.getElementById("bundle-popin-id")),this.refs.popinBundleDetails=t}renderHeadline(){const{headline:e}=this.props;return void 0===e?"":`<p class="plp-product-card-expandable__headline">${e}</p>`}renderDescription(){const{headline:e,description:t=""}=this.props,s=this.stripFirstHtmlLevel(t);return""===s&&""===e?"":`<p class="plp-product-card-expandable__description t-sm-400">${""!==s?s:e}</p>`}renderExternalLink(e,t){if(this.isType("is_giftcard"))return"";const{pdp_urls:{desktop:s=""}={}}=this.props;return this.renderLink(e,t,s)}renderLink(e,t,s=""){return`\n            <nb-link\n                data-ref="${t}"\n                class="plp-product-card-expandable__link--${t}"\n                color="gold"\n                size="large"\n                ${s&&`link="${s}"`}\n            >${e}</nb-link>\n        `}renderRating(){const{minimum_rating:e="0",rating:t="0",show_ratings:s=!1}=this.props,i=parseFloat(t),n=parseFloat(e);if(!s||!i||i<n)return"";return`<nb-rating class="plp-product-card-expandable__rating" data="${o({stars:t})}"></nb-rating>`}renderColors(){const{url:e="",name:t="",variant:{colors:s=[]}={},sku:i}=this.props;if(0===s.length)return"";return`\n            <nb-colors\n                data="${o({colors:s,activeSku:i,max_colors:"4",extra_url:e,extra_title:t})}"\n                prevent\n            ></nb-colors>\n        `}renderIntensity(){const{intensity:e=0,a11y_intensity_max:t,intensity_label:s}=this.props;return 0===e?"":`\n            <nb-intensity\n                a11y_intensity_max="${t}"\n                class="plp-product-card-expandable__intensity"\n                intensity="${e}"\n                intensity_label="${s}"\n            ></nb-intensity>\n        `}renderPrice(e=""){const{price:t,a11y_price:s,variant:{giftcard_price:i=""}}=this.props;if(!t||this.isType("is_giftcard")&&!i)return"";const n=`${t} ${s}`;return`\n            <div class="plp-product-card-expandable__price">${t}</div>\n            ${this.isType("is_capsule")&&e&&this.renderSleeve()}\n            ${this.isType("is_capsule")&&this.props.variant.show_sleeve_price?(e=>{const{show_capsule_price:t=!1,price_per_capsule:s,capsule_price_label:i,capsule_price_syntax:n="{capsule_price_label}: {price_per_capsule}"}=e;return t?`<p class="cn_card__priceWrapper--items capsulePrice">${function(e,t,s,i){let n=0;for(;e;){const r=e.indexOf(s,n);if(-1===r)break;const a=e.indexOf(i,r+1);if(-1===a)break;const o=e.substring(r+s.length,a);null!=t[o]?(e=e.substr(0,r)+t[o]+e.substr(a+i.length),n=r):n=a}return e}(n,{capsule_price_label:i,price_per_capsule:s},"{","}")}</p>`:""})(this.props.variant):""}\n            ${this.renderA11y(n)}\n        `}renderSleeve(){const{bundled:e=!1,sales_multiple:t,unit_quantity:s,show_sleeve:i=!1,variant:{number_of_sleeves:n}={},label_sleeve:r,label_sleeves:a,label_capsules:o}=this.props;if(!i||["","0"].includes(n))return"";return`\n            <p class="plp-product-card-expandable__sleeve">\n                ${n} ${n>1&&a?a:r} (${e?s:t} ${o})\n            </p>\n        `}renderAddToCart({mode:e}){const{sku:t,longSku:s="",variant:{giftcard_price:i=""}={},range:n,quantity_selector:r={}}=this.props,{index:a=null}=this.dataset,l="plp-product-card-expandable__buy",d={price:i,sku:t,quantity_selector:r};return this.isType("is_giftcard")&&i?`<nb-add-gift-card class="${l}" data="${o(d)}"></nb-add-gift-card>`:`\n            <nb-add-to-cart\n                class="${l}"\n                buttonSize="large"\n                showPrice\n                sku="${t}"\n                ${s&&`longSku="${s}"`}\n                position="${a}"\n                range="${e}-${n}"\n            ></nb-add-to-cart>\n        `}renderButtonClose(){const{variant:{bundle_details:{popin_label_close:e=""}={}}={}}=this.props;return`<nb-cta\n                    variation="navigation"\n                    contrast="highlight"\n                    icon_right="close-2"\n                    class="plp-product-card-expandable__close"\n                    data-ref="close"\n                    label="${e}"\n                ></nb-cta>`}renderCheck3D(){const{check_3d:e,variant:{key_3d:t=""}={}}=this.props;if(""===t)return"";const s=document.createElement("nb-cta-3d");s.setAttribute("class","plp-product-card-expandable__3d"),s.setAttribute("cta_ide_event",this.ctaIDEvent),s.setAttribute("key_3d",t),s.setAttribute("label_button_3d",e),this.querySelector(".replace-with-button3d").replaceWith(s)}isType(e){const{variant:t=null}=this.props;return t?Array.isArray(e)?(s=Object.keys(t),i=e,s.filter((e=>i.includes(e))).length>0||""):t[e]||"":"";var s,i}hasBundleDetails(){const{bundled:e=!1,variant:{bundle_details:{popin_link_text:t=""}={}}={}}=this.props;return!(!e||""===t)}stripFirstHtmlLevel(e){const t=document.createElement("div");return t.innerHTML=e,t.firstChild instanceof HTMLElement?t.firstChild.innerHTML:e}setDefaultAttributes(){const{category_name:e="",sku:t="",position:s=""}=this.props;this.setAttribute("data-product-item-id",t),this.setAttribute("data-product-section",e),this.setAttribute("data-product-position",s)}setDefaultStyles(){this.classList.add("class","plp-product-card-expandable")}onParentReady(e){const{parent:t,geometry:s}=(e=>{if(e.detail)return e.detail})(e);this.parent=t,this.setDefaultAttributes(),this.setDefaultStyles(s),w.is.mobile&&this.extractPopin(),this.hasBundleDetails()&&this.renderBundleDetailsPopin()}onToggle(e=null){e.preventDefault(),console.log("onToggle"),console.log(this.getAttribute("expanded"),typeof this.getAttribute("expanded"));const t="true"===this.getAttribute("expanded");t||this.button3DRendered||this.renderCheck3D(),this.button3DRendered=!0,this.setAttribute("expanded",!t)}onOpenBundleDetails(){const{popinBundleDetails:e}=this.refs,{sku:t="",variant:{bundle_details:{description:s="",other_skus:i=[],other_skus_quantity:n=""}={}}={},range:r}=this.props,{index:a=null}=this.dataset,o=`\n            <nb-bundle-details\n                description="${s}"\n                main_sku="${t}"\n                other_skus="${i}"\n                other_skus_quantity= "${n}"\n                range="${r}"\n                position="${a}"\n            >\n            </nb-bundle-details>\n        `;e.setAttribute("content",o),u({eventName:"WEB_COMPONENT_POPIN_OPEN",args:{id:"bundle-popin-id"}})}toggle(e){const t=e?"add":"remove",{index:s=null}=this.dataset;this.classList[t]("plp-product-card-expandable--expanded"),u({element:this.parent,eventName:"EVENT_PRODUCT_CARD_TOGGLE",args:{expanded:e,index:s}})}extractPopin(){const{popin:e}=this.refs;this.parent.append(e);const t=[{element:e.querySelector(".button--navigation"),type:"click",listener:this.onToggle.bind(this)}],s=e.querySelector('[data-ref="bundleDetails"]');this.hasBundleDetails()&&s&&t.push({element:s,type:"click",listener:this.onOpenBundleDetails.bind(this)}),m(t),this.eventListeners=[...this.eventListeners,t],this.popin=this.parent.querySelector(`#${this.idPopin}`)}}customElements.get("nb-plp-product-card-expandable")||customElements.define("nb-plp-product-card-expandable",L);export{L as default};
