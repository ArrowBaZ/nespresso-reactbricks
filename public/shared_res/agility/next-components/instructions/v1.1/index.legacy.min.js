const e=e=>e?e.toString().replace(/"/g,"&quot;").replace(/'/g,"&apos;"):"",n=e=>null==e;class t extends HTMLElement{constructor(){super(),this.template=""}connectedCallback(){this.props=this._createProps(),this.onStart?.(),this.loadTemplate(),this.onReady?.()}_createProps(e=null){const n=e||this.attributes;let t;try{t=[...n].reduce(((e,n)=>({...e,[n.nodeName]:n.nodeValue})),{});const e=[...n].find((e=>"data"===e.nodeName));return null==e?t:{...t,...JSON.parse(e.nodeValue)}}catch(e){console.log("ERROR: No data",e)}}render(e=!1){e&&(this.innerHTML="");const n=(e,t)=>{const i=e=>3===e.nodeType?"text":8===e.nodeType?"comment":e.tagName.toLowerCase(),o=e=>e.childNodes&&e.childNodes.length>0?null:e.textContent;var s=Array.prototype.slice.call(t.childNodes),r=Array.prototype.slice.call(e.childNodes),a=s.length-r.length;if(a>0)for(;a>0;a--)s[s.length-a].parentNode.removeChild(s[s.length-a]);r.forEach((function(e,r){if(s[r])if(i(e)===i(s[r])){var a=o(e);if(a&&a!==o(s[r])&&(s[r].textContent=a),s[r].childNodes.length>0&&e.childNodes.length<1)s[r].innerHTML="";else{if(s[r].childNodes.length<1&&e.childNodes.length>0){var d=document.createDocumentFragment();return n(e,d),void s[r].appendChild(d)}e.childNodes.length>0&&n(e,s[r])}}else s[r].parentNode.replaceChild(e.cloneNode(!0),s[r]);else t.appendChild(e.cloneNode(!0))}))},t=(i=this.template,(new DOMParser).parseFromString(i,"text/html").body);var i;n(t,this)}loadTemplate(e="",n=!1){this.template=""===e?this.template:`${e}`,this.render(n)}disconnectedCallback(){this.onDestroy?.()}}customElements.get("nb-nespresso-element")||customElements.define("nb-nespresso-element",t);const i={get is(){const{innerWidth:e,devicePixelRatio:n}=window;return{mobile:e<768,mobile_tablet:e<1024,tablet:e>=768&&e<1024,desktop:e>=1024&&n<=1,retina:e>=1024&&n>1}},lt:e=>window.innerWidth<e},o={getResponsiveSrc:e=>{const n=(t=e,Array.isArray(t)||"object"==typeof t?["mobile","tablet","desktop","retina"].find((e=>!0===i.is[e]&&e in t&&""!==t[e])):null);var t;return n?e[n]:e.desktop}};class s extends HTMLElement{connectedCallback(){this.eventListeners=[],this.props=(e=>{const t=(e=>e.find((e=>"data"===e.nodeName)))([...e]),i=[...e].filter((e=>"data"!==e.nodeName)).reduce(((e,n)=>({...e,[n.nodeName]:n.nodeValue})),{});if(n(t))return i;try{return{...i,...JSON.parse(t.nodeValue)}}catch(e){console.log("ERROR: No data",e)}})(this.attributes),this.render()}renderSteps(e){return e?e.map((e=>`\n                    <div>\n                        <h4 class="t-sm-700">${e.heading}</h4>\n                        <p class="t-sm-400">${e.description}</p>\n                    </div>\n                `)).join(""):""}renderSlidesContainer(){const{navigations:e}=this.props.copywriting;return`<div class="slider-container">${e.map(((e,n)=>{const t=`instructions-video-${n}`;return`<div>\n                            ${this.renderTopVisual(t,e)}\n                            ${this.renderTopVideo(t,e)}\n                            <div class="steps">\n                                ${this.renderSteps(e.steps)}\n                            </div>\n                        </div>`})).join("")}</div>`}render(){const{campaign:e,layout:n}=this.props,{padding_top:t,padding_bottom:i}=n;this.innerHTML=`\n            <nb-container\n                contrast="light"\n                background_color="white_1000"\n                campaign_id="${e.id}"\n                campaign_name="${e.name}"\n                campaign_creative="${e.creative}"\n                campaign_position="${e.position}"\n                classname="${t} ${i}"\n            >\n                ${this.renderTitle()}\n                ${this.renderNavigationBar()}\n            </nb-container>\n        `,this.createEventListener()}renderTitle(){const{heading:e}=this.props.copywriting;return e?`<h2 class="h-2xl-300-sl">${e}</h2>`:""}renderNavigationBar(){const{showNavigation:n,navigations:t,a11y_slider_previous_button:i,a11y_slider_next_button:o}=this.props.copywriting;return`<nb-navigation-bar\n                    data="${(n=>e(JSON.stringify(n)))({navigation:t,copywriting:{a11y_slider_previous_button:i,a11y_slider_next_button:o}})}"\n                    show-navigation="${n}"\n                    disable-auto-scroll="true"\n                    id-links-auto="true">\n                      ${this.renderSlidesContainer()}\n                </nb-navigation-bar>`}createEventListener(){const e=this.querySelectorAll(".visual");e&&e.forEach((e=>{const n=e.getAttribute("data-video-id"),t=this.openPlayer.bind(this,n);e.addEventListener("click",t),this.eventListeners.push({element:e,type:"click",listener:t})}))}openPlayer(e){(({eventName:e,args:n,element:t})=>{let i;t=t||window,n?i=new CustomEvent(e,{detail:n,bubbles:!0}):"function"==typeof Event?i=new Event(e):(i=document.createEvent("Event"),i.initEvent(e,!0,!0)),t.dispatchEvent(i)})({eventName:"WEB_COMPONENT_POPIN_OPEN",args:{id:e}})}createStyles(e){const n=e?o.getResponsiveSrc(e):"";return{container:e?[`background-image: url('${n}');`].join(" "):""}}renderPlayButton(e){return`\n            <div class="visual" data-video-id="${e}">\n                <nb-icon icon="video-play" class="icon"></nb-icon>\n            </div>\n        `}renderTopVisual(e,n){const{visual:t,has_video:i}=n;return`<div style="${this.createStyles(t).container}" class="top-visual">\n            ${i?this.renderPlayButton(e):""}\n        </div>`}renderTopVideo(e,n){const{has_video:t,video:i}=n,{video_id:o,video_mobile:s="",display_ui_controls:r,cc_policy_language:a,video_service:d}=i;return t||o&&s?`<nb-popin id="${e}" popin_id="${e}" variation="before" bgcolor="white">\n                    <nb-video\n                        container_id="player-${e}"\n                        video_id="${o}"\n                        video_mobile="${s}"\n                        video_service="${d}"\n                        popin_id="${e}"\n                        display_controls="${r}"\n                        ccPolicy_language="${a}"\n                    />\n                  </nb-popin>`:""}removeEventListeners(){this.eventListeners&&this.eventListeners.forEach((e=>e.element.removeEventListener(e.type,e.listener)))}disconnectedCallback(){this.removeEventListeners()}}customElements.get("nb-instructions")||customElements.define("nb-instructions",s);export{s as default};
