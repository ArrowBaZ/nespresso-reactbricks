class e extends HTMLElement{constructor(){super(),this.template=""}connectedCallback(){this.props=this._createProps(),this.onStart?.(),this.loadTemplate(),this.onReady?.()}_createProps(e=null){const t=e||this.attributes;let n;try{n=[...t].reduce(((e,t)=>({...e,[t.nodeName]:t.nodeValue})),{});const e=[...t].find((e=>"data"===e.nodeName));return null==e?n:{...n,...JSON.parse(e.nodeValue)}}catch(e){console.log("ERROR: No data",e)}}render(e=!1){e&&(this.innerHTML="");const t=(e,n)=>{const r=e=>3===e.nodeType?"text":8===e.nodeType?"comment":e.tagName.toLowerCase(),i=e=>e.childNodes&&e.childNodes.length>0?null:e.textContent;var s=Array.prototype.slice.call(n.childNodes),a=Array.prototype.slice.call(e.childNodes),o=s.length-a.length;if(o>0)for(;o>0;o--)s[s.length-o].parentNode.removeChild(s[s.length-o]);a.forEach((function(e,a){if(s[a])if(r(e)===r(s[a])){var o=i(e);if(o&&o!==i(s[a])&&(s[a].textContent=o),s[a].childNodes.length>0&&e.childNodes.length<1)s[a].innerHTML="";else{if(s[a].childNodes.length<1&&e.childNodes.length>0){var l=document.createDocumentFragment();return t(e,l),void s[a].appendChild(l)}e.childNodes.length>0&&t(e,s[a])}}else s[a].parentNode.replaceChild(e.cloneNode(!0),s[a]);else n.appendChild(e.cloneNode(!0))}))},n=(r=this.template,(new DOMParser).parseFromString(r,"text/html").body);var r;t(n,this)}loadTemplate(e="",t=!1){this.template=""===e?this.template:`${e}`,this.render(t)}disconnectedCallback(){this.onDestroy?.()}}customElements.get("nb-nespresso-element")||customElements.define("nb-nespresso-element",e);const t=e=>n(JSON.stringify(e)),n=e=>e?e.toString().replace(/"/g,"&quot;").replace(/'/g,"&apos;"):"",r={get is(){const{innerWidth:e,devicePixelRatio:t}=window;return{mobile:e<768,mobile_tablet:e<1024,tablet:e>=768&&e<1024,desktop:e>=1024&&t<=1,retina:e>=1024&&t>1}},lt:e=>window.innerWidth<e},i=({image:e=""},t)=>{const n=".cb-image img",r=t.querySelector(n),i=e=>{console.log(e),console.error(`Error: Component SKU - Lazy Load - ${e}`),r&&(r.style.display="none")};if(!r)return i(`${n} HTMLElement not found.`),"";const s=e+((e="product",t=150)=>{const n=[];return e&&n.push(`impolicy=${e}`),t&&n.push(`imwidth=${t}`),`?${n.join("&")}`})();if(!s)return i(`${s} source file is empty.`),"";!function(e,t,n,r,i){const s=(t,n)=>{e.setAttribute(t,n);const s=()=>e.classList.add("lazy-loaded");if(r){const t=new Image;return t.src=r,t.onload=s,void(t.onerror=()=>{i&&i(`Image ${r} cannot be loaded.`),e.classList.add("lazy-loaded-error")})}s()};if(/Trident\/|MSIE/.test(window.navigator.userAgent)||(a=window.navigator.userAgent,o=a.indexOf("OS "),(a.indexOf("iPhone")>-1||a.indexOf("iPad")>-1)&&o>-1&&window.Number(a.substr(o+3,3).replace("_","."))<14))s(t,n);else if("IntersectionObserver"in window){e.classList.add("lazy-load");let r=new IntersectionObserver((function(e){e.forEach((function(e){e.isIntersecting&&(s(t,n),r.unobserve(e.target))}))}));r.observe(e)}else s(t,n);var a,o}(r,"src",`${s}`,s,i)},s="plp",a=e=>"pdp"===e,o=e=>{const{url:t,name:n="",name_custom:r=""}=e;if(!n)return"";const i=""!==r?r:n,s=[],o=(({variation:e})=>a(e)?"h1":"h3")(e);return s.push(`<${o} class="cb-heading">`),t&&a(e.variation)?s.push((({url:e,a11y_product_card:t="",name:n="",name_custom:r=""})=>{const i=t.replace("{productName}",n);return`<a href="${e}" target="_self" title="${i}" aria-label="${i}">${""!==r?r:n}</a>`})(e)):s.push(`${i}`),s.push(`</${o}>`),s.join("")},l=({headline:e="",is_headline_hidden:t=!1})=>t&&r.is.mobile||!e?"":`<p class="cb-text">${e}</p>`,c=({label_technology:e})=>e?`<p class="cb-technology t-xs-700">${e}</p>`:"",d=({label_range:e})=>e?`<p class="cb-range t-xs-500">${e}</p>`:"",p=async e=>{const t=await(async()=>await window.napi.priceFormat())(),n=window[window.config.padl.namespace].dataLayer.app.app.currency;return t.html?t.html(n,e):t.short(n,e)||""},u=e=>e.querySelector(".cb-price-old"),h=({strikethrough_price:e},t)=>{return e?((n=e,p(n)).then((e=>{const n=u(t);n&&(n.innerHTML=e)})).catch((e=>{console.error(`Error: Component SKU - Strike Through Price  - ${e}`);const n=u(t);n&&(n.style.display="none")})),'<p class="cb-price-old"></p>'):"";var n};class m extends e{constructor(){super(),this.type="default",this.boundOnPDPLinkClick=this.onPDPLinkClick.bind(this)}loadTemplate(){this.classList.add("nb-sku"),this.classList.add(`nb-sku__${this.type}`),(({variation:e,type:t},n)=>{"pdp"!==e?"capsule"===t&&r.is.mobile?n.setAttribute("landscape","true"):n.setAttribute("portrait","true"):n.setAttribute("pdp","true")})(this.props,this),this.template=`${this.renderVisual()}\n                          ${this.renderHeader()}\n                          <div class="cb-content">\n                              ${this.renderInformation()}\n                              <div class="cb-shop">\n                                  <div class="cb-price">\n                                      ${this.renderPricing()}\n                                  </div>\n                                  ${this.renderAction()}\n                              </div>\n                              ${this.renderFooter()}\n                          </div>`,this.render()}onReady(){const{sku:e,category_name:t,position:n=0}=this.props;this.setAttribute("data-product-item-id",e),this.setAttribute("data-product-section",t),this.setAttribute("data-product-position",n.toString()),this.activateLazyLoad(),this.bindEvent()}activateLazyLoad(){const{image:e}=this.props;if(!e)return"";i(this.props,this)}renderHeaderDefault(){return`${(({labels:e=[]},n=null)=>{if(!n||!e||!e.length)return"";n&&e.length&&n.classList.add("has-labels");const i=r.is.mobile?"row":"column";return`<nb-card-labels data="${t({labels:e})}" direction="${i}"></nb-card-labels>`})(this.props,this)}${((e,n)=>{const{fair_trade:r,alt_fair_trade:i,is_organic:s,alt_organic:a,only_vertuo_next:o,alt_vertuo_next:l,is_rainforest:c,alt_rainforest:d,is_sustainable:p,alt_sustainable:u,is_q_certified_arabica:h,alt_q_certification_arabica:m,logos:g}=e;return r||s||o||c||p||h||!(null==g||g.length<1)?(n.classList.add("has-logos"),`<nb-card-logos data='${t({fair_trade:r,alt_fair_trade:i,is_organic:s,alt_organic:a,only_vertuo_next:o,alt_vertuo_next:l,is_rainforest:c,alt_rainforest:d,is_sustainable:p,alt_sustainable:u,is_q_certified_arabica:h,alt_q_certification_arabica:m,logos:g})}'></nb-card-logos>`):""})(this.props,this)}`}renderHeader(){return this.renderHeaderDefault()}renderVisualDefault(){return(({url:e,image_alt_text:t,image:n})=>{if(!n)return"";let r=`<img src="" alt="${t||"loading"}"/>`;return e&&(r=`<a href="${e}" target="_self" aria-hidden="true" tabindex="-1">${r}</a>`),`<div class="cb-image">\n                ${r}\n            </div>`})(this.props)}renderVisual(){return this.renderVisualDefault()}renderInformationDefault(){return`${c(this.props)}\n        ${d(this.props)}\n        ${o(this.props)}\n        ${l(this.props)}`}renderInformation(){return this.renderInformationDefault()}renderPricingDefault(){return`${h(this.props,this)}\n                ${(({price:e,hidePrice:t,giftcard_price:n})=>!e&&!n||t?"":`<p class="cb-price-current"><span>${e||n}</span></p>`)(this.props)}`}renderPricing(){return this.renderPricingDefault()}renderActionDefault(){return(e=>{const{category_name:t="",sku:n,longSku:i="",position:a,variation:o=s,hidePrice:l,url:c,view_details_label:d="View details",rendererName:p=""}=e;let u="large";return o===s&&(u=r.is.mobile?"small":"large"),"small"===o&&(u="small"),l?`<nb-cta link="${c}" variation="primary">${d}</nb-cta>`:`\n        <nb-add-to-cart\n            sku="${n}"\n            longSku="${i}"\n            buttonSize="${u}"\n            showPrice\n            range='${t}'\n            position='${a}'\n            rendererName='${p}'\n        ></nb-add-to-cart>\n    `})(this.props)}renderAction(){return this.renderActionDefault()}renderFooterDefault(){return(({additional_message_icon:e,additional_message:t,additional_message_link:n})=>{if(!t&&!n)return"";let r="";if(t){let n="";e&&(n=`<nb-icon icon="${e}" class="additionalMsgIcon"></nb-icon>`),r=`<p class="cb-warn t-sm-500-sl">\n            ${n}\n            ${t}</p>`}return n&&n.link&&n.label&&(r+=`<nb-link\n            link='${n.link}'\n            color="${n.color}"\n            size="${n.size}"\n            seo_label="${n.seo_label}">\n            ${n.label}\n        </nb-link>`),r})(this.props)}renderFooter(){return this.renderFooterDefault()}async onPDPLinkClick(){window.napi&&window.napi.data&&window.napi.data().product().setProductClickData(await window.productHelper.getPadlProductDetail(await window.napi.catalog().getProduct(this.props.longSku)))}bindEvent(){this.linkElements=[],this.unbindEvent(),this.linkElements=this.querySelectorAll("a[href]"),this.linkElements.length&&Array.from(this.linkElements).forEach((e=>{e.addEventListener("click",this.boundOnPDPLinkClick)}))}unbindEvent(){this.linkElements.length&&(Array.from(this.linkElements).forEach((e=>{e.removeEventListener("click",this.boundOnPDPLinkClick)})),this.linkElements=[])}disconnectedCallback(){this.unbindEvent()}}customElements.get("nb-sku")||customElements.define("nb-sku",m);const g=({colors:e,sku:n,max_colors:i=4,a11y_extra_color:s="",url:a,activeSku:o,name:l})=>{if(!e)return"";return`<nb-colors data="${t({colors:e,max_colors:i,activeSku:o||n,extra_url:a,extra_title:l+", "+s})}" size="${r.is.mobile?"small":"large"}"></nb-colors>`},b=window.napi&&window.napi.ratings,f=async e=>{const t=`n-ratings-${e}`;let n=(e=>{const t=localStorage.getItem(e);if(!t)return;const n=JSON.parse(t);if(!((new Date).getTime()>n.expiry))return n.value;localStorage.removeItem(e)})(t);return void 0===n&&(n=await b().summary(e),((e,t)=>{const n={value:t,expiry:(new Date).getTime()+864e5};localStorage.setItem(e,JSON.stringify(n))})(t,n)),n},v=(e,t)=>e.reviewCount>0&&e.ratingAverage>0&&e.ratingAverage>=t,_=({sku:e,minimum_rating:t=0},n)=>(f(e).then((e=>{const r=n.querySelector(".cb-ratings-block");if(!e||!v(e,t))return r.innerHTML="","";r.innerHTML=`<nb-rating stars="${e.ratingAverage}"></nb-rating>`})),"");class ${constructor(){this.promise=new Promise(((e,t)=>{this.reject=t,this.resolve=e}))}}class w extends m{constructor(){super(),this.type="machine",this.reviewLink=null,this.boundOnColorClick=this.onColorClick.bind(this),this.boundOnReviewLinkClick=this.onReviewLinkClick.bind(this)}renderHeader(){return`${this.renderHeaderDefault()}\n                ${(e=>{const{a11y_energy_label:n,energy_level:r}=e;return r?`<nb-energy-label data='${t({a11y_label:n,level:r})}'></nb-energy-label>`:""})(this.props)}`}renderInformation(){const{variation:e}=this.props;return"pdp"===e?this.renderInformationPDP():e===s?this.renderInformationPLP():this.renderInformationDefault()}renderInformationDefault(){return`${g(this.props)}\n                ${c(this.props)}\n                ${d(this.props)}\n                ${o(this.props)}\n                ${this.props.show_ratings&&(e=this.props,e.productRatings&&e.productRatings.ratingEnabled)?`<div class="cb-ratings-block"><nb-loader></nb-loader></div> ${_(this.props,this)}`:""}\n                ${l(this.props)}`;var e}renderInformationPLP(){return`${g(this.props)}\n                ${c(this.props)}\n                ${d(this.props)}\n                ${o(this.props)}\n                ${this.props.show_ratings?`<div class="cb-ratings-block"><nb-loader></nb-loader></div> ${_({...this.props,sku:this.props.sku||this.props.legacyId},this)}`:""}\n                ${l(this.props)}`}renderInformationPDP(){return`${c(this.props)}\n                ${d(this.props)}\n                ${o(this.props)}\n                ${l(this.props)}\n                ${(e=>{const{show_ratings:t,minimum_rating:n=0,ratingAverage:r,reviewCount:i,review_cta:s,reviews_cta:a}=e;if(!t||!v(e,n))return"";let o="";if(i&&s&&a){const e=(i>1?a:s).replace("{nb_review}",i);e&&(o=`<nb-link class="is-review" icon_right="chevron-right" size="small" color="gold">\n                        ${e}\n                    </nb-link>`)}return`<nb-rating stars="${r.toFixed(2)}"></nb-rating>\n            ${o}`})(this.props)}\n                ${(({show_voltage:e,voltage_label:t,voltage_list:n,a11y_voltage_label:r,a11y_volts_label:i})=>e&&t&&n&&n.length?`<div class="cb-sku-tab">\n        <span class="sr-only">${r}</span>\n        <p class='t-sm-400' aria-hidden="true">${t}</p>\n        ${n.map((({label:e,url:t})=>t?`<a href="${t}" target="_self"><span class="t-sm-400-caps">${e}<span aria-hidden="true">V</span><span class='sr-only'> ${i}</span></span></a>`:`<div aria-current="page"><span class="t-sm-700-caps">${e}<span aria-hidden="true">V</span><span class='sr-only'> ${i}</span></span></div>`)).join("")}\n    </div>`:"")(this.props)}\n                ${g(this.props)}`}onReviewLinkClick(e){e.preventDefault(),((e,t={})=>{const n={scrollPaddingTop:140,scrollDuration:300,...t},r=new $;let i;const s=typeof e;if(["string","object"].indexOf(s)>-1){i=e,"string"===s&&(i=document.querySelector(e));try{e=window.pageYOffset+i.getBoundingClientRect().top-n.scrollPaddingTop}catch(t){throw new Error(`error: No element found with the selector "${e}"`)}}else"number"!=typeof e&&(e=0);let a=window.performance.now(),o=0,l=window.pageYOffset-e,c=window.innerHeight,d=document.body.clientHeight;l>c&&d-c>0&&(n.scrollDuration=Math.abs(n.scrollDuration+n.scrollDuration*(Math.abs(l)/(d-c))));let p=a+n.scrollDuration;window.requestAnimationFrame((function t(){let i=window.performance.now();if(i<p){o=(i-a)/n.scrollDuration,o=--o*o*o+1;const r=l*o;window.scrollTo(0,e+(l-r)),window.requestAnimationFrame(t)}else window.scrollTo(0,e),setTimeout((()=>r.resolve()),125);return r.promise})),r.promise})("nb-rating-reviews")}onColorClick(e){const t=(e=>{if(e.detail)return e.detail})(e);var n;t.sku&&(this.template="<nb-loader></nb-loader>",this.render(),(n=t.sku,window.napi.catalog().getProduct(n)).then((e=>{e&&(this.props={...this.props,...e,sku:e.internationalId||"",longSku:e.id||"",image:e.images?.icon||"",image_alt_text:e.name||"",price:e.price,activeSku:e.internationalId||""})})).catch((()=>{console.error(`getProduct fail on sku ${t.sku}`)})).finally((()=>{this.loadTemplate(),this.onReady?.()})))}bindEvent(){this.addEventListener("EVENT_COLOR_CLICKED",this.boundOnColorClick),this.reviewLink=this.querySelector(".is-review"),this.reviewLink&&this.addEventListener("click",this.boundOnReviewLinkClick)}unbindEvent(){this.removeEventListener("EVENT_COLOR_CLICKED",this.boundOnColorClick),this.reviewLink&&this.removeEventListener("click",this.boundOnReviewLinkClick)}disconnectedCallback(){this.unbindEvent()}}customElements.get("nb-sku-machine")||customElements.define("nb-sku-machine",w);export{w as default};
