const e=e=>{const n=(e=>e.find((e=>"data"===e.nodeName)))([...e]),i=[...e].filter((e=>"data"!==e.nodeName)).reduce(((e,t)=>({...e,[t.nodeName]:t.nodeValue})),{});if(t(n))return i;try{return{...i,...JSON.parse(n.nodeValue)}}catch(e){console.log("ERROR: No data",e)}},t=e=>null==e;class n extends HTMLElement{constructor(){super(),this.template=""}connectedCallback(){this.props=this._createProps(),this.onStart?.(),this.loadTemplate(),this.onReady?.()}_createProps(e=null){const t=e||this.attributes;let n;try{n=[...t].reduce(((e,t)=>({...e,[t.nodeName]:t.nodeValue})),{});const e=[...t].find((e=>"data"===e.nodeName));return null==e?n:{...n,...JSON.parse(e.nodeValue)}}catch(e){console.log("ERROR: No data",e)}}render(e=!1){e&&(this.innerHTML="");const t=(e,n)=>{const i=e=>3===e.nodeType?"text":8===e.nodeType?"comment":e.tagName.toLowerCase(),s=e=>e.childNodes&&e.childNodes.length>0?null:e.textContent;var r=Array.prototype.slice.call(n.childNodes),o=Array.prototype.slice.call(e.childNodes),a=r.length-o.length;if(a>0)for(;a>0;a--)r[r.length-a].parentNode.removeChild(r[r.length-a]);o.forEach((function(e,o){if(r[o])if(i(e)===i(r[o])){var a=s(e);if(a&&a!==s(r[o])&&(r[o].textContent=a),r[o].childNodes.length>0&&e.childNodes.length<1)r[o].innerHTML="";else{if(r[o].childNodes.length<1&&e.childNodes.length>0){var c=document.createDocumentFragment();return t(e,c),void r[o].appendChild(c)}e.childNodes.length>0&&t(e,r[o])}}else r[o].parentNode.replaceChild(e.cloneNode(!0),r[o]);else n.appendChild(e.cloneNode(!0))}))},n=(i=this.template,(new DOMParser).parseFromString(i,"text/html").body);var i;t(n,this)}loadTemplate(e="",t=!1){this.template=""===e?this.template:`${e}`,this.render(t)}disconnectedCallback(){this.onDestroy?.()}}customElements.get("nb-nespresso-element")||customElements.define("nb-nespresso-element",n);const i={get is(){const{innerWidth:e,devicePixelRatio:t}=window;return{mobile:e<768,mobile_tablet:e<1024,tablet:e>=768&&e<1024,desktop:e>=1024&&t<=1,retina:e>=1024&&t>1}},lt:e=>window.innerWidth<e},s={getResponsiveSrc:e=>{const t=(n=e,Array.isArray(n)||"object"==typeof n?["mobile","tablet","desktop","retina"].find((e=>!0===i.is[e]&&e in n&&""!==n[e])):null);var n;return t?e[t]:e.desktop}};class r extends HTMLElement{constructor(){super()}connectedCallback(){this.props=e(this.attributes),this.render(),this.initLazyLoad()}render(){const{campaign:e,layout:t,copywriting:n}=this.props,{sizes:i,notes:s}=n,{padding_top:r,padding_bottom:o,background_color:a="white_1000"}=t;this.innerHTML=`\n            <nb-container\n                background_color="${a}"\n                campaign_id="${e.id}"\n                campaign_name="${e.name}"\n                campaign_creative="${e.creative}"\n                campaign_position="${e.position}"\n                classname="${r} ${o}"\n                contrast="light">\n                <div class="col caption">\n                    ${this.renderHeader()}\n                    ${this.renderList(i)}\n                    ${this.renderList(s)}\n                    ${this.renderLevels()}\n                    ${this.renderDetails()}\n                </div>\n                <div class="col visual">\n                    ${this.renderVisual()}\n                </div>\n            </nb-container>\n      `}renderHeader(){const{header_title:e,description:t}=this.props.copywriting;return`\n            <h2 class="h-2xl-300-sl">${e}</h2>\n            ${t&&`<div class="description wysiwyg t-sm-400">${t}</div>`}\n        `}renderList(e){return e?`\n            <div class="cb-cell">\n                <nb-list data='${JSON.stringify(e)}'></nb-list>\n            </div>\n        `:""}renderLevels(){const{levels:e}=this.props.copywriting;if(null==e)return"";return`<div class="cb-table">${e.reduce(((e,t)=>`${e}${this.renderLevel(t)}`),"")}</div>`}renderLevel({label:e,value:t,information:n}){const{a11y_level_of:s}=this.props.copywriting;return`\n            <div class="cb-row">\n                <p class="t-xs-700-caps">${e}</p>\n                <div class="cb-cell">\n                    <nb-level value="${t}" a11y_of="${s}"></nb-level>\n                </div>\n                <nb-tooltip\n                    content="${n}"\n                    position="top"\n                    alignment="${i.is.mobile?"right":"center"}">\n                </nb-tooltip>\n            </div>\n        `}renderDetails(){const{details:e={}}=this.props.copywriting;if(!e.heading||!e.text)return"";return`<nb-collapse data='${JSON.stringify({...e,classes:{title:"t-xs-700-caps"}})}'></nb-collapse>`}renderVisual(){const{background:e={}}=this.props.layout;return s.getResponsiveSrc(e)&&`<img src="" alt="${e.background_image_alt}" />`}initLazyLoad(){const{background:e={}}=this.props.layout,t=s.getResponsiveSrc(e),n=this.querySelector(".visual img");n&&t&&function(e,t,n,i,s){const r=(t,n)=>{e.setAttribute(t,n);const r=()=>e.classList.add("lazy-loaded");if(i){const t=new Image;return t.src=i,t.onload=r,void(t.onerror=()=>{s&&s(`Image ${i} cannot be loaded.`),e.classList.add("lazy-loaded-error")})}r()};if(/Trident\/|MSIE/.test(window.navigator.userAgent)||(o=window.navigator.userAgent,a=o.indexOf("OS "),(o.indexOf("iPhone")>-1||o.indexOf("iPad")>-1)&&a>-1&&window.Number(o.substr(a+3,3).replace("_","."))<14))r(t,n);else if("IntersectionObserver"in window){e.classList.add("lazy-load");let i=new IntersectionObserver((function(e){e.forEach((function(e){e.isIntersecting&&(r(t,n),i.unobserve(e.target))}))}));i.observe(e)}else r(t,n);var o,a}(n,"src",t,t)}}customElements.get("nb-detailed-description")||customElements.define("nb-detailed-description",r);const o=()=>{const e=window[window?.padlNamespace]?.dataLayer;return e?e.app.app.market.toLocaleLowerCase():"ch"};async function a(){return await window.pdpData}function c(e,t,n,i){const s=document.createElement(n);s.setAttribute("data",JSON.stringify(t)),function(e,t,n,i,s=!0){if(s){const t=e.getElementsByTagName(n);t.length>0&&t[0].parentElement&&t[0].parentElement.removeChild(t[0])}e.children.length>=i+1?e.insertBefore(t,e.children[i]):e.appendChild(t)}(e,s,n,i)}function l(e){return e.find((e=>function(e){return b("cat/capsule-attribute-only-vertuo-next").test(e.id)}(e)))}function d(e){return e.find((e=>function(e){return b("capsule-attribute-organic-eu").test(e.id)}(e)))}function u(e){return e.find((e=>function(e){return b("capsule-attribute-rainforest").test(e.id)}(e)))}function p(e){return e.find((e=>function(e){return b("capsule-attribute-sustainability").test(e.id)}(e)))}function g(e){return e.find((e=>function(e){return b("capsule-attribute-arabica").test(e.id)}(e)))}function h(e){return e.filter((e=>function(e){return b("cat/capsule-range-label").test(e.id)}(e)))}function f(e){return e.find((e=>function(e){return b("cat/capsule-attribute-highlight").test(e.id)}(e)))}function m(e){return e.find((e=>function(e){return b("cat/capsule-range-fair-trade").test(e.id)}(e)))}function b(e){return new RegExp(e.replace(/\//g,"\\/"))}async function y(e){const{configuration:{eCommerceData:{categories:t,product:n}={}}={}}=e;if(n.ranges&&n.ranges.length>0){const e=n.ranges[0],i=t.find((t=>t.id===e));null!=i&&(n.rangeData=i)}return function(e,t){const n=h(e).map((e=>e.description));t.labels=n}(t,n),function(e,t){const n=m(e);if(!n)return;t.fairTrade=n.name}(t,n),function(e,t){if(!f(e))return;t.highlighted=!0}(t,n),function(e,t){if(!l(e))return;t.onlyVertuoNext=!0}(t,n),function(e,t){d(e)&&(t.organicEu=!0)}(t,n),function(e,t){u(e)&&(t.rainforest=!0)}(t,n),function(e,t){p(e)&&(t.sustainability=!0)}(t,n),function(e,t){g(e)&&(t.arabica=!0)}(t,n),e}(function(){let e="https://www.nespresso.com/shared_res/agility/commons/img/icons/logo-organic-eu.svg";switch(o()){case"us":e="https://www.nespresso.com/shared_res/agility/commons/img/icons/logo-organic-us.svg";break;case"ca":e="https://www.nespresso.com/shared_res/agility/commons/img/icons/logo-organic-ca.svg";break;case"br":e="https://www.nespresso.com/shared_res/agility/commons/img/icons/logo-organic-br.svg";break;case"jp":e="https://www.nespresso.com/shared_res/agility/commons/img/icons/logo-organic-jp.svg";break;case"be":e="https://www.nespresso.com/shared_res/agility/commons/img/icons/logo-organic-be.png"}})();const v=["notes-almonds","notes-balanced","notes-bergamot","notes-berry","notes-biscuity","notes-blueberry","notes-cardamom","notes-cereal","notes-citrus","notes-cocoa","notes-default","notes-flowery","notes-fruity","notes-hazelnut","notes-herbal","notes-honey","notes-leather","notes-malted","notes-roasted","notes-spicy","notes-sugar","notes-winey","notes-wood","notes-brand-coffee-roasted","notes-brand-coffee-caramel","notes-brand-coffee-intense-roasted"],w=e=>{const t=(e=>(e=e.replace("capsule-aromatic-","").replace("recipe-",""),["peppery"].includes(e)?"spicy":["woody"].includes(e)?"wood":["sweet","caramel"].includes(e)?"sugar":["maltedCereal"].includes(e)?"malted":["veryRoasted","roastedCereal"].includes(e)?"roasted":["fruityWiney"].includes(e)?"fruity":["citric"].includes(e)?"citrus":["chocolate"].includes(e)?"cocoa":["nutty"].includes(e)?"hazelnut":["hintOfFruity"].includes(e)?"berry":["smooth-b2b"].includes(e)?"brand-coffee-roasted":["sweetnotes-b2b","toffeenotes-b2b","caramellynotes-b2b"].includes(e)?"brand-coffee-caramel":["rich-b2b"].includes(e)?"brand-coffee-intense-roasted":e.toLowerCase()))(e);let n=v.find((e=>t.split("-").includes(e.replace("notes-",""))));return n||(n="notes-default"),n};class _ extends HTMLElement{constructor(){super(),this.props={},this.pdpData={}}async connectedCallback(){this.props=e(this.attributes);try{this.priceFormatter=await async function(){return napi.priceFormat()}(),this.currency=(await async function(){return napi.market().read()}()).currency}catch(e){console.log(e)}!async function(){window.getPDPData=window.getPDPData||a}(),this.pdpData=await y(await window.getPDPData()),this.product=this.pdpData.configuration.eCommerceData.product,this.categories=this.pdpData.configuration.eCommerceData.categories,await this.render()}async render(){const e=this.product,{campaign:t,copywriting:n,layout:i}=this.props,{levels:s}=n,{levels_acidity_label:r,levels_bitterness_label:o,levels_roastiness_label:a,levels_acidity_info:l,levels_bitterness_info:d,levels_roastiness_info:u,level_list:p}=s,g={levels:p},h=e?.flavors?.map((e=>{const t=e.split("/")?.pop(),{name:n=""}=this.getCategory(e)||{};return{icon:w(t),label:n}}));h&&h.length>0&&(g.notes={heading:n.notes_title,items:h});const f=e?.cupSizes?.map((e=>{const t=e.match(/([^/]*)\/*$/)[1],{name:n="",capacityLabel:i=""}=this.getCategory(e)||{};return{icon:t,label:n,size:i}}));f&&f.length>0&&(g.sizes={heading:n.sizes_title,items:f}),g.details={heading:n.details_heading,text:this.renderDetailedDescIngredient(e.ingredients)},""!==n.description?g.description=function(e,t,n,i){let s=0;for(;e;){const r=e.indexOf(n,s);if(-1===r)break;const o=e.indexOf(i,r+1);if(-1===o)break;const a=e.substring(r+n.length,o);null!=t[a]?(e=e.substr(0,r)+t[a]+e.substr(o+i.length),s=r):s=o}return e}(n.description,{roasting:e.roastingDescription,origin:e.originDescription,aromatic:e.aromaticProfileDescription},"{","}"):g.description=`<p>${e.originDescription}</p><p>${e.aromaticProfileDescription}</p>`;c(this,{campaign:t,layout:i,copywriting:{...n,...g}},"nb-detailed-description",0);try{const s=await window.napi.catalog().getProduct(e.id),p=null==g.levels?0:g.levels.length,h=()=>{g.levels=null==g.levels?[]:g.levels};if(null!=s.capsuleProperties&&(null!=s.capsuleProperties.roastLevel&&(h(),g.levels.unshift({label:a,value:s.capsuleProperties.roastLevel,information:u})),null!=s.capsuleProperties.acidity&&(h(),g.levels.unshift({label:r,value:s.capsuleProperties.acidity,information:l})),null!=s.capsuleProperties.bitterness&&(h(),g.levels.unshift({label:o,value:s.capsuleProperties.bitterness,information:d})),p<g.levels.length)){c(this,{campaign:t,layout:i,copywriting:{...n,...g}},"nb-detailed-description",0)}}catch(t){console.log("PDP, error fetching product data SKU:",e.id,t)}}renderDetailedDescIngredient(e){let t=!1;return e.reduce(((e,n)=>{if("TITLE"===n.type.code)return t=!0,e+`<p><strong>${n.text}</strong>`;if("DESCRIPTION"===n.type.code){const i=`${t?"<br>":"<p>"}${n.text}</p>`;return t=!1,e+i}}),"")+(t?"</p>":"")}getCategory(e){return this.categories.find((t=>t.id===e))}}customElements.get("nb-pdp-detailed-description")||customElements.define("nb-pdp-detailed-description",_);export{_ as default};
