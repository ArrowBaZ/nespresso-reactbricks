const e=e=>null==e;window.gtmDataObject=window.gtmDataObject||[];const t="intensity",n="type",i="color",s="price",r={lightMax:5,mildMin:6,mildMax:8,intenseMin:9};let l;function o(){window.dispatchEvent(y("filteredProductDisplay")),function(e){const t=function(){let e=[];const t=k();for(const n in t)try{e.push(n+":"+t[n].join(","))}catch(e){}return e.join("|")}();if(!e&&""===t)return;n={eventAction:"PLP Filter click",eventLabel:["sort:recommended",t].join("|")},window.gtmDataObject.push({event:"customEvent",eventRaisedBy:"Web component",eventCategory:"User Engagement",eventAction:"Click",eventLabel:"",nonInteraction:0,...n});var n}()}function c(){return function(e){const t=document.querySelector("nb-plp-filter");if(null===t)return;const{filter_group_intensity_light_max_label:n,filter_group_intensity_mild_min_label:i,filter_group_intensity_mild_max_label:s,filter_group_intensity_intense_min_label:l}=t.getAttribute("data-response")?JSON.parse(t.getAttribute("data-response")):r;return[[e[0],n],[i,s],[l,e[1]]]}([undefined.intensity[0],undefined.intensity[undefined.intensity.length-1]])}const a={[t]:new Set,cupsize:new Set,aromatic:new Set,[i]:new Set,price:new Set,collection:new Set,type:new Set};function u(e,n,s){return n===t||n===i||"price"===n?s:e.find((e=>e.id===s))}const d={};function p(e,t){return!!(d[e]&&d[e][t]&&d[e][t].enabled)}function h(e,t){return e===i?t.name:t}function f(){const e=function(){const e=JSON.parse(JSON.stringify(void 0));for(const t in e){const n={};for(const i of e[t])n[h(t,i)]=!1;e[t]=n}return e}(),t=function(e){const t={};for(const n in e)t[n]=b(n);return t}(e);l.length>0?l.forEach((n=>{Object.entries(undefined).forEach((([i,s])=>{s.forEach((s=>{const r=m(i,s,!0)(n),l=h(i,s);e[i][l]=e[i][l]||(t[i],r)}))}))})):Object.entries(undefined).forEach((([n,i])=>{i.forEach((i=>e[n][h(n,i)]=t[n]))}));for(const t in e)for(const n in e[t])e[t][n]!==undefined[t][n].get()&&undefined[t][n].update(e[t][n])}function b(e){return Object.values(undefined[e]).some((e=>e.get()))}function g(e,t,n=null){e===i&&"string"==typeof t&&(t=undefined.color.find((e=>e.name===t)));const s=m(e,t,!0);null==n&&(n=!s.enabled),n?(a[e].add(s),s.enabled=!0):(a[e].delete(s),s.enabled=!1)}function m(e,r,l=!1){const o=h(e,r);return null!=d[e]&&null!=d[e][o]?d[e][o]:(null==d[e]&&(d[e]={}),d[e][o]=o=>function(e,n,s){switch(e){case t:return e=>e===n||0===e&&!s;case"cupsize":return e=>e.some((e=>new RegExp(n+"$","g").test(e)));case"aromatic":return e=>e.some((e=>new RegExp(n+"$","g").test(e)));case i:return e=>e.some((e=>e.name===n.name));case"price":return e=>e===n;case"collection":return e=>e.some((e=>new RegExp(n+"$","g").test(e)));case"type":return e=>e.some((e=>new RegExp(n+"$","g").test(e)))}}(e,r,l)(function(e,r){switch(r){case t:return e.intensity;case"cupsize":return e.cupSizes;case"aromatic":return e.flavors;case i:return e.colors;case s:return e.price;case"collection":return e.collections;case n:return e.types}}(o,e)))}function y(e){let t;return"function"==typeof Event?t=new Event(e):(t=document.createEvent("Event"),t.initEvent(e,!0,!0)),t}function v(e=!0){l=undefined.filter((e=>Object.values(a).every((t=>function(e,t){return 0===t.size||Array.from(t).some((t=>t(e)))}(e,t))))),function(){for(const e in void 0)for(const t in(void 0)[e]){const n=p(e,t);(void 0)[e][t].get()!==n&&(void 0)[e][t].update(n)}}(),f(),e&&new URLSearchParams(k()).toString(),window.filteredProducts=l.length===undefined.length?null:l,window.dispatchEvent(y("filteredProductUpdate"))}function k(){const e={};for(const n in undefined){const s=[];for(const e in undefined[n])p(n,e)&&s.push(n!==t&&n!==i?u(undefined,n,e).name:e);s.length>0&&(e[n]=s)}return e}const C={"productlistrespblock.filterlabels.intensity.chip.light":"Light {range}","productlistrespblock.filterlabels.intensity.chip.medium":"Mild {range}","productlistrespblock.filterlabels.intensity.chip.intense":"Intense {range}"};class _ extends HTMLElement{constructor(){super(),this.props={},this.chipListeners=[]}connectedCallback(){this.props=(t=>{const n=(e=>e.find((e=>"data"===e.nodeName)))([...t]),i=[...t].filter((e=>"data"!==e.nodeName)).reduce(((e,t)=>({...e,[t.nodeName]:t.nodeValue})),{});if(e(n))return i;try{return{...i,...JSON.parse(n.nodeValue)}}catch(e){console.log("ERROR: No data",e)}})(this.attributes),this.boundOnFilterUpdate=this.onFilterUpdate.bind(this),window.addEventListener("filteredProductDisplay",this.boundOnFilterUpdate);const{filter_group_intensity_light:t,filter_group_intensity_medium:n,filter_group_intensity_intense:i}=this.props;C["productlistrespblock.filterlabels.intensity.chip.light"]=t,C["productlistrespblock.filterlabels.intensity.chip.medium"]=n,C["productlistrespblock.filterlabels.intensity.chip.intense"]=i,this.render()}onFilterUpdate(){this.clearChipListeners(),this.render()}clearChipListeners(){this.chipListeners.forEach((e=>{e.element.removeEventListener("click",e.listener)})),this.chipListeners.length=0}getFilterName(e,n){if(e===t){const e=["light","medium","intense"],t=c(),i=t.findIndex((e=>e[0]===n[0]&&e[1]===n[1]));return function(e,t,n,i){let s=0;for(;e;){const r=e.indexOf(n,s);if(-1===r)break;const l=e.indexOf(i,r+1);if(-1===l)break;const o=e.substring(r+n.length,l);null!=t[o]?(e=e.substr(0,r)+t[o]+e.substr(l+i.length),s=r):s=l}return e}(C["productlistrespblock.filterlabels.intensity.chip."+e[i]],{range:t[i].join("-")},"{","}")}return undefined[e][n].name}getChipId(e,t){return`nb-plp-filter-results-chip-${e+t}`}filterActive(e){const t=[];for(let n=e[0];n<=e[1];n++)t.push(n);return t.some((e=>undefined.intensity[e]))}render(){const{label:e,label_reset:r,a11y_label_reset:o,label_results:c,label_results_zero:a,label_results_one:u,a11y_label_results:d}=this.props;this.innerHTML=`\n            ${e&&`<p class="t-sm-400-sl">${e}</p>`}\n            \x3c!-- TODO : loop on activated chips / here 2 elements to test --\x3e\n            ${this.renderActiveFilters()}\x3c!--\n            --\x3e<nb-link\n                id="nb-plp-filter-results-reset-all"\n                size="small"\n                color="black"\n                aria-label="${o}">${r}</nb-link>\n            \x3c!-- TODO : need to debug accessibility on this component, for a11y_label_reset and the rest --\x3e\n            \x3c!-- TODO : bind number of results --\x3e\n            ${this.renderResultsLabel(l,c,a,u,d)}\n        `,this.boundOnIntensityClick=this.onIntensityClick.bind(this),this.boundOnSizeClick=this.onSizeClick.bind(this),this.boundOnAromaticClick=this.onAromaticClick.bind(this),this.boundOnColorClick=this.onColorClick.bind(this),this.boundOnPriceClick=this.onPriceClick.bind(this),this.boundOnCollectionClick=this.onCollectionClick.bind(this),this.boundOnTypeClick=this.onTypeClick.bind(this),this.clickMap={[t]:this.boundOnIntensityClick,cupsize:this.boundOnSizeClick,aromatic:this.boundOnAromaticClick,[i]:this.boundOnColorClick,[s]:this.boundOnPriceClick,collection:this.boundOnCollectionClick,[n]:this.boundOnTypeClick},this.prepareActiveFiltersChips(),this.resetAllButton=document.getElementById("nb-plp-filter-results-reset-all"),this.boundOnResetAll=this.onResetAll.bind(this),this.resetAllButton.addEventListener("click",this.boundOnResetAll)}renderActiveFilters(){return""}renderActiveFiltersIntensity(e,t){const{a11y_label_button:n}=this.props;return`<nb-cta\n                    id="${this.getChipId(e[0],t[0])}"\n                    icon_right="close-2"\n                    variation="secondary"\n                    aria_label_after="${n}">\n                    ${this.getFilterName(e[0],t[0])}\n                </nb-cta>`}renderActiveFiltersIntensityRange(e,n){const{a11y_label_button:i}=this.props;return`<nb-cta\n                    id="${this.getChipId(t,n.join("-"))}"\n                    icon_right="close"\n                    variation="secondary"\n                    aria_label_after="${i}">\n                    ${this.getFilterName(t,n)}\n                </nb-cta>`}prepareActiveFiltersChips(){}createIntensityChip(e,t){const n=document.getElementById(this.getChipId(e[0],t[0]));n&&(n.addEventListener("click",this.clickMap[e[0]]),this.chipListeners.push({element:n,listener:this.clickMap[e[0]]}),n.setAttribute("value",t[0]))}createIntensityChipRange(e){const n=document.getElementById(this.getChipId(t,e.join("-")));n&&(n.addEventListener("click",this.clickMap.intensity),this.chipListeners.push({element:n,listener:this.clickMap.intensity}),n.setAttribute("value",e.join("-")))}getIntRange(e){const t=[],n=e.split("-");for(let e=parseInt(n[0]);e<=n[1];e++)t.push(e);return t}onIntensityClick(e){let n=e.currentTarget.getAttribute("value");-1!==n.indexOf("-")&&(n=this.getIntRange(n)),function(e,n){Array.isArray(e)?e.filter((e=>(void 0).intensity)).forEach((e=>g(t,e,n))):g(t,e,n),v()}(n,!1),o()}onSizeClick(e){!function(e,t){g("cupsize",e,t),v()}(e.currentTarget.getAttribute("value"),!1),o()}onAromaticClick(e){!function(e,t){g("aromatic",e,t),v()}(e.currentTarget.getAttribute("value"),!1),o()}onColorClick(e){!function(e,t){const n=(void 0).color.find((t=>t.name===e));null!=n&&(g(i,n,t),v())}(e.currentTarget.getAttribute("value"),!1),o()}onPriceClick(e){!function(e,t){g("price",e,t),v()}(e.currentTarget.getAttribute("value"),!1),o()}onCollectionClick(e){!function(e,t){g("collection",e,t),v()}(e.currentTarget.getAttribute("value"),!1),o()}onTypeClick(e){!function(e,t){g("type",e,t),v()}(e.currentTarget.getAttribute("value"),!1),o()}onResetAll(){!function(){for(const e in a)for(const t of a[e].values())a[e].delete(t),t.enabled=!1;v()}(),o()}renderResultsLabel(e,t,n,i,s){let r;return r=e&&0!==e.length?1===e.length?i:t:n,t?`<p class="t-xs-700-caps-sl"><span class="sr-only">${s}</span> <span>${e?e.length:0}</span> ${r}:</p>`:""}disconnectedCallback(){this.clearChipListeners(),window.removeEventListener("filteredProductDisplay",this.boundOnFilterUpdate),this.resetAllButton&&this.resetAllButton.removeEventListener("click",this.boundOnResetAll)}}customElements.get("nb-plp-filter-results")||customElements.define("nb-plp-filter-results",_);export{_ as default};
